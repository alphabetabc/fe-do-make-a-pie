var criticalValue=2;const defaultCategory=["李志强","赵冬","高鼎"];var graph={nodes:[{name:"李志强",category:"确诊",symbolSize:30,value:["确诊"],color:"#F10F0F"},{name:"张亮",category:"密接",symbolSize:30,value:["密接"],color:"#FFC001"},{name:"王飞",category:"王飞",symbolSize:30,value:["次密接"],color:"#1D84C6"},{name:"王丽",category:"王丽",symbolSize:30,value:["密接"],color:"#FFC001"},{name:"符华",category:"符华",symbolSize:30,value:["次密接"],color:"#1D84C6"},{name:"钱峰",category:"钱峰",symbolSize:30,value:["次密接"],color:"#1D84C6"},{name:"赵冬",category:"赵冬",symbolSize:30,value:["确诊"],color:"#F10F0F"},{name:"吴梦",category:"吴梦",symbolSize:30,color:"#1D84C6",value:["次密接"]},{name:"杨月",category:"杨月",symbolSize:30,color:"#1D84C6",value:["次密接"]},{name:"周清",category:"周清",symbolSize:30,color:"#1D84C6",value:["次密接"]},{name:"张枫",category:"张枫",symbolSize:30,color:"#FFC001",value:["密接"]},{name:"化辰",category:"化辰",symbolSize:30,color:"#FFC001",value:["密接"]},{name:"彭帅",category:"彭帅",symbolSize:30,color:"#FFC001",value:["密接"]},{name:"高鼎",category:"课程",symbolSize:30,color:"#F10F0F"},{name:"章艺",category:"章艺",symbolSize:30,color:"#1D84C6",value:["次密接"]},{name:"连亮",category:"连亮",symbolSize:30,color:"#1D84C6",value:["次密接"]},{name:"化月",category:"化月",symbolSize:30,color:"#FFC001",value:["密接"]},{name:"马可",category:"马可",symbolSize:30,color:"#FFC001",value:["密接"]}],links:[{source:"李志强",target:"张亮",reason:"聚餐"},{source:"张亮",target:"王飞",reason:"出现在同一场所"},{source:"李志强",target:"王丽",reason:"出现在同一场所"},{source:"王丽",target:"钱峰",reason:"聚餐"},{source:"王丽",target:"符华",reason:"家庭聚集"},{source:"赵冬",target:"张枫",reason:"家庭聚集"},{source:"张枫",target:"吴梦",reason:"出现在同一场所"},{source:"张枫",target:"杨月",reason:"聚会"},{source:"彭帅",target:"周清",reason:"聚会"},{source:"赵冬",target:"化辰",reason:"出现在同一场所"},{source:"赵冬",target:"彭帅",reason:"出现在同一场所"},{source:"高鼎",target:"化月",reason:"出现在同一场所"},{source:"高鼎",target:"马可",reason:"聚会"},{source:"马可",target:"章艺",reason:"出现在同一场所"},{source:"马可",target:"连亮",reason:"出现在同一场所"}]};const currentGraph={nodes:{},links:{}};defaultCategory.length<criticalValue&&(currentGraph.links=graph.links);const nodeMap={};function init(){for(let e=0;e<graph.nodes.length;e++)if(defaultCategory.length>criticalValue)for(let o=0;o<defaultCategory.length;o++)graph.nodes[e].name===defaultCategory[o]&&(currentGraph.nodes[graph.nodes[e].name]=graph.nodes[e]),nodeMap[graph.nodes[e].name]=graph.nodes[e],nodeMap[graph.nodes[e].name].links={},nodeMap[graph.nodes[e].name].nodes={},nodeMap[graph.nodes[e].name].hasAppend=!1;else currentGraph.nodes[graph.nodes[e].name]=graph.nodes[e],nodeMap[graph.nodes[e].name]=graph.nodes[e],nodeMap[graph.nodes[e].name].links={},nodeMap[graph.nodes[e].name].nodes={},nodeMap[graph.nodes[e].name].hasAppend=!0;for(let e=0;e<graph.links.length;e++){let o=graph.links[e];nodeMap[o.source]!==void 0&&nodeMap[o.target]!==void 0&&(nodeMap[o.source].links[o.target]=o,nodeMap[o.source].nodes[nodeMap[o.target].name]=nodeMap[o.target])}for(let e=0;e<graph.nodes.length;e++)graph.nodes[e].itemStyle={color:graph.nodes[e].color},graph.nodes[e].label={normal:{show:graph.nodes[e].symbolSize>15}};redrawGraph()}function append(e){let o=nodeMap[e];o.hasAppend===!0||Object.keys(o.nodes).length===0||Object.keys(o.links).length===0||(Object.values(o.nodes).forEach(n=>{n.symbolSize=40,currentGraph.nodes[n.name]=n}),Object.values(o.links).forEach(n=>{currentGraph.links[n.source+"_"+n.target]=n}),o.hasAppend=!0,redrawGraph())}function remove(e){let o=nodeMap[e];Object.values(o.nodes).forEach(n=>{delete currentGraph.nodes[n.name],n.hasAppend===!0&&Object.keys(n.nodes).length>0&&remove(n.name)}),Object.values(o.links).forEach(n=>{delete currentGraph.links[n.source+"_"+n.target]}),o.hasAppend=!1,redrawGraph()}function redrawGraph(){option.series[0].data=Object.values(currentGraph.nodes),option.series[0].links=Object.values(currentGraph.links),console.log(option),myChart.setOption(option)}option={backgroundColor:"#000",tooltip:{formatter:function(e){return e.data.reason}},legend:[],animation:!1,series:[{type:"graph",layout:"force",data:Object.values(currentGraph.nodes),links:Object.values(currentGraph.links),roam:!0,focusNodeAdjacency:!1,label:{formatter:"{b}",textStyle:{color:"#ffffff"}},edgeSymbol:["circle","arrow"],lineStyle:{color:"rgba(255,255,255,0.6)",opacity:1,curveness:.3},force:{layoutAnimation:!1,repulsion:100}}]},init(),myChart.on("click",function(e){if(e.dataType==="node"){const o=nodeMap[e.data.name];o.hasAppend===!0?(option.series[0].force.repulsion=100,currentGraph.nodes[e.data.name].symbolSize=30,remove(o.name)):(option.series[0].force.repulsion=320,currentGraph.nodes[e.data.name].symbolSize=40,append(o.name))}});
