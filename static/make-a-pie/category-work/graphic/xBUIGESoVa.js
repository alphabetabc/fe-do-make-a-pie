var bgPatternImg=new Image;bgPatternImg.setAttribute("crossOrigin","Anonymous"),bgPatternImg.src="http://image.91chep.com/3b731aac1f9441c7b505c7c7357e2e43680_680.jpg";let pointList=[{name:"测点1",position:[250,10],color:"green",items:[{name:"沉降",value:132},{name:"温度",value:12}]},{name:"测点2",position:[323,36],color:"green",items:[{name:"沉降",value:132}]},{name:"测点3",position:[360,50],color:"green",items:[{name:"沉降测点3测点3测点3测点3测",value:132},{name:"温度",value:12}]},{name:"测点4",position:[300,150],color:"skyblue",items:[{name:"沉降",value:132},{name:"温度",value:12}]},{name:"测点5",position:[440,150],color:"skyblue",items:[{name:"沉降",value:132},{name:"温度",value:12}]},{name:"测点6",position:[480,150],color:"skyblue",items:[{name:"沉降",value:132},{name:"温度",value:12}]},{name:"测点7",position:[480,80],color:"red",items:[{name:"沉降",value:132},{name:"温度",value:12}]}],lineList=[{name:"测线1",nodes:[{name:"测点1"},{name:"测点2"},{name:"测点3"}]},{name:"测线2",nodes:[{name:"测点4"},{name:"测点5"},{name:"测点6"}]}];option={graphic:[{id:"toolPan",type:"rect",z:2,position:[200,0],invisible:!0,style:{fill:"#ccc"},cursor:"all-scroll",shape:{height:300,width:600},onmousedown:dragPanStart(),onmouseup:dragPanEnd(),onmousemove:dragPan(),onmouseout:dragPanEnd(),onmousewheel:groupCanZoom("group1","toolPan"),onclick:i=>{panPosition=myChart.getOption().graphic[0].elements[0].position,console.log(panPosition)}},{type:"group",id:"group1",scale:[1,1],position:[0,0],children:[{type:"image",id:"bg",position:[200,0],z:1,style:{image:bgPatternImg},shape:{height:300,width:600}},{type:"group",id:"tooltip",ignore:!0,children:[{type:"rect",id:"tooltip-bg",z:100,left:"center",shape:{width:190,height:90},style:{fill:"rgba(22,50,79,0.7)",stroke:"#555",lineWidth:0,shadowBlur:8,shadowOffsetX:0,shadowOffsetY:2,shadowColor:"rgba(0,0,0,0.15)"}},{type:"text",id:"t-text",z:100,left:"center",top:10,style:{fill:"#fff",textAlign:"center",text:"横轴表示温度，单位是°C",font:"400 14px Microsoft YaHei"}},{type:"text",id:"t-text0",z:100,left:"center",top:10,style:{fill:"#fff",textAlign:"center",text:"横轴表示温度，单位是°C",font:"400 14px Microsoft YaHei"}},{type:"text",id:"t-text1",z:100,left:"center",top:30,style:{fill:"#fff",textAlign:"center",text:"，单位是°C",font:"400 14px Microsoft YaHei"}}]}]},{id:"legend",type:"group",children:[{id:"legend-bg",type:"rect",z:66,cursor:"default",shape:{width:200,height:300},style:{fill:"yellow"}}]}]};let isDrag,dragOrigin,panPosition=[0,0];function dragPanStart(){return i=>{isDrag=!0,dragOrigin=[i.offsetX,i.offsetY],panPosition=myChart.getOption().graphic[0].elements[0].position}}let pointListCopy;function dragPan(){return i=>{if(!isDrag)return;const t=[i.offsetX,i.offsetY],e=vecSub(t,dragOrigin);pointListCopy=JSON.parse(JSON.stringify(pointList)),pointListCopy.forEach(n=>{n.position=vecAdd(n.position,e)}),updatePoints(pointListCopy),drawLine(lineList,pointListCopy),myChart.setOption({graphic:[{id:"toolPan",$action:"merge",position:vecAdd(e,panPosition)},{id:"bg",$action:"merge",position:vecAdd(e,panPosition)}]})}}function dragPanEnd(){return i=>{isDrag=!1,dragOrigin=void 0,pointListCopy&&(pointList=pointListCopy,panPosition=myChart.getOption().graphic[0].elements[0].position)}}let curScale=1;function groupCanZoom(i,t){return e=>{let n=[e.offsetX,e.offsetY];const r=.5,o=5,s=1.25,a=e.wheelDelta>0;if(scale=a?s:1/s,curScale*scale<r||curScale*scale>o)return;curScale=curScale*scale,pointList.forEach(l=>{const g=vecSub(l.position,n),d=vecScale(g,scale);l.position=vecAdd(d,n)}),updatePoints(pointList),drawLine(lineList,pointList),panPosition=myChart.getOption().graphic[0].elements[0].position;const p=vecSub(panPosition,n),c=vecScale(p,scale);panPosition=vecAdd(c,n),myChart.setOption({graphic:[{id:"bg",$action:"merge",scale:[curScale,curScale],shape:{height:300*curScale,width:600*curScale},position:panPosition},{id:"toolPan",$action:"merge",shape:{height:300*curScale,width:600*curScale},position:panPosition}]})}}function drawPoint(i){const t=[];i.forEach(e=>{const n={id:e.name,name:e.name,type:"circle",items:e.items,position:e.position,draggable:!0,z:3,style:{fill:e.color||"black"},shape:{r:10},ondrag:onDragPoint(lineList,pointList),onclick:onPointClick(),onmouseover:showTooltip(),onmousemove:showTooltip(),onmouseout:hideTooltip()};t.push(n)}),myChart.setOption({graphic:[{id:"group1",type:"group",$action:"merge",children:t}]})}function updatePoints(i){const t=[];i.forEach(e=>{t.push({id:e.name,$action:"merge",position:e.position})}),myChart.setOption({graphic:t})}function drawLine(i,t){const e=[];i.forEach(n=>{const r=[];n.nodes.forEach(s=>{t.forEach(a=>{s.name===a.name&&r.push(a.position)})});const o={id:n.name,type:"polyline",z:2,style:{stroke:"#838A9D",lineWidth:2},shape:{points:r},onclick:onClickLine()};e.push(o)}),myChart.setOption({graphic:[{id:"group1",type:"group",$action:"merge",children:e}]})}function onDragPoint(i,t){return e=>{const n=e.target.__ecGraphicId,r=[e.offsetX,e.offsetY];pointList.forEach(s=>{s.name===n&&(s.position=r)});const o=i.filter(s=>{if(s.nodes.filter(a=>a.name===n).length)return!0});updatePoints(pointList),drawLine(o,pointList)}}let lastClickedPoint="";function onPointClick(){return magnifyScale=1.2,i=>{const t=i.target,e=t.__ecGraphicId,n=t.scale[0],r=t.style.fill,o=n===magnifyScale?1:magnifyScale;optList=[{id:e,$action:"merge",scale:[o,o],style:{shadowBlur:n===magnifyScale?0:4,shadowColor:r}}],lastClickedPoint&&lastClickedPoint!==e&&(optList.push({id:lastClickedPoint,$action:"merge",scale:[1,1],style:{shadowBlur:0}}),lastClickedPoint=""),myChart.setOption({graphic:optList}),lastClickedPoint=e}}lastClickedLine="";function onClickLine(){return magnifyWidth=4.5,i=>{const t=i.target,e=t.__ecGraphicId,n=t.style.lineWidth;optList=[{id:e,$action:"merge",style:{lineWidth:n===magnifyWidth?2:magnifyWidth}}],lastClickedLine&&lastClickedLine!==e&&(optList.push({id:lastClickedLine,$action:"merge",style:{lineWidth:2}}),lastClickedLine=""),myChart.setOption({graphic:optList}),lastClickedLine=e}}function showTooltip(){return i=>{const t=i.target;let e=0;t.items.forEach(c=>{const l=c.name+c.value;e=l.length>e?l.length:e});const n=e*14+20,r=t.items?t.items.length*20+40:40,o=t.position;let s,a;o[0]<n+10?s=o[0]+n/2+10:s=o[0]-n/2-10,o[1]<r+10?a=o[1]+10:a=o[1]-r-10;const p=[{type:"text",id:"t-text",$action:"merge",top:10,style:{text:t.name}}];t.items.forEach((c,l)=>{textOpt={type:"text",id:"t-text"+l,$action:"merge",top:10+(l+1)*20,style:{fill:"#fff",textAlign:"center",text:c.name+": "+c.value,font:"400 14px Microsoft YaHei"}},p.push(textOpt)}),myChart.setOption({graphic:[{id:"t-text",$action:"merge",style:{text:""}},{id:"t-text0",$action:"merge",style:{text:""}},{id:"t-text1",$action:"merge",style:{text:""}}]}),myChart.setOption({graphic:[{id:"tooltip",ignore:!1,$action:"merge",position:[s,a]},{id:"tooltip-bg",$action:"merge",shape:{height:r,width:n}},...p]})}}function hideTooltip(){return i=>{myChart.setOption({graphic:{id:"tooltip",ignore:!0,$action:"merge"}})}}function vecAdd(i,t){if(!(i.length<2||t.length<2))return[i[0]+t[0],i[1]+t[1]]}function vecSub(i,t){if(!(i.length<2||t.length<2))return[i[0]-t[0],i[1]-t[1]]}function vecScale(i,t){if(!(i.length<2))return[i[0]*t,i[1]*t]}function vecNegate(i){if(!(i.length<2))return[-i[0],-i[1]]}function drawLegend(){const i=pointList.map((t,e)=>({id:"legend"+e,type:"group",position:[10,25*e],children:[{id:"legend"+e+"-pan",pId:t.name,legendId:"legend"+e,color:t.color,type:"rect",z:67,position:[0,0],invisible:!0,shape:{height:20,width:100},onclick:onLegendClick()},{id:"legend"+e+"-c",type:"circle",position:[10,10],z:66,silent:!0,style:{fill:t.color},shape:{r:10}},{id:"legend"+e+"-t",type:"text",position:[30,5],z:66,silent:!0,style:{text:t.name,font:'bolder 14px "Microsoft YaHei", sans-serif',fill:t.color}}]}));myChart.setOption({graphic:[{id:"legend",type:"group",$action:"merge",children:i}]})}function onLegendClick(){return i=>{const t=i.target,e=t.pId,n=t.legendId;t.isHide?(myChart.setOption({graphic:[{id:n+"-c",style:{fill:t.color}},{id:n+"-t",style:{fill:t.color}},{id:e,ignore:!1}]}),t.isHide=!1):(myChart.setOption({graphic:[{id:n+"-c",style:{fill:"rgba(230,233,239,1)"}},{id:n+"-t",style:{fill:"rgba(230,233,239,1)"}},{id:e,ignore:!0}]}),t.isHide=!0)}}setTimeout(function(){drawPoint(pointList),drawLine(lineList,pointList),drawLegend()},100);
