$('<div class="back">返回</div>').appendTo($("#chart-panel")),$(".back").css({position:"absolute",left:"17px",top:"25px",color:"rgb(222,222,222)","font-size":"15px",cursor:"pointer","z-index":"100"}),$(".back").click(function(){parentInfo.length!==1&&(parentInfo.pop(),getGeoJson(parentInfo[parentInfo.length-1].code))});var parentJson=null,parentInfo=[{cityName:"全国",level:"china",code:0}];getGeoJson(1e5);function getGeoJson(a){AMapUI.loadUI(["geo/DistrictExplorer"],o=>{var l=new o;l.loadAreaNode(a,function(e,t){if(e){console.error(e);return}let r=t.getSubFeatures();if(r.length>0)parentJson=r;else if(r.length===0&&(r=parentJson.filter(n=>{if(n.properties.adcode==a)return n}),r.length===0))return;getMapData(r)})})}function getMapData(a){let o=a.map(t=>({name:t.properties.name,value:Math.random()*10,level:t.properties.level,cityCode:t.properties.adcode})),l=a.map(t=>({name:t.properties.name,value:["118.83531246","32.0267395887",Math.random()*1e3],cityCode:t.properties.adcode})),e={};e.features=a,initEcharts(o,l,e)}function initEcharts(a,o,l){echarts.registerMap("Map",l),myChart.setOption({backgroundColor:"rgb(20,28,52)",tooltip:{trigger:"item",formatter:e=>{let t=e.value;return window.isNaN(t)&&(t=0),e.name+"<br><hr>数值 : "+t.toFixed(2)}},title:{show:!0,x:"center",y:"top",textStyle:{color:"#fff",fontSize:16}},toolbox:{feature:{dataView:{show:!1,readOnly:!0},magicType:{show:!1,type:["line","bar"]},restore:{show:!1},saveAsImage:{show:!0,name:parentInfo[parentInfo.length-1].cityName+"地图",pixelRatio:2}},iconStyle:{normal:{borderColor:"#41A7DE"}},itemSize:15,top:20,right:22},visualMap:{type:"piecewise",pieces:[{max:30,label:"安全",color:"#2c9a42"},{min:30,max:60,label:"警告",color:"#d08a00"},{min:60,label:"危险",color:"#c23c33"}],color:"#fff",textStyle:{color:"#fff"},visibility:"off"},series:[{name:"地图",type:"map",map:"Map",roam:!0,zoom:1.1,data:a,itemStyle:{normal:{show:!0,areaColor:"#2E98CA",borderColor:"rgb(185, 220, 227)",borderWidth:"1"}},label:{normal:{show:!0,textStyle:{color:"rgb(249, 249, 249)",fontSize:12},formatter:e=>{let t=e.value;switch(window.isNaN(t)&&(t=0),e.name){case"内蒙古自治区":e.name="内蒙古";break;case"西藏自治区":e.name="西藏";break;case"新疆维吾尔自治区":e.name="新疆";break;case"宁夏回族自治区":e.name="宁夏";break;case"广西壮族自治区":e.name="广西";break;case"香港特别行政区":e.name="香港";break;case"澳门特别行政区":e.name="澳门";break;default:}return e.name==="内蒙古自治区"&&(e.name="内蒙古"),e.name}},emphasis:{show:!0,textStyle:{color:"#000"}}}},{name:"散点",type:"effectScatter",coordinateSystem:"geo",rippleEffect:{brushType:"fill"},itemStyle:{normal:{color:"#F4E925",shadowBlur:10,shadowColor:"#333"}},data:o,symbolSize:8,showEffectOn:"render"}]},!0),myChart.off("click"),myChart.on("click",echartsMapClick)}function echartsMapClick(a){if(console.log("=========params==========="),console.log(a),console.log("=========params==========="),parentInfo[parentInfo.length-1].code==a.data.cityCode)return;let o=a.data;parentInfo.push({cityName:o.name,level:o.level,code:o.cityCode}),getGeoJson(o.cityCode)}
