for(var yourdata=[],dep=[-65.17,-66.35,-71.54,-69.94,-77.82,-87.15,-96.63,-103.23,-119,-111.16,-124.77,-134.47,-137.01,-150.38],fcs=[97.43,105.72,108.44,109.06,123.54,133.95,146.27,140.12,163.79,166.96,165.11,185.32,192.77,200.13],xaxisdata=["2001_fcs","2001_dep","2002_fcs","2002_dep","2001_fcs","2001_dep","2002_fcs","2002_dep","2001_fcs","2001_dep","2002_fcs","2002_dep","2001_fcs","2001_dep","2002_fcs","2002_dep","2001_fcs","2001_dep","2002_fcs","2002_dep","2001_fcs","2001_dep","2002_fcs","2002_dep","2001_fcs","2001_dep","2002_fcs","2002_dep"],timeinterval=300,yesorno=!0,i=0;i<dep.length;i++)yourdata.push(Math.round(fcs[i],0)),yourdata.push(Math.round(dep[i],0));console.log(yourdata),console.log(xaxisdata);function maxsum(a){for(var e=0,t=[],r=0;r<a.length;r++)e=e+a[r],t.push(e);return Math.max.apply(null,t)}function getymax(){var a=maxsum(yourdata),e=Math.floor(Math.log10(a))-1,t=Math.ceil(a/Math.pow(10,e))*Math.pow(10,e);return t}function mean(a,e){for(var t=0,r=0,s=0,n=0,o=0;o<a.length;o++)a[o]>0?(t+=1,s+=a[o]):(r+=1,n+=a[o]);return e==0?Math.round(s/t):Math.round(Math.abs(n/r))}for(var ymax=getymax(),updata=[],downdata=[],auxdata=[],sum=0,i=0;i<yourdata.length;i++)auxdata.push(sum),yourdata[i]>0?(updata.push(yourdata[i]),downdata.push("-")):(updata.push("-"),downdata.push(Math.abs(yourdata[i]))),sum=sum+yourdata[i];auxdata.slice(0,yourdata.length-1),option={title:[{text:"阶梯瀑布图",subtext:"修改自官网by小白高"}],toolbox:{feature:{magicType:{type:["line","bar"]},saveAsImage:{show:!0}}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){var e;return a[1].value!="-"?e=a[1]:e=a[2],e.name+"<br/>"+e.seriesName+" : "+e.value}},legend:{data:["支出","收入"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",splitLine:{show:!1},data:xaxisdata},yAxis:[{splitLine:{show:!1},type:"value",max:ymax},{type:"value",max:ymax,inverse:!0,show:!1}],series:[{name:"辅助",type:"bar",stack:"总量",itemStyle:{normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}},data:auxdata},{name:"收入",type:"bar",stack:"总量",label:{normal:{show:yesorno,fontSize:10,position:"top"}},data:updata,animationDelay:function(a){return a*timeinterval}},{name:"支出",type:"bar",yAxisIndex:1,stack:"总量",label:{normal:{fontSize:10,show:yesorno,position:"bottom"}},data:downdata,animationDelay:function(a){return a*timeinterval}}],animationEasing:"elasticOut",animationDelayUpdate:function(a){return a*5}};
