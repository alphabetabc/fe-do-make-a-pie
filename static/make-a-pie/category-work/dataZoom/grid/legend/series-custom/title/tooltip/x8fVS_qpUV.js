var categories=["项目1","项目2","项目3","项目4","项目5","项目6"],dayTime=864e5,nowDate=new Date,nowDateStr=formatDate(nowDate);function formatDate(t){var e=t.toLocaleDateString().split("/");return e[1].length<2&&e.splice(1,1,"0"+e[1]),e[2].length<2&&e.splice(2,1,"0"+e[2]),e.join("-")}var data=[{name:"项目1",value:[0,"2020-01-12","2020-01-28","2020-01-12"]},{name:"项目2",value:[1,"2020-01-25","2020-03-31","2020-01-28"]},{name:"项目3",value:[2,"2020-02-07","2020-04-30","2020-02-10"]},{name:"项目4",value:[3,"2020-04-01","2020-07-30",""]},{name:"项目5",value:[4,"2020-07-15","2020-11-01",""]},{name:"项目6",value:[5,"2020-11-01","2020-12-25",""]}];function renderItem(t,e){var l=e.value(0),a=e.coord([e.value(1),l]),i=e.coord([e.value(2),l]),o=e.size([0,1])[1]*.4,c=echarts.graphic.clipRectByRect({x:a[0],y:a[1],width:i[0]-a[0],height:o},{x:t.coordSys.x,y:t.coordSys.y,width:t.coordSys.width,height:t.coordSys.height}),r=null;if(e.value(3)!==""){var h=e.coord([e.value(3),l]),n,v=e.value(2)-e.value(1),s=+echarts.number.parseDate(e.value(3)),d=+echarts.number.parseDate(nowDateStr);if(d-s<=v)n=e.coord([d,l]);else{var y=s+v;n=e.coord([y,l])}r=echarts.graphic.clipRectByRect({x:h[0],y:h[1],width:n[0]-h[0],height:o},{x:t.coordSys.x,y:t.coordSys.y,width:t.coordSys.width,height:t.coordSys.height})}return r===null?c&&{type:"group",children:[{type:"rect",shape:c,style:e.style({fill:"#AACCF9"})}]}:c&&r&&{type:"group",children:[{type:"rect",shape:c,style:e.style({fill:"#AACCF9"})},{type:"rect",shape:r,style:e.style({fill:"#2076ED"})}]}}myChart.setOption({tooltip:{formatter:function(t){var e=t.value[1],l=t.value[2],a="",i="";t.value[3]&&(a=t.value[3],i="实际开始日期："+a+"<br/>");var o=+echarts.number.parseDate(t.value[2])-+echarts.number.parseDate(t.value[1]),c=o/dayTime,r,h="";if(a!==""){var n=+echarts.number.parseDate(nowDateStr)-+echarts.number.parseDate(t.value[3]);r=(n/o*100).toFixed(0),r>100&&(r=100),h="当前进度："+r+"%<br/>"}var v="",s="";if(r==100){var d=+echarts.number.parseDate(a)+o;v=echarts.format.formatTime("yyyy-MM-dd",d),s="实际结束日期："+v+"<br/>"}return t.name+"<br/>计划开始时间："+e+"<br/>计划结束时间："+l+"<br/>项目周期："+c+"天<br/>"+h+i+s}},title:{text:"项目进度",left:"center"},dataZoom:[{type:"slider",filterMode:"weakFilter",showDataShadow:!1,top:400,height:10,borderColor:"transparent",backgroundColor:"#e2e2e2",handleIcon:"M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",handleSize:20,handleStyle:{shadowBlur:6,shadowOffsetX:1,shadowOffsetY:2,shadowColor:"#aaa"},labelFormatter:""},{type:"inside",filterMode:"weakFilter"}],grid:{height:300},xAxis:{type:"time",min:1577808e6,max:1609344e6,axisLabel:{interval:0}},yAxis:{data:categories,axisTick:{alignWithLabel:!0}},legend:{left:"70%",top:10,data:["计划工期","实际工期"]},series:[{type:"custom",renderItem,name:"计划工期",itemStyle:{opacity:.8,color:"#AACCF9"},encode:{x:[1,2],y:0},data},{type:"custom",name:"实际工期",itemStyle:{opacity:.8,color:"#2076ED"}}]});
