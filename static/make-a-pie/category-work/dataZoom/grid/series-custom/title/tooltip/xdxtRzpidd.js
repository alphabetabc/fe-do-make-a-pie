let series=["故障","换模","换刀"],startTimeAll=new Date("2021-03-01 00:00:00").getTime(),endTimeAll=new Date("2021-03-04 00:00:00").getTime(),categories=["A","B","C"],seriesValue=[],jsonData=[{category:"A",series:"故障",startTime:"2021-03-01 08:00:00",endTime:"2021-03-01 18:00:00"},{category:"A",series:"换刀",startTime:"2021-03-01 18:00:00",endTime:"2021-03-02 14:00:00"},{category:"A",series:"换模",startTime:"2021-03-03 10:00:00",endTime:"2021-03-03 18:00:00"},{category:"B",series:"故障",startTime:"2021-03-01 08:00:00",endTime:"2021-03-01 13:00:00"},{category:"C",series:"故障",startTime:"2021-03-01 08:00:00",endTime:"2021-03-01 16:00:00"},{category:"C",series:"换模",startTime:"2021-03-02 04:00:00",endTime:"2021-03-02 19:00:00"}];function getXDate(e){let t=e.getFullYear(),a=parseInt(e.getMonth())+1,i=e.getDate(),n=e.getHours(),r=e.getMinutes(),s=e.getSeconds();return t+"-"+a+"-"+i+" "+n+":"+r+":"+s}echarts.util.each(categories,function(e,t){let a=categories[t];series.forEach((i,n)=>{jsonData.forEach((r,s)=>{if(r.category==a){let o=[],l=new Date(r.startTime).getTime(),c=new Date(r.endTime).getTime(),d=c-l;r.series==i&&(o.push({name:r.series,value:[t,l,c,d],itemStyle:{normal:{}}}),seriesValue.push({name:i,type:"custom",renderItem,itemStyle:{normal:{opacity:.8}},encode:{x:[1,2],y:0},data:o}))}})})});function renderItem(e,t){let a=t.value(0),i=t.coord([t.value(1),a]),n=t.coord([t.value(2),a]),r=t.size([0,1])[1]*.6,s=echarts.graphic.clipRectByRect({x:i[0],y:i[1]-r/2,width:n[0]-i[0],height:r},{x:e.coordSys.x,y:e.coordSys.y,width:e.coordSys.width,height:e.coordSys.height});return s&&{type:"rect",shape:s,style:t.style()}}option={legend:{type:"scroll",data:["故障","换模","换刀"],show:!0,orient:"vertical",align:"auto",top:"10%",right:"2%"},tooltip:{formatter:function(e){return e.marker+e.name+": "+e.value[3]/1e3/60/60+" h"}},title:{text:"报警时长",left:"center"},grid:{height:300},xAxis:[{min:startTimeAll,max:endTimeAll,interval:3600*24*1e3,axisLabel:{show:!0,formatter:function(e){let t=new Date(e);return getXDate(t)}}},{data:["2021-03-01","2021-03-02","2021-03-03"]}],yAxis:{data:categories,splitLine:{show:!0}},series:seriesValue};
