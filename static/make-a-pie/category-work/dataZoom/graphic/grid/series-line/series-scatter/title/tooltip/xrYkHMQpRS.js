var symbolSize=20,showControl=!0,data=[[0,0],[50,30],[120,180],[185,100],[250,150],[255,255]],easing="bounceOut",during=5e3,easingFuncs={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return .5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return t===0?0:Math.pow(1024,t-1)},exponentialOut:function(t){return t===1?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var i,n=.1,e=.4;return t===0?0:t===1?1:(!n||n<1?(n=1,i=e/4):i=e*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)))},elasticOut:function(t){var i,n=.1,e=.4;return t===0?0:t===1?1:(!n||n<1?(n=1,i=e/4):i=e*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/e)+1)},elasticInOut:function(t){var i,n=.1,e=.4;return t===0?0:t===1?1:(!n||n<1?(n=1,i=e/4):i=e*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?-.5*(n*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)):n*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)*.5+1)},backIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},backOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},backInOut:function(t){var i=2.5949095;return(t*=2)<1?.5*(t*t*((i+1)*t-i)):.5*((t-=2)*t*((i+1)*t+i)+2)},bounceIn:function(t){return 1-easingFuncs.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?easingFuncs.bounceIn(t*2)*.5:easingFuncs.bounceOut(t*2-1)*.5+.5}},smooth=100,animate={_i:0,_runTimes:1,_timer:null,_points:[],_easingFunc:null,_always:!0,disable:!1,_timeout:20,start(t=[],i="linear",n=2500,e=!0){this._t&&clearTimeout(this._t),this._t=setTimeout(()=>{const r=t.length-1;let o=Math.round(n/this._timeout);o>r&&(o=r),this._timer&&(clearTimeout(this._timer),this._timer=null),this._easingFunc=easingFuncs[i],this._runTimes=o,this._points=t,this._i=0,this._always=e,this.disable=!1,this._run(),console.log(this)},300)},_run(){if(this.disable)return;const t=this._easingFunc(this._i/this._runTimes),i=this._points,n=i.length-1;let e=i[0];if(t<0?e=[i[0][0]-10*t,i[1]-10*t]:t>1?e=[i[n][0]+10*t,i[n][1]+10*t]:e=i[Math.round(t*n)],myChart.setOption({graphic:[...echarts.util.map(data,function(r,o){return{type:"circle",position:myChart.convertToPixel("grid",r),shape:{cx:0,cy:0,r:symbolSize/2},invisible:!0,draggable:!0,ondrag:echarts.util.curry(onPointDragging,o),onmousemove:echarts.util.curry(showTooltip,o),onmouseout:echarts.util.curry(hideTooltip,o),onclick:echarts.util.curry(removePoint,o),z:100}}),{type:"rect",position:myChart.convertToPixel("grid",e),shape:{x:-symbolSize/2,y:-symbolSize/2,width:symbolSize,height:symbolSize},style:{fill:"green"},z:200}]}),this._i++,this._i>this._runTimes)if(this._always)this._i=0;else return;this._timer=setTimeout(()=>{this._run()},this._timout)},stop(){this.disable=!0,this._timer&&(clearTimeout(this._timer),this._timer=null)}};function bezier2(t,i,n,e){const r=e*e,o=1-e,c=o*(1-e);return t*c+2*i*e*o+n*r}function bezier3(t,i,n,e,r){const o=r*r,c=r*o,u=1-r,a=u*(1-r),y=a*(1-r);return t*y+3*i*r*a+3*n*o*u+e*c}function getMidPoint(t,i){const n=t[0],e=t[1],r=i[0],o=i[1];return[(n+r)/2,(e+o)/2]}function movePoint(t,i){const n=t[0],e=t[1],r=i[0],o=i[1];return[n+r,e+o]}function getVector(t,i){const n=t[0],e=t[1],r=i[0],o=i[1];return[r-n,o-e]}function smoothLine(t,i=50){const n=t.length;if(n<3)return t;const e=[],r=[];for(let o=0;o<n-2;o++){const c=t[o],u=t[o+1],a=t[o+2],y=getMidPoint(c,u),m=getMidPoint(u,a),g=getMidPoint(y,m),d=getVector(g,u),l=movePoint(y,d),p=movePoint(m,d);if(o===0){for(let s=0;s<i;s++){const h=bezier2(c[0],l[0],u[0],s/i),f=bezier2(c[1],l[1],u[1],s/i);e.push([h,f])}r.push(l),r.push(p)}else{for(let s=0;s<i;s++){const h=r[r.length-1],f=bezier3(c[0],h[0],l[0],u[0],s/i),v=bezier3(c[1],h[1],l[1],u[1],s/i);e.push([f,v])}if(r.push(l),r.push(p),o===n-3)for(let s=0;s<=i;s++){const h=bezier2(u[0],p[0],a[0],s/i),f=bezier2(u[1],p[1],a[1],s/i);e.push([h,f])}}}return{controls:r,points:e}}var lineData=smoothLine(data,smooth);option={animation:!1,title:{text:"延指定路径移动的动画"},tooltip:{show:!1,triggerOn:"none",formatter:function(t){return"X: "+t.data[0].toFixed(2)+"<br>Y: "+t.data[1].toFixed(2)}},grid:{},xAxis:{min:-50,max:300,type:"value",axisLine:{onZero:!1}},yAxis:{min:-50,max:300,type:"value",axisLine:{onZero:!1}},dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"empty"},{type:"slider",yAxisIndex:0,filterMode:"empty"},{type:"inside",xAxisIndex:0,filterMode:"empty"},{type:"inside",yAxisIndex:0,filterMode:"empty"}],series:[{id:"a",type:"line",smooth:!0,symbolSize,lineStyle:{width:0},data},{id:"b",type:"line",smooth:!0,symbolSize:0,lineStyle:{color:"red"},data:lineData.points},{id:"c",type:"scatter",symbolSize:5,itemStyle:{color:"black"},data:showControl?lineData.controls:[]}]},setTimeout(function(){myChart.setOption({graphic:[...echarts.util.map(data,function(t,i){return{type:"circle",position:myChart.convertToPixel("grid",t),shape:{cx:0,cy:0,r:symbolSize/2},invisible:!0,draggable:!0,ondrag:echarts.util.curry(onPointDragging,i),onmousemove:echarts.util.curry(showTooltip,i),onmouseout:echarts.util.curry(hideTooltip,i),onclick:echarts.util.curry(removePoint,i),z:100}}),{type:"rect",position:myChart.convertToPixel("grid",data[0]),shape:{x:-symbolSize/2,y:-symbolSize/2,width:symbolSize,height:symbolSize},style:{fill:"green"},z:200}]}),animate.start(lineData.points,easing,during,!0)},0),window.addEventListener("resize",updatePosition),myChart.on("dataZoom",updatePosition);function updatePosition(){myChart.setOption({graphic:echarts.util.map(data,function(t,i){return{position:myChart.convertToPixel("grid",t)}})})}function showTooltip(t){myChart.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:t})}function hideTooltip(t){myChart.dispatchAction({type:"hideTip"})}function onPointDragging(t,i,n){data[t]=myChart.convertFromPixel("grid",this.position),lineData=smoothLine(data,smooth),animate.stop(),myChart.setOption({series:[{id:"a",type:"line",smooth:!0,symbolSize,lineStyle:{width:0},data},{id:"b",type:"line",smooth:!0,symbolSize:0,data:lineData.points},{id:"c",type:"scatter",symbolSize:5,data:showControl?lineData.controls:[]}]}),animate.start(lineData.points,easing,during,!0)}function removePoint(t){data=[...data.slice(0,t),...data.slice(t+1)],update()}var zr=myChart.getZr();console.log(zr);function update(){animate.stop(),lineData=smoothLine(data,smooth),myChart.setOption({series:[{id:"a",type:"line",smooth:!0,symbolSize,lineStyle:{width:0},data},{id:"b",type:"line",smooth:!0,symbolSize:0,data:lineData.points},{id:"c",type:"scatter",symbolSize:5,data:lineData.controls}]}),setTimeout(function(){myChart.setOption({graphic:[...echarts.util.map(data,function(t,i){return{type:"circle",position:myChart.convertToPixel("grid",t),shape:{cx:0,cy:0,r:symbolSize/2},invisible:!0,draggable:!0,ondrag:echarts.util.curry(onPointDragging,i),onmousemove:echarts.util.curry(showTooltip,i),onmouseout:echarts.util.curry(hideTooltip,i),onclick:echarts.util.curry(removePoint,i),z:100}}),{type:"rect",position:myChart.convertToPixel("grid",data[0]),shape:{x:-symbolSize/2,y:-symbolSize/2,width:symbolSize,height:symbolSize},style:{fill:"green"},z:200}]}),animate.start(lineData.points,easing,during,!0)},0)}zr.on("click",function(t){if(!(t.target&&t.target.type==="circle")){var i=[t.offsetX,t.offsetY],n=myChart.convertFromPixel("grid",i);myChart.containPixel("grid",i)&&(data.push(n),data.sort((e,r)=>e[0]-r[0]),update())}}),console.log(option);
