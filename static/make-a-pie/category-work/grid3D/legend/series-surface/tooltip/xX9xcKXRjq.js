function getParametricEquation(t,o,i,a,s,n){let h=(t+o)/2,p=t*Math.PI*2,d=o*Math.PI*2,e=h*Math.PI*2;t===0&&o===1&&(i=!1),s=typeof s<"u"?s:1/3;let r=i?Math.cos(e)*.1:0,c=i?Math.sin(e)*.1:0,f=a?1.05:1;return{u:{min:-Math.PI,max:Math.PI*3,step:Math.PI/32},v:{min:0,max:Math.PI*2,step:Math.PI/20},x:function(l,u){return l<p?r+Math.cos(p)*(1+Math.cos(u)*s)*f:l>d?r+Math.cos(d)*(1+Math.cos(u)*s)*f:r+Math.cos(l)*(1+Math.cos(u)*s)*f},y:function(l,u){return l<p?c+Math.sin(p)*(1+Math.cos(u)*s)*f:l>d?c+Math.sin(d)*(1+Math.cos(u)*s)*f:c+Math.sin(l)*(1+Math.cos(u)*s)*f},z:function(l,u){return l<-Math.PI*.5?Math.sin(l):l>Math.PI*2.5?Math.sin(l)*n*.1:Math.sin(u)>0?1*n*.1:-1}}}function getPie3D(t,o){let i=[],a=0,s=0,n=0,h=[],p=typeof o<"u"?(1-o)/(1+o):1/3;for(let e=0;e<t.length;e++){a+=t[e].value;let r={name:typeof t[e].name>"u"?`series${e}`:t[e].name,type:"surface",parametric:!0,wireframe:{show:!1},pieData:t[e],pieStatus:{selected:!1,hovered:!1,k:p}};if(typeof t[e].itemStyle<"u"){let c={};typeof t[e].itemStyle.color<"u"&&(c.color=t[e].itemStyle.color),typeof t[e].itemStyle.opacity<"u"&&(c.opacity=t[e].itemStyle.opacity),r.itemStyle=c}i.push(r)}for(let e=0;e<i.length;e++)n=s+i[e].pieData.value,i[e].pieData.startRatio=s/a,i[e].pieData.endRatio=n/a,i[e].parametricEquation=getParametricEquation(i[e].pieData.startRatio,i[e].pieData.endRatio,!1,!1,p,i[e].pieData.value),s=n,h.push(i[e].name);i.push({name:"mouseoutSeries",type:"surface",parametric:!0,wireframe:{show:!1},itemStyle:{opacity:0},parametricEquation:{u:{min:0,max:Math.PI*2,step:Math.PI/20},v:{min:0,max:Math.PI,step:Math.PI/20},x:function(e,r){return Math.sin(r)*Math.sin(e)+Math.sin(e)},y:function(e,r){return Math.sin(r)*Math.cos(e)+Math.cos(e)},z:function(e,r){return Math.cos(r)>0?.1:-.1}}});let d={legend:{data:h},tooltip:{formatter:e=>{if(e.seriesName!=="mouseoutSeries")return`${e.seriesName}<br/><span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${e.color};"></span>${d.series[e.seriesIndex].pieData.value}`}},xAxis3D:{min:-1,max:1},yAxis3D:{min:-1,max:1},zAxis3D:{min:-1,max:1},grid3D:{show:!1,boxHeight:10,viewControl:{alpha:40,rotateSensitivity:0,zoomSensitivity:0,panSensitivity:0,autoRotate:!1},postEffect:{enable:!0,bloom:{enable:!0,bloomIntensity:.1},SSAO:{enable:!0,quality:"medium",radius:2}}},series:i};return d}option=getPie3D([{name:"cc",value:37,itemStyle:{color:"#f77b66"}},{name:"aa",value:44,itemStyle:{color:"#3edce0"}},{name:"bb",value:32,itemStyle:{color:"#f94e76"}},{name:"ee",value:16,itemStyle:{color:"#018ef1"}},{name:"dd",value:23,itemStyle:{color:"#9e60f9"}}],.59);let selectedIndex="",hoveredIndex="";myChart.on("click",function(t){let o=!option.series[t.seriesIndex].pieStatus.selected,i=option.series[t.seriesIndex].pieStatus.hovered,a=option.series[t.seriesIndex].pieStatus.k,s=option.series[t.seriesIndex].pieData.startRatio,n=option.series[t.seriesIndex].pieData.endRatio;selectedIndex!==""&&selectedIndex!==t.seriesIndex&&(option.series[selectedIndex].parametricEquation=getParametricEquation(option.series[selectedIndex].pieData.startRatio,option.series[selectedIndex].pieData.endRatio,!1,!1,a,option.series[selectedIndex].pieData.value),option.series[selectedIndex].pieStatus.selected=!1),option.series[t.seriesIndex].parametricEquation=getParametricEquation(s,n,o,i,a,option.series[selectedIndex].pieData.value),option.series[t.seriesIndex].pieStatus.selected=o,o&&(selectedIndex=t.seriesIndex),myChart.setOption(option)}),myChart.on("mouseover",function(t){let o,i,a,s,n;hoveredIndex!==t.seriesIndex&&(hoveredIndex!==""&&(o=option.series[hoveredIndex].pieStatus.selected,i=!1,a=option.series[hoveredIndex].pieData.startRatio,s=option.series[hoveredIndex].pieData.endRatio,n=option.series[hoveredIndex].pieStatus.k,option.series[hoveredIndex].parametricEquation=getParametricEquation(a,s,o,i,n,option.series[hoveredIndex].pieData.value),option.series[hoveredIndex].pieStatus.hovered=i,hoveredIndex=""),t.seriesName!=="mouseoutSeries"&&(o=option.series[t.seriesIndex].pieStatus.selected,i=!0,a=option.series[t.seriesIndex].pieData.startRatio,s=option.series[t.seriesIndex].pieData.endRatio,n=option.series[t.seriesIndex].pieStatus.k,option.series[t.seriesIndex].parametricEquation=getParametricEquation(a,s,o,i,n,option.series[t.seriesIndex].pieData.value+5),option.series[t.seriesIndex].pieStatus.hovered=i,hoveredIndex=t.seriesIndex),myChart.setOption(option))}),myChart.on("globalout",function(){hoveredIndex!==""&&(isSelected=option.series[hoveredIndex].pieStatus.selected,isHovered=!1,k=option.series[hoveredIndex].pieStatus.k,startRatio=option.series[hoveredIndex].pieData.startRatio,endRatio=option.series[hoveredIndex].pieData.endRatio,option.series[hoveredIndex].parametricEquation=getParametricEquation(startRatio,endRatio,isSelected,isHovered,k,option.series[hoveredIndex].pieData.value),option.series[hoveredIndex].pieStatus.hovered=isHovered,hoveredIndex=""),myChart.setOption(option)});
