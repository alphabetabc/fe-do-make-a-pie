let markLineData=[],source=[["product","2015","2016"],["系列1-1",43.3],["系列1-2",83.1],["系列1-3",86.4],["系列1-4",72.4],["系列1-5",72.4],["系列2-1",20],["系列2-2",10],["系列2-3",30]];option={grid:getBarHeight(),legend:{},tooltip:{},dataset:{source},xAxis:[{show:!1,type:"category",data:["周一"]}],yAxis:[{show:!1,max:"dataMax",type:"value"}],series:[{type:"pie",radius:"50%",center:["25%","50%"],label:{show:!0,position:"inside"},startAngle:45,clockwise:!1,markLine:{lineStyle:{type:"solid",color:"#BFBFBF"},symbol:"none",data:markLineData}}]},addOtherData(source,3,option);function getMarkLineData(t){let e=myChart.getHeight(),s=myChart.getWidth()*.25,h=s+e/4*Math.cos(45*3.14/180),r=e*.5-e/4*Math.sin(45*3.14/180),i=360*(t/100),a=0;a=i<=45?45-i:360-(i-45),a<270&&a>45&&(a=270);let o=0,l=0;return o=s+e/4*Math.cos(a*3.14/180),l=e*.5-e/4*Math.sin(a*3.14/180),[[{x:h,y:r},{x:"75%",y:"35%"}],[{x:o,y:l},{x:"75%",y:"65%"}]]}function addOtherData(t,e,n){let s=0,h=0;t.forEach((o,l)=>{if(l>0){let g=0;for(let y of o){let f=isNaN(y)?0:Number(y);g===1&&(h+=f),g++}}});let r=t.splice(t.length-e),i=["其他"];for(let o=0;o<r.length;o++){let l=0;for(let g of r[o]){let y=isNaN(g)?0:g;l&&(i[l]?i[l]+=y:i.push(y)),l++}}t.push(i),s=h?(i[1]/h*100).toFixed(2):100,n.series[0].markLine.data=getMarkLineData(s);let a=0;i[1]||(height=myChart.getHeight()*.3,a=height/e),getBarSeries(r,n,a)}function getBarHeight(){let t=myChart.getHeight();return[{x:"75%",y:"35%",width:"100",height:t*.3}]}function getBarSeries(t,e,n){let s=[];t.forEach(h=>{let r={name:h[0],type:"bar",stack:"系列2",data:[h[1]],barMinHeight:n,label:{show:!0,position:"inside",formatter:`{a}
{c}`},tooltip:{show:!1}};s.push(r)}),e.series=e.series.concat(s)}
