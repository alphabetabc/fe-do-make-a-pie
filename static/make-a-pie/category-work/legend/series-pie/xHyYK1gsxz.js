var districts={宝安区:{lat:22.589685,lng:113.863138},南山区:{lat:22.529685,lng:113.933138},福田区:{lat:22.538123,lng:114.068775},罗湖区:{lat:22.562155,lng:114.139489},盐田区:{lat:22.576038,lng:114.23895},龙岗区:{lat:22.71586,lng:114.23435}},allData={穆斯林影响系数:{district_count:[{district:"宝安区",count:.2},{district:"南山区",count:.3},{district:"福田区",count:.4},{district:"罗湖区",count:.4},{district:"盐田区",count:.2},{district:"龙岗区",count:.2}]},外来人口影响系数:{district_count:[{district:"宝安区",count:.3},{district:"南山区",count:.3},{district:"福田区",count:.4},{district:"罗湖区",count:.26},{district:"盐田区",count:.28},{district:"龙岗区",count:.33}]},失业率影响系数:{district_count:[{district:"宝安区",count:.1},{district:"南山区",count:.2},{district:"福田区",count:.1},{district:"罗湖区",count:.1},{district:"盐田区",count:.2},{district:"龙岗区",count:.2}]},低收入影响系数:{district_count:[{district:"宝安区",count:.18},{district:"南山区",count:.15},{district:"福田区",count:.1},{district:"罗湖区",count:.1},{district:"盐田区",count:.2},{district:"龙岗区",count:.24}]}},option={bmap:{center:[114.103916626,22.5902744004],zoom:12,roam:!0,enableMapClick:!1,mapStyle:{styleJson:[{featureType:"all",elementType:"all"},{featureType:"poi",elementType:"all",stylers:{visibility:"on"}}]}},legend:{show:!1,orient:"vertical",right:20,top:15,padding:10,backgroundColor:"rgba(255,255,255,0.8)",data:[]},series:[{type:"pie",data:[]}]};myChart.setOption(option),myChart.on("legendselectchanged",function(n){console.log(n.name);for(var t in districtChart)districtChart[t].dispatchAction({type:"legendToggleSelect",name:n.name})}),setTimeout(init,0);function init(){initMap(),initPieDistrict(myChart,getMap()),showPie(["穆斯林影响系数","外来人口影响系数","失业率影响系数","低收入影响系数"])}function initMap(){var n=new BMap.NavigationControl({}),t=getMap();return t.addControl(n),t.disableDoubleClickZoom(),t.removeEventListener("click"),t}function getMap(){return myChart.getModel().getComponent("bmap").getBMap()}var districtPoint=districts,districtChart={},districtLabels=[],parentChart=null,initPieDistrict=function(n,t){parentChart=n;var i=0;for(var e in districtPoint){var o=e,r=districtPoint[e],a="districtPoint"+i++;districtLabels.push(o),districtChart[o]=initPieMarker(t,a,o,r)}};function initPieMarker(n,t,i,e){var o='<div id="'+t+'" style="width:100px;height:100px;"></div>',r=new BMap.Point(e.lng,e.lat),a=new BMapLib.RichMarker(o,r,{anchor:new BMap.Size(-30,-30),barkground:"transparent"});n.addOverlay(a),document.getElementById(t).parentNode.style.backgroundColor="transparent",document.getElementById(t).parentNode.style.zIndex="1";var c=echarts.init(document.getElementById(t),"macarons"),l={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},title:{left:"center",top:"center",textStyle:{fontSize:14,fontWeight:"bold"}},series:[{name:i,type:"pie",avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center",formatter:"{a}"}},radius:["25","40"],data:[]}]};return c.setOption(l),c}function showPie(n){let t={};console.log(n.length,"len"),districtLabels.forEach(i=>{t[i]={},n.forEach(e=>{console.log(e,"xxx"),t[i][e]=0})}),console.log(t,"AA");for(let i in allData)allData[i].district_count.forEach(e=>{t[e.district][i]===0&&(t[e.district][i]=e.count)});console.log(t),setData(t,n)}var placeHolderStyle={normal:{color:"rgba(255,255,255,0.8)",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"rgba(0,0,0,0)"}};function setData(n,t){districtLabels.forEach(e=>{var o=0,r=n[e],a=[];for(let c in r)a.push({name:c,value:r[c]}),o+=r[c];console.log(a),o===0&&(a=[]),districtChart[e].setOption({title:{show:o>0,text:e},legend:{show:!1,data:t},series:[{data:a},{tooltip:{show:!1},type:"pie",radius:[0,25],data:[{value:0,itemStyle:placeHolderStyle}]}]})});let i=t.map(e=>({name:e}));parentChart.setOption({legend:{show:t.length>0,data:t},series:[{data:i}]})}
