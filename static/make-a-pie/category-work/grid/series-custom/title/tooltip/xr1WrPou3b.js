var data={name:"基础数据资源",children:[{name:"基础信息数据量",children:[{name:"建档人数",size:133,add:"11",rate:"13%"},{name:"妊娠期妇女管理数",size:44,add:"11",rate:"13%"},{name:"儿童管理数",size:24,add:"11",rate:"13%"},{name:"新生儿管理数",size:4,add:"13",rate:"13%"},{name:"老年人管理数",size:34,add:"14",rate:"13%"}],size:199,add:"11",rate:"13%"},{name:"健康档案数量",children:[{name:"健康档案管理数",size:155,add:"11",rate:"13%"},{name:"门诊管理数",size:114,add:"1",rate:"13%"},{name:"住院管理数",size:84,add:"1",rate:"13%"},{name:"检验报告管理数",size:14,add:"3",rate:"13%"},{name:"检查报告管理数",size:15,add:"4",rate:"13%"}],size:300,add:"11",rate:"13%"},{name:"家庭医生签约人数",children:[{name:"慢性病人管理数",children:[{name:"精神病患者管理数",size:13,add:"1",rate:"13%"},{name:"糖尿病患者管理数",size:14,add:"1",rate:"13%"},{name:"高血压患者管理数",size:4,add:"3",rate:"13%"},{name:"脑卒中患者管理数",size:4,add:"3",rate:"13%"},{name:"残疾患者管理数",size:4,add:"4",rate:"13%"}],size:55,add:"11",rate:"13%"},{name:"家庭医生签约",children:[{name:"糖尿病患者签约数",size:15,add:"11",rate:"13%"},{name:"精神病患者签约数",size:4,add:"1",rate:"13%"},{name:"高血压患者签约数",size:4,add:"1",rate:"13%"},{name:"脑卒中患者签约数",size:4,add:"3",rate:"13%"}],size:44,add:"11",rate:"13%"}],size:77,add:"11",rate:"13%"}]},getFillColor=function(r,a){var e={},o=["基础信息数据量","建档人数","妊娠期妇女管理数","儿童管理数","新生儿管理数","老年人管理数"],l=["家庭医生签约人数","慢性病人管理数","家庭医生签约","精神病患者管理数","糖尿病患者管理数","高血压患者管理数","脑卒中患者管理数","残疾患者管理数","糖尿病患者签约数","精神病患者签约数","高血压患者签约数","脑卒中患者签约数"],t=["健康档案数量","健康档案管理数","门诊管理数","住院管理数","检验报告管理数","检查报告管理数"];return $.inArray(r,o)!=-1?a?(e.fillColor={type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#626815"},{offset:1,color:"#a9aa0e"}],globalCoord:!1},e.borderColor="rgba(182, 184,30, 1)",e.borderWidth=2,e.emphasisFillColor={type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#a7ac0e"},{offset:.5,color:"#babc0c"},{offset:1,color:"#f6f701"}],globalCoord:!1},e.emphasisBorderColor="#f6f701",e.emphasisborderWidth=2):(e.fillColor="rgba(156,156,14,0.1)",e.borderColor="rgba(64,67,34,1)",e.borderWidth=1,e.emphasisFillColor="rgba(156,156,14,0.1)",e.emphasisBorderColor="rgba(64,67,34,1)",e.emphasisborderWidth=3):$.inArray(r,l)!=-1?a?(e.fillColor={type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#4e0435"},{offset:1,color:"#84085a"}],globalCoord:!1},e.borderColor="rgba(154, 14, 109, 1)",e.borderWidth=2,e.emphasisFillColor={type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#ae0876"},{offset:.5,color:"#cd0a8b"},{offset:1,color:"#f505a4"}],globalCoord:!1},e.emphasisBorderColor="#f505a4",e.emphasisborderWidth=3):(e.fillColor="rgba(130, 10, 88, 0.18)",e.borderColor="rgba(77, 15, 75, 1)",e.borderWidth=1,e.emphasisFillColor="rgba(130, 10, 88, 0.18)",e.emphasisBorderColor="rgba(77, 15, 75, 1)",e.emphasisborderWidth=3):a?(e.fillColor={type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#034e61"},{offset:.7,color:"#086b87"},{offset:1,color:"#068ca3"}],globalCoord:!1},e.borderColor="#03a1b3",e.borderWidth=2,e.emphasisFillColor={type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#0a7998"},{offset:.7,color:"#0b9ec8"},{offset:1,color:"#09c2f6"}],globalCoord:!1},e.emphasisBorderColor="#09c2f6",e.emphasisborderWidth=1):(e.fillColor="rgba(0, 252, 255, 0.1)",e.borderColor="rgba(11, 72, 115, 1)",e.borderWidth=1,e.emphasisFillColor="rgba(0, 252, 255, 0.1)",e.emphasisBorderColor="rgba(11, 72, 115, 1)",e.emphasisborderWidth=3),e},renderItem=function(r,a){var e=getFillColor(a.value(2),a.value(9)),o="inside";return a.value(9)||(a.value(1)==1?a.value(6)>a.getWidth()/2?o="right":o="left":o="top"),{type:"circle",shape:{cx:a.value(6),cy:a.value(7),r:a.value(8)},z2:a.value(1)*2,style:a.style({stroke:e.borderColor,fill:e.fillColor,textPosition:o,lineWidth:e.borderWidth}),styleEmphasis:a.style({textPosition:o,stroke:e.emphasisBorderColor,fill:e.emphasisFillColor,lineWidth:e.emphasisborderWidth})}},root=d3.hierarchy(data).sum(function(r){return r.size}).sort(function(r,a){return a.value-r.value});d3.pack().size([800-2,480-2]).padding(.5)(root);var maxDepth=0,nodeAll=root.descendants(),nodes=nodeAll.filter(function(r){return r.parent}),seriesData=nodes.map(function(r){maxDepth=Math.max(maxDepth,r.depth);var a="#ffffff";if(r.isLeaf=!r.children||!r.children.length,r.depth==1){switch(r.data.name){case"家庭医生签约人数":a="rgba(218, 22, 158, 1)";break;case"基础信息数据量":a="rgba(156,156,14,1)";break;case"健康档案数量":a="rgba(14, 149, 156, 1)";break}return{value:[r.value,r.depth,r.data.name,r.data.size,r.data.add,r.data.rate,r.x,r.y,r.r,r.isLeaf],label:{normal:{show:!0,color:a,formatter:function(e){return"{type|"+e.value[2]+`}
{numAll|`+e.value[3]+`}
{add|本月新增：`+e.value[4]+"}"},rich:{type:{fontSize:14,color:a},numAll:{fontSize:28,padding:[5,0,5,0],color:a},add:{fontSize:14,color:a}}}}}}else return(r.data.name=="家庭医生签约"||r.data.name=="慢性病人管理数")&&(a="rgba(222, 0, 155,1)"),{value:[r.value,r.depth,r.data.name,r.data.size,r.data.add,r.data.rate,r.x,r.y,r.r,r.isLeaf],label:{normal:{show:!0,color:a,position:"inside",formatter:function(e){var o="",l=e.value[2];if(e.value[9]){if(e.value[8]>10){var t=echarts.format.truncateText(l,2*e.value[8],{fontSize:14,fontFamily:"微软雅黑"},".");if(t.indexOf(".")>0){var i=l.indexOf("患者"),s=l.indexOf("管理数");i>0?o+="{type|"+l.substring(0,i)+"}":o+="{type|"+l.substring(0,s)+"}"}else o+="{type|"+l+"}";e.value[8]>45&&(o+=`
{num|`+e.value[3]+"}")}}else o+="{type|"+e.value[2]+"}";return o},rich:{type:{fontSize:12,padding:[5,0,5,0],color:a},num:{fontSize:16,color:a}}}}}});option={backgroundColor:"#0c1b3e",title:{text:"2017-10",textStyle:{color:"rgba(164, 159, 159, 0.21)",fontSize:32,fontFamily:"微软雅黑",fontWeight:"normal"},right:10,bottom:10},xAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},splitLine:{show:!1}},yAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},splitLine:{show:!1}},tooltip:{backgroundColor:"rgba(50,50,50,0.95)",formatter:function(r){var a=(""+r.value[3]).replace(/\d{1,3}(?=(\d{3})+$)/g,"$&,"),e=(""+r.value[4]).replace(/\d{1,3}(?=(\d{3})+$)/g,"$&,"),o="<span>"+r.value[2]+"</span><br><span style = 'line-height:30px;font-size : 25px; font-weight:bold;'>"+a+"</span></br><div><div style = 'float : left; padding-right:20px; border-right: solid 1px #4c4a4a;'><span >本月新增</span></br><span style = 'color : red; '>"+e+"</span></div><div style = 'float : right; margin-left:20px;'><span style = 'width : 100px;'>月增长率</span></br>";return r.value[5]>0?o+="<span style = 'color : red;  width : 100px;'>+"+r.value[5]+"</span>":o+="<span style = 'color : red;  width : 100px;'>"+r.value[5]+"</span>",o+="</div></div>",o}},series:{type:"custom",renderItem,data:seriesData}};
