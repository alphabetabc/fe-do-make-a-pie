var convertRatePostion=15,events=["搜索商品","查看商品详情","加入购物车","开始付款","付款成功"],data=[{names:["北京"],original_names:["北京"],values:[1151,594,109,44,23],p_next:["100.0","51.6","18.4","40.4","52.3"],p_total:["100.0","51.6","9.5","3.8","2.0"]},{names:["上海"],original_names:["上海"],values:[845,334,116,43,30],p_next:["100.0","39.5","34.7","37.1","69.8"],p_total:["100.0","39.5","13.7","5.1","3.6"]},{names:["湖北"],original_names:["湖北"],values:[577,161,38,13,7],p_next:["100.0","27.9","23.6","34.2","53.8"],p_total:["100.0","27.9","6.6","2.3","1.2"]},{names:["广东"],original_names:["广东"],values:[463,209,57,28,14],p_next:["100.0","45.1","27.3","49.1","50.0"],p_total:["100.0","45.1","12.3","6.0","3.0"]}],color=["#00a0e9","#f4b93b","#85bd41","#f29c9f","#8f82bc","#0068b7","#f29b76","#13b5b1","#6e7074","#546570","#c4ccd3"];function getYAxisData(){var e=[];for(i=0;i<events.length;i++)e[i*2]=events[i],i<events.length-1&&(e[i*2+1]="a"+i.toString());return e}var yAxisData=getYAxisData();function getSeriesData(){var e=[];for(i=0;i<data.length;i++){var t=[];for(t[0]=[],t[1]=[],t[2]=[],t[2][0]=0,j=0;j<data[i].p_total.length;j++)t[0][j*2]=data[i].p_total[j],j>0&&(t[2][j*2]=data[i].p_total[j-1]),j<events.length-1&&(t[0][j*2+1]=null,t[1][j]={value:data[i].p_next[j+1],xAxis:convertRatePostion,yAxis:"a"+j.toString()});e[i]=t}return e}var seriesData=getSeriesData();function generateXAxises(){var e=[];for(i=0;i<data.length;i++)e.push({gridIndex:i,min:0,max:100,axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1,lineStyle:{color:"#eee",type:"dotted"}},axisLabel:{show:!1,formatter:"{value}%",color:"#aaa",fontSize:10}});return e}function generateYAxises(){var e=[];for(i=0;i<data.length;i++)e.push({gridIndex:i,axisLine:{show:!1},data:yAxisData,inverse:!0,axisTick:{show:!1},axisLabel:{show:i==0,width:"100%",interval:1,fontSize:11}});return e}function generateSeries(){var e=[];for(i=0;i<data.length;i++)e.push({xAxisIndex:i,yAxisIndex:i,type:"bar",barWidth:40,z:10,name:data[i].names[0],data:seriesData[i][0],itemStyle:{color:color[i]},emphasis:{itemStyle:{opacity:.6}},markPoint:{symbol:"triangle",symbolSize:[42,21],symbolRotate:180,label:{formatter:"{c}%",position:"insideTop",distance:1,fontSize:7},itemStyle:{color:"#bbb"},data:seriesData[i][1]}});return e}function generateTitles(){var e=[];for(i=0;i<data.length;i++)e.push({textAlign:"left",text:data[i].names[0],left:12+i*22+"%",top:"2%",textStyle:{fontSize:12,fontWeight:"normal",color:color[i]}});return e}option={backgroundColor:"#fff",height:350,grid:[{show:!1,x:"10%",y:"7%",width:"20%"},{show:!1,x:"32%",y:"7%",width:"20%"},{show:!1,x:"54%",y:"7%",width:"20%"},{show:!1,x:"76%",y:"7%",width:"20%"}],tooltip:{trigger:"item",formatter:function(e){if(e.componentType=="markPoint")return events[e.dataIndex]+"→"+events[e.dataIndex+1]+"<br>"+data[e.dataIndex].names[0]+"："+e.value+"%"},textStyle:{fontSize:10},axisPointer:{type:"none",label:{show:!1}}},title:generateTitles(),xAxis:generateXAxises(),yAxis:generateYAxises(),series:generateSeries()};function compare(e,t){if(t!=0){for(option.animation=!1,i=0;i<data.length;i++){var o=Array(seriesData[e][0].length).fill(null);o[t]={value:seriesData[e][0][t],vs:seriesData[i][0][t],currentIndex:e,compareIndex:i},option.series.push({xAxisIndex:i,yAxisIndex:i,type:"bar",name:"compare",z:15,itemStyle:{color:"rgb(1, 1, 1, 0)",borderWidth:1,borderColor:color[e]},label:{show:!0,fontSize:9,position:"right",align:"left",color:"#777777",formatter:function(n){return n.data.currentIndex==n.data.compareIndex?"转化："+n.data.value+"%（"+data[n.data.currentIndex].values[n.dataIndex]+"人）":data[n.data.currentIndex].names[0]+"："+n.data.value+"%（"+data[n.data.currentIndex].values[n.dataIndex]+`人）
`+data[n.data.compareIndex].names[0]+"："+n.data.vs+"%（"+data[n.data.compareIndex].values[n.dataIndex]+"人）"}},silent:!0,barWidth:40,barGap:"-100%",data:o}),option.series[i].markLine={symbol:["none","none"],z:20,data:[{xAxis:seriesData[e][0][t]}],lineStyle:{color:color[e],type:"dotted"},label:{formatter:"{c}%",fontSize:10}}}myChart.setOption(option,!1)}}myChart.on("mouseover",{componentType:"series"},function(e){if(e.componentSubType=="bar")for(compare(e.seriesIndex,e.dataIndex),i=0;i<data.length;i++)myChart.dispatchAction({type:"highlight",seriesIndex:i,dataIndex:e.dataIndex})}),myChart.on("mouseout",{componentType:"series"},function(e){if(option.grid[e.seriesIndex].show=!1,e.componentSubType=="bar"){for(i=0;i<data.length;i++)myChart.dispatchAction({type:"downplay",seriesIndex:i,dataIndex:e.dataIndex}),option.series[i].markLine=null;option.series.splice(4,4),myChart.setOption(option,!0)}});
