app.title="俄罗斯方块";var refreshT,fallBlockT,fallTimout,speed=1e3,downSpeed=30,nomrlSpeed=1e3,fallLine=20,rlMove=4,score=0,death=!1,data=[],data2=[];Array.prototype.clone=function(){for(var t=[],s=0,a=this.length;s<a;s++)this[s]instanceof Array?t.push(this[s].clone()):t.push(this[s]);return t};for(var block1={basePt:[[0,0],[0,1],[1,0],[1,1]],roate:function(){}},block2={basePt:[[0,0],[1,0],[2,0],[2,1]],shapList:[[[0,0],[1,0],[2,0],[2,1]],[[0,0],[0,1],[0,2],[1,0]],[[0,0],[0,1],[1,1],[2,1]],[[0,2],[1,0],[1,1],[1,2]]],shapIndex:0,roate:function(){this.shapIndex++,this.basePt=this.shapList[this.shapIndex%this.shapList.length].clone()}},block3={basePt:[[0,1],[1,0],[1,1],[2,0]],shapList:[[[0,1],[1,0],[1,1],[2,0]],[[0,0],[0,1],[1,1],[1,2]],[[0,1],[1,0],[1,1],[2,0]],[[0,0],[0,1],[1,1],[1,2]]],shapIndex:0,roate:function(){this.shapIndex++,this.basePt=this.shapList[this.shapIndex%this.shapList.length].clone()}},block4={basePt:[[0,0],[1,0],[1,1],[2,1]],shapList:[[[0,0],[1,0],[1,1],[2,1]],[[0,1],[0,2],[1,0],[1,1]]],shapIndex:0,roate:function(){this.shapIndex++,this.basePt=this.shapList[this.shapIndex%this.shapList.length].clone()}},block5={basePt:[[0,0],[0,1],[1,0],[2,0]],shapList:[[[0,0],[0,1],[1,0],[2,0]],[[0,0],[0,1],[0,2],[1,2]],[[0,1],[1,1],[2,1],[2,0]],[[0,0],[1,0],[1,1],[1,2]]],shapIndex:0,roate:function(){this.shapIndex++,this.basePt=this.shapList[this.shapIndex%this.shapList.length].clone()}},block6={basePt:[[0,0],[1,0],[1,1],[2,0]],shapList:[[[0,0],[1,0],[1,1],[2,0]],[[0,0],[0,1],[0,2],[1,1]],[[1,0],[0,1],[1,1],[2,1]],[[0,1],[1,0],[1,1],[1,2]]],shapIndex:0,roate:function(){this.shapIndex++,this.basePt=this.shapList[this.shapIndex%this.shapList.length].clone()}},block7={basePt:[[-1,0],[0,0],[1,0],[2,0]],shapList:[[[-1,0],[0,0],[1,0],[2,0]],[[0,0],[0,1],[0,2],[0,3]]],shapIndex:0,roate:function(){this.shapIndex++,this.basePt=this.shapList[this.shapIndex%this.shapList.length].clone()}},blocks=[block1,block2,block3,block4,block5,block6,block7],randomBlock=function(){for(var t=parseInt(Math.random()*100)%7,s=blocks[t],a=Math.random()*6,e=0;e<a;e++)s.roate();return s},firstBlock=randomBlock(),j=0;j<20;j++)for(var i=0;i<10;i++)data.push([i,j,0]);option={backgroundColor:"#aaa",title:[{text:"俄罗斯方块"},{text:"    当前得分：0",left:550,top:"30%"},{text:`   ←、→ 左右移动\r
\r
↓ 加速下落，↑ 变形`,left:550,top:"60%"}],grid:{show:!0,borderColor:"#000",z:2,top:50,left:200,height:520,width:260},legend:{show:!1},xAxis:{interval:2,splitLine:{lineStyle:{type:"dashed"}},max:10,axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!1}},yAxis:{interval:2,splitLine:{lineStyle:{type:"dashed"}},max:20,axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!1}},series:[{data,type:"scatter",symbol:"rect",symbolSize:function(t){return t[2]*26},symbolOffset:[13,-13],label:{emphasis:{show:!1}},itemStyle:{normal:{shadowBlur:10,shadowColor:"rgba(120, 36, 50, 0.5)",shadowOffsetY:5,color:new echarts.graphic.RadialGradient(.4,.3,1,[{offset:0,color:"rgb(251, 118, 123)"},{offset:1,color:"rgb(204, 46, 72)"}])}}},{data:data2,type:"scatter",symbol:"rect",symbolSize:function(t){return t[2]*26},symbolOffset:[13,-13],label:{emphasis:{show:!1}},itemStyle:{normal:{shadowBlur:10,shadowColor:"rgba(25, 100, 150, 0.5)",shadowOffsetY:5,color:new echarts.graphic.RadialGradient(.4,.3,1,[{offset:0,color:"rgb(151, 218, 23)"},{offset:1,color:"rgb(104, 100, 5)"}])}}}]};var touchDistortionOther=function(){var t=firstBlock.basePt.clone();firstBlock.roate();var s=touchFallOther();return firstBlock.basePt=t,firstBlock.shapIndex--,s},touchFallOther=function(){for(var t=firstBlock.basePt.clone(),s=0;s<t.length;s++){var a=t[s][0]+rlMove,e=t[s][1]+fallLine;if(a<0||a>=10||option.series[0].data[e*10+a]&&option.series[0].data[e*10+a][2]===1)return!0}return!1},touchLeftRightOther=function(t){for(var s=firstBlock.basePt.clone(),a=rlMove+t,e=0;e<s.length;e++){var o=s[e][0]+a,r=s[e][1]+fallLine;if(o<0||o>=10||option.series[0].data[r*10+o]&&option.series[0].data[r*10+o][2]===1)return!0}return!1},setScore=function(){for(var t=0;t<20;t++){for(var s=0,a=0;a<10;a++)s+=option.series[0].data[t*10+a][2];if(s==10){for(var e=t+1;e<20;e++)for(var o=0;o<10;o++)option.series[0].data[(e-1)*10+o][2]=option.series[0].data[e*10+o][2];score++,option.title[1].text="    当前得分："+score,t--}}},checkDeath=function(){for(var t=0;t<10;t++)option.series[0].data[19*10+t][2]===1&&(death=!0,option.title[1].text=`游戏结束\r
\r
    本次得分：`+score)};refreshT=function(){var t=firstBlock.basePt.clone();if(fallLine<0||touchFallOther()){for(e=0;e<t.length;e++){var s=t[e][0]+rlMove,a=t[e][1]+fallLine+1;option.series[0].data[a*10+s]&&(option.series[0].data[a*10+s][2]=1)}myChart.setOption(option),setScore(),checkDeath(),option.series[1].data=[],firstBlock=randomBlock(),rlMove=4,fallLine=20,speed=nomrlSpeed}else{for(var e=0;e<t.length;e++)t[e][0]+=rlMove,t[e][1]+=fallLine,t[e][2]=1;option.series[1].data=t}myChart.setOption(option)},fallBlockT=function(){death||(fallLine--,refreshT(),fallTimout=setTimeout(fallBlockT,speed))},fallBlockT(),document.onkeydown=function(t){t&&t.keyCode===37&&(touchLeftRightOther(-1)||(rlMove--,refreshT())),t&&t.keyCode===40&&(speed=downSpeed,clearTimeout(fallTimout),fallBlockT()),t&&t.keyCode===39&&(touchLeftRightOther(1)||(rlMove++,refreshT())),t&&t.keyCode===38&&(touchDistortionOther()||(firstBlock.roate(),refreshT()))};
