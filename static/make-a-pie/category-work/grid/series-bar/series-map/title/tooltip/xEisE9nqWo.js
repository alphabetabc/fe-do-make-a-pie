var typeArr=["鲜花","星星","香蕉","嫌弃"],typeIndex=1,selectedRange=null,option=null,str="",data=[],geoCoordMap={},name="虚拟地图区域饼图数据统计",mapName="china",mapFeatures=echarts.getMap(mapName).geoJson.features;mapFeatures.forEach(function(e){var a=e.properties.name;geoCoordMap[a]=e.properties.cp,data.push({name:a,value:[{name:"鲜花",value:Math.round(Math.random()*100+10)},{name:"星星",value:Math.round(Math.random()*100+10)},{name:"香蕉",value:Math.round(Math.random()*100+10)},{name:"嫌弃",value:Math.round(Math.random()*100+10)}]})});function convertMapDta(e,a){var o=[];return a.forEach(function(n){n.value.forEach(function(r){String(r.name)===String(e)&&o.push({name:n.name,value:r.value})})}),o}function resetPie(e,a,o,n){var r=e.getOption(),t=r.series,i=option.grid;e.setOption(r,!0)}function addPie(e,a){for(var o=e.getOption(),n=option.series,r=option.grid,t=0;t<a.length;t++){var i=Math.round(Math.random()*30),h=i<=10?10:i,s=geoCoordMap[a[t].name];if(s){var p=[];a[t].value.map(function(m,l){p.push({name:m.name,value:m.value})});var u=e.convertToPixel({seriesIndex:0},s);r.push({width:20,height:20,left:u[0],top:u[1],z:5}),option.yAxis.push({gridIndex:t,type:"value",show:!1,axisLabel:{show:!1},z:5}),option.xAxis.push({type:"category",data:["1","2"],show:!1,gridIndex:t}),n.push({data:[120,200],type:"bar",yAxisIndex:t,xAxisIndex:t,z:5,itemStyle:{color:"red"}})}}return option}var option={title:{text:name,left:"center",textStyle:{color:"#03A89E"}},tooltip:{trigger:"item",formatter:function(e){if(e.value)return e.name+"<br/>"+typeArr[typeIndex]+": "+e.value}},grid:[],yAxis:[],xAxis:[],series:[{name:"chinaMap",type:"map",mapType:mapName,roam:!0,label:{normal:{show:!0},emphasis:{show:!0}},itemStyle:{normal:{areaColor:"#808A87"}},data:convertMapDta(typeArr[typeIndex],data),z:2}]};option&&typeof option=="object"&&myChart.setOption(option,!0),addPie(myChart,data),myChart.setOption(option,!0),myChart.on("georoam",function(e){resetPie(myChart,e,geoCoordMap,typeIndex)}),myChart.on("datarangeselected",function(e){resetPie(myChart,e,geoCoordMap,typeIndex)}),window.addEventListener("resize",function(){myChart.resize(),resetPie(myChart,0,geoCoordMap)});
