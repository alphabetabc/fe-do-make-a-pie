var data={children:[{children:[{ifend:"1",name:"节点二1",number:".18"}],name:"节点一1",number:"0"},{ifend:"1",name:"节点一2",number:".87"},{ifend:"1",name:"节点一3",number:".92"},{ifend:"1",name:"节点一4",number:"1.68"},{children:[{code:"2",ifend:"1",name:"节点二10",number:"10.01"},{ifend:"1",name:"节点二11",number:"0.31"},{code:"2",ifend:"1",name:"节点二12",number:"-.92"},{code:"2",name:"节点二2",number:"100"},{ifend:"1",name:"节点二3",number:".05"},{ifend:"1",name:"节点二4",number:"1.53"},{ifend:"1",name:"节点二5",number:"1.14"},{ifend:"1",name:"节点二6",number:"1.98"},{ifend:"1",name:"节点二7",number:".02"},{ifend:"1",name:"节点二8",number:"1.03"},{ifend:"1",name:"节点二9",number:"3.05"}],name:"节点一5",number:".16"},{ifend:"1",name:"节点一6",number:"2.33"}],name:"节点",number:".46"};function format(n){if(n.x=0,n.y=0,!n.hasOwnProperty("children"))return n.len=[1,-1],n.leny=[1,9],n;var e=n.children,a=parseInt(e.length/2),o=e.length-a,d=getSum(e,0,a),c=getSum(e,o-1,e.length);e=sortData(e,a,o),n.children=e;for(var m=a>9||d===0?300:200,g=o>9||c===0?300:200,t=[-1e5,1e5],h=[-1e5,1e5],r=0;r<e.length;r++)if(r<a?(e[r].x=getLoction(a,n.x,r+1),e[r].y=n.y+m,e[r].fx=getFX(a,r,!1)):(e[r].x=getLoction(o,n.x,r-a+1),e[r].y=n.y-g,e[r].fx=getFX(o,r-a,!0)),getMaxMin(t,e[r].x),getMaxMin(h,e[r].y),!!e[r].hasOwnProperty("children"))for(var s=e[r].children,i=0;i<s.length;i++)r<a?(s[i].x=getLoction(s.length,e[r].x,i+1),s[i].y=e[r].y+200,s[i].fx=getFX(s.length,i,!1)):(s[i].x=getLoction(s.length,e[r].x,i+1),s[i].y=e[r].y-200,s[i].fx=getFX(s.length,i,!0)),getMaxMin(t,s[i].x),getMaxMin(h,s[i].y);var b;if(a%2===0){if(b=a/2,e[b].hasOwnProperty("children")&&e[b-1].hasOwnProperty("children")&&e[b].children[0].x<e[b].x-50){for(var l=50-e[b].children[0].x,i=0;i<e[b].children.length;i++)e[b].children[i].x=e[b].children[i].x+l,getMaxMin(t,e[b].children[i].x);e[b].x=getLoction2(e[b].children)}}else b=parseInt(a/2);for(var r=b+1;r<a;r++)if(e[r].hasOwnProperty("children")&&e[r-1].hasOwnProperty("children")&&e[r-1].children[e[r-1].children.length-1].x-e[r].children[0].x>-100){for(var l=e[r-1].children[e[r-1].children.length-1].x+100-e[r].children[0].x,i=0;i<e[r].children.length;i++)e[r].children[i].x=e[r].children[i].x+l,getMaxMin(t,e[r].children[i].x);e[r].x=getLoction2(e[r].children)}for(var r=b-1;r>=0;r--)if(e[r].hasOwnProperty("children")&&e[r+1].hasOwnProperty("children")&&e[r+1].children[0].x-e[r].children[e[r].children.length-1].x<100){for(var l=e[r].children[e[r].children.length-1].x-(e[r+1].children[0].x-100),i=0;i<e[r].children.length;i++)e[r].children[i].x=e[r].children[i].x-l,getMaxMin(t,e[r].children[i].x);e[r].x=getLoction2(e[r].children)}if(o%2===0){if(b=o/2+a,e[b].hasOwnProperty("children")&&e[b-1].hasOwnProperty("children")&&e[b].children[0].x<e[b].x-50){for(var l=50-e[b].children[0].x,i=0;i<e[b].children.length;i++)e[b].children[i].x=e[b].children[i].x+l,getMaxMin(t,e[b].children[i].x);e[b].x=getLoction2(e[b].children)}}else b=parseInt(o/2)+a;for(var r=b+1;r<e.length;r++)if(e[r].hasOwnProperty("children")&&e[r-1].hasOwnProperty("children")&&e[r-1].children[e[r-1].children.length-1].x-e[r].children[0].x>-100){for(var l=e[r-1].children[e[r-1].children.length-1].x+100-e[r].children[0].x,i=0;i<e[r].children.length;i++)e[r].children[i].x=e[r].children[i].x+l,getMaxMin(t,e[r].children[i].x);e[r].x=getLoction2(e[r].children)}for(var r=b-1;r>=a;r--)if(e[r].hasOwnProperty("children")&&e[r+1].hasOwnProperty("children")&&e[r+1].children[0].x-e[r].children[e[r].children.length-1].x<100){for(var l=e[r].children[e[r].children.length-1].x-(e[r+1].children[0].x-100),i=0;i<e[r].children.length;i++)e[r].children[i].x=e[r].children[i].x-l,getMaxMin(t,e[r].children[i].x);e[r].x=getLoction2(e[r].children)}return t[0]-t[1]<=400&&(t[0]=t[0]+100,t[1]=t[1]-100),n.len=t,n.leny=h,n}function format2(n){if(!n.hasOwnProperty("children"))return n;for(var e=n.children,a=parseInt(e.length/2),o=e.length-a,d=n.len,c=0;c<e.length;c++)if(!e[c].hasOwnProperty("children")){if(c>0&&c!=a&&e[c-1].hasOwnProperty("children")&&e[c-1].children.length>5){var m=(e[c-1].children.length-5)/2;e[c].x=e[c].x+100*m;var g,t=!1;c<a?g=a:g=e.length;for(var h=c+1;h<g;h++){if(t=!0,e[h].x=e[h].x+100*m,e[h].hasOwnProperty("children"))for(var r=e[h].children,s=0;s<r.length;s++)r[s].x=r[s].x+100*m,getMaxMin(d,r[s].x);getMaxMin(d,e[h].x)}t&&(e[c].x=e[c].x>d[0]?d[0]:e[c].x)}else if(c<e.length-1&&e[c+1].hasOwnProperty("children")&&e[c+1].children.length>5){var m=(e[c+1].children.length-5)/2;e[c].x=e[c].x-100*m;var g,t=!1;c<a?g=0:g=a;for(var h=c-1;h>=g;h--){if(t=!0,e[h].x=e[h].x-100*m,e[h].hasOwnProperty("children"))for(var r=e[h].children,s=0;s<r.length;s++)r[s].x=r[s].x-100*m,getMaxMin(d,r[s].x);getMaxMin(d,e[h].x)}t&&(e[c].x=e[c].x<d[1]?d[1]:e[c].x)}}return d[0]-d[1]<=400&&(d[0]=d[0]+100,d[1]=d[1]-100),n.len=d,n}function getLoction(n,e,a){if(n%2===0){var o=n/2-a;e=e-50-100*o}else{var o=parseInt(n/2+1)-a;e=e-100*o}return e}function getFX(n,e,a){var o,d;return n<1?1:(d=n%2===0?n/2:parseInt(n/2)+1,o=e<d?1:-1,a&&(o=-o),o)}function getSum(n,e,a){a>n.length&&(a=n.length);for(var o=0,d=e;d<a;d++)if(!!n[d].hasOwnProperty("children")){var c=n[d].children;o=o+c.length}return o}function sortData(n,e,a){for(var o=[],d=e-1,c=0,m=0;m<e-1;m++){for(var g=1,t=0;t<d;t++){var h=n[t].hasOwnProperty("children")?n[t].children.length:0,r=n[t+1].hasOwnProperty("children")?n[t+1].children.length:0;if(h>r){var s=n[t];n[t]=n[t+1],n[t+1]=s,g=0,c=t}}if(d=c,g===1)break}for(var m=0;m<e;m++)m%2===0?o[m/2]=n[m]:o[e-(m+1)/2]=n[m];d=n.length-1,c=0;for(var m=e;m<n.length-1;m++){for(var g=1,t=e;t<d;t++){var h=n[t].hasOwnProperty("children")?n[t].children.length:0,r=n[t+1].hasOwnProperty("children")?n[t+1].children.length:0;if(h>r){var s=n[t];n[t]=n[t+1],n[t+1]=s,g=0,c=t}}if(d=c,g===1)break}for(var m=0;m<a;m++)m%2===0?o[m/2+e]=n[m+e]:o[a-(m+1)/2+e]=n[m+e];return o}function getMaxMin(n,e){return n[0]<e&&(n[0]=e),n[1]>e&&(n[1]=e),n}function initCharts(n){var e={},a=[],o=[],d="image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAgCAYAAABO6BuSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFMzhFMDM4REEwQUYxMUVBQkY1NEIzNTg4MTM4RjIxOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFMzhFMDM4RUEwQUYxMUVBQkY1NEIzNTg4MTM4RjIxOCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkUzOEUwMzhCQTBBRjExRUFCRjU0QjM1ODgxMzhGMjE4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkUzOEUwMzhDQTBBRjExRUFCRjU0QjM1ODgxMzhGMjE4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ZMccrwAACbZJREFUeNrkWUtvJFcV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",c=d,m=c;n.number=n.number===void 0?"--":n.number+"%",n.number=n.number.startsWith(".")?"0"+n.number:n.number,n.number=n.number.startsWith("-.")?n.number.replace("-.","-0."):n.number;var g="${pageContext.request.requestURL}".replace("${pageContext.request.requestURI}",""),t=[{name:n.name+"："+n.number,tooltip:{formatter:"{b}"},symbol:d,symbolSize:[60,40],value:[n.x,n.y],datadate:n.datadate,spid:n.id}];if("children"in n)for(var h=n.children,r,s,i,b,l=0;l<h.length;l++){r=h[l].fx===1?.1:-.1,h[l].number=h[l].number===void 0?"--":h[l].number+"%",h[l].number=h[l].number.startsWith(".")?"0"+h[l].number:h[l].number,h[l].number=h[l].number.startsWith("-.")?h[l].number.replace("-.","-0."):h[l].number,s=h[l].code==="2"||h[l].code===2?"#C75050":"#53B5EA";var f={source:n.name+"："+n.number,target:h[l].name+`：
`+h[l].number,lineStyle:{curveness:r,color:s}};a.push(f),i=h[l].code==="2"||h[l].code===2?"rgba(199,80,80,0.5)":"rgba(55,155,255,0.5)";var u={coords:[[n.x,n.y],[h[l].x,h[l].y]],lineStyle:{curveness:r,color:i}};o.push(u);var y={name:h[l].name+`：
`+h[l].number,tooltip:{formatter:"{b}"},symbol:c,symbolSize:[60,40],value:[h[l].x,h[l].y],datadate:h[l].datadate,ifend:h[l].ifend,spid:h[l].id};if(t.push(y),"children"in h[l])for(var v=h[l].children,x=0;x<v.length;x++){r=v[x].fx===1?.1:-.1,v[x].number=v[x].number===void 0?"--":v[x].number+"%",v[x].number=v[x].number.startsWith(".")?"0"+v[x].number:v[x].number,v[x].number=v[x].number.startsWith("-.")?v[x].number.replace("-.","-0."):v[x].number,s=v[x].code==="2"||v[x].code===2?"#C75050":"#53B5EA";var f={source:h[l].name+`：
`+h[l].number,target:v[x].name+`：
`+v[x].number,lineStyle:{curveness:r,color:s}};a.push(f),i=v[x].code==="2"||v[x].code===2?"rgba(199,80,80,0.5)":"rgba(55,155,255,0.5)";var u={coords:[[h[l].x,h[l].y],[v[x].x,v[x].y]],lineStyle:{curveness:r,color:i}};o.push(u),y={name:v[x].name+`：
`+v[x].number,tooltip:{formatter:"{b}"},symbol:m,symbolSize:[60,40],value:[v[x].x,v[x].y],datadate:v[x].datadate,ifend:v[x].ifend,spid:v[x].id},t.push(y)}}return e.data=t,e.links=a,e.lines=o,e.len=n.len,e.leny=n.leny,e}var jsons=format(data);debugger;jsons=format2(jsons);var returninfo=initCharts(jsons);option={backgroundColor:"#f5f5f5",grid:{left:"5%",right:"5%"},xAxis:{show:!1,type:"value",max:returninfo.len[0],min:returninfo.len[1]},yAxis:{show:!1,type:"value",max:returninfo.leny[0],min:returninfo.leny[1]-10},tooltip:{},series:[{type:"graph",zlevel:5,draggable:!1,coordinateSystem:"cartesian2d",label:{show:!0,color:"#000",position:"bottom"},data:returninfo.data,links:returninfo.links,lineStyle:{opacity:1,width:2}},{type:"lines",coordinateSystem:"cartesian2d",zlevel:1,animation:!1,effect:{show:!0,period:5,trailLength:.01,symbolSize:12,symbol:"pin",loop:!0},data:returninfo.lines,lineStyle:{width:0}},{type:"lines",coordinateSystem:"cartesian2d",zlevel:1,animation:!1,effect:{show:!0,period:6,trailLength:.01,symbolSize:12,symbol:"pin",loop:!0},data:returninfo.lines,lineStyle:{width:0}},{type:"lines",coordinateSystem:"cartesian2d",zlevel:1,animation:!1,effect:{show:!0,period:8,trailLength:.01,symbolSize:12,symbol:"pin",loop:!0},data:returninfo.lines,lineStyle:{width:0}}]};
