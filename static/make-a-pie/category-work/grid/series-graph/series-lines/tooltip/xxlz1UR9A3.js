var points=[{name:"故障初判",value:[0,300],target:["离线实验","装置检修"]},{name:"离线实验",value:[300,300],target:["告警确认","在线数据审核"]},{name:"告警确认",value:[300,500],target:["离线实验"],offset:!0},{name:"装置检修",value:[300,100],offset:!0,target:["在线数据审核"],selected:!0},{name:"在线数据审核",value:[600,300],target:["关闭"]},{name:"关闭",value:[900,300]}],getPointCoordinate=function(a,e){var r=a.filter(t=>t.name==e);return console.log("targetItem,",r),r[0].value},getRoutePoint=function(a,e){var r=getPointCoordinate(points,e),t=100,l=[];let o=a[0],n=a[1],s=r[0],v=r[1];if(o==s){var f={name:"offset1"+e,value:[o+t,n],symbol:"none",target:["offset2"+e]},u={name:"offset2"+e,value:[o+t,v],symbol:"none",target:[e]};l.push(f),l.push(u)}else if(n==v){var f={name:"offset1"+e,value:[o,n-t],symbol:"none",target:["offset2"+e]},u={name:"offset2"+e,value:[s,n-t],symbol:"none",target:[e]};l.push(f),l.push(u)}else l.push({name:"offset1"+e,value:[s,n],symbol:"none",target:[e]});return l},handlePoints=function(a){for(var e=0;e<a.length;e++){var r=a[e],t=r.value;if(r.target)for(var l=r.target,o=0;o<l.length;o++){var n=r.selected;if(r.offset){var s=getRoutePoint(t,l[o]),v=[s[0].name];r.target=v;for(const u in s){var f=s[u];f.selected=n,a.push(f)}}}}return a},newPoints=handlePoints(points);console.log("newPoints",newPoints);var linesData=function(a){return[{coords:[[300,100],[600,100]]},{coords:[[600,100],[600,300]]}]},seriesData=function(a){return a.map(e=>({name:e.name,symbol:e.symbol&&e.symbol==="none"?"none":"rect",symbolSize:e.name.indexOf("offset")!=-1?0:[80,40],draggable:!1,fixed:!0,value:e.value,edgeSymbol:["circle","arrow"],itemStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,1,0,[{offset:0,color:"#157eff"},{offset:1,color:"#35c2ff"}])}}}))};console.log("seriesData",seriesData(newPoints));var links=function(a){console.log("links data",a);for(var e=[],r=0;r<a.length;r++){var t=a[r],l=t.value;if(console.debug("currentCoordinate",l),t.target){console.debug("item.target",t.target);for(var o=0;o<t.target.length;o++)e.push({source:t.name,target:t.target[o],lineStyle:{normal:{color:"#12b5d0"}}})}}return console.log("links",e),e};option={backgroundColor:"#fff",roam:!0,xAxis:{show:!1,type:"value"},yAxis:{show:!1,type:"value"},tooltip:{},series:[{type:"graph",draggable:!1,coordinateSystem:"cartesian2d",edgeSymbol:["circle","arrow"],edgeSymbolSize:[2,6],symbol:"rect",symbolOffset:["15%",0],label:{normal:{show:!0}},lineStyle:{normal:{opacity:1,curveness:0,type:"dashed",width:1}},data:seriesData(newPoints),links:links(newPoints)},{type:"lines",coordinateSystem:"cartesian2d",z:1,zlevel:2,animation:!1,effect:{show:!0,period:5,trailLength:.01,symbolSize:6,symbol:"arrow",loop:!0,color:"rgba(55,155,255,0.5)"},lineStyle:{curveness:0,color:"#0ca361",opacity:.6,width:1,type:"dashed"},data:linesData()}]};
