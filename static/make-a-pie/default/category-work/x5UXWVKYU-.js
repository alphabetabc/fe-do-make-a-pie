option={title:{text:"位置获取中。。。。。",left:"center",top:"0",textStyle:{color:"rgba(18,89,147,1)",fontSize:21},backgroundColor:"rgba(255,255,255,0.8)"},bmap:{roam:!0,mapStyle:{style:"grayscale"}},series:[{coordinateSystem:"bmap",type:"effectScatter",symbol:"arrow",itemStyle:{normal:{color:"rgba(18,89,147,1)"}},data:[]}]},setTimeout(function(){var i=myChart.getModel().getComponent("bmap").getBMap();i.addControl(new BMap.NavigationControl({})),i.addControl(new BMap.ScaleControl({})),i.enableScrollWheelZoom(),i.addControl(new BMap.MapTypeControl),new AMap.Geolocation().getCurrentPosition(function(b,e){var t=e.addressComponent;t.city||(t.city=t.province.replace("市","城区")),f(t.province,t.city,t.district);function f(c,o,d){new AMap.DistrictSearch({level:"province",subdistrict:1,showbiz:!1,extensions:"base"}).search("中国",function(u,m){u=="complete"&&m.districtList[0].districtList.forEach(function(n){n.name!=c?a(n.name):o&&new AMap.DistrictSearch({level:"city",subdistrict:1,showbiz:!1,extensions:"base"}).search(n.name,function(s,r){s=="complete"&&r.districtList[0].districtList.forEach(function(l){l.name!=o?a(l.name):d&&new AMap.DistrictSearch({level:"district",subdistrict:1,showbiz:!1,extensions:"base"}).search(l.name,function(y,h){y=="complete"&&h.districtList[0].districtList.forEach(function(p){p.name!=d&&a(p.name)})})})})});function a(n){new BMap.Boundary().get(n,function(s){s.boundaries.forEach(function(r){i.addOverlay(new BMap.Polygon(r,{strokeColor:"white",fillColor:"black",strokeWeight:1,strokeOpacity:.01,fillOpacity:.521}))})})}})}i.centerAndZoom(t.city),setTimeout(function(){myChart.setOption({title:{text:"当前位置："+e.formattedAddress},tooltip:{show:!0,backgroundColor:option.title.backgroundColor,formatter:function(c){var o=new BMap.InfoWindow;o.setWidth(0),o.setHeight(0),o.setTitle(e.formattedAddress),o.setContent('<ul style="color:'+option.title.textStyle.color+';"><li>省市区：'+t.province+"</li><li>地级市："+t.city+"</li><li>区 县："+t.district+"</li><li>街 道："+(t.street?t.street:"未知")+"</li><li>经 度："+e.position.lng+"</li><li>纬 度："+e.position.lat+"</li></ul>"),i.openInfoWindow(o,new BMap.Point(e.position.lng,e.position.lat))}},series:[{data:[{name:t,value:[e.position.lng,e.position.lat]}]}]}),setTimeout(function(){myChart.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:0})},100)},100)})},2e3);
