function getColor(l){var e;if(isNaN(l))switch(l){case"暂无数据":e="gray";break;case"优":e="#43ce17";break;case"良":e="#efdc31";break;case"轻度污染":e="#fa0";break;case"中度污染":e="#ff401a";break;case"重度污染":e="#d20040";break;case"严重污染":e="#9c0a4e";break;case"AQI":e="hsl(40,100%,50%)";break;case"臭氧":e="hsl(80,100%,50%)";break;case"二氧化硫":e="hsl(120,100%,50%)";break;case"NO2":e="hsl(160,100%,50%)";break;case"一氧化碳":e="hsl(200,100%,50%)";break;case"细颗粒物":e="hsl(240,100%,50%)";break;case"可吸入颗粒物":e="hsl(280,100%,50%)";break;default:break}else{let t=function(n){return n<=50?"优":n<=100?"良":n<=150?"轻度污染":n<=200?"中度污染":n<=300?"重度污染":"严重污染"};var a=t;e=getColor(t(l))}return e}let backgroundColor,textColor="gray",fontFamily="仿宋",$body=$(myChart.getDom());$body.css({"font-family":fontFamily}),option={title:{subtext:"数据来源：中国环境监测总站",sublink:"http://123.127.175.45:8082/",left:10,bottom:"400",textStyle:{color:textColor}},grid:{show:!1,containLabel:!0,zlevel:"2",left:"10",bottom:"180",width:"30%",height:"30%",borderWidth:0},xAxis:{type:"value",splitLine:{show:!1},show:!1},bmap:{roam:!0,center:[116.39825,40.045975]},visualMap:[{seriesIndex:0,backgroundColor:"whitesmoke",bottom:2,left:2,borderRadius:0,itemWidth:38,itemGap:4,padding:5,inverse:!0,pieces:[{value:"NaN",label:"暂无",color:getColor("暂无")},{min:0,max:50,label:"优",color:getColor("优")},{min:51,max:100,label:"良",color:getColor("良")},{min:101,max:150,label:"轻度",color:getColor("轻度污染")},{min:151,max:200,label:"中度",color:getColor("中度污染")},{min:201,max:300,label:"重度",color:getColor("重度污染")},{min:301,label:"严重",color:getColor("严重污染")}],textStyle:{color:"black"}}],tooltip:{trigger:"item",confine:!0,enterable:!0,textStyle:{fontFamily}},series:[{type:"effectScatter",coordinateSystem:"bmap",symbol:"rect",symbolSize:function(l,e){var a=[12*e.name.length,25];return a},showEffectOn:"render",rippleEffect:{brushType:"stroke"},tooltip:{formatter:function(l){const e=l.data.data;var a=$("<ul><li><b>"+l.name+"</b></li></ul>");a.css({"font-size":"small","border-radius":"5px","list-style":"none",padding:"10px","box-shadow":"0 1px 4px #ddd",color:l.color}),a.children().first().css({"font-size":"large","border-bottom":"1px double"});let t={title:{text:e.name},grid:{show:!0},yAxis:{type:"category",axisLabel:{rotate:-45,textStyle:{color:"white"},show:!1},data:[],show:!1,name:e.name,nameLocation:"end",nameTextStyle:{color:"white"}},series:[{},{zlevel:"2",type:"bar",gridIndex:0,label:{normal:{show:!0,position:"insideLeft",formatter:"{b}:{c}",fontFamily,fontWeight:"bold"}},data:[]}]};return a.children().first().find("b").css({color:"whitesmoke","text-shadow":"0 1px 2px black"}),e.aqi&&(a.children().first().append('<b style="font-size: xx-large;float: right;">'+e.aqi+"</b>"),t.yAxis.data.push("AQI"),t.series[1].data.push({value:e.aqi,itemStyle:{color:getColor(e.aqi)}})),e.pm2_5&&($("<li><b>细颗粒物：</b>"+e.pm2_5+"<span>μg/m<sup>3</sup></span></li>").appendTo(a),t.yAxis.data.push("细颗粒物"),t.series[1].data.push({value:e.pm2_5,itemStyle:{color:getColor("细颗粒物")}})),e.pm10&&($("<li><b>可吸入颗粒物：</b>"+e.pm10+"<span>μg/m<sup>3</sup></span></li>").appendTo(a),t.yAxis.data.push("可吸入颗粒物"),t.series[1].data.push({value:e.pm10,itemStyle:{color:getColor("可吸入颗粒物")}})),e.o3&&($("<li><b>臭氧：</b>"+e.o3+"<span>μg/m<sup>3</sup></span></li>").appendTo(a),t.yAxis.data.push("臭氧"),t.series[1].data.push({value:e.o3,itemStyle:{color:getColor("臭氧")}})),e.co&&($("<li><b>一氧化碳：</b>"+e.co+"<span>mg/m<sup>3</sup></span></li>").appendTo(a),t.yAxis.data.push("一氧化碳"),t.series[1].data.push({value:e.co,itemStyle:{color:getColor("一氧化碳")}})),e.so2&&($("<li><b>二氧化硫：</b>"+e.so2+"<span>μg/m<sup>3</sup></span></li>").appendTo(a),t.yAxis.data.push("二氧化硫"),t.series[1].data.push({value:e.so2,itemStyle:{color:getColor("二氧化硫")}})),a.children("li").find("span").css("font-size","xx-small"),myChart.setOption(t),a.prop("outerHTML")}},hoverAnimation:!0,label:{normal:{formatter:"{b}",show:!0,borderColor:"#ddd",borderWidth:1,fontFamily,fontWeight:"bold",fontSize:13,color:"whitesmoke",padding:4}},itemStyle:{normal:{shadowBlur:10,shadowColor:"#333"}}}]},setTimeout(function(){const l=[{name:"张家口市",o3:61,pubtime:"2018-12-28 14:00:00",latitude:"40.812435",pm2_5:10,so2:6,aqi:23,pm10:23,city_code:"131200",co:.2,longitude:"114.89305"},{name:"秦皇岛市",o3:55,pubtime:"2018-12-28 14:00:00",latitude:"39.9366",pm2_5:15,so2:10,aqi:28,pm10:28,city_code:"130300",co:.8,longitude:"119.60482"},{name:"承德市",o3:58,pubtime:"2018-12-28 14:00:00",latitude:"40.96416",pm2_5:7,so2:6,aqi:31,pm10:31,city_code:"130800",co:.3,longitude:"117.92774"},{name:"北京市",o3:53,pubtime:"2018-12-28 14:00:00",latitude:"40.045975",pm2_5:9,so2:3,aqi:32,pm10:32,city_code:"110000",co:.3,longitude:"116.39825"},{name:"石家庄市",o3:57,pubtime:"2018-12-28 14:00:00",latitude:"38.03179861125",pm2_5:15,so2:12,aqi:34,pm10:34,city_code:"130100",co:.7,longitude:"114.4970652875"},{name:"唐山市",o3:55,pubtime:"2018-12-28 14:00:00",latitude:"39.6449533333333",pm2_5:19,so2:8,aqi:36,pm10:36,city_code:"130200",co:.6,longitude:"118.182916666667"},{name:"廊坊市",o3:58,pubtime:"2018-12-28 14:00:00",latitude:"39.54584",pm2_5:12,so2:4,aqi:40,pm10:40,city_code:"131000",co:.5,longitude:"116.72406"},{name:"沧州市",o3:65,pubtime:"2018-12-28 14:00:00",latitude:"38.3157666666667",pm2_5:16,so2:12,aqi:45,pm10:45,city_code:"130900",co:.5,longitude:"116.871566666667"},{name:"天津市",o3:51,pubtime:"2018-12-28 14:00:00",latitude:"39.0985566666667",pm2_5:8,so2:6,aqi:51,pm10:52,city_code:"120000",co:.4,longitude:"117.319033333333"},{name:"保定市",o3:54,pubtime:"2018-12-28 14:00:00",latitude:"38.8762666666667",pm2_5:24,so2:18,aqi:52,pm10:53,city_code:"130600",co:.6,longitude:"115.4852"},{name:"衡水市",o3:55,pubtime:"2018-12-28 14:00:00",latitude:"37.74335",pm2_5:28,so2:12,aqi:54,pm10:57,city_code:"131100",co:.6,longitude:"115.6743"},{name:"邢台市",o3:52,pubtime:"2018-12-28 14:00:00",latitude:"37.0771",pm2_5:31,so2:14,aqi:54,pm10:58,city_code:"130500",co:.5,longitude:"114.506675"},{name:"邯郸市",o3:49,pubtime:"2018-12-28 14:00:00",latitude:"36.60786",pm2_5:32,so2:18,aqi:64,pm10:77,city_code:"130400",co:.8,longitude:"114.513875"}].sort(function(o,i){return o.aqi>i.aqi}),e=$("<table></table>");e.css({position:"fixed",right:"12px",bottom:"21px","z-index":9,"box-shadow":"0 1px 4px #ddd"}),e.appendTo($body),myChart.setOption({series:[{data:l.filter(function(o){return o.latitude&&o.longitude}).map(function(o,i){o.value=[o.longitude,o.latitude].concat(o.aqi);var s=$("<tr><td>"+(i+1)+"</td><td>"+o.name+"</td><td>"+(o.aqi?o.aqi:"--")+"</td></tr>");return s.appendTo(e),s.children().not(":eq(1)").css({"text-align":"center"}),s.children().css({"border-bottom":"1px dotted"}),s.children().last().css("background-color",getColor(o.aqi)),{name:o.name,value:o.value,data:o}})}]});var a=myChart.getModel().getComponent("bmap").getBMap();a.setMinZoom(7),a.setMaxZoom(10),a.addControl(new BMap.NavigationControl);const t=$("<select></select");t.css({position:"fixed",right:".521%",top:".521%"}),t.appendTo($body),t.append('<option value="normal"></option>'),t.append('<option value="dark">极夜黑</option>'),t.change(function(){let o=$(this).val();switch(console.log(o),o){case"normal":case"dark":case"light":a.setMapStyle({style:o});break;default:json=$(this).find("option:selected").data("json"),json.push({featureType:"road",elementType:"all",stylers:{visibility:"off"}}),a.setMapStyle({styleJson:json})}function i(s,r){myChart.setOption({title:{textStyle:{color:r}},grid:{backgroundColor:s},tooltip:{backgroundColor:s},series:[{label:{backgroundColor:s,color:r}}]}),$body.css({"background-color":s,color:r}),e.css({"background-color":s})}switch(o){case"一蓑烟雨":i("rgba(237, 243, 243,.88)","gray");break;case"dark":i("rgba(33, 33, 33,.88)","white");break;case"绿野仙踪":i("rgba(31, 60, 69,.88)","whitesmoke");break;case"青花瓷":i("rgba(241, 241, 241,.88)","rgb(27, 129, 197)");break;default:i(backgroundColor,textColor)}});const n="/asset/get/s/data-1572317283167-8bAaywO7.json";$.getJSON(n,function(o){for(key in o)if(key!="眼眸"){let i=$("<option>"+key+"</option>");i.data("json",o[key]),t.append(i)}t.children().eq(3).prop("selected",!0),t.trigger("change")})},100);
