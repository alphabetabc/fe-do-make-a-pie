class RingCharts{constructor(t){this.options=this.deepCopy(this.defaultConfig(),t),this.parentContainer=typeof this.options.container=="string"?document.querySelector(this.options.container):this.options.container,this.container=document.createElement("div"),this.tips=document.createElement("div"),this.setStyle(this.tips,this.options.tooltip.style),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.pixelRatio=this.getPixelRatio(this.ctx),this.width=this.parentContainer.offsetWidth,this.height=this.parentContainer.offsetHeight,this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.radius=(this.canvas.width>this.canvas.height?this.canvas.height:this.canvas.width)/2,this.maxRadius=this.handleNum(this.options.polar.maxRadius,this.radius),this.minRadius=this.handleNum(this.options.polar.minRadius,this.radius),this.center={x:this.canvas.width/2,y:this.canvas.height/2},this.container.style.cssText=this.canvas.style.cssText="position:relative;width:100%;height:100%;overflow:hidden",this.container.appendChild(this.canvas),this.parentContainer.appendChild(this.container),this.container.appendChild(this.tips),this.resultData=[],this.options.tooltip.show&&(this.canvas.onmousemove=this.debounce(this.mousemove,20)),this.resizeTimer=null,this.animateStartTime=null,this.animateTimer=null}handleNum(t,i){let e=0;return t.toString().indexOf("%")>-1?e=t.replace("%","")/100*i:t>0&&t<=1?e=t*i:e=parseInt(t),e}debounce(t,i){let e=null;return n=>{e!==null&&clearTimeout(e),e=setTimeout(()=>{t.call(this,n)},i)}}mousemove(t){this.draw(this.resultData,{callBack:null,type:"mousemove",x:t.offsetX,y:t.offsetY})}click(t){this.canvas.onclick=i=>{this.draw(this.resultData,{callBack:t,type:"click",x:i.offsetX,y:i.offsetY})}}resize(){this.resizeTimer&&(clearTimeout(this.resizeTimer),this.resizeTimer=null),this.resizeTimer=setTimeout(()=>{this.width=this.parentContainer.offsetWidth,this.height=this.parentContainer.offsetHeight,this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio,this.radius=(this.canvas.width>this.canvas.height?this.canvas.height:this.canvas.width)/2,this.maxRadius=this.handleNum(this.options.polar.maxRadius,this.radius),this.minRadius=this.handleNum(this.options.polar.minRadius,this.radius),this.center={x:this.canvas.width/2,y:this.canvas.height/2},this.draw(this.resultData)},20)}setStyle(t,i){for(let e in i)t.style[e]=i[e]}deepCopy(t,i){for(var e in i)i.hasOwnProperty(e)&&(typeof i[e]=="object"&&t[e]?this.deepCopy(t[e],i[e]):t[e]=i[e]);return t}defaultConfig(){return{color:["#18b78e","#6c77fd","#ffbe75","#ff647c","#01b3ee","#164bcd"],polar:{maxRadius:"90%",minRadius:"10%",center:["center","center"],strokeBackgroundColor:"#031f3e",strokeBackgroundWidth:14,strokeWidth:14,strokeColor:"#6f78cc",lineCap:"round"},xAxis:{marker:{show:!0,symbolSize:10,offsetX:40},axisLabel:{show:!0,offsetX:70,font:"24px Microsoft YaHei",color:"#00b2f6",align:"left",verticalAlign:"middle",formatter:function(t){return t.name}}},animation:{show:!1,duration:800},desc:{show:!0,offsetCenterY:0,font:"24px Microsoft YaHei",color:"#000",align:"center",verticalAlign:"middle",formatter:function(t){return t.value+t.unit}},tooltip:{style:{position:"absolute",display:"none",whiteSpace:"nowrap",zIndex:"9999999",transition:"left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s",backgroundColor:"rgba(50, 50, 50, 0.7)",borderRadius:"4px",border:"0px solid rgb(51, 51, 51)",color:"rgb(255, 255, 255)",font:"20px / 30px Microsoft YaHei",padding:"5px",left:"0px",top:"0px",pointerEvents:"none"},markerTemplate:'<span style="display: inline-block;width:14px;height: 14px;border-radius: 50%;margin-right: 4px;background-color: #"></span>',show:!0,formatter:function(t){return`${t.marker}${t.data.name}：${t.data.value}`}}}}getPixelRatio(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/i}draw(t,i){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),!t)return;this.resultData=t;let e=[],n=(this.maxRadius-this.minRadius)/t.length,h=t.map(s=>s.value),p=Math.max(...h)*1.2,a=1;!i&&this.options.animation.show&&(this.animateStartTime?a=(new Date-this.animateStartTime)/this.options.animation.duration:(a=0,this.animateStartTime=new Date),a>=1?(a=1,this.animateStartTime=null,window.cancelAnimationFrame(this.animateTimer),this.animateTimer=null):this.animateTimer=window.requestAnimationFrame(()=>{this.draw(this.resultData)}));for(var o=0;o<h.length;o++){let s=this.maxRadius-o*n-this.options.polar.strokeWidth/2;this.drawArc({deg:0,stroke:this.options.polar.strokeBackgroundColor,strokeWidth:this.options.polar.strokeBackgroundWidth,radius:s,lineCap:this.options.polar.lineCap}),e.push(this.drawArc({deg:(1-h[o]/p*a)*Math.PI*3/2,stroke:this.options.color[o%this.options.color.length],strokeWidth:this.options.polar.strokeWidth,radius:s,lineCap:this.options.polar.lineCap},i)),this.options.xAxis.marker.show&&this.drawCircle({x:this.handleNum(this.options.xAxis.marker.offsetX,this.radius),y:s,fillColor:this.options.color[o%this.options.color.length],symbolSize:this.options.xAxis.marker.symbolSize,centerX:this.center.x,centerY:this.center.y}),this.options.xAxis.axisLabel.show&&this.drawText({x:this.handleNum(this.options.xAxis.axisLabel.offsetX,this.radius),y:s,fillColor:this.options.xAxis.axisLabel.color=="auto"?this.options.color[o%this.options.color.length]:this.options.xAxis.axisLabel.color,font:this.options.xAxis.axisLabel.font,text:this.options.xAxis.axisLabel.formatter(t[o]),align:this.options.xAxis.axisLabel.align,verticalAlign:this.options.xAxis.axisLabel.verticalAlign,centerX:this.center.x,centerY:this.center.y})}if(i)if(e.some(s=>s===!0)){let s=e.lastIndexOf(!0),l=this.options.color[s%this.options.color.length];this.tips.innerHTML=this.options.tooltip.formatter({marker:this.options.tooltip.markerTemplate.replace("#",l),color:l,data:t[s]});let c=i.x+20,d=i.y+20;i.x+this.tips.offsetWidth+20>this.width&&(c=i.x-20-this.tips.offsetWidth),i.y+this.tips.offsetHeight+20>this.height&&(d=i.y-20-this.tips.offsetHeight),this.tips.style.left=`${c}px`,this.tips.style.top=`${d}px`,this.tips.style.display="block",this.container.style.cursor="pointer",i.callBack&&i.callBack(t[s])}else this.container.style.cursor="default",this.tips.style.display="none"}drawArc(t,i){let e=!1;return this.ctx.beginPath(),this.ctx.arc(this.center.x,this.center.y,t.radius,Math.PI*3/2,t.deg,!0),this.ctx.lineCap=t.lineCap,this.ctx.strokeStyle=t.stroke,this.ctx.lineWidth=t.strokeWidth,this.ctx.stroke(),i&&this.ctx.isPointInStroke(i.x*this.pixelRatio,i.y*this.pixelRatio)&&(e=!0),e}drawText(t){this.ctx.save(),this.ctx.beginPath(),this.ctx.translate(t.centerX,t.centerY),this.ctx.font=t.font,this.ctx.fillStyle=t.fillColor,this.ctx.textAlign=t.align,this.ctx.textBaseline=t.verticalAlign,this.ctx.fillText(t.text,t.x,-t.y),this.ctx.restore()}drawCircle(t){this.ctx.save(),this.ctx.beginPath(),this.ctx.translate(t.centerX,t.centerY),this.ctx.arc(t.x,-t.y,t.symbolSize,0,Math.PI*2,!1),this.ctx.fillStyle=t.fillColor,this.ctx.fill(),this.ctx.restore()}}let domObj=document.createElement("div");domObj.style.cssText="position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: 99;background-color: #000;",document.getElementById("chart-panel").appendChild(domObj);var ringCharts=new RingCharts({container:domObj,animation:{show:!0}});ringCharts.click(function(r){console.log(r)}),ringCharts.draw([{name:"类目名称一",value:69,unit:"个"},{name:"类目名称二",value:32,unit:"个"},{name:"类目名称三",value:11,unit:"个"},{name:"类目名称四",value:100,unit:"个"},{name:"类目名称五",value:88,unit:"个"}]),window.addEventListener("resize",function(){ringCharts.resize()});
