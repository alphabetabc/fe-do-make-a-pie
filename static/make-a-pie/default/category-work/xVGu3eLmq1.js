var option={bmap:{center:[121.4693,31.2],zoom:10,roam:!0,enableMapClick:!1,mapStyle:{styleJson:[{featureType:"all",elementType:"all",stylers:{lightness:15,saturation:-50}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#ffffff"}},{featureType:"poi",elementType:"labels.icon",stylers:{visibility:"off"}},{featureType:"road",elementType:"labels",stylers:{visibility:"off"}}]}},title:{x:"center",text:"上海养老设施床位热力图2021",subtext:"",textStyle:{color:"#696969",fontSize:25}}};myChart.setOption(option),setTimeout(init,0);function init(){initMap(),initMapv()}function getMap(){return myChart.getModel().getComponent("bmap").getBMap()}function initMap(){var M=new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_SMALL}),K=new BMap.ScaleControl({offset:new BMap.Size(100,50)}),U=getMap();return U.addControl(M),U.addControl(K),U.disableDoubleClickZoom(),U}function initMapv(){for(var M=getMap(),K=[],U=points.length;U--;){var a1=points[U];K.push({geometry:{type:"Point",coordinates:[a1[0],a1[1]]},count:a1[2]})}var t1=new mapv.DataSet(K),j={fillStyle:"#DC143C",strokeStyle:"black",lineWidth:1,size:25,globalAlpha:1,gradient:{.25:"rgb(0,0,255)",.5:"rgb(0,255,0)",.75:"yellow",1:"rgb(255,0,0)"},label:{show:!0,fillStyle:"white",average:!1},max:600,draw:"heatmap",methods:{click:function(n1){console.log(n1)}}},e1=new mapv.baiduMapLayer(M,t1,j)}var points=[[121.380403038199,31.3594409168496,188],[121.608683668294,31.5461829333558,41],[121.660925661872,31.591197985231,133],[121.488624126292,31.2136632198447,150],[121.465910264862,31.1180561554501,86],[121.458158207209,31.134335570808,70],[121.462304785443,31.1238802945588,80],[121.457852269505,31.1334408892971,222],[121.437865104857,31.2547278249629,226],[121.4581342503,31.1109458060308,750],[121.445269589244,31.2094543073803,324],[121.602332165949,31.2726900676622,140],[121.598592251517,31.2866355295784,100],[121.515987284669,31.1662244249428,364],[121.580017841165,31.2495250746587,142],[121.573504138082,31.1552964031984,200],[121.533889224414,31.1653559865706,133],[121.516993265569,31.1413529638887,225],[121.517567192959,31.2063591665174,80],[121.525814625677,31.1910548423087,274],[121.495141804377,31.2668828894747,250],[121.477456055327,31.3005765701448,860],[121.492554145525,31.2607113819583,205],[121.530612924558,31.6177887335789,50],[121.534764353642,31.1941403722925,60],[121.541898785833,31.3257489117535,50],[121.374229002395,31.6845129694279,190],[121.423427290769,31.2930550872056,326],[121.481182136752,31.2930204065837,180],[121.507822408922,31.2944615687467,200],[121.392049119983,31.2795252601165,500],[121.507171258699,31.2770354649283,440],[121.480162649829,31.2049094302128,70],[121.482659961604,31.2073022793219,258],[121.477643262196,31.2437500492745,80],[121.218141517457,30.8536781061824,966],[121.561955697615,31.1919513156987,195],[121.540679160035,31.1759117495344,301],[121.537788850379,31.1478111336516,108],[121.54782433057,31.1587113678358,200],[121.525315599,31.1361345375517,140],[121.532039972691,31.1477068322086,50],[121.420723031861,31.2037325598615,43],[121.412966798885,31.2190214023794,42],[121.625489347436,31.1446798876142,548],[121.498924029896,31.1743568213001,80],[120.924742714655,31.0517653279711,188],[121.145722688311,31.1592362534301,270],[121.290420583739,31.0115705582651,200],[121.284367980874,31.3127718972611,778],[121.136779718298,31.1718421243789,181],[121.612359175119,31.27585375156,139],[121.631435312454,31.2645707890989,252],[121.42065932134,31.3830689022684,313],[121.140338484932,31.1931477552379,565],[121.123011178645,31.1423838036082,248],[121.463387063922,31.1601864618775,85],[121.430970000119,31.1418728560926,312],[121.362879972277,31.2098680918167,440],[121.361658989139,31.2188006574138,825],[121.490814286752,31.293611020468,837],[121.624895926816,31.5422416649173,400],[121.391273972158,31.1828514443081,605],[121.468456022253,31.2840440613142,300],[121.670580819273,31.1157467801201,148],[121.221409640038,31.0723231521727,1730],[121.067247269621,31.0812882900961,158],[121.616847019616,31.0806688883448,113],[121.823745463319,31.5427393720401,156],[121.359601735674,31.1355371350924,149],[121.421202175444,31.0850951573168,498],[121.378790310317,30.9994569755198,293],[121.500377488212,31.0975768761327,148],[121.326892056936,31.2287343023645,316],[121.38149896104,31.1909817170893,184],[121.224533737296,31.2744304775442,370],[121.506275153139,31.0830821151875,67],[121.494560404882,31.2714426249808,196],[121.21965600036,31.3244088801152,128],[121.298473020382,31.3397004299362,334],[121.389433325304,31.3401701622144,213],[121.411668274016,31.3912951813554,396],[121.403980413766,31.2394086081689,70],[121.356227570823,31.7189904977793,166],[121.37489103559,31.7453519370436,102],[121.2280656949,31.7553031299131,60],[121.428181842172,31.7111164993574,106],[121.838992582401,31.5506177749438,100],[121.624514791958,31.5515081104005,150],[121.501835707546,31.4059250545365,270],[121.728425816502,31.0770068270558,160],[121.389868483357,31.1492501685988,95],[121.358324772832,31.1440411889081,731],[121.35745695132,31.1436809208561,316],[121.395301188048,31.1410604799542,200],[121.282156290725,31.20741010722,420],[121.402628971517,31.1601738971706,187],[121.419475449898,31.2029802861769,50],[121.358653469107,31.2236945035105,398],[121.469344985386,31.2142398570488,59],[121.50079747119,31.2241278837222,69],[121.506407004625,31.1698286261745,220],[121.314280296729,31.2119739706899,197],[121.418535189927,31.1868202192587,66],[121.524275019863,31.0814088297959,762],[121.548138415905,31.3226275442549,105],[121.515039524745,31.2073560159625,250],[121.47805466456,31.3156236296532,462],[121.380825331619,31.3250913317919,288],[121.500596854417,31.3781952221126,170],[121.48619817411,31.347912302477,284],[121.464731875779,31.3448840118502,154],[121.506556919238,30.9890096778759,130],[121.296668747714,31.7580964456353,179],[121.479131934087,30.9963652848312,208],[121.447777748058,30.9784071627781,100],[121.404302999767,30.9681668456363,357],[121.408339351423,30.9683069187347,140],[121.473123977005,31.2837388490994,200],[121.492990093189,31.3026848802962,204],[121.496643764003,31.272892233138,140],[121.432877285073,31.1094106787803,200],[121.375818669876,31.0864278943146,500],[121.146010136193,31.3149346374898,696],[121.232170939403,31.357291549585,470],[121.252727556981,31.3986786642959,260],[121.298419994306,31.2988458488722,380],[121.320938537169,31.2908192686795,400],[121.264336845968,30.7591925197545,247],[121.20666769833,30.8516176749894,302],[121.297129299068,30.8076477743424,335],[121.448194922934,31.2381755871763,302],[121.456205021539,31.2717618767618,241],[121.466157985183,31.3198765859907,321],[121.29970214576,31.2141228078001,293],[121.275878311093,31.2480721456423,271],[121.543316222097,31.0721497484239,519],[121.43455127739,31.0152321454913,426],[121.717874499643,31.2027538180889,112],[121.677083389656,31.1966135930865,303],[121.583290180392,31.3409415258972,250],[121.774859587635,31.0609104552718,250],[121.666200351029,31.2118383782712,727],[121.63976206465,31.1804131562002,250],[121.757977013542,31.1878978493711,200],[121.821263624856,31.0945417064523,231],[121.456506133546,31.2580687534796,459],[121.406913291426,31.2361038032529,234],[121.401193241261,31.2631300110511,150],[121.234195005869,31.2469179536927,146],[121.224227415117,30.9381616306937,176],[121.194932863962,31.057036955426,150],[121.313910769774,31.1287343901434,600],[121.283242224409,30.9360045490848,428],[121.283163691846,30.9354473629515,400],[121.442880802655,31.1706626014753,198],[121.434986955563,31.1443219883868,168],[121.459914933465,31.1745419704071,237],[121.474276889246,31.2006877861082,200],[121.54838707226,31.2743313657549,285],[121.542502716627,31.3199787534998,508],[121.535966009736,31.2853558139417,209],[121.546832762084,31.3015739702374,300],[121.549851304851,31.3051391672929,1e3],[121.448836334627,31.0957632028105,498],[121.823745463319,31.5427393720401,300],[121.368453162067,31.2145397632706,318],[121.701027918855,31.2239862504672,260],[121.728211211316,31.227971358702,280],[121.508539325889,30.8984490308211,300],[121.438134258747,31.2344232589192,499],[121.618422326786,31.3033771681635,500],[121.505663506799,31.3073274071365,350],[121.537446515132,31.2891284074283,250],[121.463284567263,31.2634062752071,300],[121.382174999716,31.1073508529458,550],[121.382670720628,31.3665507391115,203],[121.394935052196,31.2162724969908,372],[121.848000161241,31.0365178049753,130],[121.510184199633,30.9195605296047,150],[121.671851853298,31.2990250135109,250],[121.560922291448,31.2601551036556,50],[121.454340588453,31.1795991726416,165],[121.532201177208,31.2073667486778,248],[121.707606508342,31.1875455211888,250],[121.638037282139,31.3099025670285,305],[121.433236158124,31.4190633522629,503],[121.476610861232,31.3105769640225,400],[121.498873904449,31.3882820033217,245],[121.474502965794,31.4134238665471,230],[121.42205809351,31.303911646189,408],[121.403973316255,31.2780996467271,364],[121.218141517457,30.8536781061824,1092],[121.327072389971,31.2706124081715,381],[121.313836623637,31.3402597579307,1022],[121.435491443937,31.3329591602671,140],[121.415968300797,31.246574386352,96],[121.381770112761,31.2354605686914,320],[121.560338000307,30.9339118454998,160],[121.216570923696,31.0599971584342,560],[121.348692314713,30.7249045589365,421],[121.333798713883,30.7303980409216,109],[121.341993741254,30.8534520547418,220],[121.421376818612,31.1446236375669,190],[121.424780498189,31.2140782580147,100],[121.429533971625,31.1367978303311,189],[121.565165796847,31.2650620681439,150],[121.522452447814,31.1943233972342,103],[121.766990602046,31.157018919421,418],[121.487451231245,31.1759876966065,75],[121.452566794393,31.1770754717312,110],[121.462992707803,31.1628856694285,101],[121.422756482926,31.1563821658707,180],[121.097672593379,31.2218200065282,335],[121.044138450207,31.0102293927926,566],[121.466012900758,31.2025335901283,53],[121.446825274726,31.1784801451306,175],[121.6675817877,30.8808353014631,40],[121.4095110113,31.3123358925117,140],[121.375144271506,31.3223781925723,96],[121.494545958332,31.3293148931883,430],[121.382731805403,31.3734142950312,131],[121.334674132366,31.4960530361729,110],[121.500616706969,31.3936429760059,160],[121.516352953401,31.3961795548394,421],[121.504647134301,31.3966895285203,93],[121.456897345595,31.3397384488351,72],[121.451965468685,31.3507958064245,190],[121.618233868578,31.5563518036021,265],[121.459356367098,31.6268347289006,70],[121.410315623545,31.7030362234366,130],[121.458659012531,31.6915084732921,137],[121.225780307768,31.7743673587891,75],[121.342921600117,31.725023381231,140],[121.374114901426,31.7485055545209,170],[121.376902700949,31.7102626711502,180],[121.742337963766,31.561353647625,95],[121.767540463831,31.5733538609334,100],[121.342796645821,31.8350127406893,78],[121.302278220963,31.8262432219986,100],[121.700390060858,31.3963291258326,92],[121.786270942189,31.5273243643035,182],[121.590744058107,30.9340187918256,50],[121.659855462009,30.9396813772962,161],[121.452936249483,30.9700941235873,59],[121.741687410915,30.8718775504053,182],[121.510435635346,30.9948979906326,431],[121.570557516348,30.9895107513989,96],[121.570137917844,30.9944429390659,110],[121.375548764104,30.9005149499109,200],[121.402276148553,30.9013367538213,118],[121.369207366797,30.7696838272023,362],[121.484661004501,31.3070206818935,110],[121.486755049865,31.3075039006754,75],[121.476644576435,31.3127884455024,120],[121.473145686355,31.3030782468044,77],[121.477790198926,31.2984780869276,50],[121.495160602318,31.2727067480892,60],[121.495841194505,31.27682554012,100],[121.491308714105,31.2720045613186,159],[121.519189883049,31.259736373091,129],[121.501598663586,31.20954453092,52],[121.504620719627,31.2133392791406,100],[121.519432883673,31.2360922245748,120],[121.343779032726,31.091127269924,59],[121.500858691609,31.2216922384644,96],[121.49455862444,31.2216880884903,200],[121.490294318778,31.2195342834929,28],[121.526846357402,31.2408360773467,163],[121.489559487803,31.2074734420619,275],[121.476960370347,31.2036105555279,50],[121.527656690955,31.2880713649449,50],[121.507660410303,31.2256802515979,87],[121.491663924765,31.2270065344661,80],[121.508014206132,31.1807924622008,155],[121.505634012734,31.1746958362204,118],[121.291395556031,31.4768449710572,880],[121.294729365406,31.2780531299055,400],[121.252154296134,31.3983939669449,350],[121.291904853933,31.3835566221331,562],[121.284585314214,31.3435457956291,149],[121.298112145007,31.3466254152797,149],[121.174326544038,31.3708138898154,499],[121.275171767758,31.420458125237,199],[121.261045017105,31.4236119000263,298],[121.27904592766,31.4201756664937,260],[121.385577996581,31.2603606106797,192],[120.999635317276,30.9027536757756,232],[121.026646780063,30.8963844874315,126],[121.257073686598,30.7831618900002,172],[121.189066415151,30.7861260452923,263],[121.250219724252,30.8322824761442,122],[121.804085193843,30.909321972219,200],[121.362976450289,30.7675735718956,152],[121.329987332961,30.9051685218055,200],[121.31958409907,30.8872869149579,88],[121.329477739516,30.8853275736392,101],[121.24253666275,30.897021404917,54],[121.243273003777,30.8969903153412,150],[121.304126569888,30.8072778329687,130],[121.21171368699,30.9008352920027,100],[121.216659935891,30.8985169090541,116],[121.169706828292,30.8764022486844,106],[121.172610115768,30.894022989957,180],[121.224224780387,30.8357030413973,95],[121.224672705158,30.8869025574793,161],[121.438745825139,31.2642567469689,120],[121.646305511527,30.9532095773879,42],[121.448194922934,31.2381755871763,120],[121.437818234869,31.2410277763851,50],[121.466713309564,31.2971365406376,273],[121.471008488191,31.2711503308275,58],[121.399011975821,31.2079408399054,167],[121.445289208236,31.2241560298361,125],[121.439469679719,31.3112332611104,80],[121.467930244038,31.3218793259478,100],[121.459943230088,31.3150123572342,52],[121.437450378763,31.309717044519,60],[121.454399786786,31.3196976437925,320],[121.447003145505,31.3234432612527,52],[121.445234016346,31.3141658955855,130],[121.461406300272,31.3200342041211,54],[121.457491664521,31.3140680988835,100],[121.442736098214,31.3239210639663,146],[121.436067706922,31.3036892652136,340],[121.431798959138,31.2971845993288,405],[121.465178716295,31.2436155028235,100],[121.473506026339,31.2661059040716,150],[121.473644469591,31.2604350517255,90],[121.736483257604,30.9556735538769,232],[121.353220878501,31.485556536651,120],[121.368879754778,31.1812228510125,72],[121.375347105297,31.0363941135969,550],[121.540483440824,31.016681438185,56],[121.538809153862,31.0236231692716,92],[121.389607166285,31.095745844427,290],[121.479536890211,31.0496710970122,99],[121.470182565444,31.0466411503989,192],[121.481016219725,31.0503167676365,100],[121.420928264128,31.0366615316004,181],[121.410602721986,31.0613192492415,320],[121.434263014745,31.183027110726,100],[121.474724706221,31.3060603690801,148],[121.571306966347,31.1933199246187,196],[121.512747873728,31.1803744049484,126],[121.540533630949,31.3647628509238,376],[121.555574941052,31.2101282212268,98],[121.62315707684,31.1464791759459,99],[121.52702329574,31.2418699612516,93],[121.529994980198,31.2273137075438,136],[121.552906891044,31.242123363939,70],[121.601253999913,31.0565767609787,246],[121.513688182207,31.2051400972305,191],[121.588213980638,31.1090964718926,529],[121.554321093408,31.2127452290637,240],[121.530047174443,31.2679672576821,295],[121.407878622205,31.0689983220247,158],[121.561195979984,31.1910475233022,89],[121.683644610406,31.2689104356731,155],[121.705982641471,31.1940629147939,158],[121.731549849083,31.1633315607673,100],[121.716294380251,31.1241225784542,60],[121.691100054765,31.128626703909,80],[121.682471920173,31.0590205141189,250],[121.759756556757,31.0208473142273,130],[121.75303833017,30.976767883846,120],[121.768357203201,31.0018015039751,276],[121.755119093189,30.9762174070714,150],[121.51668531566,31.1492202581695,175],[121.528485916772,31.1491919897198,93],[121.590162825696,31.3559346946146,80],[121.590530171565,31.2803668666659,33],[121.585453487806,31.2822754985174,115],[121.774859587635,31.0609104552718,82],[121.783412975125,31.0323441599916,138],[121.762081281586,31.0446077892074,54],[121.568971737631,31.2585512381558,135],[121.585408303039,31.2574075324305,88],[121.513179019051,31.2061452402068,210],[121.866339966533,30.9115248583083,122],[121.833012652451,30.908106042676,324],[121.804391222276,30.915784992219,271],[121.624895926816,31.5422416649173,206],[121.493341150983,31.1714543276073,63],[121.914018160288,30.9593904174133,100],[121.893188279072,30.9279522942104,145],[121.872529992175,30.9292172623878,300],[121.879902942444,30.9812557067702,100],[121.839406970732,30.9797782704016,50],[121.732031255497,31.082491592569,127],[121.714811382956,31.0751190620077,153],[121.603973697099,31.2113101707994,175],[121.633871795472,31.1922055373932,69],[121.766842749942,31.1140887975279,125],[121.766842749942,31.1140887975279,330],[121.356005869023,31.2892049747207,125],[121.420065651889,31.2453988579855,92],[121.40540907885,31.2420138366356,130],[121.434599999685,31.2690318717459,120],[121.434780699228,31.2687687256273,50],[121.446450269006,31.2694750898218,175],[121.438882277746,31.2737782842623,80],[121.431930291404,31.2699511045758,82],[121.440600917644,31.2661579969433,82],[121.438652131874,31.2730968425483,120],[121.432508081508,31.2559659956767,120],[121.430327534713,31.2510333932971,168],[121.393036806891,31.2233051701457,110],[121.428906595057,31.2547129774162,125],[121.426074147954,31.2838679240531,160],[121.454455481728,31.2652867018177,120],[121.443969022526,31.2668859761056,76],[121.443485913823,31.2644811510755,160],[121.421699489951,31.2390235913603,160],[121.421389920397,31.2422056111408,40],[121.440564695271,31.250848772482,100],[121.382754622363,31.2449017176657,176],[121.400960400472,31.2718653506026,80],[121.396836673334,31.2672761878553,110],[121.386498041084,31.2561764510873,84],[121.260931279949,31.2058506224255,55],[121.154726595777,31.1672295773118,300],[121.276189250562,31.1756022413165,100],[121.491938536759,31.3512202981645,312],[121.510957011864,31.2649389862557,80],[121.184522311576,31.2067989089926,298],[121.073664584523,30.9310233891171,216],[121.314192622111,31.115471381138,190],[121.34315848328,31.4863140740474,281],[121.354233781743,31.2961725845199,260],[121.29298201207,30.9708520912223,228],[121.265540575352,31.0409744541059,156],[121.188791799563,31.1004668274201,250],[121.282491344308,31.1213198955351,40],[121.150865133423,30.9634503662672,150],[121.121517363955,31.0393932550249,400],[121.331130418637,31.068517212889,308],[121.240251744533,31.0105934221771,80],[121.263369011612,31.0724486522117,120],[121.199072881871,31.0757548614067,280],[121.65074215261,31.0278147652439,127],[121.658881704226,31.0737285311841,119],[121.466127973694,31.2007678867869,52],[121.462024920158,31.1203775452602,108],[121.423384980579,31.1604748497209,88],[121.431783777775,31.1840187682195,90],[121.548554491255,31.2737225056883,60],[121.542468131865,31.265071714053,77],[121.507660410303,31.2256802515979,59],[121.54655581719,31.2790333560163,100],[121.544206693485,31.2796546711962,160],[121.559262686391,31.2799312139328,140],[121.555544765174,31.2851430021881,100],[121.564463222226,31.2794801839556,210],[121.519958504684,31.330760770872,300],[121.542458519996,31.3199263106008,50],[121.515985366786,31.2753671896529,258],[121.413257534565,30.8025347478502,100],[121.52688743332,31.2585075761733,158],[121.538012452993,31.2661188341524,80],[121.522215025668,31.3054578850992,150],[121.509596602728,31.2956634192812,100],[121.530119754833,31.3256014637124,80],[121.545770572411,31.3038475622634,50],[121.538589967317,31.289141868182,185],[121.519598345259,31.2700448112579,300],[121.5460948607,31.2911947374948,50],[121.538909010401,31.2968890641368,170],[121.543590923922,31.3317923841556,120],[121.541844887502,31.33545328703,50],[121.549065107869,31.3321741654561,85],[121.536499071412,31.3374022759035,160],[121.542658572633,31.3196984921359,50],[121.549670655613,31.2989680761132,50],[121.558354959453,31.2997584859238,444],[121.788995412971,31.0846656628058,70],[121.399314525117,31.243524514805,124],[121.371143772121,31.2263727780237,60],[121.423518289117,31.2055001892311,73],[121.44184583164,31.2270483455753,83],[121.434374850188,31.2275226062762,163],[121.440930144817,31.2287140766793,45],[121.382425303563,31.1877158931144,120],[121.408717350297,31.2204457554489,122],[121.416107807643,31.2184781611704,50],[121.401138085302,31.2168647792674,61],[121.40070564103,31.2155323304483,80],[121.401452043078,31.2131968319038,50],[121.36553787862,31.2191610433022,148],[121.364548035778,31.2161138604492,118],[121.368157163216,31.2098412514771,156],[121.379942686269,31.2104128782041,308],[121.377487767327,31.2060238952747,60],[121.583905903243,31.3629475458684,250],[121.535532795616,31.1933384880057,60],[121.347609313997,31.4205561823015,215],[121.274828964494,31.3351278861191,152],[121.17969230251,30.9639200723416,130],[121.536462240886,31.2740973020598,112],[121.369129940947,31.1216299999008,180],[121.237344328445,30.8369265307012,136],[121.474728302138,31.0460174441324,50],[121.376687017796,31.1274377476705,80],[121.376846765261,31.4429483211804,120],[121.498531560219,31.315378242242,150],[121.534259505945,31.2919668083405,50],[121.077536999915,30.8707420801126,128],[121.547631861428,31.3012392597695,43],[121.522215025668,31.3054578850992,50],[121.542728011649,31.322038964866,50],[121.835494131592,31.0588987083613,128],[121.361852041282,31.1116878550496,151],[121.541993736725,31.3116341774216,140],[121.476595209157,31.2656679836397,142],[121.376446365343,31.1981876447804,132],[121.207695169393,31.1586096406704,90],[121.140617000962,31.2611558560963,432],[121.692803062351,30.9350776145821,58],[121.416797885936,31.6560660569875,33],[121.766842749942,31.1140887975279,50],[121.54454870085,31.2640752721776,91],[121.372684976918,31.3835529228089,850],[121.530548095646,31.1840333490953,78],[121.512899306478,31.2162769277771,60],[121.090265855144,31.2568583733718,122],[121.482517108571,31.2799997641917,53],[121.524252741886,30.9126319558627,149],[121.459885450179,30.9064146751958,252],[121.544880520532,31.2973208348612,200],[121.441705651963,31.2485301406229,40],[121.452432407889,31.1481197302978,136],[121.673574204096,31.2875780004637,413],[121.600274181263,31.0300486210338,186],[121.598551051633,31.0731536299133,426],[121.593362439008,31.0394358378685,75],[121.59250796901,31.0204593098916,380],[121.468426647663,31.2050674158818,70],[121.421035950298,31.1543923985336,190],[121.461003500082,31.1274617046883,175],[121.469375258282,31.1981778812363,63],[121.470030033168,31.2070907053619,200],[121.399665672741,31.1858139039167,80],[121.331515455735,30.7296617742049,150],[121.343206722286,30.7319638528111,60],[121.366195017846,31.2419227030291,348],[121.470182565444,31.0466411503989,380],[121.379016009576,31.1265932975293,680],[121.37444492809,31.0356446732704,81],[121.401069178982,31.0211534826909,132],[121.368490249509,30.9882396246069,250],[121.5775339366,31.2504354095732,70],[121.699553041343,31.1977897058222,40],[121.575083089677,31.2586204620005,50],[121.580017841165,31.2495250746587,75],[121.603653876083,31.2558097165998,73],[121.695879028401,31.1803849179256,608],[121.592590974236,31.1208667253044,80],[121.733082537944,31.253885074047,320],[121.533504120842,31.1938809705074,180],[121.517559737023,30.9594624941204,768],[121.439764054434,31.4161944992957,65],[121.476200134394,31.4103704660578,142],[121.700390060858,31.3963291258326,200],[121.451706455765,31.4015663794108,1350],[121.409179716228,31.4577178120347,58],[121.506186560453,31.3991851843963,25],[121.377368202864,31.2538662776299,144],[121.717413758747,31.6025176528955,248],[121.625547827125,31.6111090954425,275],[121.572621283427,31.5745636718055,154],[121.442049685008,31.2589515260654,89],[121.408017308898,31.240726205824,97],[121.447194298629,31.1397215637599,60],[121.441151217803,31.1555414645766,139],[121.427020872131,31.1442298090255,66],[121.430838311226,31.1995756745814,128],[121.557891220013,31.274436356175,103],[121.414458339065,31.1670643437792,60],[121.579013104419,31.2618012972275,290],[121.473911072293,31.2509227187455,133],[121.491149552335,31.2912234108452,180],[121.501935239796,31.294504074523,63],[121.492987128781,31.2883818862096,134],[121.486716462253,31.3043809932662,100],[121.495379226524,31.2882804365187,153],[121.492943650794,31.2993846271992,150],[121.485839132177,31.3178783152094,70],[121.257642224155,31.2777311499899,60],[121.487651573137,31.28982214794,171],[121.546987417055,31.292586975331,140],[121.534292204266,31.2901831977619,133],[121.527067761863,31.3143766826078,220],[121.55572999577,31.2962762627364,120],[121.727423846536,30.9510736662426,50],[121.398934857192,30.9139088530882,86],[121.429188034174,30.8626448446687,100],[121.550007910044,30.8801384045297,100],[121.543916268618,30.9281568977667,401],[121.58186080475,30.9343657196239,260],[121.422841861475,31.1433379727396,145],[121.421082765489,31.037102115438,92],[121.379076973978,31.1959010267504,48],[121.361111298558,31.2326194827609,110],[121.547100999702,31.1001578522826,128],[121.475107076249,31.2661933335791,50],[121.414866978242,31.3367506383697,171],[121.388985538872,31.2439130635831,230],[121.371008020192,31.1037228691515,274],[121.394025735258,31.2135913308746,54],[121.470001774273,31.3189989772277,317],[121.70900337341,31.5186736391248,100],[121.537551615978,31.6160564269473,132],[121.478326603197,31.304746167918,91],[121.3388169997,30.9573178455399,300],[121.454260549432,31.2465322909845,140],[121.447086473222,31.3267340682103,55],[121.143676877461,31.1633866365095,68],[120.935293441327,31.1291726707407,132],[121.520235511561,31.273064947266,12],[121.536934701076,31.2612043568188,90],[121.521781302208,31.2855050779993,80],[121.431691252308,31.229855354305,123],[121.432754086065,31.233021703464,93],[121.414458339065,31.1670643437792,60],[121.370397801259,31.3873601431917,110],[121.54062184455,31.3020319201671,26],[121.549684860518,31.2695304868117,50],[121.546379893039,31.5864651196816,232],[121.467250496259,31.3139796344283,80],[121.561874405458,31.2895215868333,49],[121.140338484932,31.1931477552379,153],[121.84369269649,31.3496721198031,208],[121.423384980579,31.1604748497209,66],[121.452930158972,31.1920618943491,70],[121.463187460437,31.3408265558575,20],[121.815023754038,31.481753192287,64],[121.846359226566,31.5252066793853,156],[121.376902700949,31.7102626711502,180],[121.543356700641,31.624000798222,191],[121.487589300802,31.2993455948986,82],[121.471749030592,31.3058108491435,148],[121.437170197274,31.197221012831,20],[121.465467988636,31.1223618906381,10],[121.456897345595,31.2451233896268,60],[121.50359700438,31.2651213281954,60],[121.491738854224,31.3173983416445,112],[121.505409637577,31.2582414555748,120],[121.433439085338,31.2581946226428,213],[121.209041075386,31.017164760647,40],[121.07376681169,31.0806408214856,537],[121.41807945978,31.4324271020316,466],[121.462539782165,31.6605537842376,499],[121.534539109823,31.2687413675135,191],[121.491475055133,31.2383985796564,412],[121.547100999702,31.1001578522826,128],[121.523960882426,31.2724648947621,49],[121.572029030604,31.1608347731927,50],[121.487350150316,31.2047604595983,136],[121.42950217161,31.1758061034354,148],[121.50326879858,31.2813625106733,40],[121.5150902826,31.2772846286377,68],[121.756092458412,31.0536142749527,242]],mapv={};(function(M,K){K(mapv)})(window,function(M){"use strict";var K="2.0.13",U=function(e){e&&e.clearRect&&e.clearRect(0,0,e.canvas.width,e.canvas.height)},a1=function(e){var t=window.devicePixelRatio;e.canvas.width=e.canvas.width*t,e.canvas.height=e.canvas.height*t,e.canvas.style.width=e.canvas.width/t+"px",e.canvas.style.height=e.canvas.height/t+"px",e.scale(t,t)};function t1(){this._subscribers={}}t1.prototype.on=function(e,t){var r=this._subscribers[e];r||(r=[],this._subscribers[e]=r),r.push({callback:t})},t1.prototype.off=function(e,t){var r=this._subscribers[e];if(r)for(var n=0;n<r.length;n++)r[n].callback==t&&(r.splice(n,1),n--)},t1.prototype._trigger=function(e,t,r){if(e=="*")throw new Error("Cannot trigger event *");var n=[];e in this._subscribers&&(n=n.concat(this._subscribers[e])),"*"in this._subscribers&&(n=n.concat(this._subscribers["*"]));for(var a=0,i=n.length;a<i;a++){var o=n[a];o.callback&&o.callback(e,t,r||null)}};var j=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e1=function(){function e(t,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n1=function e(t,r,n){t===null&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(a===void 0){var i=Object.getPrototypeOf(t);return i===null?void 0:e(i,r,n)}else{if("value"in a)return a.value;var o=a.get;return o===void 0?void 0:o.call(n)}},m1=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},w1=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e};function A(e,t){this._options=t||{},this._data=[],e&&this.add(e)}A.prototype=new t1,A.prototype.add=function(e,t){if(Array.isArray(e))for(var r=0,n=e.length;r<n;r++){if(e[r].time&&e[r].time.length==14&&e[r].time.substr(0,2)=="20"){var a=e[r].time;e[r].time=new Date(a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)+" "+a.substr(8,2)+":"+a.substr(10,2)+":"+a.substr(12,2)).getTime()}this._data.push(e[r])}else if(e instanceof Object)this._data.push(e);else throw new Error("Unknown dataType")},A.prototype.get=function(e){e=e||{};var r=new Date,t=this._data,r=new Date;if(e.filter){for(var n=[],a=0;a<t.length;a++)e.filter(t[a])&&n.push(t[a]);t=n}return e.transferCoordinate&&(t=this.transferCoordinate(t,e.transferCoordinate,e.fromColumn,e.toColumn)),t},A.prototype.set=function(e){this._set(e),this._trigger("change")},A.prototype._set=function(e){this.clear(),this.add(e)},A.prototype.clear=function(e){this._data=[]},A.prototype.remove=function(e){},A.prototype.update=function(e){},A.prototype.transferCoordinate=function(e,t,r,n){n=n||"_coordinates",r=r||"coordinates";for(var a=0;a<e.length;a++){var i=e[a].geometry,o=i[r];switch(i.type){case"Point":i[n]=t(o);break;case"LineString":for(var l=[],s=0;s<o.length;s++)l.push(t(o[s]));i[n]=l;break;case"Polygon":var l=v(o);i[n]=l;break;case"MultiPolygon":for(var l=[],f=0;f<o.length;f++){var d=o[f],d=v(d);l.push(d)}i[n]=l;break}}function v(c){for(var y=[],g=0;g<c.length;g++){for(var w=c[g],x=[],p=0;p<w.length;p++)x.push(t(w[p]));y.push(x)}return y}return e},A.prototype.initGeometry=function(e){e?this._data.forEach(function(t){t.geometry=e(t)}):this._data.forEach(function(t){!t.geometry&&t.lng&&t.lat&&(t.geometry={type:"Point",coordinates:[t.lng,t.lat]})})},A.prototype.getMax=function(e){var t=this._data;if(!(!t||t.length<=0)){for(var r=parseFloat(t[0][e]),n=1;n<t.length;n++){var a=parseFloat(t[n][e]);a>r&&(r=a)}return r}},A.prototype.getSum=function(e){var t=this._data;if(!(!t||t.length<=0)){for(var r=0,n=0;n<t.length;n++)t[n][e]&&(r+=parseFloat(t[n][e]));return r}},A.prototype.getMin=function(e){var t=this._data;if(!(!t||t.length<=0)){for(var r=parseFloat(t[0][e]),n=1;n<t.length;n++){var a=parseFloat(t[n][e]);a<r&&(r=a)}return r}};var i1={drawDataSet:function(t,r,n){for(var a=r instanceof A?r.get():r,i=0,o=a.length;i<o;i++){var s=a[i];this.draw(t,s,n)}},draw:function(t,r,n){var a=r.geometry.type,i=r.geometry._coordinates||r.geometry.coordinates,o=n.symbol||"circle";switch(a){case"Point":var s=r._size||r.size||n._size||n.size||5;n.symbol==="rect"?t.rect(i[0]-s/2,i[1]-s/2,s,s):(n.bigData==="Point"&&t.moveTo(i[0],i[1]),t.arc(i[0],i[1],s,0,Math.PI*2));break;case"LineString":for(var l=0;l<i.length;l++){var f=i[l][0],d=i[l][1];l==0?t.moveTo(f,d):t.lineTo(f,d)}break;case"Polygon":this.drawPolygon(t,i);break;case"MultiPolygon":for(var v=0;v<i.length;v++){var c=i[v];this.drawPolygon(t,c)}t.closePath();break;default:console.log("type"+a+"is not support now!");break}},drawPolygon:function(t,r){for(var n=0;n<r.length;n++){var a=r[n];t.moveTo(a[0][0],a[0][1]);for(var i=1;i<a.length;i++)t.lineTo(a[i][0],a[i][1]);t.lineTo(a[0][0],a[0][1])}}},_1={draw:function(t,r,n){var a=r instanceof A?r.get():r;t.save();for(var i in n)t[i]=n[i];if(n.bigData){t.save(),t.beginPath();for(var o=0,s=a.length;o<s;o++){var l=a[o];i1.draw(t,l,n)}var f=n.bigData;f=="Point"||f=="Polygon"||f=="MultiPolygon"?(t.fill(),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):f=="LineString"&&t.stroke(),t.restore()}else for(var o=0,s=a.length;o<s;o++){var l=a[o];t.save(),l.fillStyle&&(t.fillStyle=l.fillStyle),l.strokeStyle&&(t.strokeStyle=l.strokeStyle);var f=l.geometry.type;t.beginPath(),i1.draw(t,l,n),f=="Point"||f=="Polygon"||f=="MultiPolygon"?(t.fill(),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):f=="LineString"&&t.stroke(),t.restore()}t.restore()}};function h1(e,t){var r;if(typeof document>"u"){var n=require("canvas");r=new n(e,t)}else{var r=document.createElement("canvas");e&&(r.width=e),t&&(r.height=t)}return r}function k(e){e=e||{},this.gradient=e.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=e.maxSize||35,this.minSize=e.minSize||0,this.max=e.max||100,this.min=e.min||0,this.initPalette()}k.prototype.setMax=function(e){this.max=e||100},k.prototype.setMin=function(e){this.min=e||0},k.prototype.setMaxSize=function(e){this.maxSize=e||35},k.prototype.setMinSize=function(e){this.minSize=e||0},k.prototype.initPalette=function(){var e=this.gradient,t=new h1(256,1),r=this.paletteCtx=t.getContext("2d"),n=r.createLinearGradient(0,0,256,1);for(var a in e)n.addColorStop(parseFloat(a),e[a]);r.fillStyle=n,r.fillRect(0,0,256,1)},k.prototype.getColor=function(e){var t=this.getImageData(e);return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},k.prototype.getImageData=function(e){var t=this.paletteCtx.getImageData(0,0,256,1).data;if(e===void 0)return t;var r=this.max,n=this.min;e>r&&(e=r),e<n&&(e=n);var a=Math.floor((e-n)/(r-n)*(256-1))*4;return[t[a],t[a+1],t[a+2],t[a+3]]},k.prototype.getSize=function(e){var t=0,r=this.max,n=this.min,a=this.maxSize,i=this.minSize;return e>r&&(e=r),e<n&&(e=n),t=i+(e-n)/(r-n)*(a-i),t},k.prototype.getLegend=function(e){var t=this.gradient,r=e.width||20,n=e.height||180,a=new h1(r,n),i=a.getContext("2d"),o=i.createLinearGradient(0,n,0,0);for(var s in t)o.addColorStop(parseFloat(s),t[s]);return i.fillStyle=o,i.fillRect(0,0,r,n),a};var q1=typeof window>"u"?{}:window,E1=q1.devicePixelRatio;function G1(e){var t=e/2,r=e+t,n=1e4,a=new h1(r*2,r*2),i=a.getContext("2d");return i.shadowBlur=t,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=n,i.beginPath(),i.arc(r-n,r-n,e,0,Math.PI*2,!0),i.closePath(),i.fill(),a}function $1(e,t,r){for(var n=r.maxOpacity||.8,a=3,i=e.length,o;a<i;a+=4)o=e[a]*4,e[a]/256>n&&(e[a]=256*n),e[a-3]=t[o],e[a-2]=t[o+1],e[a-1]=t[o+2]}function Y1(e,t,r){var n=r.max||100,a=r.min||0,i=r._size;i==null&&(i=r.size,i==null&&(i=13));var o=new k({gradient:r.gradient,max:n,min:a}),s=G1(i),l=s.width/2,f=s.height/2,d=t,v={};d.forEach(function(g,w){var x=g.count===void 0?1:g.count,p=Math.min(1,x/n).toFixed(2);v[p]=v[p]||[],v[p].push(g)});for(var c in v)if(!isNaN(c)){var y=v[c];e.beginPath(),r.withoutAlpha||(e.globalAlpha=c),e.strokeStyle=o.getColor(c*n),y.forEach(function(g,w){if(!!g.geometry){var x=g.geometry._coordinates||g.geometry.coordinates,p=g.geometry.type;if(p==="Point"){var _=g.count===void 0?1:g.count;e.globalAlpha=_/n,e.drawImage(s,x[0]-l,x[1]-f)}else if(p==="LineString"){var _=g.count===void 0?1:g.count;e.globalAlpha=_/n,e.beginPath(),i1.draw(e,g,r),e.stroke()}}})}}function V1(e,t,r){var n=r.strength||.3;e.strokeStyle="rgba(0,0,0,"+n+")";var a=new h1(e.canvas.width,e.canvas.height),i=a.getContext("2d");i.scale(E1,E1),r=r||{};var o=t instanceof A?t.get():t;e.save();var s=new k({gradient:r.gradient});if(Y1(i,o,r),!r.absolute){var l=i.getImageData(0,0,e.canvas.width,e.canvas.height);$1(l.data,s.getImageData(),r),e.putImageData(l,0,0),e.restore()}s=null,a=null}var P1={draw:V1},I1={draw:function(t,r,n){t.save();for(var a=r instanceof A?r.get():r,i={},o={},s=n._size||n.size||50,l=n.offset||{x:0,y:0},f=0;f<a.length;f++){var d=a[f].geometry._coordinates||a[f].geometry.coordinates,v=Math.floor((d[0]-l.x)/s)+","+Math.floor((d[1]-l.y)/s);i[v]||(i[v]=0,o[v]=[]);var c=~~(a[f].count||1);i[v]+=c,o[v].push(a[f])}for(var v in i){var y=i[v];o[v].forEach(_=>{_.total=y,_.average=parseInt(y/o[v].length)})}var g=new k({max:n.max||100,gradient:n.gradient});for(var v in i){v=v.split(","),t.beginPath(),t.rect(v[0]*s+.5+l.x,v[1]*s+.5+l.y,s,s);var w=i[v];n.label.average&&(w=parseInt(i[v]/o[v].length)),t.fillStyle=g.getColor(w),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&n.label.show!==!1){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var v in i){v=v.split(",");var w=i[v];n.label.average&&(w=parseInt(w/o[v].length));var x=t.measureText(w).width;t.fillText(w,v[0]*s+.5+l.x+s/2-x/2,v[1]*s+.5+l.y+s/2+5)}}t.restore()}};function J1(e,t,r){var n=60*r+30,a=Math.PI/180*n;return[e.x+t*Math.cos(a),e.y+t*Math.sin(a)]}var z1={draw:function(t,r,n){t.save();var a=r instanceof A?r.get():r;for(var i in n)t[i]=n[i];var o={},s=n.offset||{x:10,y:10},l=n._size||n.size||40;l=l/2/Math.sin(Math.PI/3);for(var f=l*2*Math.sin(Math.PI/3),d=l*1.5,v={},c=0;c<a.length;c++){var y=a[c].geometry._coordinates||a[c].geometry.coordinates,g=(y[1]-s.y)/d,w=Math.round(g),x=(y[0]-s.x)/f-(w&1?.5:0),p=Math.round(x),_=g-w;if(Math.abs(_)*3>1){var F=x-p,z=p+(x<p?-1:1)/2,m=w+(g<w?-1:1),C=x-z,R=g-m;F*F+_*_>C*C+R*R&&(p=z+(w&1?1:-1)/2,w=m)}var Y=p+"-"+w,q=v[Y];q?q.push(a[c]):(q=v[Y]=[a[c]],q.i=p,q.j=w,q.x=(p+(w&1?1/2:0))*f,q.y=w*d)}var N=new k({max:n.max||100,maxSize:l,gradient:n.gradient});for(var i in v){var G=v[i];t.beginPath();for(var V=0;V<6;V++){var r1=l,y1=J1({x:G.x+s.x,y:G.y+s.y},r1,V);t.lineTo(y1[0],y1[1])}t.closePath();for(var v1=0,c=0;c<G.length;c++)v1+=G[c].count||1;G.count=v1,t.fillStyle=N.getColor(v1),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&n.label.show!==!1){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var i in v){var G=v[i],J=G.count;J<0?J=J.toFixed(2):J=~~J;var g1=t.measureText(J).width;t.fillText(J,G.x+s.x-g1/2,G.y+s.y+5)}}t.restore()}};function O1(e,t,r){var n=e.createShader(r);return e.shaderSource(n,t),e.compileShader(n),n}function x1(e,t,r){var n=O1(e,t,e.VERTEX_SHADER),a=O1(e,r,e.FRAGMENT_SHADER),i=e.createProgram();return e.attachShader(i,n),e.attachShader(i,a),e.linkProgram(i),e.useProgram(i),i}function b1(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=1,t.height=1,r.fillStyle=e,r.fillRect(0,0,1,1),r.getImageData(0,0,1,1).data}var X1=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),K1=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function j1(e,t,r){if(!!t){var n=x1(e,X1,K1);e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),e.clear(e.COLOR_BUFFER_BIT);var a=e.canvas.width/2,i=e.canvas.height/2,o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o);var s=e.getAttribLocation(n,"a_Position");e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s);var l=e.getUniformLocation(n,"u_FragColor"),f=b1(r.strokeStyle||"red");e.uniform4f(l,f[0]/255,f[1]/255,f[2]/255,f[3]/255),e.lineWidth(r.lineWidth||1);for(var d=0,v=t.length;d<v;d++){for(var c=t[d].geometry._coordinates,y=[],g=0;g<c.length;g++){var w=c[g],x=(w[0]-a)/a,p=(i-w[1])/i;y.push(x,p)}var _=new Float32Array(y);e.bufferData(e.ARRAY_BUFFER,_,e.STATIC_DRAW),e.drawArrays(e.LINE_STRIP,0,c.length)}}}var T1={draw:j1},Q1=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),tt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function et(e,t,r){if(!!t){var n=x1(e,Q1,tt),a=e.getAttribLocation(n,"a_Position"),i=e.getAttribLocation(n,"a_PointSize"),o=e.getUniformLocation(n,"u_FragColor");e.clear(e.COLOR_BUFFER_BIT);for(var s=e.canvas.width/2,l=e.canvas.height/2,f=[],d=0,v=0;v<t.length;v++){var c=t[v].geometry._coordinates,y=(c[0]-s)/s,g=(l-c[1])/l;y<-1||y>1||g<-1||g>1||(f.push(y,g),d++)}var w=new Float32Array(f),x=d,p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.bufferData(e.ARRAY_BUFFER,w,e.STATIC_DRAW),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a),e.vertexAttrib1f(i,r._size);var _=b1(r.fillStyle||"red");e.uniform4f(o,_[0]/255,_[1]/255,_[2]/255,_[3]/255),e.drawArrays(e.POINTS,0,x)}}var R1={draw:et};function c1(e,t,r){r=r||2;var n=t&&t.length,a=n?t[0]*r:e.length,i=F1(e,0,a,r,!0),o=[];if(!i)return o;var s,l,f,d,v,c,y;if(n&&(i=ot(e,t,i,r)),e.length>80*r){s=f=e[0],l=d=e[1];for(var g=r;g<a;g+=r)v=e[g],c=e[g+1],v<s&&(s=v),c<l&&(l=c),v>f&&(f=v),c>d&&(d=c);y=Math.max(f-s,d-l)}return s1(i,o,r,s,l,y),o}function F1(e,t,r,n,a){var i,o;if(a===L1(e,t,r,n)>0)for(i=t;i<r;i+=n)o=U1(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=U1(i,e[i],e[i+1],o);return o&&Q(o,o.next)&&(u1(o),o=o.next),o}function o1(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(Q(r,r.next)||Z(r.prev,r,r.next)===0)){if(u1(r),r=t=r.prev,r===r.next)return null;n=!0}else r=r.next;while(n||r!==t);return t}function s1(e,t,r,n,a,i,o){if(!!e){!o&&i&&ft(e,n,a,i);for(var s=e,l,f;e.prev!==e.next;){if(l=e.prev,f=e.next,i?rt(e,n,a,i):nt(e)){t.push(l.i/r),t.push(e.i/r),t.push(f.i/r),u1(e),e=f.next,s=f.next;continue}if(e=f,e===s){o?o===1?(e=at(e,t,r),s1(e,t,r,n,a,i,2)):o===2&&it(e,t,r,n,a,i):s1(o1(e),t,r,n,a,i,1);break}}}}function nt(e){var t=e.prev,r=e,n=e.next;if(Z(t,r,n)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(d1(t.x,t.y,r.x,r.y,n.x,n.y,a.x,a.y)&&Z(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function rt(e,t,r,n){var a=e.prev,i=e,o=e.next;if(Z(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,l=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,f=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,d=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,v=C1(s,l,t,r,n),c=C1(f,d,t,r,n),y=e.nextZ;y&&y.z<=c;){if(y!==e.prev&&y!==e.next&&d1(a.x,a.y,i.x,i.y,o.x,o.y,y.x,y.y)&&Z(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(y=e.prevZ;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&d1(a.x,a.y,i.x,i.y,o.x,o.y,y.x,y.y)&&Z(y.prev,y,y.next)>=0)return!1;y=y.prevZ}return!0}function at(e,t,r){var n=e;do{var a=n.prev,i=n.next.next;!Q(a,i)&&B1(a,n,n.next,i)&&l1(a,i)&&l1(i,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(i.i/r),u1(n),u1(n.next),n=e=i),n=n.next}while(n!==e);return n}function it(e,t,r,n,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ct(o,s)){var l=D1(o,s);o=o1(o,o.next),l=o1(l,l.next),s1(o,t,r,n,a,i),s1(l,t,r,n,a,i);return}s=s.next}o=o.next}while(o!==e)}function ot(e,t,r,n){var a=[],i,o,s,l,f;for(i=0,o=t.length;i<o;i++)s=t[i]*n,l=i<o-1?t[i+1]*n:e.length,f=F1(e,s,l,n,!1),f===f.next&&(f.steiner=!0),a.push(ht(f));for(a.sort(st),i=0;i<a.length;i++)lt(a[i],r),r=o1(r,r.next);return r}function st(e,t){return e.x-t.x}function lt(e,t){if(t=ut(e,t),t){var r=D1(t,e);o1(r,r.next)}}function ut(e,t){var r=t,n=e.x,a=e.y,i=-1/0,o;do{if(a<=r.y&&a>=r.next.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>i){if(i=s,s===n){if(a===r.y)return r;if(a===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(n===i)return o.prev;var l=o,f=o.x,d=o.y,v=1/0,c;for(r=o.next;r!==l;)n>=r.x&&r.x>=f&&d1(a<d?n:i,a,f,d,a<d?i:n,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(n-r.x),(c<v||c===v&&r.x>o.x)&&l1(r,e)&&(o=r,v=c)),r=r.next;return o}function ft(e,t,r,n){var a=e;do a.z===null&&(a.z=C1(a.x,a.y,t,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,vt(a)}function vt(e){var t,r,n,a,i,o,s,l,f=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,n=r,s=0,t=0;t<f&&(s++,n=n.nextZ,!!n);t++);for(l=f;s>0||l>0&&n;)s===0?(a=n,n=n.nextZ,l--):l===0||!n||r.z<=n.z?(a=r,r=r.nextZ,s--):(a=n,n=n.nextZ,l--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;r=n}i.nextZ=null,f*=2}while(o>1);return e}function C1(e,t,r,n,a){return e=32767*(e-r)/a,t=32767*(t-n)/a,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function ht(e){var t=e,r=e;do t.x<r.x&&(r=t),t=t.next;while(t!==e);return r}function d1(e,t,r,n,a,i,o,s){return(a-o)*(t-s)-(e-o)*(i-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(i-s)-(a-o)*(n-s)>=0}function ct(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!dt(e,t)&&l1(e,t)&&l1(t,e)&&pt(e,t)}function Z(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Q(e,t){return e.x===t.x&&e.y===t.y}function B1(e,t,r,n){return Q(e,t)&&Q(r,n)||Q(e,n)&&Q(r,t)?!0:Z(e,t,r)>0!=Z(e,t,n)>0&&Z(r,n,e)>0!=Z(r,n,t)>0}function dt(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&B1(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function l1(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function pt(e,t){var r=e,n=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do r.y>i!=r.next.y>i&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function D1(e,t){var r=new M1(e.i,e.x,e.y),n=new M1(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function U1(e,t,r,n){var a=new M1(e,t,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function u1(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function M1(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}c1.deviation=function(e,t,r,n){var a=t&&t.length,i=a?t[0]*r:e.length,o=Math.abs(L1(e,0,i,r));if(a)for(var s=0,l=t.length;s<l;s++){var f=t[s]*r,d=s<l-1?t[s+1]*r:e.length;o-=Math.abs(L1(e,f,d,r))}var v=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,y=n[s+1]*r,g=n[s+2]*r;v+=Math.abs((e[c]-e[g])*(e[y+1]-e[c+1])-(e[c]-e[y])*(e[g+1]-e[c+1]))}return o===0&&v===0?0:Math.abs((v-o)/o)};function L1(e,t,r,n){for(var a=0,i=t,o=r-n;i<r;i+=n)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}c1.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,a=0;a<e.length;a++){for(var i=0;i<e[a].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[a][i][o]);a>0&&(n+=e[a-1].length,r.holes.push(n))}return r};var yt=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),gt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function mt(e,t,r){if(!!t){e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,e.canvas.width,e.canvas.height);var n=x1(e,yt,gt);e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE);var a=e.canvas.width/2,i=e.canvas.height/2;e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,e.createBuffer());var o=e.getAttribLocation(n,"a_Position");e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o);var s=e.getUniformLocation(n,"u_FragColor"),l=b1(r.fillStyle||"red");e.uniform4f(s,l[0]/255,l[1]/255,l[2]/255,l[3]/255),e.lineWidth(r.lineWidth||1);for(var f=[],d=[],v=65536,c=0,y=0,g=t.length;y<g;y++){var w=c1.flatten(t[y].geometry._coordinates||t[y].geometry.coordinates),x=w.vertices;c=f.length/2;for(var p=0;p<x.length;p+=2)x[p]=(x[p]-a)/a,x[p+1]=(i-x[p+1])/i;(f.length+x.length)/2>v&&(e.bufferData(e.ARRAY_BUFFER,new Float32Array(f),e.STATIC_DRAW),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),e.STATIC_DRAW),e.drawElements(e.TRIANGLES,d.length,e.UNSIGNED_SHORT,0),f.length=0,d.length=0,c=0);for(var p=0;p<x.length;p++)f.push(x[p]);for(var _=c1(x,w.holes,w.dimensions),p=0;p<_.length;p++)d.push(_[p]+c)}e.bufferData(e.ARRAY_BUFFER,new Float32Array(f),e.STATIC_DRAW),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),e.STATIC_DRAW),e.drawElements(e.TRIANGLES,d.length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}var k1={draw:mt},Z1={draw:function(t,r,n){var a=r instanceof A?r.get():r;a.length>0&&(a[0].geometry.type=="LineString"?T1.draw(t,a,n):a[0].geometry.type=="Polygon"||a[0].geometry.type=="MultiPolygon"?k1.draw(t,a,n):R1.draw(t,a,n))}};function S1(e){var t=e.split("|");return t[0]=t[0].split(","),{lng:parseFloat(t[0][0]),lat:parseFloat(t[0][1])}}var wt={getCenterByCityName:function(t){for(var r=0;r<citycenter.municipalities.length;r++)if(citycenter.municipalities[r].n==t)return S1(citycenter.municipalities[r].g);for(var n=citycenter.provinces,r=0;r<n.length;r++){if(n[r].n==t)return S1(n[r].g);for(var a=n[r].cities,i=0;i<a.length;i++)if(a[i].n==t)return S1(a[i].g)}return null}};function _t(e){for(var t=[],r=0;r<e.length-1;r++){var n=xt(e[r],e[r+1]);n&&n.length>0&&(t=t.concat(n))}return t}function xt(e,t){if(!e||!t)return null;var r=function(R){return 1-2*R+R*R},n=function(R){return 2*R-2*R*R},a=function(R){return R*R},i=[],o=40,s=!1,l,f,d,v,c,y,g,w=[],x=0,p=0;if(typeof t>"u"){typeof i<"u"&&(i=[]);return}var _=parseFloat(e.lat),F=parseFloat(t.lat),z=parseFloat(e.lng),m=parseFloat(t.lng);for(m>z&&parseFloat(m-z)>180&&z<0&&(z=parseFloat(180+180+z)),z>m&&parseFloat(z-m)>180&&m<0&&(m=parseFloat(180+180+m)),y=0,g=0,F==_?(l=0,f=z-m):m==z?(l=Math.PI/2,f=_-F):(l=Math.atan((F-_)/(m-z)),f=(F-_)/Math.sin(l)),g==0&&(g=l+Math.PI/5),d=f/2,c=d*Math.cos(g)+z,v=d*Math.sin(g)+_,x=0;x<o+1;x++)i.push([z*r(p)+c*n(p)+m*a(p),_*r(p)+v*n(p)+F*a(p)]),p=p+1/o;return i}var bt={getPoints:_t},Ct=function(){var t={},r=[],n=[],a=[],i=.1,o=.1,s=1,l=2,f=6,d=70,v=.6666667,c=.6,y=!1,g=1e-8;function w(u,h){return u.x*h.x+u.y*h.y}function x(u){return{x:t[u.target].x-t[u.source].x,y:t[u.target].y-t[u.source].y}}function p(u){return Math.sqrt(Math.pow(t[u.source].x-t[u.target].x,2)+Math.pow(t[u.source].y-t[u.target].y,2))}function _(u){return Math.sqrt(Math.pow(u.source.x-u.target.x,2)+Math.pow(u.source.y-u.target.y,2))}function F(u){var h=(t[u.source].x+t[u.target].x)/2,b=(t[u.source].y+t[u.target].y)/2;return{x:h,y:b}}function z(u){for(var h=0,b=1;b<a[u].length;b++){var L=m(a[u][b],a[u][b-1]);h+=L}return h}function m(u,h){return Math.sqrt(Math.pow(u.x-h.x,2)+Math.pow(u.y-h.y,2))}function C(u,h){var b=Math.sqrt((h.target.x-h.source.x)*(h.target.x-h.source.x)+(h.target.y-h.source.y)*(h.target.y-h.source.y)),L=((h.source.y-u.y)*(h.source.y-h.target.y)-(h.source.x-u.x)*(h.target.x-h.source.x))/(b*b);return{x:h.source.x+L*(h.target.x-h.source.x),y:h.source.y+L*(h.target.y-h.source.y)}}function R(){for(var u=0;u<r.length;u++)s==1?a[u]=[]:(a[u]=[],a[u].push(t[r[u].source]),a[u].push(t[r[u].target]))}function Y(){for(var u=0;u<r.length;u++)n[u]=[]}function q(u){for(var h=[],b=0;b<u.length;b++)t[u[b].source].x!=t[u[b].target].x&&t[u[b].source].y!=t[u[b].target].y&&h.push(u[b]);return h}function N(u,h,b){var L=a[u][h-1],O=a[u][h+1],E=a[u][h],S=L.x-E.x+O.x-E.x,D=L.y-E.y+O.y-E.y;return S*=b,D*=b,{x:S,y:D}}function G(u,h,b){for(var L={x:0,y:0},O=n[u],E=0;E<O.length;E++){var S={x:a[O[E]][h].x-a[u][h].x,y:a[O[E]][h].y-a[u][h].y};if(Math.abs(S.x)>g||Math.abs(S.y)>g){var D=1/Math.pow(_({source:a[O[E]][h],target:a[u][h]}),1);L.x+=S.x*D,L.y+=S.y*D}}return L}function V(u,h,b){for(var L=i/(p(r[u])*(h+1)),O=[{x:0,y:0}],E=1;E<h+1;E++){var S={x:0,y:0},D=N(u,E,L),$=G(u,E,b);S.x=b*(D.x+$.x),S.y=b*(D.y+$.y),O.push(S)}return O.push({x:0,y:0}),O}function r1(u){for(var h=0;h<r.length;h++)if(u==1)a[h].push(t[r[h].source]),a[h].push(F(r[h])),a[h].push(t[r[h].target]);else{var b=z(h),L=b/(u+1),O=L,E=[];E.push(t[r[h].source]);for(var S=1;S<a[h].length;S++){for(var D=m(a[h][S],a[h][S-1]);D>O;){var $=O/D,X=a[h][S-1].x,W1=a[h][S-1].y;X+=$*(a[h][S].x-a[h][S-1].x),W1+=$*(a[h][S].y-a[h][S-1].y),E.push({x:X,y:W1}),D-=O,O=L}O-=D}E.push(t[r[h].target]),a[h]=E}}function y1(u,h){var b=Math.abs(w(x(u),x(h))/(p(u)*p(h)));return b}function v1(u,h){var b=(p(u)+p(h))/2,L=2/(b/Math.min(p(u),p(h))+Math.max(p(u),p(h))/b);return L}function J(u,h){var b=(p(u)+p(h))/2,L={x:(t[u.source].x+t[u.target].x)/2,y:(t[u.source].y+t[u.target].y)/2},O={x:(t[h.source].x+t[h.target].x)/2,y:(t[h.source].y+t[h.target].y)/2},E=b/(b+m(L,O));return E}function g1(u,h){var b=C(t[h.source],{source:t[u.source],target:t[u.target]}),L=C(t[h.target],{source:t[u.source],target:t[u.target]}),O={x:(b.x+L.x)/2,y:(b.y+L.y)/2},E={x:(t[u.source].x+t[u.target].x)/2,y:(t[u.source].y+t[u.target].y)/2},S=Math.max(0,1-2*m(E,O)/m(b,L));return S}function Rt(u,h){return Math.min(g1(u,h),g1(h,u))}function Ft(u,h){var b=y1(u,h)*v1(u,h)*J(u,h)*Rt(u,h);return b}function Bt(u,h){return Ft(u,h)>=c}function Dt(){for(var u=0;u<r.length-1;u++)for(var h=u+1;h<r.length;h++)u!=h&&Bt(r[u],r[h])&&(n[u].push(h),n[h].push(u))}var B=function(){var h=o,b=d,L=s;R(),Y(),r1(L),Dt();for(var O=0;O<f;O++){for(var E=0;E<b;E++){for(var S=[],D=0;D<r.length;D++)S[D]=V(D,L,h);for(var $=0;$<r.length;$++)for(var X=0;X<L+1;X++)a[$][X].x+=S[$][X].x,a[$][X].y+=S[$][X].y}h=h/2,L=L*2,b=v*b,r1(L)}return a};return B.nodes=function(u){return arguments.length==0?t:(t=u,B)},B.edges=function(u){return arguments.length==0?r:(r=q(u),B)},B.bundling_stiffness=function(u){return arguments.length==0?i:(i=u,B)},B.step_size=function(u){return arguments.length==0?o:(o=u,B)},B.cycles=function(u){return arguments.length==0?f:(f=u,B)},B.iterations=function(u){return arguments.length==0?d:(d=u,B)},B.iterations_rate=function(u){return arguments.length==0?v:(v=u,B)},B.subdivision_points_seed=function(u){return arguments.length==0?P:(P=u,B)},B.subdivision_rate=function(u){return arguments.length==0?l:(l=u,B)},B.compatbility_threshold=function(u){return arguments.length==0?compatbility_threshold:(c=u,B)},B};function p1(e){this.splitList=e||{other:1}}p1.prototype.get=function(e){var t=this.splitList,r=t.other;for(var n in t)if(e==n){r=t[n];break}return r},p1.prototype.generateByDataSet=function(e){var t=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],r=e.get();this.splitList={};for(var n=0,a=0;a<r.length&&(this.splitList[r[a].count]===void 0&&(this.splitList[r[a].count]=t[n],n++),!(n>=t.length-1));a++);this.splitList.other=t[t.length-1]};function f1(e){this.splitList=e||[{start:0,value:"red"}]}f1.prototype.get=function(e){for(var t=this.splitList,r=!1,n=0;n<t.length;n++)if((t[n].start===void 0||t[n].start!==void 0&&e>=t[n].start)&&(t[n].end===void 0||t[n].end!==void 0&&e<t[n].end)){r=t[n].value;break}return r},f1.prototype.generateByDataSet=function(e){var t=e.getMin("count"),r=e.getMax("count");this.generateByMinMax(t,r)},f1.prototype.generateByMinMax=function(e,t){var r=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],n=(t-e)/7,a=e;this.splitList=[];for(var i=0;a<t;)this.splitList.push({start:a,end:a+n,value:r[i]}),i++,a+=n};var Mt=function(){function e(t,r,n){if(j(this,e),!t||!r)return console.warn("id 和 type 为必填项"),!1;if(r=="baidu"){if(!BMap)return console.warn("请先引入百度地图JS API"),!1}else console.warn("暂不支持你的地图类型");this.type=r;var a=n&&n.center?n.center:[106.962497,38.208726],i=n&&n.zoom?n.zoom:5,o=this.map=new BMap.Map(t,{enableMapClick:!1});o.centerAndZoom(new BMap.Point(a[0],a[1]),i),o.enableScrollWheelZoom(!0),o.setMapStyle({style:"light"})}return e1(e,[{key:"addLayer",value:function(r,n){if(this.type=="baidu")return new mapv.baiduMapLayer(this.map,dataSet,n)}},{key:"getMap",value:function(){return this.map}}]),e}();function W(e){this.options=e||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=e.map,this._lastDrawTime=null,this.show()}var H1=typeof window>"u"?{}:window;H1.BMap&&(W.prototype=new BMap.Overlay,W.prototype.initialize=function(e){this._map=e;var t=this.canvas=document.createElement("canvas");t.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",t.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),e.getPanes()[this.paneName].appendChild(t);var r=this;return e.addEventListener("resize",function(){r.adjustSize(),r._draw()}),this.canvas},W.prototype.adjustSize=function(){var e=this._map.getSize(),t=this.canvas,r=this.devicePixelRatio=H1.devicePixelRatio;t.width=e.width*r,t.height=e.height*r,this.context=="2d"&&t.getContext(this.context).scale(r,r),t.style.width=e.width+"px",t.style.height=e.height+"px"},W.prototype.draw=function(){var e=this;clearTimeout(e.timeoutID),e.timeoutID=setTimeout(function(){e._draw()},15)},W.prototype._draw=function(){var e=this._map,t=e.getSize(),r=e.getCenter();if(r){var n=e.pointToOverlayPixel(r);this.canvas.style.left=n.x-t.width/2+"px",this.canvas.style.top=n.y-t.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},W.prototype.getContainer=function(){return this.canvas},W.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},W.prototype.hide=function(){this.canvas.style.display="none"},W.prototype.setZIndex=function(e){this.canvas.style.zIndex=e},W.prototype.getZIndex=function(){return this.zIndex});var T=T||function(){var e=[];return{getAll:function(){return e},removeAll:function(){e=[]},add:function(r){e.push(r)},remove:function(r){var n=e.indexOf(r);n!==-1&&e.splice(n,1)},update:function(r,n){if(e.length===0)return!1;var a=0;for(r=r!==void 0?r:T.now();a<e.length;)e[a].update(r)||n?a++:e.splice(a,1);return!0}}}();typeof window>"u"&&typeof process<"u"?T.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6}:typeof window<"u"&&window.performance!==void 0&&window.performance.now!==void 0?T.now=window.performance.now.bind(window.performance):Date.now!==void 0?T.now=Date.now:T.now=function(){return new Date().getTime()},T.Tween=function(e){var t=e,r={},n={},a={},i=1e3,o=0,s,l=!1,f=!1,d=!1,v=0,c=null,y=T.Easing.Linear.None,g=T.Interpolation.Linear,w=[],x=null,p=!1,_=null,F=null,z=null;this.to=function(m,C){return n=m,C!==void 0&&(i=C),this},this.start=function(m){T.add(this),f=!0,p=!1,c=m!==void 0?m:T.now(),c+=v;for(var C in n){if(n[C]instanceof Array){if(n[C].length===0)continue;n[C]=[t[C]].concat(n[C])}t[C]!==void 0&&(r[C]=t[C],r[C]instanceof Array||(r[C]*=1),a[C]=r[C]||0)}return this},this.stop=function(){return f?(T.remove(this),f=!1,z!==null&&z.call(t,t),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+i),this},this.stopChainedTweens=function(){for(var m=0,C=w.length;m<C;m++)w[m].stop()},this.delay=function(m){return v=m,this},this.repeat=function(m){return o=m,this},this.repeatDelay=function(m){return s=m,this},this.yoyo=function(m){return l=m,this},this.easing=function(m){return y=m,this},this.interpolation=function(m){return g=m,this},this.chain=function(){return w=arguments,this},this.onStart=function(m){return x=m,this},this.onUpdate=function(m){return _=m,this},this.onComplete=function(m){return F=m,this},this.onStop=function(m){return z=m,this},this.update=function(m){var C,R,Y;if(m<c)return!0;p===!1&&(x!==null&&x.call(t,t),p=!0),R=(m-c)/i,R=R>1?1:R,Y=y(R);for(C in n)if(r[C]!==void 0){var q=r[C]||0,N=n[C];N instanceof Array?t[C]=g(N,Y):(typeof N=="string"&&(N.charAt(0)==="+"||N.charAt(0)==="-"?N=q+parseFloat(N):N=parseFloat(N)),typeof N=="number"&&(t[C]=q+(N-q)*Y))}if(_!==null&&_.call(t,Y),R===1)if(o>0){isFinite(o)&&o--;for(C in a){if(typeof n[C]=="string"&&(a[C]=a[C]+parseFloat(n[C])),l){var G=a[C];a[C]=n[C],n[C]=G}r[C]=a[C]}return l&&(d=!d),s!==void 0?c=m+s:c=m+v,!0}else{F!==null&&F.call(t,t);for(var V=0,r1=w.length;V<r1;V++)w[V].start(c+i);return!1}return!0}},T.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return .5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)},Out:function(t){return t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1},InOut:function(t){return t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1)}},Back:{In:function(t){var r=1.70158;return t*t*((r+1)*t-r)},Out:function(t){var r=1.70158;return--t*t*((r+1)*t+r)+1},InOut:function(t){var r=2.5949095;return(t*=2)<1?.5*(t*t*((r+1)*t-r)):.5*((t-=2)*t*((r+1)*t+r)+2)}},Bounce:{In:function(t){return 1-T.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?T.Easing.Bounce.In(t*2)*.5:T.Easing.Bounce.Out(t*2-1)*.5+.5}}},T.Interpolation={Linear:function(t,r){var n=t.length-1,a=n*r,i=Math.floor(a),o=T.Interpolation.Utils.Linear;return r<0?o(t[0],t[1],a):r>1?o(t[n],t[n-1],n-a):o(t[i],t[i+1>n?n:i+1],a-i)},Bezier:function(t,r){for(var n=0,a=t.length-1,i=Math.pow,o=T.Interpolation.Utils.Bernstein,s=0;s<=a;s++)n+=i(1-r,a-s)*i(r,s)*t[s]*o(a,s);return n},CatmullRom:function(t,r){var n=t.length-1,a=n*r,i=Math.floor(a),o=T.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(r<0&&(i=Math.floor(a=n*(1+r))),o(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],a-i)):r<0?t[0]-(o(t[0],t[0],t[1],t[1],-a)-t[0]):r>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],a-n)-t[n]):o(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],a-i)},Utils:{Linear:function(t,r,n){return(r-t)*n+t},Bernstein:function(t,r){var n=T.Interpolation.Utils.Factorial;return n(t)/n(r)/n(t-r)},Factorial:function(){var e=[1];return function(t){var r=1;if(e[t])return e[t];for(var n=t;n>1;n--)r*=n;return e[t]=r,r}}(),CatmullRom:function(t,r,n,a,i){var o=(n-t)*.5,s=(a-r)*.5,l=i*i,f=i*l;return(2*r-2*n+o+s)*f+(-3*r+3*n-2*o-s)*l+o*i+r}}};var Lt={draw:function(t,r,n){var a=r instanceof A?r.get():r;t.save();for(var i in n)t[i]=n[i];var o=n.offset||{x:0,y:0},s=[],l=n._size||n.size;l?t.font="bold "+l+"px Arial":l=12;var f=n.textKey||"text";if(t.textAlign="center",t.textBaseline="middle",n.avoid)for(var d=0,v=a.length;d<v;d++){var c=a[d].geometry._coordinates||a[d].geometry.coordinates,y=c[0]+o.x,g=c[1]+o.y,w=a[d][f],x=t.measureText(w).width,p=y-x/2,_=g-l/2,F={sw:{x:p,y:_+l},ne:{x:p+x,y:_}};St(s,F)||(s.push(F),p=p+x/2,_=_+l/2,t.fillText(w,p,_))}else for(var d=0,v=a.length;d<v;d++){var c=a[d].geometry._coordinates||a[d].geometry.coordinates,y=c[0]+o.x,g=c[1]+o.y,w=a[d][f];t.fillText(w,y,g)}t.restore()}};function St(e,t){for(var r=0;r<e.length;r++)if(At(e[r],t))return!0;return!1}function At(e,t){var r=Math.min(e.ne.x,t.ne.x),n=Math.min(e.sw.y,t.sw.y),a=Math.max(e.sw.x,t.sw.x),i=Math.max(e.ne.y,t.ne.y);return r>a&&n>i}var Et={draw:function(t,r,n){var a=r instanceof A?r.get():r;t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var i=n.offset||{x:0,y:0},o=0,s=a.length;o<s;o++)if(a[o].geometry){var l=a[o].deg||n.deg,f=a[o].icon||n.icon,d=a[o].geometry._coordinates||a[o].geometry.coordinates,v=d[0],c=d[1];l&&(t.save(),t.translate(v,c),t.rotate(l*Math.PI/180),t.translate(-v,-c));var y=n._width||n.width||f.width,g=n._height||n.height||f.height;v=v-y/2+i.x,c=c-g/2+i.y,n.sx&&n.sy&&n.swidth&&n.sheight&&n.width&&n.height?t.drawImage(f,n.sx,n.sy,n.swidth,n.sheight,v,c,y,g):n.width&&n.height?t.drawImage(f,v,c,y,g):t.drawImage(f,v,c),l&&t.restore()}}};typeof window<"u"&&requestAnimationFrame(N1);function N1(e){requestAnimationFrame(N1),T.update(e)}var A1=function(){function e(t,r,n){j(this,e),r instanceof A||(r=new A(r)),this.dataSet=r,this.map=t}return e1(e,[{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(r){var n=this;if(n.intensity=new k({maxSize:n.options.maxSize,minSize:n.options.minSize,gradient:n.options.gradient,max:n.options.max||this.dataSet.getMax("count")}),n.category=new p1(n.options.splitList),n.choropleth=new f1(n.options.splitList),n.options.splitList===void 0&&n.category.generateByDataSet(this.dataSet),n.options.splitList===void 0){var a=n.options.min||this.dataSet.getMin("count"),i=n.options.max||this.dataSet.getMax("count");n.choropleth.generateByMinMax(a,i)}}},{key:"getLegend",value:function(r){var n=this.options.draw,a=null;if(self.options.draw=="intensity"||self.options.draw=="heatmap")return this.intensity.getLegend(r)}},{key:"processData",value:function(r){var n=this,a=n.options.draw;if(a=="bubble"||a=="intensity"||a=="category"||a=="choropleth"||a=="simple")for(var i=0;i<r.length;i++){var o=r[i];n.options.draw=="bubble"?r[i]._size=n.intensity.getSize(o.count):r[i]._size=void 0;var s="fillStyle";(r[i].geometry.type==="LineString"||n.options.styleType==="stroke")&&(s="strokeStyle"),n.options.draw=="intensity"?r[i][s]=n.intensity.getColor(o.count):n.options.draw=="category"?r[i][s]=n.category.get(o.count):n.options.draw=="choropleth"&&(r[i][s]=n.choropleth.get(o.count))}}},{key:"isEnabledTime",value:function(){var r=this.options.animation,n=r&&r.enabled!==!1;return n}},{key:"argCheck",value:function(r){r.draw=="heatmap"&&r.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(r,n,a,i){var o=this;switch(o.options.draw){case"heatmap":P1.draw(r,n,o.options);break;case"grid":case"honeycomb":o.options.offset={x:i.x,y:i.y},o.options.draw=="grid"?I1.draw(r,n,o.options):z1.draw(r,n,o.options);break;case"text":Lt.draw(r,n,o.options);break;case"icon":Et.draw(r,n,o.options);break;case"clip":r.save(),r.fillStyle=o.options.fillStyle||"rgba(0, 0, 0, 0.5)",r.fillRect(0,0,r.canvas.width,r.canvas.height),_1.draw(r,n,o.options),r.beginPath(),i1.drawDataSet(r,n,o.options),r.clip(),U(r),r.restore();break;default:o.options.context=="webgl"?Z1.draw(o.canvasLayer.canvas.getContext("webgl"),n,o.options):_1.draw(r,n,o.options)}}},{key:"isPointInPath",value:function(a,n){for(var a=this.canvasLayer.canvas.getContext(this.context),i=this.dataSet.get(),o=0;o<i.length;o++)if(a.beginPath(),i1.draw(a,i[o],this.options),a.isPointInPath(n.x*this.canvasLayer.devicePixelRatio,n.y*this.canvasLayer.devicePixelRatio))return i[o]}},{key:"clickEvent",value:function(r,n){var a=this.isPointInPath(this.getContext(),r);a?this.options.methods.click(a,n):this.options.methods.click(null,n)}},{key:"mousemoveEvent",value:function(r,n){var a=this.isPointInPath(this.getContext(),r);a?this.options.methods.mousemove(a,n):this.options.methods.mousemove(null,n)}},{key:"update",value:function(r,n){var a=this,i=r.options,o=a.options;for(var s in i)o[s]=i[s];a.init(o),n!==!1&&a.draw()}},{key:"setOptions",value:function(r){var n=this;n.init(r),n.draw()}},{key:"set",value:function(r){var n=this,a=this.getContext(),i=this.getDefaultContextConfig();for(var o in i)a[o]=i[o];n.init(r.options),n.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var r=this,n=r.options.animation;if(r.options.draw=="time"||r.isEnabledTime()){n.stepsRange||(n.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:n.stepsRange.start},r.animator=new T.Tween(this.steps).onUpdate(function(){r._canvasUpdate(this.step)}).repeat(1/0),this.addAnimatorEvent();var a=n.duration*1e3||5e3;r.animator.to({step:n.stepsRange.end},a),r.animator.start()}else r.animator&&r.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var r=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=r.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),e}(),Pt=function(e){m1(t,e);function t(r,n,a){j(this,t);var i=w1(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n,a));i.map=r,i.options=a||{},i.dataSet=n,i.init(a);var o=new W({map:r,update:i._canvasUpdate.bind(i)});i.transferToMercator();var s=i;return n.on("change",function(){s.transferToMercator(),o.draw()}),i.ctx=o.canvas.getContext("2d"),i.start(),i}return e1(t,[{key:"init",value:function(n){var a=this;a.options=n,this.initDataRange(n),this.context=a.options.context||"2d",a.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(a.options.zIndex),a.options.max&&this.intensity.setMax(a.options.max),a.options.min&&this.intensity.setMin(a.options.min),this.initAnimator()}},{key:"transferToMercator",value:function(){var n=this.map.getMapType().getProjection();if(this.options.coordType!=="bd09mc"){var a=this.dataSet.get();a=this.dataSet.transferCoordinate(a,function(i){var o=n.lngLatToPoint({lng:i[0],lat:i[1]});return[o.x,o.y]},"coordinates","coordinates_mercator"),this.dataSet._set(a)}}},{key:"_canvasUpdate",value:function(){var n=this.ctx;if(!!n){var a=this.map,i=Math.pow(2,18-a.getZoom()),o=a.getMapType().getProjection(),s=o.lngLatToPoint(a.getCenter()),l=new BMap.Pixel(s.x-a.getSize().width/2*i,s.y+a.getSize().height/2*i);U(n);var f={fromColumn:this.options.coordType=="bd09mc"?"coordinates":"coordinates_mercator",transferCoordinate:function(v){if(!!v){var c=(v[0]-l.x)/i,y=(l.y-v[1])/i;return[c,y]}}};this.data=this.dataSet.get(f),this.processData(this.data),this.drawAnimation()}}},{key:"drawAnimation",value:function(){var n=this.ctx,a=this.data;if(!!a){n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore(),n.save(),this.options.shadowColor&&(n.shadowColor=this.options.shadowColor),this.options.shadowBlur&&(n.shadowBlur=this.options.shadowBlur),this.options.globalAlpha&&(n.globalAlpha=this.options.globalAlpha),this.options.globalCompositeOperation&&(n.globalCompositeOperation=this.options.globalCompositeOperation);for(var i=this.options,o=0;o<a.length;o++)if(a[o].geometry.type==="Point"){n.beginPath();var s=a[o].size||this.options.size,l=a[o].minSize||this.options.minSize||0;a[o]._size===void 0&&(a[o]._size=l),n.arc(a[o].geometry._coordinates[0],a[o].geometry._coordinates[1],a[o]._size,0,Math.PI*2,!0),n.closePath(),a[o]._size++,a[o]._size>s&&(a[o]._size=l),n.lineWidth=1,n.strokeStyle=a[o].strokeStyle||i.strokeStyle||"yellow",n.stroke();var f=a[o].fillStyle||i.fillStyle;f&&(n.fillStyle=f,n.fill())}else if(a[o].geometry.type==="LineString"){n.beginPath();var d=a[o].size||this.options.size||5,l=a[o].minSize||this.options.minSize||0;a[o]._index===void 0&&(a[o]._index=0);var v=a[o]._index;n.arc(a[o].geometry._coordinates[v][0],a[o].geometry._coordinates[v][1],d,0,Math.PI*2,!0),n.closePath(),a[o]._index++,a[o]._index>=a[o].geometry._coordinates.length&&(a[o]._index=0),n.lineWidth=i.lineWidth||1;var c=a[o].strokeStyle||i.strokeStyle,f=a[o].fillStyle||i.fillStyle||"yellow";n.fillStyle=f,n.fill(),c&&(n.strokeStyle=c,n.stroke())}n.restore()}}},{key:"animate",value:function(){this.drawAnimation();var n=this.options.animateTime||100;this.timeout=setTimeout(this.animate.bind(this),n)}},{key:"start",value:function(){this.stop(),this.animate()}},{key:"stop",value:function(){clearTimeout(this.timeout)}}]),t}(A1),It=function(e){m1(t,e);function t(r,n,a){j(this,t);var i=w1(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n,a)),o=i,s=null;a=a||{},o.init(a),o.argCheck(a),o.transferToMercator();var l=i.canvasLayer=new W({map:r,context:i.context,paneName:a.paneName,mixBlendMode:a.mixBlendMode,enableMassClear:a.enableMassClear,zIndex:a.zIndex,update:function(){o._canvasUpdate()}});return n.on("change",function(){o.transferToMercator(),l.draw()}),i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.bindEvent(),i}return e1(t,[{key:"clickEvent",value:function(n){var a=n.pixel;n1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clickEvent",this).call(this,a,n)}},{key:"mousemoveEvent",value:function(n){var a=n.pixel;n1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"mousemoveEvent",this).call(this,a,n)}},{key:"bindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&(a.setDefaultCursor("default"),a.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&a.addEventListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&a.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&a.removeEventListener("mousemove",this.mousemoveEvent))}},{key:"transferToMercator",value:function(){var n=this.map.getMapType().getProjection();if(this.options.coordType!=="bd09mc"){var a=this.dataSet.get();a=this.dataSet.transferCoordinate(a,function(i){var o=n.lngLatToPoint({lng:i[0],lat:i[1]});return[o.x,o.y]},"coordinates","coordinates_mercator"),this.dataSet._set(a)}}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(!!this.canvasLayer){var a=this,i=a.options.animation,o=this.canvasLayer._map,s=Math.pow(2,18-o.getZoom()),l=o.getMapType().getProjection(),f=l.lngLatToPoint(o.getCenter()),d=new BMap.Pixel(f.x-o.getSize().width/2*s,f.y+o.getSize().height/2*s),v=this.getContext();if(a.isEnabledTime()){if(n===void 0){U(v);return}this.context=="2d"&&(v.save(),v.globalCompositeOperation="destination-out",v.fillStyle="rgba(0, 0, 0, .1)",v.fillRect(0,0,v.canvas.width,v.canvas.height),v.restore())}else U(v);if(this.context=="2d")for(var c in a.options)v[c]=a.options[c];else v.clear(v.COLOR_BUFFER_BIT);if(!(a.options.minZoom&&o.getZoom()<a.options.minZoom||a.options.maxZoom&&o.getZoom()>a.options.maxZoom)){var y=1;this.context!="2d"&&(y=this.canvasLayer.devicePixelRatio);var g={fromColumn:a.options.coordType=="bd09mc"?"coordinates":"coordinates_mercator",transferCoordinate:function(_){var F=(_[0]-d.x)/s*y,z=(d.y-_[1])/s*y;return[F,z]}};n!==void 0&&(g.filter=function(p){var _=i.trails||10;return!!(n&&p.time>n-_&&p.time<n)});var w=a.dataSet.get(g);this.processData(w);var x=o.pointToPixel(new BMap.Point(0,0));a.options.unit=="m"?(a.options.size&&(a.options._size=a.options.size/s),a.options.width&&(a.options._width=a.options.width/s),a.options.height&&(a.options._height=a.options.height/s)):(a.options._size=a.options.size,a.options._height=a.options.height,a.options._width=a.options.width),this.drawContext(v,w,a.options,x),a.options.updateCallback&&a.options.updateCallback(n)}}}},{key:"init",value:function(n){var a=this;a.options=n,this.initDataRange(n),this.context=a.options.context||"2d",a.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(a.options.zIndex),a.options.max&&this.intensity.setMax(a.options.max),a.options.min&&this.intensity.setMin(a.options.min),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),t}(A1);function I(e){this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=I.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var t=document.createElement("canvas");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.pointerEvents="none",this.canvas=t,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1;function r(n,a){return function(){a.apply(n)}}this.repositionFunction_=r(this,this.repositionCanvas_),this.resizeFunction_=r(this,this.resize_),this.requestUpdateFunction_=r(this,this.update_),e&&this.setOptions(e)}var H=typeof window>"u"?{}:window;H.google&&H.google.maps&&(I.prototype=new google.maps.OverlayView,I.DEFAULT_PANE_NAME_="overlayLayer",I.CSS_TRANSFORM_=function(){for(var e=document.createElement("div"),t=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],r=0;r<t.length;r++){var n=t[r];if(e.style[n]!==void 0)return n}return t[0]}(),I.prototype.requestAnimFrame_=H.requestAnimationFrame||H.webkitRequestAnimationFrame||H.mozRequestAnimationFrame||H.oRequestAnimationFrame||H.msRequestAnimationFrame||function(e){return H.setTimeout(e,1e3/60)},I.prototype.cancelAnimFrame_=H.cancelAnimationFrame||H.webkitCancelAnimationFrame||H.mozCancelAnimationFrame||H.oCancelAnimationFrame||H.msCancelAnimationFrame||function(e){},I.prototype.setOptions=function(e){e.animate!==void 0&&this.setAnimate(e.animate),e.paneName!==void 0&&this.setPaneName(e.paneName),e.updateHandler!==void 0&&this.setUpdateHandler(e.updateHandler),e.resizeHandler!==void 0&&this.setResizeHandler(e.resizeHandler),e.resolutionScale!==void 0&&this.setResolutionScale(e.resolutionScale),e.map!==void 0&&this.setMap(e.map)},I.prototype.setAnimate=function(e){this.isAnimated_=!!e,this.isAnimated_&&this.scheduleUpdate()},I.prototype.isAnimated=function(){return this.isAnimated_},I.prototype.setPaneName=function(e){this.paneName_=e,this.setPane_()},I.prototype.getPaneName=function(){return this.paneName_},I.prototype.setPane_=function(){if(!!this.isAdded_){var e=this.getPanes();if(!e[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');e[this.paneName_].appendChild(this.canvas)}},I.prototype.setResizeHandler=function(e){this.resizeHandler_=e},I.prototype.setResolutionScale=function(e){typeof e=="number"&&(this.resolutionScale_=e,this.resize_())},I.prototype.setUpdateHandler=function(e){this.updateHandler_=e},I.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},I.prototype.onRemove=function(){!this.isAdded_||(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(H,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},I.prototype.resize_=function(){if(!!this.isAdded_){var e=this.getMap(),t=e.getDiv().offsetWidth,r=e.getDiv().offsetHeight,n=t*this.resolutionScale_,a=r*this.resolutionScale_,i=this.canvas.width,o=this.canvas.height;(i!==n||o!==a)&&(this.canvas.width=n,this.canvas.height=a,this.needsResize_=!0,this.scheduleUpdate()),(this.canvasCssWidth_!==t||this.canvasCssHeight_!==r)&&(this.canvasCssWidth_=t,this.canvasCssHeight_=r,this.canvas.style.width=t+"px",this.canvas.style.height=r+"px")}},I.prototype.draw=function(){this.repositionCanvas_()},I.prototype.repositionCanvas_=function(){var e=this.getMap(),t=e.getBounds().getNorthEast().lat(),r=e.getCenter(),n=Math.pow(2,e.getZoom()),a=r.lng()-this.canvasCssWidth_*180/(256*n);this.topLeft_=new google.maps.LatLng(t,a);var i=this.getProjection(),o=i.fromLatLngToDivPixel(r),s=-Math.round(this.canvasCssWidth_/2-o.x),l=-Math.round(this.canvasCssHeight_/2-o.y);this.canvas.style[I.CSS_TRANSFORM_]="translate("+s+"px,"+l+"px)",this.scheduleUpdate()},I.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},I.prototype.getTopLeft=function(){return this.topLeft_},I.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(H,this.requestUpdateFunction_))});var zt=function(e){m1(t,e);function t(r,n,a){j(this,t);var i=w1(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n,a)),o=i,s=null;a=a||{},o.init(a),o.argCheck(a);var l={map:r,animate:!1,updateHandler:function(){o._canvasUpdate()},resolutionScale},f=i.canvasLayer=new I(l);return i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.bindEvent(),i}return e1(t,[{key:"clickEvent",value:function(n){var a=n.pixel;n1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clickEvent",this).call(this,a,n)}},{key:"mousemoveEvent",value:function(n){var a=n.pixel;n1(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"mousemoveEvent",this).call(this,a,n)}},{key:"bindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&(a.setDefaultCursor("default"),a.addListener("click",this.clickEvent)),this.options.methods.mousemove&&a.addListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&a.removeListener("click",this.clickEvent),this.options.methods.mousemove&&a.removeListener("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(!!this.canvasLayer){var a=this,i=a.options.animation,o=this.getContext();if(a.isEnabledTime()){if(n===void 0){U(o);return}this.context=="2d"&&(o.save(),o.globalCompositeOperation="destination-out",o.fillStyle="rgba(0, 0, 0, .1)",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.restore())}else U(o);if(this.context=="2d")for(var s in a.options)o[s]=a.options[s];else o.clear(o.COLOR_BUFFER_BIT);if(!(a.options.minZoom&&l.getZoom()<a.options.minZoom||a.options.maxZoom&&l.getZoom()>a.options.maxZoom)){var d=1;this.context!="2d"&&(d=this.canvasLayer.devicePixelRatio);var l=this.map,f=l.getProjection(),d=Math.pow(2,l.zoom)*resolutionScale,v=f.fromLatLngToPoint(this.canvasLayer.getTopLeft()),c={transferCoordinate:function(_){var F=new google.maps.LatLng(_[1],_[0]),z=f.fromLatLngToPoint(F),m={x:(z.x-v.x)*d,y:(z.y-v.y)*d};return[m.x,m.y]}};n!==void 0&&(c.filter=function(p){var _=i.trails||10;return!!(n&&p.time>n-_&&p.time<n)});var y=a.dataSet.get(c);this.processData(y);var g=new google.maps.LatLng(0,0),w=f.fromLatLngToPoint(g),x={x:(w.x-v.x)*d,y:(w.y-v.y)*d};a.options.unit=="m"&&a.options.size?a.options._size=a.options.size/zoomUnit:a.options._size=a.options.size,this.drawContext(o,new A(y),a.options,x),a.options.updateCallback&&a.options.updateCallback(n)}}}},{key:"init",value:function(n){var a=this;a.options=n,this.initDataRange(n),this.context=a.options.context||"2d",a.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(a.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){self.canvasLayer.draw()}}]),t}(A1),Ot={getDataSet:function(t){for(var r=[],n=t.features,a=0;a<n.length;a++){var i=n[a],o=i.geometry,s=i.properties,l={};for(var f in s)l[f]=s[f];l.geometry=o,r.push(l)}return new A(r)}},Tt={CSVToArray:function(t,r){r=r||",";for(var n=new RegExp("(\\"+r+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+r+"\\r\\n]*))","gi"),a=[[]],i=null;i=n.exec(t);){var o=i[1];o.length&&o!==r&&a.push([]);var s;i[2]?s=i[2].replace(new RegExp('""',"g"),'"'):s=i[3],a[a.length-1].push(s)}return a},getDataSet:function(t){for(var r=this.CSVToArray(t,","),n=[],a=r[0],i=1;i<r.length-1;i++){for(var o=r[i],s={},l=0;l<o.length;l++){var f=o[l];a[l]=="geometry"&&(f=JSON.parse(f)),s[a[l]]=f}n.push(s)}return new A(n)}};M.version=K,M.canvasClear=U,M.canvasResolutionScale=a1,M.canvasDrawSimple=_1,M.canvasDrawHeatmap=P1,M.canvasDrawGrid=I1,M.canvasDrawHoneycomb=z1,M.webglDrawSimple=Z1,M.webglDrawPoint=R1,M.webglDrawLine=T1,M.webglDrawPolygon=k1,M.utilCityCenter=wt,M.utilCurve=bt,M.utilForceEdgeBundling=Ct,M.utilDataRangeIntensity=k,M.utilDataRangeCategory=p1,M.utilDataRangeChoropleth=f1,M.Map=Mt,M.baiduMapCanvasLayer=W,M.baiduMapAnimationLayer=Pt,M.baiduMapLayer=It,M.googleMapCanvasLayer=I,M.googleMapLayer=zt,M.DataSet=A,M.geojson=Ot,M.csv=Tt,Object.defineProperty(M,"__esModule",{value:!0})});
