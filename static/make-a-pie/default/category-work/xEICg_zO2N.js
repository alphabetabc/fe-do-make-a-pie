const elem=document.createElement("div"),mEchart=echarts.init(elem,"yunting_multi_color",{width:800,height:284});document.body.appendChild(elem);const multiPositiveColor=["#1574B3","#CDB446","#D07B49","#1EA082","#3D85FF","#D8727F","#0E97AD","#119073","#D969BF","#A9A557","#3D42C6","#3ACCD3","#1A9E59","#1574B3","#38B5FF","#9369D9","#1BBF69","#CC6A77","#A3A3A3","#D2D2D2"],emotionTypes=["positive","negative","total"];function getDemoData(){const c=Array.from({length:5}).map((e,t)=>`指标${t}`),p=Array.from({length:5}).map((e,t)=>`视觉${t}`);let r=0;return c.reduce((e,t)=>{const o=parseInt(Math.random()*1e3%10)+1;return Array.from({length:o}).forEach((n,i)=>{const s=parseInt(Math.random()*1e4),d=parseInt(Math.random()*1e4);r+=s+d;const m=1;e.push({aspect1:t,aspect2:`${t}${i}`,negative:d,positive:s,businessView:Array.from({length:m}).reduce(a=>{const g=parseInt(Math.random()*1e3)%p.length;return a.find(u=>u.id===g)||a.push({id:g,name:p[g]}),a},[])})}),e},[]).map(e=>({...e,messageTotal:r}))}function transformChartData(c,p,r){let l=c.reduce((e,t)=>(t.businessView.forEach(({id:o,name:n})=>{let i=e.find(d=>d.view===n);i||(i={id:o,view:n,aspects:[]},e.push(i));const s=t.positive+t.negative;i.aspects.push({total:s,aspect:t.aspect2,positive:t.positive,negative:t.negative,negRate:t.negative/s,posRate:t.positive/s,menRate:s/t.messageTotal})}),e),[]);if(console.log({viewData:l}),p===1)return l.reduce((e,t)=>{let o=0,n=0;t.aspects.forEach(s=>{o+=s.positive,n+=s.negative});const i=o+n;if(i){const s=o/i,d=n/i;e.push([t.view,i,s,d])}return e},[["业务视觉","指标声量","指标好评率","指标差评率"]]);if(p===2){const e=l.reduce((o,n)=>{const{view:i,aspects:s}=n;return s.sort((m,a)=>a.posRate-m.posRate).forEach(m=>{o.push([i,m.aspect,m.posRate])}),o},[["业务视觉","指标","指标好评率"]]),t=l.reduce((o,n)=>{const{view:i,aspects:s}=n;return s.sort((m,a)=>a.negRate-m.negRate).forEach(m=>{o.push([i,m.aspect,m.negRate])}),o},[["业务视觉","指标","指标差评率"]]);return[e,t].map(o=>({source:o}))}else if(p===3){const e=l.reduce((n,i)=>{const{view:s,aspects:d}=i;return d.sort((a,g)=>g.total-a.total).forEach(a=>{n.push([s,a.aspect,a.total,a.menRate])}),n},[["业务视觉","指标","指标声量","指标提及率"]]),t=l.reduce((n,i)=>{const{view:s,aspects:d}=i;return d.sort((a,g)=>g.positive-a.positive).forEach(a=>{n.push([s,a.aspect,a.positive,a.menRate])}),n},[["业务视觉","指标","指标正面声量","指标提及率"]]),o=l.reduce((n,i)=>{const{view:s,aspects:d}=i;return d.sort((a,g)=>g.negative-a.negative).forEach(a=>{n.push([s,a.aspect,a.negative,a.menRate])}),n},[["业务视觉","指标","指标负面声量","指标提及率"]]);return[t,o,e].map(n=>({source:n}))}return l}function getChartOneOption(c,p){const r=p==="positive"?2:3;return{title:{text:"自主分析"},dataset:[{source:c}],grid:{top:80,bottom:50,left:20,right:20,containLabel:!0},legend:{left:20,top:40,data:[{name:c[0][1],icon:"path://M0,0H10V10H0z"},{name:c[0][r],icon:"path://M512 341.504A170.496 170.496 0 1 0 682.496 512 170.496 170.496 0 0 0 512 341.504z m0-170.496a341.504 341.504 0 0 1 330.752 256H1024v170.496h-181.248a341.504 341.504 0 0 1-660.992 0H0V426.496h181.248a341.504 341.504 0 0 1 330.752-256z"}]},dataZoom:[{show:"slider",bottom:20,xAxisIndex:[0,1],height:15,handleSize:"100%",showDetail:!1}],tooltip:{trigger:"axis",formatter:l=>l.reduce((e,t,o)=>{const{marker:n,data:i,dimensionNames:s}=t;return e.push(`${n} ${s[o?r:1]}：${o?`${(i[r]*100).toFixed(2)}%`:i[1]}`),e},[`<span style="font-size: 14px; color: #262626; font-weight: bold; padding-bottom: 8px; display: inline-block;">${l[0].name}</span>`]).join("</br>")},xAxis:[0,1].map(l=>({type:"category"})),yAxis:[0,1].map(l=>({type:"value",position:l?"left":"right",max:"dataMax",axisLabel:{formatter:e=>l?`${(e*100).toFixed(0)}%`:e}})),series:[{type:"bar",name:c[0][1],yAxisIndex:0,barMaxWidth:24,encode:{x:0,y:1}},{type:"line",name:c[0][r],yAxisIndex:1,encode:{x:0,y:r}}]}}function getChartTwoOption(c,p){const r=emotionTypes.indexOf(p),l=c[r].source.reduce((e,t,o)=>(o>0&&!e.includes(t[0])&&e.push(t[0]),e),[]);return{title:{text:c[r].source[0][2]},dataset:c,grid:{top:80,bottom:50,left:20,right:70,containLabel:!0},visualMap:[{type:"piecewise",top:40,left:20,itemWidth:10,itemHeight:10,orient:"horizontal",dimension:0,categories:l.map(e=>e),inRange:{symbol:"rect",color:multiPositiveColor},outOfRange:{color:"#bfbfbf"}}],dataZoom:[{show:"slider",bottom:20,xAxisIndex:0,height:15,handleSize:"100%",showDetail:!1}],tooltip:{formatter:e=>{const{marker:t,data:o,dimensionNames:n}=e;return[`<span style="font-size: 14px; color: #262626; font-weight: bold; padding-bottom: 8px; display: inline-block;">${o[1]}</span>`,`${n[0]}：${o[0]}`,`${t} ${n[2]}：${(o[2]*100).toFixed(2)}%`].join("</br>")}},xAxis:{type:"category"},yAxis:{type:"value",max:1,axisLabel:{formatter:e=>`${e*100}%`}},series:[{type:"bar",datasetIndex:r,barMaxWidth:24,markLine:{symbol:"none",silent:!0,data:[{type:"average",lineStyle:{color:"#BFBFBF"},label:{formatter:e=>`{a|${(e.value*100).toFixed(2)}%}`,rich:{a:{backgroundColor:"#BFBFBF",color:"#fff",padding:[4,4]}}}}]},encode:{x:1,y:2}}]}}function getChartThreeOption(c,p){const r=emotionTypes.indexOf(p),l=c[r].source.reduce((e,t,o)=>(o>0&&!e.includes(t[0])&&e.push(t[0]),e),[]);return{title:{text:c[r].source[0][2]},dataset:c,grid:{top:80,bottom:50,left:20,right:20,containLabel:!0},legend:{left:20,top:40,itemWidth:12,itemHeight:12,data:[c[r].source[0][3]],icon:"path://M512 341.504A170.496 170.496 0 1 0 682.496 512 170.496 170.496 0 0 0 512 341.504z m0-170.496a341.504 341.504 0 0 1 330.752 256H1024v170.496h-181.248a341.504 341.504 0 0 1-660.992 0H0V426.496h181.248a341.504 341.504 0 0 1 330.752-256z"},visualMap:[{type:"piecewise",top:40,left:110,seriesIndex:1,itemWidth:10,itemHeight:10,orient:"horizontal",dimension:0,categories:l.map(e=>e),inRange:{symbol:"rect",color:multiPositiveColor},outOfRange:{color:"#bfbfbf"}}],dataZoom:[{show:"slider",bottom:20,xAxisIndex:0,height:15,handleSize:"100%",showDetail:!1}],tooltip:{trigger:"axis",formatter:e=>{console.log(e);const[t,o]=e;return[`<span style="font-size: 14px; color: #262626; font-weight: bold; padding-bottom: 8px; display: inline-block;">${e[0].name}</span>`,`${o.marker} ${o.dimensionNames[2]}：${o.data[2]}`,`${t.marker} ${t.dimensionNames[3]}：${(t.data[3]*100).toFixed(2)}%`].join("</br>")}},xAxis:[0,1].map(e=>({type:"category"})),yAxis:[0,1].map(e=>({type:"value",max:e?void 0:"dataMax",splitNumber:3,position:e?"right":"left",axisLabel:{formatter:t=>e?t:`${(t*100).toFixed(0)}%`}})),series:[{type:"line",datasetIndex:r,yAxisIndex:0,xAxisIndex:0,markLine:{symbol:"none",silent:!0,data:[{type:"average",lineStyle:{color:"#BFBFBF"},label:{formatter:e=>`{a|${(e.value*100).toFixed(2)}%}`,rich:{a:{backgroundColor:"#BFBFBF",color:"#fff",padding:[4,4]}}}}]},itemStyle:{color:"#D96969"},encode:{x:1,y:3,seriesName:3}},{type:"bar",datasetIndex:r,xAxisIndex:0,yAxisIndex:1,barMaxWidth:24,encode:{x:1,y:2}}]}}function getOption(c,p,r){if(p===1)return getChartOneOption(c,r);if(p===2)return getChartTwoOption(c,r);if(p===3)return getChartThreeOption(c,r)}const chartType=3,emotionType="positive",data=getDemoData(),chartData=transformChartData(data,chartType,emotionType),option=getOption(chartData,chartType,emotionType);console.log({data,chartData,option}),mEchart.setOption(option);
