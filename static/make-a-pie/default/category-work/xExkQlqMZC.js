var option={bmap:{center:[121.4693,31.2],zoom:10,roam:!0,enableMapClick:!1,mapStyle:{styleJson:[{featureType:"all",elementType:"all",stylers:{lightness:15,saturation:-50}},{featureType:"highway",elementType:"geometry.fill",stylers:{color:"#ffffff"}},{featureType:"poi",elementType:"labels.icon",stylers:{visibility:"off"}},{featureType:"road",elementType:"labels",stylers:{visibility:"off"}}]}},title:{x:"center",text:"上海社区养老组织热力图",subtext:"",textStyle:{color:"#696969",fontSize:25}}};myChart.setOption(option),setTimeout(init,0);function init(){initMap(),initMapv()}function getMap(){return myChart.getModel().getComponent("bmap").getBMap()}function initMap(){var M=new BMap.NavigationControl({type:BMAP_NAVIGATION_CONTROL_SMALL}),K=new BMap.ScaleControl({offset:new BMap.Size(100,50)}),U=getMap();return U.addControl(M),U.addControl(K),U.disableDoubleClickZoom(),U}function initMapv(){for(var M=getMap(),K=[],U=points.length;U--;){var at=points[U];K.push({geometry:{type:"Point",coordinates:[at[0],at[1]]},count:at[2]})}var tt=new mapv.DataSet(K),j={fillStyle:"#DC143C",strokeStyle:"white",lineWidth:1,size:40,globalAlpha:1,gradient:{.1:"rgba(200, 20, 60,0.1)",.2:"rgba(200, 20, 60,0.2)",.3:"rgba(200, 20, 60,0.3)",.4:"rgba(200, 20, 60,0.4)",.5:"rgba(200, 20, 60,0.5)",.6:"rgba(200, 20, 60,0.6)",.7:"rgba(200, 20, 60,0.7)",.8:"rgba(200, 20, 60,0.8)",.9:"rgba(200, 20, 60,0.85)",1:"rgba(200, 20, 60,0.9)"},label:{show:!0,fillStyle:"white",average:!1,font:"12px Calibra"},max:4,draw:"honeycomb",methods:{click:function(nt){console.log(nt)}}},et=new mapv.baiduMapLayer(M,tt,j)}var points=[[121.469876782248,31.273721070047,1],[121.418394355386,31.3133588508395,1],[121.435551001592,31.3331638901449,1],[121.603444252899,31.2637399744409,1],[121.4082002039,31.3554095254148,1],[121.381213258565,31.1968148054537,1],[121.547051017085,31.6848768942766,1],[121.506950209967,31.3957964177403,1],[121.353228595844,31.4213809943265,1],[121.334125501258,31.4786349363326,1],[121.472011425631,31.3370185112196,1],[121.486850907148,31.4074878733841,1],[121.462024244633,31.3421664706414,1],[121.83914412654,31.5323043494477,1],[121.396163113083,31.6257406126358,1],[121.848411585164,31.3462218738458,1],[121.494644682108,31.629976151533,1],[121.778591777537,31.5226195290328,1],[121.463925148922,31.6634600899975,1],[121.574845856175,30.8687550756141,1],[121.431713310199,30.7970595812757,1],[121.447202672633,30.9989135285422,1],[121.402277675672,30.9013332678464,1],[121.478999434024,31.2795290407276,1],[121.436839800508,31.1981679195382,1],[121.45757790185,31.2340192321385,1],[121.477838823305,31.2696724677033,1],[121.494884436255,31.2700104379951,1],[121.438597203187,31.2332038422688,1],[121.538872933553,31.1493744070405,1],[121.49872637304,31.2528239386035,1],[121.650466349463,30.9107608151123,1],[121.494601809579,31.2851591184254,1],[121.494601809579,31.2851591184254,1],[121.562638863447,31.1785229353569,1],[121.522229630319,31.2436606691494,1],[121.465034480769,30.9213199388172,1],[121.58186080475,30.9343657196239,1],[121.477782230058,31.2059297689316,1],[121.491786273975,31.2358144902528,1],[121.504246887094,31.300162317392,1],[121.498025618386,31.2092019222985,1],[121.193443473426,30.7910734817746,1],[121.47393544961,31.2358220979302,1],[121.47393544961,31.2358220979302,1],[121.485418006554,31.2434306577266,1],[121.504208940873,31.2322262554045,1],[121.471235469332,31.2233013872603,1],[121.180596716498,30.8994091451047,1],[121.48837546814,31.2069387354708,1],[121.507660410303,31.2256802515979,1],[121.500852195063,31.2290587280869,1],[121.253501574737,31.3850711747581,1],[121.417200307041,30.8006612645052,1],[121.348479349833,30.7409017252181,1],[121.324938599977,30.7317373586464,1],[121.198468324957,30.8061861005615,1],[121.457946954499,31.2506236817808,1],[121.378580082573,30.7732441036199,1],[121.319089999599,30.8873008463566,1],[121.319649531643,30.8872656426318,1],[121.304126569888,30.8072778329687,1],[121.4841865887,31.3071103454952,1],[121.459176029572,31.2837208859099,1],[121.445590643633,31.2343257646533,1],[121.450767319575,31.2416996227765,1],[121.451388487056,31.2327468756417,1],[121.448035741401,31.2286574910561,1],[121.465378786898,31.3183314925332,1],[121.452886231832,31.3194700210451,1],[121.446339650767,31.2906024110283,1],[121.471494089692,31.2501917939364,1],[121.465178716295,31.2436155028235,1],[121.374185340256,31.1342326465834,1],[121.316921045436,31.2195158003406,1],[121.4725849937,31.2548368445297,1],[121.38947099844,31.1572906243438,1],[121.389665098007,31.1750964921128,1],[121.405153690593,31.01617137005,1],[121.537086024232,31.0631098480045,1],[121.376119468374,31.1203169875427,1],[121.388768812786,31.0961616422284,1],[121.051392536692,31.0046648187979,1],[121.755912887141,30.9774403937783,1],[121.641542765781,31.322033620977,1],[121.618422326786,31.3033771681635,1],[121.586986279074,31.3510442518219,1],[121.59250796901,31.0204593098916,1],[121.758236923868,31.0544658639371,1],[121.606591597406,31.1267073888516,1],[121.849028271897,31.0410677402715,1],[121.516924904519,31.1962142479104,1],[121.813129585243,30.9169958810735,1],[121.633719840807,31.1983083185316,1],[121.879566423726,30.980637840397,1],[121.666135785321,31.2135691381637,1],[121.530528753332,31.2160875326289,1],[121.826416060922,30.9777199195254,1],[121.522177207006,31.2319240389101,1],[121.650675879223,31.0278955789002,1],[121.706043546585,31.0294313965473,1],[121.504257000218,31.179374873885,1],[121.464330194877,31.2677061674839,1],[121.442621976584,31.270929990217,1],[121.434214412824,31.2620876081042,1],[121.352863234332,31.2891189982229,1],[121.440564695271,31.250848772482,1],[121.398997602933,31.2347923930579,1],[121.392496433008,31.2584727823967,1],[121.126167583461,31.1980928489199,1],[121.235724378187,31.2062206414189,1],[121.625068683542,31.5485599932156,1],[121.356425913086,31.7210745946171,1],[120.92386010344,31.0426354909736,1],[121.276189250562,31.1756022413165,1],[121.203262056854,31.1578639862529,1],[121.18640574562,31.2084914103295,1],[121.066455323483,31.0814911740177,1],[121.534170006869,30.8377274555644,1],[121.347464959895,30.8631520658324,1],[121.273860441137,31.088183640434,1],[121.207634814042,31.0458228145207,1],[121.216451502962,30.9383673779042,1],[121.325741881832,31.0165830193468,1],[121.129473384568,30.9889316332928,1],[121.074236445811,30.9402699569996,1],[121.212398977315,31.0187378449706,1],[121.700598707584,31.183978992634,1],[121.402513515004,31.1785108234077,1],[121.445298874003,31.2149036995576,1],[121.463803608187,31.2145659882205,1],[121.456942514193,31.1748381356108,1],[121.431877291379,31.1799717669106,1],[121.524052022707,31.2718683988739,1],[121.527349531556,31.2913655466849,1],[121.526101585778,31.266983963465,1],[121.54838707226,31.2743313657549,1],[121.518212212247,31.2821463993738,1],[121.528355798117,31.3223568633638,1],[121.54179038551,31.3079297876422,1],[121.539475876211,31.2967671127292,1],[121.549364602028,31.2941524096132,1],[121.379243125463,31.2217764568648,1],[121.420723031861,31.2037325598615,1],[121.431444038631,31.2236732673273,1],[121.43961834928,31.2222629408271,1],[121.409828382636,31.2189619309826,1],[121.394519884136,31.2093669050482,1],[121.440010451551,31.2090510192176,1],[121.365690395624,31.2205029239869,1],[121.422396036043,31.2194698634332,1],[121.224330720251,31.2752946603853,1],[121.187414331606,31.4307448395091,1],[121.291490327263,31.4765995987119,1],[121.371655249312,31.2521376619119,1],[121.499039605883,31.2249538348759,1],[121.452965282717,31.1400515859375,1],[121.551586064842,31.2480236122499,1],[121.498617959243,31.181846684909,1],[121.460385016738,31.2039629005213,1],[121.256934269583,31.0117441895561,1],[121.295093022832,31.7496307345151,1],[121.581663896182,31.1200297902111,1],[121.689658960727,31.2626247284332,1],[121.330191263583,31.2598248869539,1],[121.621010840824,31.2744384256708,1],[121.416815559198,31.2688452352277,1],[121.420014178983,31.2296612053128,1],[121.434809899547,31.2641129829819,1],[121.448262652474,31.2653877339353,1],[121.440564695271,31.250848772482,1],[121.23934158678,30.9999183941088,1],[121.457675226964,31.2093335989581,1],[121.460382717076,31.1257647490899,1],[121.445620736868,31.180826009376,1],[121.440664336216,31.1398144429822,1],[113.558881651622,23.2998606949244,1],[121.769799730935,31.1245378730823,1],[121.380778537987,31.2438727043696,1],[121.343206722286,30.7319638528111,1],[121.352863234332,31.2891189982229,1],[121.421233898205,31.2425519780091,1],[121.441816608863,31.2445681421303,1],[121.410004839483,31.2674394387813,1],[121.414100993134,31.2602028726962,1],[121.426917307387,31.2475075153791,1],[121.43070430201,31.268186914502,1],[121.397362327583,31.2385189297993,1],[121.429452705519,31.2887959409089,1],[121.408467359958,31.2619644451283,1],[121.403599352569,31.2653093889399,1],[121.747474002163,31.0523773939089,1],[121.43269097651,31.4232414356542,1],[121.225376158322,31.7738289250939,1],[121.431567016656,31.2675755268894,1],[121.53695675807,31.2692926683349,1],[121.549870056979,31.2149917393287,1],[121.276189250562,31.1756022413165,1],[121.464330194877,31.2677061674839,1],[120.926222900254,31.0429910353838,1],[121.420117304456,30.8014761307708,1],[121.173289311089,30.9046968965318,1],[121.180994486177,30.8313525463332,1],[121.023337842971,30.8921337500141,1],[121.419440521085,31.6791664134338,1],[121.411154773841,30.8022183035782,1],[121.500003254136,31.279784424511,1],[121.160305072994,31.1656480664878,1],[121.053721114354,31.0159283556639,1],[121.518296870355,31.1307312314605,1],[121.461633861719,31.193104504312,1],[121.124362710725,31.1434746672674,1],[121.046774797218,31.0138914963003,1],[121.389861117252,31.1526222413411,1],[121.276098120163,31.2466431379876,1],[121.342796645821,31.8350127406893,1],[121.625068683542,31.5485599932156,1],[121.727796575052,31.5265291918447,1],[121.657819846028,31.5869215875581,1],[121.415497985761,31.6276488982498,1],[121.541856316643,31.6237584337351,1],[121.857767711932,30.8623571358405,1],[121.694537851088,31.3932797943169,1],[121.112026397038,31.1674187739841,1],[121.507171258699,31.2770354649283,1],[121.478999434024,31.2795290407276,1],[121.108364330661,31.2632601299497,1],[121.144664406268,31.2481862366757,1],[121.358299622973,31.1736101714907,1],[121.49872637304,31.2528239386035,1],[121.414859925645,31.0484942188142,1],[121.252309792817,31.3877986482721,1],[121.470161620552,31.0499687945684,1],[121.523046137925,31.0814717670761,1],[121.379664073222,31.0383065448668,1],[121.476083714,31.2946064431643,1],[121.453293888263,30.9347657465508,1],[121.501723958341,30.9609738471784,1],[121.508052161336,30.9948212975715,1],[121.465387875954,30.9075689052954,1],[121.729741923905,30.944572571737,1],[121.729741923905,30.944572571737,1],[121.589198253986,30.9371950696902,1],[121.378580082573,30.7732441036199,1],[121.734339879997,31.2223810672181,1],[121.425269819573,31.0984150767787,1],[121.554661910518,31.2979357156569,1]],mapv={};(function(M,K){K(mapv)})(window,function(M){"use strict";var K="2.0.13",U=function(e){e&&e.clearRect&&e.clearRect(0,0,e.canvas.width,e.canvas.height)},at=function(e){var t=window.devicePixelRatio;e.canvas.width=e.canvas.width*t,e.canvas.height=e.canvas.height*t,e.canvas.style.width=e.canvas.width/t+"px",e.canvas.style.height=e.canvas.height/t+"px",e.scale(t,t)};function tt(){this._subscribers={}}tt.prototype.on=function(e,t){var r=this._subscribers[e];r||(r=[],this._subscribers[e]=r),r.push({callback:t})},tt.prototype.off=function(e,t){var r=this._subscribers[e];if(r)for(var n=0;n<r.length;n++)r[n].callback==t&&(r.splice(n,1),n--)},tt.prototype._trigger=function(e,t,r){if(e=="*")throw new Error("Cannot trigger event *");var n=[];e in this._subscribers&&(n=n.concat(this._subscribers[e])),"*"in this._subscribers&&(n=n.concat(this._subscribers["*"]));for(var a=0,i=n.length;a<i;a++){var o=n[a];o.callback&&o.callback(e,t,r||null)}};var j=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},et=function(){function e(t,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),nt=function e(t,r,n){t===null&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(a===void 0){var i=Object.getPrototypeOf(t);return i===null?void 0:e(i,r,n)}else{if("value"in a)return a.value;var o=a.get;return o===void 0?void 0:o.call(n)}},mt=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},wt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e};function A(e,t){this._options=t||{},this._data=[],e&&this.add(e)}A.prototype=new tt,A.prototype.add=function(e,t){if(Array.isArray(e))for(var r=0,n=e.length;r<n;r++){if(e[r].time&&e[r].time.length==14&&e[r].time.substr(0,2)=="20"){var a=e[r].time;e[r].time=new Date(a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)+" "+a.substr(8,2)+":"+a.substr(10,2)+":"+a.substr(12,2)).getTime()}this._data.push(e[r])}else if(e instanceof Object)this._data.push(e);else throw new Error("Unknown dataType")},A.prototype.get=function(e){e=e||{};var r=new Date,t=this._data,r=new Date;if(e.filter){for(var n=[],a=0;a<t.length;a++)e.filter(t[a])&&n.push(t[a]);t=n}return e.transferCoordinate&&(t=this.transferCoordinate(t,e.transferCoordinate,e.fromColumn,e.toColumn)),t},A.prototype.set=function(e){this._set(e),this._trigger("change")},A.prototype._set=function(e){this.clear(),this.add(e)},A.prototype.clear=function(e){this._data=[]},A.prototype.remove=function(e){},A.prototype.update=function(e){},A.prototype.transferCoordinate=function(e,t,r,n){n=n||"_coordinates",r=r||"coordinates";for(var a=0;a<e.length;a++){var i=e[a].geometry,o=i[r];switch(i.type){case"Point":i[n]=t(o);break;case"LineString":for(var l=[],s=0;s<o.length;s++)l.push(t(o[s]));i[n]=l;break;case"Polygon":var l=v(o);i[n]=l;break;case"MultiPolygon":for(var l=[],f=0;f<o.length;f++){var d=o[f],d=v(d);l.push(d)}i[n]=l;break}}function v(c){for(var y=[],g=0;g<c.length;g++){for(var w=c[g],x=[],p=0;p<w.length;p++)x.push(t(w[p]));y.push(x)}return y}return e},A.prototype.initGeometry=function(e){e?this._data.forEach(function(t){t.geometry=e(t)}):this._data.forEach(function(t){!t.geometry&&t.lng&&t.lat&&(t.geometry={type:"Point",coordinates:[t.lng,t.lat]})})},A.prototype.getMax=function(e){var t=this._data;if(!(!t||t.length<=0)){for(var r=parseFloat(t[0][e]),n=1;n<t.length;n++){var a=parseFloat(t[n][e]);a>r&&(r=a)}return r}},A.prototype.getSum=function(e){var t=this._data;if(!(!t||t.length<=0)){for(var r=0,n=0;n<t.length;n++)t[n][e]&&(r+=parseFloat(t[n][e]));return r}},A.prototype.getMin=function(e){var t=this._data;if(!(!t||t.length<=0)){for(var r=parseFloat(t[0][e]),n=1;n<t.length;n++){var a=parseFloat(t[n][e]);a<r&&(r=a)}return r}};var it={drawDataSet:function(t,r,n){for(var a=r instanceof A?r.get():r,i=0,o=a.length;i<o;i++){var s=a[i];this.draw(t,s,n)}},draw:function(t,r,n){var a=r.geometry.type,i=r.geometry._coordinates||r.geometry.coordinates,o=n.symbol||"circle";switch(a){case"Point":var s=r._size||r.size||n._size||n.size||5;n.symbol==="rect"?t.rect(i[0]-s/2,i[1]-s/2,s,s):(n.bigData==="Point"&&t.moveTo(i[0],i[1]),t.arc(i[0],i[1],s,0,Math.PI*2));break;case"LineString":for(var l=0;l<i.length;l++){var f=i[l][0],d=i[l][1];l==0?t.moveTo(f,d):t.lineTo(f,d)}break;case"Polygon":this.drawPolygon(t,i);break;case"MultiPolygon":for(var v=0;v<i.length;v++){var c=i[v];this.drawPolygon(t,c)}t.closePath();break;default:console.log("type"+a+"is not support now!");break}},drawPolygon:function(t,r){for(var n=0;n<r.length;n++){var a=r[n];t.moveTo(a[0][0],a[0][1]);for(var i=1;i<a.length;i++)t.lineTo(a[i][0],a[i][1]);t.lineTo(a[0][0],a[0][1])}}},_t={draw:function(t,r,n){var a=r instanceof A?r.get():r;t.save();for(var i in n)t[i]=n[i];if(n.bigData){t.save(),t.beginPath();for(var o=0,s=a.length;o<s;o++){var l=a[o];it.draw(t,l,n)}var f=n.bigData;f=="Point"||f=="Polygon"||f=="MultiPolygon"?(t.fill(),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):f=="LineString"&&t.stroke(),t.restore()}else for(var o=0,s=a.length;o<s;o++){var l=a[o];t.save(),l.fillStyle&&(t.fillStyle=l.fillStyle),l.strokeStyle&&(t.strokeStyle=l.strokeStyle);var f=l.geometry.type;t.beginPath(),it.draw(t,l,n),f=="Point"||f=="Polygon"||f=="MultiPolygon"?(t.fill(),(l.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):f=="LineString"&&t.stroke(),t.restore()}t.restore()}};function ht(e,t){var r;if(typeof document>"u"){var n=require("canvas");r=new n(e,t)}else{var r=document.createElement("canvas");e&&(r.width=e),t&&(r.height=t)}return r}function k(e){e=e||{},this.gradient=e.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=e.maxSize||35,this.minSize=e.minSize||0,this.max=e.max||100,this.min=e.min||0,this.initPalette()}k.prototype.setMax=function(e){this.max=e||100},k.prototype.setMin=function(e){this.min=e||0},k.prototype.setMaxSize=function(e){this.maxSize=e||35},k.prototype.setMinSize=function(e){this.minSize=e||0},k.prototype.initPalette=function(){var e=this.gradient,t=new ht(256,1),r=this.paletteCtx=t.getContext("2d"),n=r.createLinearGradient(0,0,256,1);for(var a in e)n.addColorStop(parseFloat(a),e[a]);r.fillStyle=n,r.fillRect(0,0,256,1)},k.prototype.getColor=function(e){var t=this.getImageData(e);return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},k.prototype.getImageData=function(e){var t=this.paletteCtx.getImageData(0,0,256,1).data;if(e===void 0)return t;var r=this.max,n=this.min;e>r&&(e=r),e<n&&(e=n);var a=Math.floor((e-n)/(r-n)*(256-1))*4;return[t[a],t[a+1],t[a+2],t[a+3]]},k.prototype.getSize=function(e){var t=0,r=this.max,n=this.min,a=this.maxSize,i=this.minSize;return e>r&&(e=r),e<n&&(e=n),t=i+(e-n)/(r-n)*(a-i),t},k.prototype.getLegend=function(e){var t=this.gradient,r=e.width||20,n=e.height||180,a=new ht(r,n),i=a.getContext("2d"),o=i.createLinearGradient(0,n,0,0);for(var s in t)o.addColorStop(parseFloat(s),t[s]);return i.fillStyle=o,i.fillRect(0,0,r,n),a};var qt=typeof window>"u"?{}:window,Et=qt.devicePixelRatio;function Gt(e){var t=e/2,r=e+t,n=1e4,a=new ht(r*2,r*2),i=a.getContext("2d");return i.shadowBlur=t,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=n,i.beginPath(),i.arc(r-n,r-n,e,0,Math.PI*2,!0),i.closePath(),i.fill(),a}function $t(e,t,r){for(var n=r.maxOpacity||.8,a=3,i=e.length,o;a<i;a+=4)o=e[a]*4,e[a]/256>n&&(e[a]=256*n),e[a-3]=t[o],e[a-2]=t[o+1],e[a-1]=t[o+2]}function Yt(e,t,r){var n=r.max||100,a=r.min||0,i=r._size;i==null&&(i=r.size,i==null&&(i=13));var o=new k({gradient:r.gradient,max:n,min:a}),s=Gt(i),l=s.width/2,f=s.height/2,d=t,v={};d.forEach(function(g,w){var x=g.count===void 0?1:g.count,p=Math.min(1,x/n).toFixed(2);v[p]=v[p]||[],v[p].push(g)});for(var c in v)if(!isNaN(c)){var y=v[c];e.beginPath(),r.withoutAlpha||(e.globalAlpha=c),e.strokeStyle=o.getColor(c*n),y.forEach(function(g,w){if(!!g.geometry){var x=g.geometry._coordinates||g.geometry.coordinates,p=g.geometry.type;if(p==="Point"){var _=g.count===void 0?1:g.count;e.globalAlpha=_/n,e.drawImage(s,x[0]-l,x[1]-f)}else if(p==="LineString"){var _=g.count===void 0?1:g.count;e.globalAlpha=_/n,e.beginPath(),it.draw(e,g,r),e.stroke()}}})}}function Vt(e,t,r){var n=r.strength||.3;e.strokeStyle="rgba(0,0,0,"+n+")";var a=new ht(e.canvas.width,e.canvas.height),i=a.getContext("2d");i.scale(Et,Et),r=r||{};var o=t instanceof A?t.get():t;e.save();var s=new k({gradient:r.gradient});if(Yt(i,o,r),!r.absolute){var l=i.getImageData(0,0,e.canvas.width,e.canvas.height);$t(l.data,s.getImageData(),r),e.putImageData(l,0,0),e.restore()}s=null,a=null}var Pt={draw:Vt},It={draw:function(t,r,n){t.save();for(var a=r instanceof A?r.get():r,i={},o={},s=n._size||n.size||50,l=n.offset||{x:0,y:0},f=0;f<a.length;f++){var d=a[f].geometry._coordinates||a[f].geometry.coordinates,v=Math.floor((d[0]-l.x)/s)+","+Math.floor((d[1]-l.y)/s);i[v]||(i[v]=0,o[v]=[]);var c=~~(a[f].count||1);i[v]+=c,o[v].push(a[f])}for(var v in i){var y=i[v];o[v].forEach(_=>{_.total=y,_.average=parseInt(y/o[v].length)})}var g=new k({max:n.max||100,gradient:n.gradient});for(var v in i){v=v.split(","),t.beginPath(),t.rect(v[0]*s+.5+l.x,v[1]*s+.5+l.y,s,s);var w=i[v];n.label.average&&(w=parseInt(i[v]/o[v].length)),t.fillStyle=g.getColor(w),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&n.label.show!==!1){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var v in i){v=v.split(",");var w=i[v];n.label.average&&(w=parseInt(w/o[v].length));var x=t.measureText(w).width;t.fillText(w,v[0]*s+.5+l.x+s/2-x/2,v[1]*s+.5+l.y+s/2+5)}}t.restore()}};function Jt(e,t,r){var n=60*r+30,a=Math.PI/180*n;return[e.x+t*Math.cos(a),e.y+t*Math.sin(a)]}var zt={draw:function(t,r,n){t.save();var a=r instanceof A?r.get():r;for(var i in n)t[i]=n[i];var o={},s=n.offset||{x:10,y:10},l=n._size||n.size||40;l=l/2/Math.sin(Math.PI/3);for(var f=l*2*Math.sin(Math.PI/3),d=l*1.5,v={},c=0;c<a.length;c++){var y=a[c].geometry._coordinates||a[c].geometry.coordinates,g=(y[1]-s.y)/d,w=Math.round(g),x=(y[0]-s.x)/f-(w&1?.5:0),p=Math.round(x),_=g-w;if(Math.abs(_)*3>1){var F=x-p,z=p+(x<p?-1:1)/2,m=w+(g<w?-1:1),C=x-z,R=g-m;F*F+_*_>C*C+R*R&&(p=z+(w&1?1:-1)/2,w=m)}var Y=p+"-"+w,q=v[Y];q?q.push(a[c]):(q=v[Y]=[a[c]],q.i=p,q.j=w,q.x=(p+(w&1?1/2:0))*f,q.y=w*d)}var N=new k({max:n.max||100,maxSize:l,gradient:n.gradient});for(var i in v){var G=v[i];t.beginPath();for(var V=0;V<6;V++){var rt=l,yt=Jt({x:G.x+s.x,y:G.y+s.y},rt,V);t.lineTo(yt[0],yt[1])}t.closePath();for(var vt=0,c=0;c<G.length;c++)vt+=G[c].count||1;G.count=vt,t.fillStyle=N.getColor(vt),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&n.label.show!==!1){t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur);for(var i in v){var G=v[i],J=G.count;J<0?J=J.toFixed(2):J=~~J;var gt=t.measureText(J).width;t.fillText(J,G.x+s.x-gt/2,G.y+s.y+5)}}t.restore()}};function Ot(e,t,r){var n=e.createShader(r);return e.shaderSource(n,t),e.compileShader(n),n}function xt(e,t,r){var n=Ot(e,t,e.VERTEX_SHADER),a=Ot(e,r,e.FRAGMENT_SHADER),i=e.createProgram();return e.attachShader(i,n),e.attachShader(i,a),e.linkProgram(i),e.useProgram(i),i}function bt(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=1,t.height=1,r.fillStyle=e,r.fillRect(0,0,1,1),r.getImageData(0,0,1,1).data}var Xt=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),Kt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function jt(e,t,r){if(!!t){var n=xt(e,Xt,Kt);e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),e.clear(e.COLOR_BUFFER_BIT);var a=e.canvas.width/2,i=e.canvas.height/2,o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o);var s=e.getAttribLocation(n,"a_Position");e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(s);var l=e.getUniformLocation(n,"u_FragColor"),f=bt(r.strokeStyle||"red");e.uniform4f(l,f[0]/255,f[1]/255,f[2]/255,f[3]/255),e.lineWidth(r.lineWidth||1);for(var d=0,v=t.length;d<v;d++){for(var c=t[d].geometry._coordinates,y=[],g=0;g<c.length;g++){var w=c[g],x=(w[0]-a)/a,p=(i-w[1])/i;y.push(x,p)}var _=new Float32Array(y);e.bufferData(e.ARRAY_BUFFER,_,e.STATIC_DRAW),e.drawArrays(e.LINE_STRIP,0,c.length)}}}var Tt={draw:jt},Qt=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),te=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function ee(e,t,r){if(!!t){var n=xt(e,Qt,te),a=e.getAttribLocation(n,"a_Position"),i=e.getAttribLocation(n,"a_PointSize"),o=e.getUniformLocation(n,"u_FragColor");e.clear(e.COLOR_BUFFER_BIT);for(var s=e.canvas.width/2,l=e.canvas.height/2,f=[],d=0,v=0;v<t.length;v++){var c=t[v].geometry._coordinates,y=(c[0]-s)/s,g=(l-c[1])/l;y<-1||y>1||g<-1||g>1||(f.push(y,g),d++)}var w=new Float32Array(f),x=d,p=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,p),e.bufferData(e.ARRAY_BUFFER,w,e.STATIC_DRAW),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a),e.vertexAttrib1f(i,r._size);var _=bt(r.fillStyle||"red");e.uniform4f(o,_[0]/255,_[1]/255,_[2]/255,_[3]/255),e.drawArrays(e.POINTS,0,x)}}var Rt={draw:ee};function ct(e,t,r){r=r||2;var n=t&&t.length,a=n?t[0]*r:e.length,i=Ft(e,0,a,r,!0),o=[];if(!i)return o;var s,l,f,d,v,c,y;if(n&&(i=oe(e,t,i,r)),e.length>80*r){s=f=e[0],l=d=e[1];for(var g=r;g<a;g+=r)v=e[g],c=e[g+1],v<s&&(s=v),c<l&&(l=c),v>f&&(f=v),c>d&&(d=c);y=Math.max(f-s,d-l)}return st(i,o,r,s,l,y),o}function Ft(e,t,r,n,a){var i,o;if(a===Lt(e,t,r,n)>0)for(i=t;i<r;i+=n)o=Ut(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=Ut(i,e[i],e[i+1],o);return o&&Q(o,o.next)&&(ut(o),o=o.next),o}function ot(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(Q(r,r.next)||Z(r.prev,r,r.next)===0)){if(ut(r),r=t=r.prev,r===r.next)return null;n=!0}else r=r.next;while(n||r!==t);return t}function st(e,t,r,n,a,i,o){if(!!e){!o&&i&&fe(e,n,a,i);for(var s=e,l,f;e.prev!==e.next;){if(l=e.prev,f=e.next,i?re(e,n,a,i):ne(e)){t.push(l.i/r),t.push(e.i/r),t.push(f.i/r),ut(e),e=f.next,s=f.next;continue}if(e=f,e===s){o?o===1?(e=ae(e,t,r),st(e,t,r,n,a,i,2)):o===2&&ie(e,t,r,n,a,i):st(ot(e),t,r,n,a,i,1);break}}}}function ne(e){var t=e.prev,r=e,n=e.next;if(Z(t,r,n)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(dt(t.x,t.y,r.x,r.y,n.x,n.y,a.x,a.y)&&Z(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function re(e,t,r,n){var a=e.prev,i=e,o=e.next;if(Z(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,l=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,f=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,d=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,v=Ct(s,l,t,r,n),c=Ct(f,d,t,r,n),y=e.nextZ;y&&y.z<=c;){if(y!==e.prev&&y!==e.next&&dt(a.x,a.y,i.x,i.y,o.x,o.y,y.x,y.y)&&Z(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(y=e.prevZ;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&dt(a.x,a.y,i.x,i.y,o.x,o.y,y.x,y.y)&&Z(y.prev,y,y.next)>=0)return!1;y=y.prevZ}return!0}function ae(e,t,r){var n=e;do{var a=n.prev,i=n.next.next;!Q(a,i)&&Bt(a,n,n.next,i)&&lt(a,i)&&lt(i,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(i.i/r),ut(n),ut(n.next),n=e=i),n=n.next}while(n!==e);return n}function ie(e,t,r,n,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ce(o,s)){var l=Dt(o,s);o=ot(o,o.next),l=ot(l,l.next),st(o,t,r,n,a,i),st(l,t,r,n,a,i);return}s=s.next}o=o.next}while(o!==e)}function oe(e,t,r,n){var a=[],i,o,s,l,f;for(i=0,o=t.length;i<o;i++)s=t[i]*n,l=i<o-1?t[i+1]*n:e.length,f=Ft(e,s,l,n,!1),f===f.next&&(f.steiner=!0),a.push(he(f));for(a.sort(se),i=0;i<a.length;i++)le(a[i],r),r=ot(r,r.next);return r}function se(e,t){return e.x-t.x}function le(e,t){if(t=ue(e,t),t){var r=Dt(t,e);ot(r,r.next)}}function ue(e,t){var r=t,n=e.x,a=e.y,i=-1/0,o;do{if(a<=r.y&&a>=r.next.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>i){if(i=s,s===n){if(a===r.y)return r;if(a===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(n===i)return o.prev;var l=o,f=o.x,d=o.y,v=1/0,c;for(r=o.next;r!==l;)n>=r.x&&r.x>=f&&dt(a<d?n:i,a,f,d,a<d?i:n,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(n-r.x),(c<v||c===v&&r.x>o.x)&&lt(r,e)&&(o=r,v=c)),r=r.next;return o}function fe(e,t,r,n){var a=e;do a.z===null&&(a.z=Ct(a.x,a.y,t,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,ve(a)}function ve(e){var t,r,n,a,i,o,s,l,f=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,n=r,s=0,t=0;t<f&&(s++,n=n.nextZ,!!n);t++);for(l=f;s>0||l>0&&n;)s===0?(a=n,n=n.nextZ,l--):l===0||!n||r.z<=n.z?(a=r,r=r.nextZ,s--):(a=n,n=n.nextZ,l--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;r=n}i.nextZ=null,f*=2}while(o>1);return e}function Ct(e,t,r,n,a){return e=32767*(e-r)/a,t=32767*(t-n)/a,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function he(e){var t=e,r=e;do t.x<r.x&&(r=t),t=t.next;while(t!==e);return r}function dt(e,t,r,n,a,i,o,s){return(a-o)*(t-s)-(e-o)*(i-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(i-s)-(a-o)*(n-s)>=0}function ce(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!de(e,t)&&lt(e,t)&&lt(t,e)&&pe(e,t)}function Z(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Q(e,t){return e.x===t.x&&e.y===t.y}function Bt(e,t,r,n){return Q(e,t)&&Q(r,n)||Q(e,n)&&Q(r,t)?!0:Z(e,t,r)>0!=Z(e,t,n)>0&&Z(r,n,e)>0!=Z(r,n,t)>0}function de(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Bt(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function lt(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function pe(e,t){var r=e,n=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do r.y>i!=r.next.y>i&&a<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function Dt(e,t){var r=new Mt(e.i,e.x,e.y),n=new Mt(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Ut(e,t,r,n){var a=new Mt(e,t,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function ut(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Mt(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ct.deviation=function(e,t,r,n){var a=t&&t.length,i=a?t[0]*r:e.length,o=Math.abs(Lt(e,0,i,r));if(a)for(var s=0,l=t.length;s<l;s++){var f=t[s]*r,d=s<l-1?t[s+1]*r:e.length;o-=Math.abs(Lt(e,f,d,r))}var v=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,y=n[s+1]*r,g=n[s+2]*r;v+=Math.abs((e[c]-e[g])*(e[y+1]-e[c+1])-(e[c]-e[y])*(e[g+1]-e[c+1]))}return o===0&&v===0?0:Math.abs((v-o)/o)};function Lt(e,t,r,n){for(var a=0,i=t,o=r-n;i<r;i+=n)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}ct.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,a=0;a<e.length;a++){for(var i=0;i<e[a].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[a][i][o]);a>0&&(n+=e[a-1].length,r.holes.push(n))}return r};var ye=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),ge=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");function me(e,t,r){if(!!t){e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,e.canvas.width,e.canvas.height);var n=xt(e,ye,ge);e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE);var a=e.canvas.width/2,i=e.canvas.height/2;e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,e.createBuffer());var o=e.getAttribLocation(n,"a_Position");e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(o);var s=e.getUniformLocation(n,"u_FragColor"),l=bt(r.fillStyle||"red");e.uniform4f(s,l[0]/255,l[1]/255,l[2]/255,l[3]/255),e.lineWidth(r.lineWidth||1);for(var f=[],d=[],v=65536,c=0,y=0,g=t.length;y<g;y++){var w=ct.flatten(t[y].geometry._coordinates||t[y].geometry.coordinates),x=w.vertices;c=f.length/2;for(var p=0;p<x.length;p+=2)x[p]=(x[p]-a)/a,x[p+1]=(i-x[p+1])/i;(f.length+x.length)/2>v&&(e.bufferData(e.ARRAY_BUFFER,new Float32Array(f),e.STATIC_DRAW),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),e.STATIC_DRAW),e.drawElements(e.TRIANGLES,d.length,e.UNSIGNED_SHORT,0),f.length=0,d.length=0,c=0);for(var p=0;p<x.length;p++)f.push(x[p]);for(var _=ct(x,w.holes,w.dimensions),p=0;p<_.length;p++)d.push(_[p]+c)}e.bufferData(e.ARRAY_BUFFER,new Float32Array(f),e.STATIC_DRAW),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),e.STATIC_DRAW),e.drawElements(e.TRIANGLES,d.length,e.UNSIGNED_SHORT,0),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}var kt={draw:me},Zt={draw:function(t,r,n){var a=r instanceof A?r.get():r;a.length>0&&(a[0].geometry.type=="LineString"?Tt.draw(t,a,n):a[0].geometry.type=="Polygon"||a[0].geometry.type=="MultiPolygon"?kt.draw(t,a,n):Rt.draw(t,a,n))}};function St(e){var t=e.split("|");return t[0]=t[0].split(","),{lng:parseFloat(t[0][0]),lat:parseFloat(t[0][1])}}var we={getCenterByCityName:function(t){for(var r=0;r<citycenter.municipalities.length;r++)if(citycenter.municipalities[r].n==t)return St(citycenter.municipalities[r].g);for(var n=citycenter.provinces,r=0;r<n.length;r++){if(n[r].n==t)return St(n[r].g);for(var a=n[r].cities,i=0;i<a.length;i++)if(a[i].n==t)return St(a[i].g)}return null}};function _e(e){for(var t=[],r=0;r<e.length-1;r++){var n=xe(e[r],e[r+1]);n&&n.length>0&&(t=t.concat(n))}return t}function xe(e,t){if(!e||!t)return null;var r=function(R){return 1-2*R+R*R},n=function(R){return 2*R-2*R*R},a=function(R){return R*R},i=[],o=40,s=!1,l,f,d,v,c,y,g,w=[],x=0,p=0;if(typeof t>"u"){typeof i<"u"&&(i=[]);return}var _=parseFloat(e.lat),F=parseFloat(t.lat),z=parseFloat(e.lng),m=parseFloat(t.lng);for(m>z&&parseFloat(m-z)>180&&z<0&&(z=parseFloat(180+180+z)),z>m&&parseFloat(z-m)>180&&m<0&&(m=parseFloat(180+180+m)),y=0,g=0,F==_?(l=0,f=z-m):m==z?(l=Math.PI/2,f=_-F):(l=Math.atan((F-_)/(m-z)),f=(F-_)/Math.sin(l)),g==0&&(g=l+Math.PI/5),d=f/2,c=d*Math.cos(g)+z,v=d*Math.sin(g)+_,x=0;x<o+1;x++)i.push([z*r(p)+c*n(p)+m*a(p),_*r(p)+v*n(p)+F*a(p)]),p=p+1/o;return i}var be={getPoints:_e},Ce=function(){var t={},r=[],n=[],a=[],i=.1,o=.1,s=1,l=2,f=6,d=70,v=.6666667,c=.6,y=!1,g=1e-8;function w(u,h){return u.x*h.x+u.y*h.y}function x(u){return{x:t[u.target].x-t[u.source].x,y:t[u.target].y-t[u.source].y}}function p(u){return Math.sqrt(Math.pow(t[u.source].x-t[u.target].x,2)+Math.pow(t[u.source].y-t[u.target].y,2))}function _(u){return Math.sqrt(Math.pow(u.source.x-u.target.x,2)+Math.pow(u.source.y-u.target.y,2))}function F(u){var h=(t[u.source].x+t[u.target].x)/2,b=(t[u.source].y+t[u.target].y)/2;return{x:h,y:b}}function z(u){for(var h=0,b=1;b<a[u].length;b++){var L=m(a[u][b],a[u][b-1]);h+=L}return h}function m(u,h){return Math.sqrt(Math.pow(u.x-h.x,2)+Math.pow(u.y-h.y,2))}function C(u,h){var b=Math.sqrt((h.target.x-h.source.x)*(h.target.x-h.source.x)+(h.target.y-h.source.y)*(h.target.y-h.source.y)),L=((h.source.y-u.y)*(h.source.y-h.target.y)-(h.source.x-u.x)*(h.target.x-h.source.x))/(b*b);return{x:h.source.x+L*(h.target.x-h.source.x),y:h.source.y+L*(h.target.y-h.source.y)}}function R(){for(var u=0;u<r.length;u++)s==1?a[u]=[]:(a[u]=[],a[u].push(t[r[u].source]),a[u].push(t[r[u].target]))}function Y(){for(var u=0;u<r.length;u++)n[u]=[]}function q(u){for(var h=[],b=0;b<u.length;b++)t[u[b].source].x!=t[u[b].target].x&&t[u[b].source].y!=t[u[b].target].y&&h.push(u[b]);return h}function N(u,h,b){var L=a[u][h-1],O=a[u][h+1],E=a[u][h],S=L.x-E.x+O.x-E.x,D=L.y-E.y+O.y-E.y;return S*=b,D*=b,{x:S,y:D}}function G(u,h,b){for(var L={x:0,y:0},O=n[u],E=0;E<O.length;E++){var S={x:a[O[E]][h].x-a[u][h].x,y:a[O[E]][h].y-a[u][h].y};if(Math.abs(S.x)>g||Math.abs(S.y)>g){var D=1/Math.pow(_({source:a[O[E]][h],target:a[u][h]}),1);L.x+=S.x*D,L.y+=S.y*D}}return L}function V(u,h,b){for(var L=i/(p(r[u])*(h+1)),O=[{x:0,y:0}],E=1;E<h+1;E++){var S={x:0,y:0},D=N(u,E,L),$=G(u,E,b);S.x=b*(D.x+$.x),S.y=b*(D.y+$.y),O.push(S)}return O.push({x:0,y:0}),O}function rt(u){for(var h=0;h<r.length;h++)if(u==1)a[h].push(t[r[h].source]),a[h].push(F(r[h])),a[h].push(t[r[h].target]);else{var b=z(h),L=b/(u+1),O=L,E=[];E.push(t[r[h].source]);for(var S=1;S<a[h].length;S++){for(var D=m(a[h][S],a[h][S-1]);D>O;){var $=O/D,X=a[h][S-1].x,Wt=a[h][S-1].y;X+=$*(a[h][S].x-a[h][S-1].x),Wt+=$*(a[h][S].y-a[h][S-1].y),E.push({x:X,y:Wt}),D-=O,O=L}O-=D}E.push(t[r[h].target]),a[h]=E}}function yt(u,h){var b=Math.abs(w(x(u),x(h))/(p(u)*p(h)));return b}function vt(u,h){var b=(p(u)+p(h))/2,L=2/(b/Math.min(p(u),p(h))+Math.max(p(u),p(h))/b);return L}function J(u,h){var b=(p(u)+p(h))/2,L={x:(t[u.source].x+t[u.target].x)/2,y:(t[u.source].y+t[u.target].y)/2},O={x:(t[h.source].x+t[h.target].x)/2,y:(t[h.source].y+t[h.target].y)/2},E=b/(b+m(L,O));return E}function gt(u,h){var b=C(t[h.source],{source:t[u.source],target:t[u.target]}),L=C(t[h.target],{source:t[u.source],target:t[u.target]}),O={x:(b.x+L.x)/2,y:(b.y+L.y)/2},E={x:(t[u.source].x+t[u.target].x)/2,y:(t[u.source].y+t[u.target].y)/2},S=Math.max(0,1-2*m(E,O)/m(b,L));return S}function Re(u,h){return Math.min(gt(u,h),gt(h,u))}function Fe(u,h){var b=yt(u,h)*vt(u,h)*J(u,h)*Re(u,h);return b}function Be(u,h){return Fe(u,h)>=c}function De(){for(var u=0;u<r.length-1;u++)for(var h=u+1;h<r.length;h++)u!=h&&Be(r[u],r[h])&&(n[u].push(h),n[h].push(u))}var B=function(){var h=o,b=d,L=s;R(),Y(),rt(L),De();for(var O=0;O<f;O++){for(var E=0;E<b;E++){for(var S=[],D=0;D<r.length;D++)S[D]=V(D,L,h);for(var $=0;$<r.length;$++)for(var X=0;X<L+1;X++)a[$][X].x+=S[$][X].x,a[$][X].y+=S[$][X].y}h=h/2,L=L*2,b=v*b,rt(L)}return a};return B.nodes=function(u){return arguments.length==0?t:(t=u,B)},B.edges=function(u){return arguments.length==0?r:(r=q(u),B)},B.bundling_stiffness=function(u){return arguments.length==0?i:(i=u,B)},B.step_size=function(u){return arguments.length==0?o:(o=u,B)},B.cycles=function(u){return arguments.length==0?f:(f=u,B)},B.iterations=function(u){return arguments.length==0?d:(d=u,B)},B.iterations_rate=function(u){return arguments.length==0?v:(v=u,B)},B.subdivision_points_seed=function(u){return arguments.length==0?P:(P=u,B)},B.subdivision_rate=function(u){return arguments.length==0?l:(l=u,B)},B.compatbility_threshold=function(u){return arguments.length==0?compatbility_threshold:(c=u,B)},B};function pt(e){this.splitList=e||{other:1}}pt.prototype.get=function(e){var t=this.splitList,r=t.other;for(var n in t)if(e==n){r=t[n];break}return r},pt.prototype.generateByDataSet=function(e){var t=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],r=e.get();this.splitList={};for(var n=0,a=0;a<r.length&&(this.splitList[r[a].count]===void 0&&(this.splitList[r[a].count]=t[n],n++),!(n>=t.length-1));a++);this.splitList.other=t[t.length-1]};function ft(e){this.splitList=e||[{start:0,value:"red"}]}ft.prototype.get=function(e){for(var t=this.splitList,r=!1,n=0;n<t.length;n++)if((t[n].start===void 0||t[n].start!==void 0&&e>=t[n].start)&&(t[n].end===void 0||t[n].end!==void 0&&e<t[n].end)){r=t[n].value;break}return r},ft.prototype.generateByDataSet=function(e){var t=e.getMin("count"),r=e.getMax("count");this.generateByMinMax(t,r)},ft.prototype.generateByMinMax=function(e,t){var r=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],n=(t-e)/7,a=e;this.splitList=[];for(var i=0;a<t;)this.splitList.push({start:a,end:a+n,value:r[i]}),i++,a+=n};var Me=function(){function e(t,r,n){if(j(this,e),!t||!r)return console.warn("id 和 type 为必填项"),!1;if(r=="baidu"){if(!BMap)return console.warn("请先引入百度地图JS API"),!1}else console.warn("暂不支持你的地图类型");this.type=r;var a=n&&n.center?n.center:[106.962497,38.208726],i=n&&n.zoom?n.zoom:5,o=this.map=new BMap.Map(t,{enableMapClick:!1});o.centerAndZoom(new BMap.Point(a[0],a[1]),i),o.enableScrollWheelZoom(!0),o.setMapStyle({style:"light"})}return et(e,[{key:"addLayer",value:function(r,n){if(this.type=="baidu")return new mapv.baiduMapLayer(this.map,dataSet,n)}},{key:"getMap",value:function(){return this.map}}]),e}();function W(e){this.options=e||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=e.map,this._lastDrawTime=null,this.show()}var Ht=typeof window>"u"?{}:window;Ht.BMap&&(W.prototype=new BMap.Overlay,W.prototype.initialize=function(e){this._map=e;var t=this.canvas=document.createElement("canvas");t.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",t.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),e.getPanes()[this.paneName].appendChild(t);var r=this;return e.addEventListener("resize",function(){r.adjustSize(),r._draw()}),this.canvas},W.prototype.adjustSize=function(){var e=this._map.getSize(),t=this.canvas,r=this.devicePixelRatio=Ht.devicePixelRatio;t.width=e.width*r,t.height=e.height*r,this.context=="2d"&&t.getContext(this.context).scale(r,r),t.style.width=e.width+"px",t.style.height=e.height+"px"},W.prototype.draw=function(){var e=this;clearTimeout(e.timeoutID),e.timeoutID=setTimeout(function(){e._draw()},15)},W.prototype._draw=function(){var e=this._map,t=e.getSize(),r=e.getCenter();if(r){var n=e.pointToOverlayPixel(r);this.canvas.style.left=n.x-t.width/2+"px",this.canvas.style.top=n.y-t.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},W.prototype.getContainer=function(){return this.canvas},W.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},W.prototype.hide=function(){this.canvas.style.display="none"},W.prototype.setZIndex=function(e){this.canvas.style.zIndex=e},W.prototype.getZIndex=function(){return this.zIndex});var T=T||function(){var e=[];return{getAll:function(){return e},removeAll:function(){e=[]},add:function(r){e.push(r)},remove:function(r){var n=e.indexOf(r);n!==-1&&e.splice(n,1)},update:function(r,n){if(e.length===0)return!1;var a=0;for(r=r!==void 0?r:T.now();a<e.length;)e[a].update(r)||n?a++:e.splice(a,1);return!0}}}();typeof window>"u"&&typeof process<"u"?T.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6}:typeof window<"u"&&window.performance!==void 0&&window.performance.now!==void 0?T.now=window.performance.now.bind(window.performance):Date.now!==void 0?T.now=Date.now:T.now=function(){return new Date().getTime()},T.Tween=function(e){var t=e,r={},n={},a={},i=1e3,o=0,s,l=!1,f=!1,d=!1,v=0,c=null,y=T.Easing.Linear.None,g=T.Interpolation.Linear,w=[],x=null,p=!1,_=null,F=null,z=null;this.to=function(m,C){return n=m,C!==void 0&&(i=C),this},this.start=function(m){T.add(this),f=!0,p=!1,c=m!==void 0?m:T.now(),c+=v;for(var C in n){if(n[C]instanceof Array){if(n[C].length===0)continue;n[C]=[t[C]].concat(n[C])}t[C]!==void 0&&(r[C]=t[C],r[C]instanceof Array||(r[C]*=1),a[C]=r[C]||0)}return this},this.stop=function(){return f?(T.remove(this),f=!1,z!==null&&z.call(t,t),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+i),this},this.stopChainedTweens=function(){for(var m=0,C=w.length;m<C;m++)w[m].stop()},this.delay=function(m){return v=m,this},this.repeat=function(m){return o=m,this},this.repeatDelay=function(m){return s=m,this},this.yoyo=function(m){return l=m,this},this.easing=function(m){return y=m,this},this.interpolation=function(m){return g=m,this},this.chain=function(){return w=arguments,this},this.onStart=function(m){return x=m,this},this.onUpdate=function(m){return _=m,this},this.onComplete=function(m){return F=m,this},this.onStop=function(m){return z=m,this},this.update=function(m){var C,R,Y;if(m<c)return!0;p===!1&&(x!==null&&x.call(t,t),p=!0),R=(m-c)/i,R=R>1?1:R,Y=y(R);for(C in n)if(r[C]!==void 0){var q=r[C]||0,N=n[C];N instanceof Array?t[C]=g(N,Y):(typeof N=="string"&&(N.charAt(0)==="+"||N.charAt(0)==="-"?N=q+parseFloat(N):N=parseFloat(N)),typeof N=="number"&&(t[C]=q+(N-q)*Y))}if(_!==null&&_.call(t,Y),R===1)if(o>0){isFinite(o)&&o--;for(C in a){if(typeof n[C]=="string"&&(a[C]=a[C]+parseFloat(n[C])),l){var G=a[C];a[C]=n[C],n[C]=G}r[C]=a[C]}return l&&(d=!d),s!==void 0?c=m+s:c=m+v,!0}else{F!==null&&F.call(t,t);for(var V=0,rt=w.length;V<rt;V++)w[V].start(c+i);return!1}return!0}},T.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return .5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){return t===0?0:t===1?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return t===0?0:t===1?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI)},Out:function(t){return t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t-.1)*5*Math.PI)+1},InOut:function(t){return t===0?0:t===1?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*5*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*5*Math.PI)+1)}},Back:{In:function(t){var r=1.70158;return t*t*((r+1)*t-r)},Out:function(t){var r=1.70158;return--t*t*((r+1)*t+r)+1},InOut:function(t){var r=2.5949095;return(t*=2)<1?.5*(t*t*((r+1)*t-r)):.5*((t-=2)*t*((r+1)*t+r)+2)}},Bounce:{In:function(t){return 1-T.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?T.Easing.Bounce.In(t*2)*.5:T.Easing.Bounce.Out(t*2-1)*.5+.5}}},T.Interpolation={Linear:function(t,r){var n=t.length-1,a=n*r,i=Math.floor(a),o=T.Interpolation.Utils.Linear;return r<0?o(t[0],t[1],a):r>1?o(t[n],t[n-1],n-a):o(t[i],t[i+1>n?n:i+1],a-i)},Bezier:function(t,r){for(var n=0,a=t.length-1,i=Math.pow,o=T.Interpolation.Utils.Bernstein,s=0;s<=a;s++)n+=i(1-r,a-s)*i(r,s)*t[s]*o(a,s);return n},CatmullRom:function(t,r){var n=t.length-1,a=n*r,i=Math.floor(a),o=T.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(r<0&&(i=Math.floor(a=n*(1+r))),o(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],a-i)):r<0?t[0]-(o(t[0],t[0],t[1],t[1],-a)-t[0]):r>1?t[n]-(o(t[n],t[n],t[n-1],t[n-1],a-n)-t[n]):o(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],a-i)},Utils:{Linear:function(t,r,n){return(r-t)*n+t},Bernstein:function(t,r){var n=T.Interpolation.Utils.Factorial;return n(t)/n(r)/n(t-r)},Factorial:function(){var e=[1];return function(t){var r=1;if(e[t])return e[t];for(var n=t;n>1;n--)r*=n;return e[t]=r,r}}(),CatmullRom:function(t,r,n,a,i){var o=(n-t)*.5,s=(a-r)*.5,l=i*i,f=i*l;return(2*r-2*n+o+s)*f+(-3*r+3*n-2*o-s)*l+o*i+r}}};var Le={draw:function(t,r,n){var a=r instanceof A?r.get():r;t.save();for(var i in n)t[i]=n[i];var o=n.offset||{x:0,y:0},s=[],l=n._size||n.size;l?t.font="bold "+l+"px Arial":l=12;var f=n.textKey||"text";if(t.textAlign="center",t.textBaseline="middle",n.avoid)for(var d=0,v=a.length;d<v;d++){var c=a[d].geometry._coordinates||a[d].geometry.coordinates,y=c[0]+o.x,g=c[1]+o.y,w=a[d][f],x=t.measureText(w).width,p=y-x/2,_=g-l/2,F={sw:{x:p,y:_+l},ne:{x:p+x,y:_}};Se(s,F)||(s.push(F),p=p+x/2,_=_+l/2,t.fillText(w,p,_))}else for(var d=0,v=a.length;d<v;d++){var c=a[d].geometry._coordinates||a[d].geometry.coordinates,y=c[0]+o.x,g=c[1]+o.y,w=a[d][f];t.fillText(w,y,g)}t.restore()}};function Se(e,t){for(var r=0;r<e.length;r++)if(Ae(e[r],t))return!0;return!1}function Ae(e,t){var r=Math.min(e.ne.x,t.ne.x),n=Math.min(e.sw.y,t.sw.y),a=Math.max(e.sw.x,t.sw.x),i=Math.max(e.ne.y,t.ne.y);return r>a&&n>i}var Ee={draw:function(t,r,n){var a=r instanceof A?r.get():r;t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var i=n.offset||{x:0,y:0},o=0,s=a.length;o<s;o++)if(a[o].geometry){var l=a[o].deg||n.deg,f=a[o].icon||n.icon,d=a[o].geometry._coordinates||a[o].geometry.coordinates,v=d[0],c=d[1];l&&(t.save(),t.translate(v,c),t.rotate(l*Math.PI/180),t.translate(-v,-c));var y=n._width||n.width||f.width,g=n._height||n.height||f.height;v=v-y/2+i.x,c=c-g/2+i.y,n.sx&&n.sy&&n.swidth&&n.sheight&&n.width&&n.height?t.drawImage(f,n.sx,n.sy,n.swidth,n.sheight,v,c,y,g):n.width&&n.height?t.drawImage(f,v,c,y,g):t.drawImage(f,v,c),l&&t.restore()}}};typeof window<"u"&&requestAnimationFrame(Nt);function Nt(e){requestAnimationFrame(Nt),T.update(e)}var At=function(){function e(t,r,n){j(this,e),r instanceof A||(r=new A(r)),this.dataSet=r,this.map=t}return et(e,[{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(r){var n=this;if(n.intensity=new k({maxSize:n.options.maxSize,minSize:n.options.minSize,gradient:n.options.gradient,max:n.options.max||this.dataSet.getMax("count")}),n.category=new pt(n.options.splitList),n.choropleth=new ft(n.options.splitList),n.options.splitList===void 0&&n.category.generateByDataSet(this.dataSet),n.options.splitList===void 0){var a=n.options.min||this.dataSet.getMin("count"),i=n.options.max||this.dataSet.getMax("count");n.choropleth.generateByMinMax(a,i)}}},{key:"getLegend",value:function(r){var n=this.options.draw,a=null;if(self.options.draw=="intensity"||self.options.draw=="heatmap")return this.intensity.getLegend(r)}},{key:"processData",value:function(r){var n=this,a=n.options.draw;if(a=="bubble"||a=="intensity"||a=="category"||a=="choropleth"||a=="simple")for(var i=0;i<r.length;i++){var o=r[i];n.options.draw=="bubble"?r[i]._size=n.intensity.getSize(o.count):r[i]._size=void 0;var s="fillStyle";(r[i].geometry.type==="LineString"||n.options.styleType==="stroke")&&(s="strokeStyle"),n.options.draw=="intensity"?r[i][s]=n.intensity.getColor(o.count):n.options.draw=="category"?r[i][s]=n.category.get(o.count):n.options.draw=="choropleth"&&(r[i][s]=n.choropleth.get(o.count))}}},{key:"isEnabledTime",value:function(){var r=this.options.animation,n=r&&r.enabled!==!1;return n}},{key:"argCheck",value:function(r){r.draw=="heatmap"&&r.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(r,n,a,i){var o=this;switch(o.options.draw){case"heatmap":Pt.draw(r,n,o.options);break;case"grid":case"honeycomb":o.options.offset={x:i.x,y:i.y},o.options.draw=="grid"?It.draw(r,n,o.options):zt.draw(r,n,o.options);break;case"text":Le.draw(r,n,o.options);break;case"icon":Ee.draw(r,n,o.options);break;case"clip":r.save(),r.fillStyle=o.options.fillStyle||"rgba(0, 0, 0, 0.5)",r.fillRect(0,0,r.canvas.width,r.canvas.height),_t.draw(r,n,o.options),r.beginPath(),it.drawDataSet(r,n,o.options),r.clip(),U(r),r.restore();break;default:o.options.context=="webgl"?Zt.draw(o.canvasLayer.canvas.getContext("webgl"),n,o.options):_t.draw(r,n,o.options)}}},{key:"isPointInPath",value:function(a,n){for(var a=this.canvasLayer.canvas.getContext(this.context),i=this.dataSet.get(),o=0;o<i.length;o++)if(a.beginPath(),it.draw(a,i[o],this.options),a.isPointInPath(n.x*this.canvasLayer.devicePixelRatio,n.y*this.canvasLayer.devicePixelRatio))return i[o]}},{key:"clickEvent",value:function(r,n){var a=this.isPointInPath(this.getContext(),r);a?this.options.methods.click(a,n):this.options.methods.click(null,n)}},{key:"mousemoveEvent",value:function(r,n){var a=this.isPointInPath(this.getContext(),r);a?this.options.methods.mousemove(a,n):this.options.methods.mousemove(null,n)}},{key:"update",value:function(r,n){var a=this,i=r.options,o=a.options;for(var s in i)o[s]=i[s];a.init(o),n!==!1&&a.draw()}},{key:"setOptions",value:function(r){var n=this;n.init(r),n.draw()}},{key:"set",value:function(r){var n=this,a=this.getContext(),i=this.getDefaultContextConfig();for(var o in i)a[o]=i[o];n.init(r.options),n.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var r=this,n=r.options.animation;if(r.options.draw=="time"||r.isEnabledTime()){n.stepsRange||(n.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:n.stepsRange.start},r.animator=new T.Tween(this.steps).onUpdate(function(){r._canvasUpdate(this.step)}).repeat(1/0),this.addAnimatorEvent();var a=n.duration*1e3||5e3;r.animator.to({step:n.stepsRange.end},a),r.animator.start()}else r.animator&&r.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var r=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=r.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),e}(),Pe=function(e){mt(t,e);function t(r,n,a){j(this,t);var i=wt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n,a));i.map=r,i.options=a||{},i.dataSet=n,i.init(a);var o=new W({map:r,update:i._canvasUpdate.bind(i)});i.transferToMercator();var s=i;return n.on("change",function(){s.transferToMercator(),o.draw()}),i.ctx=o.canvas.getContext("2d"),i.start(),i}return et(t,[{key:"init",value:function(n){var a=this;a.options=n,this.initDataRange(n),this.context=a.options.context||"2d",a.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(a.options.zIndex),a.options.max&&this.intensity.setMax(a.options.max),a.options.min&&this.intensity.setMin(a.options.min),this.initAnimator()}},{key:"transferToMercator",value:function(){var n=this.map.getMapType().getProjection();if(this.options.coordType!=="bd09mc"){var a=this.dataSet.get();a=this.dataSet.transferCoordinate(a,function(i){var o=n.lngLatToPoint({lng:i[0],lat:i[1]});return[o.x,o.y]},"coordinates","coordinates_mercator"),this.dataSet._set(a)}}},{key:"_canvasUpdate",value:function(){var n=this.ctx;if(!!n){var a=this.map,i=Math.pow(2,18-a.getZoom()),o=a.getMapType().getProjection(),s=o.lngLatToPoint(a.getCenter()),l=new BMap.Pixel(s.x-a.getSize().width/2*i,s.y+a.getSize().height/2*i);U(n);var f={fromColumn:this.options.coordType=="bd09mc"?"coordinates":"coordinates_mercator",transferCoordinate:function(v){if(!!v){var c=(v[0]-l.x)/i,y=(l.y-v[1])/i;return[c,y]}}};this.data=this.dataSet.get(f),this.processData(this.data),this.drawAnimation()}}},{key:"drawAnimation",value:function(){var n=this.ctx,a=this.data;if(!!a){n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore(),n.save(),this.options.shadowColor&&(n.shadowColor=this.options.shadowColor),this.options.shadowBlur&&(n.shadowBlur=this.options.shadowBlur),this.options.globalAlpha&&(n.globalAlpha=this.options.globalAlpha),this.options.globalCompositeOperation&&(n.globalCompositeOperation=this.options.globalCompositeOperation);for(var i=this.options,o=0;o<a.length;o++)if(a[o].geometry.type==="Point"){n.beginPath();var s=a[o].size||this.options.size,l=a[o].minSize||this.options.minSize||0;a[o]._size===void 0&&(a[o]._size=l),n.arc(a[o].geometry._coordinates[0],a[o].geometry._coordinates[1],a[o]._size,0,Math.PI*2,!0),n.closePath(),a[o]._size++,a[o]._size>s&&(a[o]._size=l),n.lineWidth=1,n.strokeStyle=a[o].strokeStyle||i.strokeStyle||"yellow",n.stroke();var f=a[o].fillStyle||i.fillStyle;f&&(n.fillStyle=f,n.fill())}else if(a[o].geometry.type==="LineString"){n.beginPath();var d=a[o].size||this.options.size||5,l=a[o].minSize||this.options.minSize||0;a[o]._index===void 0&&(a[o]._index=0);var v=a[o]._index;n.arc(a[o].geometry._coordinates[v][0],a[o].geometry._coordinates[v][1],d,0,Math.PI*2,!0),n.closePath(),a[o]._index++,a[o]._index>=a[o].geometry._coordinates.length&&(a[o]._index=0),n.lineWidth=i.lineWidth||1;var c=a[o].strokeStyle||i.strokeStyle,f=a[o].fillStyle||i.fillStyle||"yellow";n.fillStyle=f,n.fill(),c&&(n.strokeStyle=c,n.stroke())}n.restore()}}},{key:"animate",value:function(){this.drawAnimation();var n=this.options.animateTime||100;this.timeout=setTimeout(this.animate.bind(this),n)}},{key:"start",value:function(){this.stop(),this.animate()}},{key:"stop",value:function(){clearTimeout(this.timeout)}}]),t}(At),Ie=function(e){mt(t,e);function t(r,n,a){j(this,t);var i=wt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n,a)),o=i,s=null;a=a||{},o.init(a),o.argCheck(a),o.transferToMercator();var l=i.canvasLayer=new W({map:r,context:i.context,paneName:a.paneName,mixBlendMode:a.mixBlendMode,enableMassClear:a.enableMassClear,zIndex:a.zIndex,update:function(){o._canvasUpdate()}});return n.on("change",function(){o.transferToMercator(),l.draw()}),i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.bindEvent(),i}return et(t,[{key:"clickEvent",value:function(n){var a=n.pixel;nt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clickEvent",this).call(this,a,n)}},{key:"mousemoveEvent",value:function(n){var a=n.pixel;nt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"mousemoveEvent",this).call(this,a,n)}},{key:"bindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&(a.setDefaultCursor("default"),a.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&a.addEventListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&a.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&a.removeEventListener("mousemove",this.mousemoveEvent))}},{key:"transferToMercator",value:function(){var n=this.map.getMapType().getProjection();if(this.options.coordType!=="bd09mc"){var a=this.dataSet.get();a=this.dataSet.transferCoordinate(a,function(i){var o=n.lngLatToPoint({lng:i[0],lat:i[1]});return[o.x,o.y]},"coordinates","coordinates_mercator"),this.dataSet._set(a)}}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(!!this.canvasLayer){var a=this,i=a.options.animation,o=this.canvasLayer._map,s=Math.pow(2,18-o.getZoom()),l=o.getMapType().getProjection(),f=l.lngLatToPoint(o.getCenter()),d=new BMap.Pixel(f.x-o.getSize().width/2*s,f.y+o.getSize().height/2*s),v=this.getContext();if(a.isEnabledTime()){if(n===void 0){U(v);return}this.context=="2d"&&(v.save(),v.globalCompositeOperation="destination-out",v.fillStyle="rgba(0, 0, 0, .1)",v.fillRect(0,0,v.canvas.width,v.canvas.height),v.restore())}else U(v);if(this.context=="2d")for(var c in a.options)v[c]=a.options[c];else v.clear(v.COLOR_BUFFER_BIT);if(!(a.options.minZoom&&o.getZoom()<a.options.minZoom||a.options.maxZoom&&o.getZoom()>a.options.maxZoom)){var y=1;this.context!="2d"&&(y=this.canvasLayer.devicePixelRatio);var g={fromColumn:a.options.coordType=="bd09mc"?"coordinates":"coordinates_mercator",transferCoordinate:function(_){var F=(_[0]-d.x)/s*y,z=(d.y-_[1])/s*y;return[F,z]}};n!==void 0&&(g.filter=function(p){var _=i.trails||10;return!!(n&&p.time>n-_&&p.time<n)});var w=a.dataSet.get(g);this.processData(w);var x=o.pointToPixel(new BMap.Point(0,0));a.options.unit=="m"?(a.options.size&&(a.options._size=a.options.size/s),a.options.width&&(a.options._width=a.options.width/s),a.options.height&&(a.options._height=a.options.height/s)):(a.options._size=a.options.size,a.options._height=a.options.height,a.options._width=a.options.width),this.drawContext(v,w,a.options,x),a.options.updateCallback&&a.options.updateCallback(n)}}}},{key:"init",value:function(n){var a=this;a.options=n,this.initDataRange(n),this.context=a.options.context||"2d",a.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(a.options.zIndex),a.options.max&&this.intensity.setMax(a.options.max),a.options.min&&this.intensity.setMin(a.options.min),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),t}(At);function I(e){this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=I.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var t=document.createElement("canvas");t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.pointerEvents="none",this.canvas=t,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1;function r(n,a){return function(){a.apply(n)}}this.repositionFunction_=r(this,this.repositionCanvas_),this.resizeFunction_=r(this,this.resize_),this.requestUpdateFunction_=r(this,this.update_),e&&this.setOptions(e)}var H=typeof window>"u"?{}:window;H.google&&H.google.maps&&(I.prototype=new google.maps.OverlayView,I.DEFAULT_PANE_NAME_="overlayLayer",I.CSS_TRANSFORM_=function(){for(var e=document.createElement("div"),t=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],r=0;r<t.length;r++){var n=t[r];if(e.style[n]!==void 0)return n}return t[0]}(),I.prototype.requestAnimFrame_=H.requestAnimationFrame||H.webkitRequestAnimationFrame||H.mozRequestAnimationFrame||H.oRequestAnimationFrame||H.msRequestAnimationFrame||function(e){return H.setTimeout(e,1e3/60)},I.prototype.cancelAnimFrame_=H.cancelAnimationFrame||H.webkitCancelAnimationFrame||H.mozCancelAnimationFrame||H.oCancelAnimationFrame||H.msCancelAnimationFrame||function(e){},I.prototype.setOptions=function(e){e.animate!==void 0&&this.setAnimate(e.animate),e.paneName!==void 0&&this.setPaneName(e.paneName),e.updateHandler!==void 0&&this.setUpdateHandler(e.updateHandler),e.resizeHandler!==void 0&&this.setResizeHandler(e.resizeHandler),e.resolutionScale!==void 0&&this.setResolutionScale(e.resolutionScale),e.map!==void 0&&this.setMap(e.map)},I.prototype.setAnimate=function(e){this.isAnimated_=!!e,this.isAnimated_&&this.scheduleUpdate()},I.prototype.isAnimated=function(){return this.isAnimated_},I.prototype.setPaneName=function(e){this.paneName_=e,this.setPane_()},I.prototype.getPaneName=function(){return this.paneName_},I.prototype.setPane_=function(){if(!!this.isAdded_){var e=this.getPanes();if(!e[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');e[this.paneName_].appendChild(this.canvas)}},I.prototype.setResizeHandler=function(e){this.resizeHandler_=e},I.prototype.setResolutionScale=function(e){typeof e=="number"&&(this.resolutionScale_=e,this.resize_())},I.prototype.setUpdateHandler=function(e){this.updateHandler_=e},I.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},I.prototype.onRemove=function(){!this.isAdded_||(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(H,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},I.prototype.resize_=function(){if(!!this.isAdded_){var e=this.getMap(),t=e.getDiv().offsetWidth,r=e.getDiv().offsetHeight,n=t*this.resolutionScale_,a=r*this.resolutionScale_,i=this.canvas.width,o=this.canvas.height;(i!==n||o!==a)&&(this.canvas.width=n,this.canvas.height=a,this.needsResize_=!0,this.scheduleUpdate()),(this.canvasCssWidth_!==t||this.canvasCssHeight_!==r)&&(this.canvasCssWidth_=t,this.canvasCssHeight_=r,this.canvas.style.width=t+"px",this.canvas.style.height=r+"px")}},I.prototype.draw=function(){this.repositionCanvas_()},I.prototype.repositionCanvas_=function(){var e=this.getMap(),t=e.getBounds().getNorthEast().lat(),r=e.getCenter(),n=Math.pow(2,e.getZoom()),a=r.lng()-this.canvasCssWidth_*180/(256*n);this.topLeft_=new google.maps.LatLng(t,a);var i=this.getProjection(),o=i.fromLatLngToDivPixel(r),s=-Math.round(this.canvasCssWidth_/2-o.x),l=-Math.round(this.canvasCssHeight_/2-o.y);this.canvas.style[I.CSS_TRANSFORM_]="translate("+s+"px,"+l+"px)",this.scheduleUpdate()},I.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},I.prototype.getTopLeft=function(){return this.topLeft_},I.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(H,this.requestUpdateFunction_))});var ze=function(e){mt(t,e);function t(r,n,a){j(this,t);var i=wt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n,a)),o=i,s=null;a=a||{},o.init(a),o.argCheck(a);var l={map:r,animate:!1,updateHandler:function(){o._canvasUpdate()},resolutionScale},f=i.canvasLayer=new I(l);return i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.bindEvent(),i}return et(t,[{key:"clickEvent",value:function(n){var a=n.pixel;nt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clickEvent",this).call(this,a,n)}},{key:"mousemoveEvent",value:function(n){var a=n.pixel;nt(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"mousemoveEvent",this).call(this,a,n)}},{key:"bindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&(a.setDefaultCursor("default"),a.addListener("click",this.clickEvent)),this.options.methods.mousemove&&a.addListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(n){var a=this.map;this.options.methods&&(this.options.methods.click&&a.removeListener("click",this.clickEvent),this.options.methods.mousemove&&a.removeListener("mousemove",this.mousemoveEvent))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(!!this.canvasLayer){var a=this,i=a.options.animation,o=this.getContext();if(a.isEnabledTime()){if(n===void 0){U(o);return}this.context=="2d"&&(o.save(),o.globalCompositeOperation="destination-out",o.fillStyle="rgba(0, 0, 0, .1)",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.restore())}else U(o);if(this.context=="2d")for(var s in a.options)o[s]=a.options[s];else o.clear(o.COLOR_BUFFER_BIT);if(!(a.options.minZoom&&l.getZoom()<a.options.minZoom||a.options.maxZoom&&l.getZoom()>a.options.maxZoom)){var d=1;this.context!="2d"&&(d=this.canvasLayer.devicePixelRatio);var l=this.map,f=l.getProjection(),d=Math.pow(2,l.zoom)*resolutionScale,v=f.fromLatLngToPoint(this.canvasLayer.getTopLeft()),c={transferCoordinate:function(_){var F=new google.maps.LatLng(_[1],_[0]),z=f.fromLatLngToPoint(F),m={x:(z.x-v.x)*d,y:(z.y-v.y)*d};return[m.x,m.y]}};n!==void 0&&(c.filter=function(p){var _=i.trails||10;return!!(n&&p.time>n-_&&p.time<n)});var y=a.dataSet.get(c);this.processData(y);var g=new google.maps.LatLng(0,0),w=f.fromLatLngToPoint(g),x={x:(w.x-v.x)*d,y:(w.y-v.y)*d};a.options.unit=="m"&&a.options.size?a.options._size=a.options.size/zoomUnit:a.options._size=a.options.size,this.drawContext(o,new A(y),a.options,x),a.options.updateCallback&&a.options.updateCallback(n)}}}},{key:"init",value:function(n){var a=this;a.options=n,this.initDataRange(n),this.context=a.options.context||"2d",a.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(a.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){self.canvasLayer.draw()}}]),t}(At),Oe={getDataSet:function(t){for(var r=[],n=t.features,a=0;a<n.length;a++){var i=n[a],o=i.geometry,s=i.properties,l={};for(var f in s)l[f]=s[f];l.geometry=o,r.push(l)}return new A(r)}},Te={CSVToArray:function(t,r){r=r||",";for(var n=new RegExp("(\\"+r+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+r+"\\r\\n]*))","gi"),a=[[]],i=null;i=n.exec(t);){var o=i[1];o.length&&o!==r&&a.push([]);var s;i[2]?s=i[2].replace(new RegExp('""',"g"),'"'):s=i[3],a[a.length-1].push(s)}return a},getDataSet:function(t){for(var r=this.CSVToArray(t,","),n=[],a=r[0],i=1;i<r.length-1;i++){for(var o=r[i],s={},l=0;l<o.length;l++){var f=o[l];a[l]=="geometry"&&(f=JSON.parse(f)),s[a[l]]=f}n.push(s)}return new A(n)}};M.version=K,M.canvasClear=U,M.canvasResolutionScale=at,M.canvasDrawSimple=_t,M.canvasDrawHeatmap=Pt,M.canvasDrawGrid=It,M.canvasDrawHoneycomb=zt,M.webglDrawSimple=Zt,M.webglDrawPoint=Rt,M.webglDrawLine=Tt,M.webglDrawPolygon=kt,M.utilCityCenter=we,M.utilCurve=be,M.utilForceEdgeBundling=Ce,M.utilDataRangeIntensity=k,M.utilDataRangeCategory=pt,M.utilDataRangeChoropleth=ft,M.Map=Me,M.baiduMapCanvasLayer=W,M.baiduMapAnimationLayer=Pe,M.baiduMapLayer=Ie,M.googleMapCanvasLayer=I,M.googleMapLayer=ze,M.DataSet=A,M.geojson=Oe,M.csv=Te,Object.defineProperty(M,"__esModule",{value:!0})});
