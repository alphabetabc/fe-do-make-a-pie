const uploadedDataURL="/asset/get/s/data-1635390802457-HRSoVX4EN.json",AQI_LEVELS=[{icon:"k1",label:"优",otherName:"一级",value:1,min:0,max:50,proposal:"空气质量令人满意，基本无空气污染",influence:"各类人群可正常活动",color:"#00E500",lightColor:"#D2F5A5"},{icon:"k2",label:"良",otherName:"二级",value:2,min:51,max:100,proposal:"空气质量可接受，但某些污染物可能对极少数异常敏感人群健康有较弱影响",influence:"极少数异常敏感人群应减少户外活动",color:"#FFFF00",lightColor:"#EBEBD8"},{icon:"k3",label:"轻度",otherName:"三级",value:3,min:101,max:150,proposal:"易感人群症状有轻度加剧，健康人群出现刺激症状",influence:"儿童、老年人及心脏病、呼吸系统疾病患者应减少长时间、高强度的户外锻炼",color:"#FF7E00",lightColor:"#F2E1C7"},{icon:"k4",label:"中度",otherName:"四级",value:4,min:151,max:200,proposal:"进一步加剧易感人群症状，可能对健康人群心脏、呼吸系统有影响",influence:"儿童、老年人及心脏病、呼吸系统疾病患者避免长时间、高强度的户外锻炼，一般人群适量减少户外运动",color:"#FE0000",lightColor:"#F3D3D3"},{icon:"k5",label:"重度",otherName:"五级",value:5,min:201,max:300,proposal:"心脏病和肺病患者症状显著加剧，运动耐受力降低，健康人群普遍出现症状",influence:"儿童、老年人及心脏病、肺病患者应停留在室内，停止户外运动，一般人群减少户外运动",color:"#99004C",lightColor:"#E5D2ED"},{icon:"k6",label:"严重",otherName:"六级",value:6,min:301,max:"+",proposal:"健康人群运动耐受力降低，有明显强烈症状，提前出现某些疾病",influence:"儿童、老年人和病人应停留在室内，避免体力消耗，一般人群避免户外活动",color:"#7E0022",lightColor:"#F3CBD7"}],PRIMARY={NA:"无"},getPrimaryLabel=e=>e?PRIMARY[e]?PRIMARY[e]:e:"",transformData=(e={},s=!1)=>{let n=[],l=[];for(const t in e){const o=(e[t]||{}).aqi||null;n.push([t,o])}s&&(l=AQI_LEVELS.map(({label:t,min:o,max:a,color:i})=>{const f=n.filter(([,m])=>a==="+"?m>=o:m>=o&&m<=a);return{name:t,data:f,color:i}}),l.push({name:"空值",color:"#efefef",data:n.filter(t=>t[1]===-1)}));const c=n[0][0],r=n[n.length-1][0];return{startDay:c,endDay:r,seriesData:n,seriesDatas:l}},getTooltipRow=(e,s=!1)=>s&&!e.value?"":`
  <div style="display: flex; justify-content: space-between; min-width: 80px; padding-top: 3px;">
    <span>${e.marker||""} ${e.seriesName}</span>
    <span style="padding-left: 10px; font-weight: bold;">${e.value===-1||!e.value?"-":e.value}</span>
  </div>`,getVirtulData=(e={},s)=>{const n=new Date,l=3600*24*1e3,c=n-l*365,r=JSON.parse(JSON.stringify(e));for(let t=c;t<n;t+=l){const o=s(new Date(t),"Y-m-d");r[o]||(r[o]={aqi:-1,aqidate:o,data_type:"history",primary:""})}return r},formatDate=(e=null,s="Y-m-d",n="-")=>{const l=["周日","周一","周二","周三","周四","周五","周六"],c=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],r=u=>{const D=u.toString();return D.length===1?`0${D}`:D};let t=e;if(e===null||Number.isNaN(e)&&typeof e!="string"){if(typeof n=="string")return n;t=new Date}else if(typeof e=="number"){if(e===0)return n;t=new Date(e*1e3)}else typeof e=="string"&&(parseInt(e)==e?t=new Date(e*1e3):e.includes("T")?t=new Date(e):t=new Date(e.replace(/-/g,"/")));if(!(t instanceof Date))throw new Error("被处理的只能是Date对象");if(Number.isNaN(t.getTime())){if(typeof e=="string")return e;throw new Error("非法日期对象")}const o=t.getDate(),a=t.getFullYear(),i=t.getHours(),f=t.getDay(),m=l[f],N=t.getMinutes(),v=t.getSeconds(),h=t.getMonth(),d=i<12?"am":"pm",E=t.getTime()%1e3;let p=i%12;p=p||12;const g=new Date(t.getFullYear(),0,1),F=Math.round((t-g)/864e5),x=Math.ceil(((t-g)/864e5+g.getDay()-1)/7),y={d:r(o),D:m.substr(0,3),l:m,w:f,j:o,z:F,W:x,M:c[h].substr(0,3),F:c[h],Y:a,a:d,A:d.toUpperCase(),y:`${a}`.substr(2,2),c:t.toISOString(),m:r(h+1),U:Math.round(t/1e3),g:p,G:r(p),h:i,H:r(i),i:r(N),s:r(v),e:E},w=[];return Object.keys(y).forEach(u=>{w.push(`(\\\\)?${u}`)}),s.replace(new RegExp(w.join("|"),"g"),u=>y[u]?y[u]:u.replace("\\",""))};$.getJSON(uploadedDataURL,e=>{const s=getVirtulData(e.history,formatDate),n="最近12个月空气质量分布",l=AQI_LEVELS.map(({min:o,max:a,color:i})=>({min:o,max:a,color:i})),{seriesDatas:c}=transformData(s,!0),r=o=>getPrimaryLabel((s[o]||{}).primary)||"",t={title:{text:n,left:"center"},tooltip:{position:"top",formatter:o=>{const a=r(o.value[0]);return`${o.value[0]}<br />${getTooltipRow({...o,value:o.value[1]})}${getTooltipRow({seriesName:"首要污染物",value:a})}`}},legend:{show:!0,icon:"circle",bottom:0},calendar:{range:new Date().getFullYear(),top:60,left:60,right:15,bottom:40,height:150,cellSize:[14,14],itemStyle:{borderWidth:4,borderColor:"#fff"},yearLabel:{show:!1},splitLine:{show:!1},monthLabel:{nameMap:"cn"},dayLabel:{nameMap:["日","一","二","三","四","五","六"],firstDay:1,left:10}},visualMap:{show:!1,type:"piecewise",pieces:[{max:0,min:-10,color:"#efefef",name:"空值"},...l]},series:c.map(({name:o,data:a,color:i})=>({type:"heatmap",coordinateSystem:"calendar",name:o,data:a,color:i,label:{show:!0,fontSize:10,formatter:f=>r(f.value[0])}}))};myChart.setOption(t)});
