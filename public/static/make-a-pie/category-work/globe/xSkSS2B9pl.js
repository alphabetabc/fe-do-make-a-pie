var config={color:"#c0101a",levels:50,intensity:100,threshold:.01},canvas=document.createElement("canvas");canvas.width=4096,canvas.height=2048,context=canvas.getContext("2d"),context.lineWidth=.4,context.strokeStyle=config.color,context.fillStyle=config.color,context.shadowColor=config.color,image("/asset/get/s/data-1491837512042-rJlLfXYax.jpg").then(function(a){for(var n=a.height,t=a.width,e=new Array(t*n),o=d3.contours().size([t,n]).smooth(!0),u=d3.geoIdentity().scale(canvas.width/t),m=d3.geoPath(u,context),l=0,r=0;l<n;++l)for(var c=0;c<t;++c,++r)e[r]=a.data[r<<2]/255;var f={image:canvas},d=[];function v(s,i){context.clearRect(0,0,canvas.width,canvas.height);for(var g=[],h=0;h<i;h++)g.push((s+1/i*h)%1);d=o.thresholds(g)(e),x()}function x(){d.forEach(function(s,i){context.beginPath(),m(s),context.globalAlpha=1,context.stroke(),i>config.levels/5*3&&(context.globalAlpha=.01,context.fill())}),onupdate()}v(config.threshold,config.levels),initCharts(f)});function image(a){return new Promise(function(n){var t=new Image;t.src=a,t.onload=function(){var e=document.createElement("canvas");e.width=t.width/4,e.height=t.height/4;var o=e.getContext("2d");o.drawImage(t,0,0,e.width,e.height),n(o.getImageData(0,0,e.width,e.height))}})}var contourChart=echarts.init(document.createElement("canvas"),null,{width:4096,height:2048}),img=new echarts.graphic.Image({style:{x:-1,y:-1}});onupdate=function(){img.dirty()};function initCharts(a){img.style.width=a.image.width+2,img.style.height=a.image.height+2,img.style.image=a.image,contourChart.getZr().add(img),myChart.setOption({backgroundColor:"#000",globe:{environment:"/asset/get/s/data-1491837999815-H1_44Qtal.jpg",heightTexture:"/asset/get/s/data-1491837512042-rJlLfXYax.jpg",displacementScale:.05,displacementQuality:"high",baseColor:"#111",shading:"realistic",realisticMaterial:{roughness:.2,metalness:0},postEffect:{enable:!0,depthOfField:{}},light:{ambient:{intensity:0},main:{intensity:.1,shadow:!1},ambientCubemap:{texture:"/asset/get/s/data-1491837984109-r1u7NmY6e.hdr",exposure:1,diffuseIntensity:.5,specularIntensity:2}},viewControl:{autoRotate:!1},layers:[{type:"blend",blendTo:"albedo",texture:contourChart,intensity:50}]}})}
