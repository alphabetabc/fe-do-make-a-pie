var config={color:"#c0101a",levels:1,intensity:4,threshold:.01},canvas=document.createElement("canvas");canvas.width=4096,canvas.height=2048,context=canvas.getContext("2d"),context.lineWidth=.5,context.strokeStyle=config.color,context.fillStyle=config.color,context.shadowColor=config.color,image("/asset/get/s/data-1491837512042-rJlLfXYax.jpg").then(function(e){for(var n=e.height,t=e.width,a=new Array(t*n),r=d3.contours().size([t,n]).smooth(!0),f=d3.geoIdentity().scale(canvas.width/t),v=d3.geoPath(f,context),l=0,s=0;l<n;++l)for(var c=0;c<t;++c,++s)a[s]=e.data[s<<2]/255;var d={image:canvas},g=[];function u(o,i){context.clearRect(0,0,canvas.width,canvas.height);for(var m=[],h=0;h<i;h++)m.push((o+1/i*h)%1);g=r.thresholds(m)(a),x()}function x(){g.forEach(function(o,i){context.beginPath(),v(o),context.globalAlpha=1,context.stroke(),i>config.levels/5*3&&(context.globalAlpha=.01,context.fill())}),d.onupdate()}d3.timer(function(o){var i=o%1e4/1e4;u(i,1)}),initCharts(d),u(config.threshold,config.levels)});function image(e){return new Promise(function(n){var t=new Image;t.src=e,t.onload=function(){var a=document.createElement("canvas");a.width=t.width/8,a.height=t.height/8;var r=a.getContext("2d");r.drawImage(t,0,0,a.width,a.height),n(r.getImageData(0,0,a.width,a.height))}})}function initCharts(e){var n=echarts.init(document.createElement("canvas"),null,{width:4096,height:2048}),t=new echarts.graphic.Image({style:{image:e.image,x:-1,y:-1,width:e.image.width+2,height:e.image.height+2}});n.getZr().add(t),e.onupdate=function(){t.dirty()},myChart.setOption({backgroundColor:"#000",globe:{environment:"/asset/get/s/data-1491837999815-H1_44Qtal.jpg",heightTexture:"/asset/get/s/data-1491837512042-rJlLfXYax.jpg",displacementScale:.05,displacementQuality:"high",baseColor:"#000",shading:"realistic",realisticMaterial:{roughness:.2,metalness:0},postEffect:{enable:!0,depthOfField:{}},light:{ambient:{intensity:0},main:{intensity:.1,shadow:!1},ambientCubemap:{texture:"/asset/get/s/data-1491837984109-r1u7NmY6e.hdr",exposure:1,diffuseIntensity:.5,specularIntensity:2}},viewControl:{autoRotate:!1},layers:[{type:"blend",blendTo:"emission",texture:n,intensity:config.intensity}]}})}
