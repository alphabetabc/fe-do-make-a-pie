mapboxgl.accessToken=mapboxglToken;var ENCODE_SCALE=1e6;function decodeLine(t){for(var i=[],a=t[0],n=t[1],r=0;r<t[2].length;r+=2){var e=t[2].charCodeAt(r)-64,s=t[2].charCodeAt(r+1)-64;e=e>>1^-(e&1),s=s>>1^-(s&1),e+=a,s+=n,a=e,n=s,i.push([e/ENCODE_SCALE,s/ENCODE_SCALE,10])}return i}var geoJSON={features:[]},regions=[],readShp=new Promise(function(t,i){shapefile.open("/asset/get/s/data-1498751177695-rkzAeiGEb.shp","/asset/get/s/data-1498751184605-rJYAxjMVW.dbf").then(a=>a.read().then(function n(r){if(r.done){t();return}var e=r.value;return e.properties.name=geoJSON.features.length+"",regions.push({name:geoJSON.features.length+"",value:1,height:e.properties.SHAPE_leng*1e4}),geoJSON.features.push(e),a.read().then(n)}))});myChart.showLoading(),Promise.all([$.getJSON("/asset/get/s/data-1498751206824-HkkgZsfEW.json"),readShp]).then(function([t,i]){var a=t.map(function(n){return{coords:decodeLine(n)}});myChart.hideLoading(),echarts.registerMap("buildings",geoJSON),myChart.setOption({mapbox:{center:[18.424552361777955,-33.92188144682616],zoom:14,pitch:50,bearing:-10,altitudeScale:2,style:"mapbox://styles/mapbox/dark-v9",postEffect:{enable:!0,screenSpaceAmbientOcclusion:{enable:!0,intensity:1.2,radius:6,quality:"high"},screenSpaceReflection:{enable:!0}},light:{main:{intensity:1,shadow:!0,shadowQuality:"high"},ambient:{intensity:0},ambientCubemap:{texture:"/asset/get/s/data-1491838644249-ry33I7YTe.hdr",exposure:1,diffuseIntensity:.5,specularIntensity:2}}},series:[{type:"lines3D",coordinateSystem:"mapbox",effect:{show:!0,constantSpeed:5,trailWidth:2,trailLength:.8,trailOpacity:1,spotIntensity:10},blendMode:"lighter",polyline:!0,lineStyle:{width:.1,color:"rgb(200, 40, 0)",opacity:0},data:{count:function(){return a.length},getItem:function(n){return a[n]}}},{type:"map3D",map:"buildings",coordinateSystem:"mapbox",shading:"realistic",silent:!0,instancing:!0,data:regions,realisticMaterial:{metalness:1,roughness:.2}}]})}),window.addEventListener("keydown",function(){myChart.dispatchAction({type:"lines3DToggleEffect",seriesIndex:0})});
