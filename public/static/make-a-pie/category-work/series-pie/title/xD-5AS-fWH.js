const sourceData=[{name:"小学",value:129},{name:"中学",value:224},{name:"高中",value:384},{name:"大专",value:420},{name:"本科",value:558},{name:"研究生",value:238}],total=sourceData.reduce((e,t)=>(e+=t.value,e),0),inSplitWidth=3,inSplitValue=Math.floor(total/(200/inSplitWidth)),itemSplitWidth=2,outSplitWidth=inSplitWidth+itemSplitWidth,outSplitValue=Math.floor(total/(200/outSplitWidth)),valueTotal=total+inSplitValue*sourceData.length;function getTextAngle(e,t){if(e=e+t,console.log("currentAngle",e),e<=90)return-e;if(e<=180&&e>90)return 180-e;if(e<270&&e>180)return 180-e;if(e<360&&e>=270)return 360-e}const valueData=sourceData.reduce((e,t)=>{const s=e.reduce((l,o)=>(l+=o.value,l),0),a=360*(s/valueTotal),n=360*(t.value/valueTotal)/2;return console.log("current  angle",a),e.push({name:t.name,value:t.value,itemStyle:{},label:{lineHeight:80,rotate:getTextAngle(a,n)}},{name:"",value:inSplitValue,itemStyle:{color:"transparent",opacity:0},label:{show:!1},labelLine:{show:!1}}),e},[]),itemReduced=outSplitValue-inSplitValue,outValueData=sourceData.reduce((e,t,s)=>{const a=e.reduce((o,i)=>(o+=i.value,o),0),n=360*(a/valueTotal),l=360*(t.value/valueTotal)/2;return e.push({name:t.name,value:t.value-itemReduced,itemStyle:{},label:{color:"rgb(160, 60, 60)",position:"inside",align:"center",rotate:getTextAngle(n,l)}},{name:"",value:outSplitValue,itemStyle:{color:"transparent",opacity:0},label:{show:!1},labelLine:{show:!1}}),e},[]);option={title:{text:"Awesome Chart"},series:[{type:"pie",data:valueData,label:{show:!1,position:"outside",align:"center",verticalAlign:"middle",formatter(e){return e.data.name}},labelLine:{show:!1},emphasis:{scale:!0,scaleSize:20},blur:{itemStyle:{opacity:1}},radius:["60%","80%"],itemStyle:{}},{type:"pie",startAngle:-360*(itemReduced/2/valueTotal)+90,radius:["79%","95%"],itemStyle:{opacity:.3},label:{show:!0,formatter(e){return"{a|"+e.data.name+"}"},rich:{a:{lineHeight:50,color:"red"}}},labelLine:{show:!1,length:10},data:outValueData}]};
