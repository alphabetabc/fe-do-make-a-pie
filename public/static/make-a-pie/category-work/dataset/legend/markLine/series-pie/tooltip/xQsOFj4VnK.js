let markLineData=[],source=[["product","2015","2016"],["京东方",103.3],["北方华创",83.1],["电子城",86.4],["七星",2.4],["正东",7.4],["益泰",3.9],["燕东",15.8],["北广",5.8]],a=(source[4][1]+source[5][1]+source[6][1]+source[7][1]+source[8][1])/(source[2][1]+source[3][1]+source[4][1]+source[5][1]+source[6][1]+source[7][1]+source[8][1])*360/2;addOtherData(source,5),option={legend:{},tooltip:{},dataset:{source},series:[{type:"pie",radius:"50%",center:["25%","50%"],label:{show:!0,position:"inside"},startAngle:a,clockwise:!1,markLine:{lineStyle:{type:"solid",color:"#BFBFBF"},symbol:"none",data:markLineData}},{type:"pie",radius:"30%",center:["75%","50%"],encode:{itemName:"product",value:"2016"},label:{show:!0,position:"inside"}}]};function getMarkLineData(s){let l=myChart.getHeight(),r=myChart.getWidth()*.25,h=r+l/4*Math.cos(a*3.14/180),n=l*.5-l/4*Math.sin(a*3.14/180),t=360*(s/100),e=0;e=t<=a?a-t:360-(t-a),e<270&&e>a&&(e=270);let i=0,o=0;return i=r+l/4*Math.cos(e*3.14/180),o=l*.5-l/4*Math.sin(e*3.14/180),[[{x:h,y:n},{x:"75%",y:"35%"}],[{x:i,y:o},{x:"75%",y:"65%"}]]}function addOtherData(s,l){let c=0,r=0;s.forEach((t,e)=>{if(e>0){let i=0;for(let o of t){let u=isNaN(o)?0:Number(o);i===1&&(r+=u),i++}}});let h=s.slice(s.length-l),n=["其他"];for(let t=0;t<h.length;t++){let e=0;for(let i of h[t]){let o=isNaN(i)?0:i;e&&(n[e]?n[e]+=o:n.push(o)),e++}h[t].splice(1,0,"")}s.push(n),c=r?(n[1]/r*100).toFixed(2):100,markLineData=getMarkLineData(c)}
