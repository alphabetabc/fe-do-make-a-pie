$(`<div class="map_tips">
        <div v-cloak class="map_tips_city"></div>
        <div class="map_tips_group">
            <div class="map_tips_lol">英雄联盟玩家：856321人</div>
            <div class="map_tips_king">王者荣耀玩家：725654人</div>
            <div class="map_tips_cf">穿越火线玩家：254268人</div>
            <div class="map_tips_car">QQ飞车玩家：125436人</div>
        </div>
    </div>
    <div id="container"></div>
    <div class="back">返回</div>
    <div class="input-card">
            <h4>下属行政区查询</h4>
            <div class="input-item">
                <div class="input-item-prepend"><span class="input-item-text">省市区</span></div>
                <select id='province' style="width:100px"></select>
            </div>
            <div class="input-item">
                <div class="input-item-prepend"><span class="input-item-text">地级市</span></div>
                <select id='city' style="width:100px"></select>
            </div>
            <div class="input-item">
                <div class="input-item-prepend"><span class="input-item-text">区县</span></div>
                <select id='district' style="width:100px"></select>
            </div>
             <div class="input-item-" style='display: none;'>
        <div class="input-item-prepend"><span class="input-item-text" >街道</span></div>
        <select id='street' style="width:100px" onchange='setCenter(this)'></select>
    </div>
    <p>请选择文件命名方式</p>
    <div class="radio">
        <input type="radio" value="name" name="nameType">地域名称
        <input type="radio" value="code" checked name="nameType">地域行政编码
    </div>
    <div class="input-item download" @click="download">下载geoJson数据</div>
</div>`).appendTo($("#chart-panel")),$(".back").css({position:"absolute",width:"100px",padding:"10px 0",top:"30px",right:"50px",background:"#1c71fb",color:"#fff","text-align":"center","border-radius":"5px",cursor:"pointer","z-index":"100"}),$(".map_tips").css({position:"absolute",width:"273px",height:"218px",color:"#fff","font-size":"14px","background-repeat":"no-repeat","background-image":"url(https://s2.ax1x.com/2019/04/26/EmXmcj.png)","background-size":"100% 100%","z-index":"9","pointer-events":"none",display:"none"}),$(".map_tips_city").css({"margin-top":"35px","margin-left":"32px"}),$(".map_tips_group").css({"margin-top":"29px","margin-left":"82px"}),$(".map_tips_group div").css({"margin-top":"10px"}),$("*").css({"box-sizing":"border-box"}),$("#container").css({position:"absolute",width:"100%",left:"0",top:"0",height:"100%"}),$(".input-card").css({position:"fixed",top:"10px",left:"10px",height:"300px",display:"flex","flex-direction":"column","min-width":"0","word-wrap":"break-word","background-color":"#fff","background-clip":"border-box","border-radius":".25rem",width:"22rem","border-width":"0","border-radius":"0.4rem","box-shadow":"0 2px 6px 0 rgba(114, 124, 245, .5)",bottom:"1rem",right:"1rem","-ms-flex":"1 1 auto",flex:"1 1 auto",padding:"0.75rem 1.25rem","z-index":"10"}),$(".input-item").css({position:"relative",display:"-ms-flexbox",display:"flex","-ms-flex-wrap":"wrap","flex-wrap":"wrap","-ms-flex-align":"center","align-items":"center",width:"100%",height:"3rem"}),$(".input-item-text").css({width:"6rem","text-align":"justify",padding:"0.4rem 0.7rem",display:"inline-block","text-justify":"distribute-all-lines","text-align-last":"justify","-moz-text-align-last":"justify","-webkit-text-align-last":"justify","-ms-flex-align":"center","align-items":"center","margin-bottom":"0","font-size":"1rem"," font-weight":"400","line-height":"1.5",color:"#495057","text-align":"center","white-space":"nowrap","background-color":"#e9ecef",border:"1px solid #ced4da","border-radius":".25rem","border-bottom-right-radius":"0","border-top-right-radius":"0",height:"calc(2.2rem + 2px)"});var url="",background=`#fff url(${url}) no-repeat right .75rem center`;$("select").css({display:"inline-block",width:"100%",padding:".375rem 1.75rem .375rem .75rem","line-height":"1.5",color:"#495057","vertical-align":"middle","background-size":"8px 10px",border:"1px solid #ced4da","border-radius":".25rem","-webkit-appearance":"none","-moz-appearance":"none",appearance:"none",position:"relative","-ms-flex":"1 1 auto",flex:"1 1 auto",width:"1%","border-top-left-radius":"0","border-bottom-left-radius":"0",height:"calc(2.2rem + 2px)","margin-bottom":"0"}),$(".radio").css({margin:"3px 0"}),$($("#chart-panel").children("div").get(0)).css({position:"absolute","z-index":"8"}),$(".download").css({display:"-webkit-box",display:"-ms-flexbox",display:"flex","-webkit-box-pack":"center","-ms-flex-pack":"center","justify-content":"center","-webkit-box-align":"center","-ms-flex-align":"center","align-items":"center",border:"1px solid #ced4da","border-radius":".25rem","background-color":"#e9ecef",color:"#495057","text-align":"center",cursor:"pointer"});var map,district,polygons=[],mapData=[],cityCode=1e5,cityName="中国",areaCode=1e4,geoJsonData="",provinceSelect=document.getElementById("province"),citySelect=document.getElementById("city"),districtSelect=document.getElementById("district"),areaSelect=document.getElementById("street"),areaData={},deepTree=[{mapData,code:1e5}];$("select").change(function(){search(this)}),$(".back").click(function(){console.log(deepTree),deepTree.length>1&&(mapData=deepTree[deepTree.length-1].mapData,deepTree.pop(),console.log(deepTree[deepTree.length-1],"back"),loadMapData(deepTree[deepTree.length-1].code))}),map=new AMap.Map("container",{resizeEnable:!0,center:[116.30946,39.937629],zoom:3});var opts={subdistrict:1,showbiz:!1};district=new AMap.DistrictSearch(opts),district.search("中国",function(e,a){e=="complete"&&getData(a.districtList[0],"",1e5)});function echartsMapClick(e){if(!(!e.data||e.data.level=="street")){cityName=e.data.name,cityCode=e.data.cityCode,district.setLevel(e.data.level),district.setExtensions("all"),district.search(e.data.cityCode,(o,i)=>{o==="complete"&&(deepTree.push({mapData,code:e.data.cityCode}),getData(i.districtList[0],e.data.level,e.data.cityCode))}),setSearchOption(e.data,e.data.level,e.data.cityCode);var a="option[text="+cityName+"]";e.data.level=="province"?$("#province").find(a).attr("selected",!0):e.data.level=="city"?$("#city").find(a).attr("selected",!0):$("#district").find(a).attr("selected",!0)}}function loadMapData(e){console.log(e,"loadCode"),AMapUI.loadUI(["geo/DistrictExplorer"],a=>{var o=window.districtExplorer=new a({eventSupport:!0,map});o.loadAreaNode(e,(i,n)=>{if(i){console.error(i);return}let r={};r.features=n.getSubFeatures(),console.log(cityName,r,"loadmap"),loadMap(cityName,r),geoJsonData=r})})}function downloadJson(){var e=$("input[name='nameType']:checked").val(),a=new Blob([JSON.stringify(geoJsonData)],{type:"text/plain;charset=utf-8"});let o=cityName;e==="code"&&(o=cityCode),saveAs(a,`${o}.geoJson`)}function loadMap(e,a){if(a){echarts.registerMap(e,a);var o={backgroundColor:"rgba(0,0,0,.6)",visualMap:{type:"piecewise",pieces:[{max:30,label:"安全",color:"#2c9a42"},{min:30,max:60,label:"警告",color:"#d08a00"},{min:60,label:"危险",color:"#c23c33"}],color:"#fff",textStyle:{color:"#fff"},visibility:"off"},series:[{name:"数据名称",type:"map",roam:!1,mapType:e,selectedMode:"single",showLegendSymbol:!1,visibility:"off",itemStyle:{normal:{color:"#ccc",areaColor:"#fff",borderColor:"#fff",borderWidth:.5,label:{show:!0,textStyle:{color:"rgb(249, 249, 249)"}}},emphasis:{areaColor:!1,borderColor:"#fff",areaStyle:{color:"#fff"},label:{show:!0,textStyle:{color:"rgb(249, 249, 249)"}}}},data:mapData}]};myChart.setOption(o)}}myChart.on("click",echartsMapClick),$(".download").on("click",downloadJson);var lastCode="";myChart.on("mousemove",function(e){$(".map_tips").is(":hidden")&&$(".map_tips").show();var a=e.data.name,a=a.substring(0,2);lastCode!==e.data.cityCode&&($(".map_tips_city").text(a),$(".map_tips_lol").text("英雄联盟玩家："+person[Math.floor(Math.random()*10)].lol+"人"),$(".map_tips_king").text("王者荣耀玩家："+person[Math.floor(Math.random()*10)].king+"人"),$(".map_tips_cf").text("穿越火线玩家："+person[Math.floor(Math.random()*10)].cf+"人"),$(".map_tips_car").text("QQ飞车玩家："+person[Math.floor(Math.random()*10)].car+"人")),lastCode=e.data.cityCode;var o=e.event.offsetX,i=e.event.offsetY,n=80;$(".map_tips").css({top:i+10,left:o+10})}),myChart.on("mouseout",function(e){$(".map_tips").hide()});function getData(e,a,o){var i=e.boundaries;if(i){for(var n=0,r=i.length;n<r;n++){var p=new AMap.Polygon({map,strokeWeight:1,strokeColor:"#0091ea",fillColor:"#80d8ff",fillOpacity:.2,path:i[n]});polygons.push(p)}map.setFitView()}setSearchOption(e,a,o)}var person=[{lol:"123521",king:"5215463",cf:"6321525",car:"932154"},{lol:"532154",king:"3252152",cf:"321025",car:"302542"},{lol:"521345",king:"3452345",cf:"66734",car:"51235"},{lol:"4531235",king:"1285978",cf:"45612",car:"123571"},{lol:"123484",king:"678453",cf:"45612",car:"156786"},{lol:"9754158",king:"123453",cf:"4567812",car:"7541234"},{lol:"84536",king:"123654",cf:"4568",car:"15678"},{lol:"45611258",king:"123515",cf:"45612",car:"1452345"},{lol:"456847",king:"3157456",cf:"56456",car:"12357"},{lol:"314543",king:"312371",cf:"456878645",car:"45686"}];function setSearchOption(e,a,o){a==="province"?(citySelect.innerHTML="",districtSelect.innerHTML=""):a==="city"&&(districtSelect.innerHTML="");var i=e.districtList;if(i){var n=new Option("--请选择--"),r=i[0].level;if(r==="street"){let g=geoJsonData.features,m={};for(let h in g)g[h].properties.name==cityName&&(m.features=[].concat(g[h]));mapData=[],mapData.push({name:cityName,value:Math.random()*100,level:r}),loadMap(cityName,m),geoJsonData=m;return}var p=document.querySelector("#"+r);p.add(n),mapData=[];for(var c=0,k=i.length;c<k;c++){var v=i[c].name,_=i[c].adcode;mapData.push({name:v,value:Math.random()*100,cityCode:_,level:r});var x=i[c].level;n=new Option(v),n.setAttribute("value",x),n.setAttribute("text",v),n.center=i[c].center,n.adcode=i[c].adcode,p.add(n)}loadMapData(o),areaData[r]=p}}function search(e){console.log("111");for(var a=0,o=polygons.length;a<o;a++)polygons[a].setMap(null);var i=e[e.options.selectedIndex],n=i.text,r=i.adcode;cityName=n,cityCode=r,district.setLevel(i.value),district.setExtensions("all"),district.search(r,function(p,c){p==="complete"&&(deepTree.push({mapData,code:r}),getData(c.districtList[0],e.id,r))})}function setCenter(e){map.setCenter(e[e.options.selectedIndex].center)}var saveAs=saveAs||function(e){"use strict";if(!(typeof e>"u"||typeof navigator<"u"&&/MSIE [1-9]\./.test(navigator.userAgent))){var a=e.document,o=function(){return e.URL||e.webkitURL||e},i=a.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in i,r=function(t){var s=new MouseEvent("click");t.dispatchEvent(s)},p=/constructor/i.test(e.HTMLElement)||e.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent),k=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},v="application/octet-stream",_=1e3*40,x=function(t){var s=function(){typeof t=="string"?o().revokeObjectURL(t):t.remove()};setTimeout(s,_)},g=function(t,s,u){s=[].concat(s);for(var l=s.length;l--;){var y=t["on"+s[l]];if(typeof y=="function")try{y.call(t,u||t)}catch(b){k(b)}}},m=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},h=function(t,s,u){u||(t=m(t));var l=this,y=t.type,b=y===v,f,C=function(){g(l,"writestart progress write writeend".split(" "))},E=function(){if((c||b&&p)&&e.FileReader){var w=new FileReader;w.onloadend=function(){var M=c?w.result:w.result.replace(/^data:[^;]*;/,"data:attachment/file;"),L=e.open(M,"_blank");L||(e.location.href=M),M=void 0,l.readyState=l.DONE,C()},w.readAsDataURL(t),l.readyState=l.INIT;return}if(f||(f=o().createObjectURL(t)),b)e.location.href=f;else{var I=e.open(f,"_blank");I||(e.location.href=f)}l.readyState=l.DONE,C(),x(f)};if(l.readyState=l.INIT,n){f=o().createObjectURL(t),setTimeout(function(){i.href=f,i.download=s,r(i),C(),x(f),l.readyState=l.DONE});return}E()},d=h.prototype,S=function(t,s,u){return new h(t,s||t.name||"download",u)};return typeof navigator<"u"&&navigator.msSaveOrOpenBlob?function(t,s,u){return s=s||t.name||"download",u||(t=m(t)),navigator.msSaveOrOpenBlob(t,s)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,S)}}(typeof self<"u"&&self||typeof window<"u"&&window||this.content);typeof module<"u"&&module.exports?module.exports.saveAs=saveAs:typeof define<"u"&&define!==null&&define.amd!==null&&define("FileSaver.js",function(){return saveAs});
