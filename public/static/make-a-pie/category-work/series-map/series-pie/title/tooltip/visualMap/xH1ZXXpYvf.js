var typeArr=["男性","女性","城镇人口","农村人口"],typeIndex=1,selectedRange=null,option=null,str="",data=[],mapdata1=[],geoCoordMap={冷水江市:[111.47,27.68],涟源市:[111.79,27.74],娄星区:[112,27.78],双峰县:[112.2,27.46],新化县:[111.23,27.88]},name="定制地图区域饼图数据统计",mapName="loudi";$.get("/asset/get/s/data-1519004377467-ByWkioPwf.json",function(h){echarts.registerMap("loudi",h);var d=echarts.getMap(mapName).geoJson.features;d.forEach(function(e){var a=e.properties.name,r=Math.round(Math.random()*100+10),o=Math.round(Math.random()*100+10);data.push({name:a,value:[{name:"男性",value:r},{name:"女性",value:o}]}),mapdata1.push({name:a,value:r+o})}),console.log("===========geoCoordMap===============");for(var g in geoCoordMap)console.log(geoCoordMap[g]);console.log(geoCoordMap),console.log("==============data==============="),console.log(data);function y(e,a){var r=[];return a.forEach(function(o){o.value.forEach(function(t){String(t.name)===String(e)&&r.push({name:o.name,value:t.value})})}),r}console.log("================mapData=================="),console.log(y(typeArr[typeIndex],data)),console.log("=========================================");function m(e,a,r,o){var t=e.getOption(),s=t.series;s.forEach(function(n,u){if(u>0){var c=r[n.name],v=e.convertToPixel({seriesIndex:0},c);if(n.center=v,a!=0&&a.zoom&&(n.radius=n.radius*a.zoom),a!=0&&a.selected){var l=a.selected[0],f=a.selected[1],p=n.data[o].value;p<l||p>f?n.itemStyle.normal.opacity=0:n.itemStyle.normal.opacity=1}}}),e.setOption(t,!0)}function M(e,a){for(var r=e.getOption(),o=i.series,t=0;t<a.length;t++){var s=Math.round(Math.random()*30)*2,n=s<=10?10:s,u=geoCoordMap[a[t].name];if(u){var c=[];a[t].value.map(function(l,f){c.push({name:l.name,value:l.value,visualMap:!1})});var v=e.convertToPixel({seriesIndex:0},u);o.push({name:a[t].name,type:"pie",tooltip:{formatter:function(l){return l.seriesName+"<br/>"+l.name+" : "+l.value+"万人"}},radius:n,center:v,data:c,label:{normal:{show:!1}},labelLine:{normal:{show:!1}},itemStyle:{mormal:{opacity:.1}}})}}return o}var i={title:{text:name,left:"center",textStyle:{color:"black"}},tooltip:{trigger:"item",formatter:function(e){if(e.value)return e.name+"<br/>总人口: "+e.value+"万人"}},visualMap:{type:"continuous",show:!0,min:0,max:200,left:"left",top:"bottom",text:["高    (亿元)","低    (亿元)"],calculable:!0,inRange:{color:["#00467F","#A5CC82"]}},series:[{name:"chinaMap",type:"map",mapType:mapName,roam:!0,label:{normal:{show:!0,color:"black",fontSize:13},emphasis:{show:!0}},data:mapdata1}]};i&&typeof i=="object"&&myChart.setOption(i,!0),M(myChart,data),myChart.setOption(i,!0),myChart.on("georoam",function(e){m(myChart,e,geoCoordMap,typeIndex)}),myChart.on("datarangeselected",function(e){m(myChart,e,geoCoordMap,typeIndex)}),window.addEventListener("resize",function(){myChart.resize(),m(myChart,0,geoCoordMap)})}),myChart.setOption(option);
