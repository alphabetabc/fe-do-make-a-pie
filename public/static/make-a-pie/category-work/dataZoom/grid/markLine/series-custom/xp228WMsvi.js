const projectData={projectName:"项目",startDate:"2021-08-01T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:1,actuleRatio:7,emergencyDegree:1,engineeringScheduleList:[{engineeringScheduleId:14116,milestoneId:916,engineeringName:"龙湖集团:自建工程1",startDate:"2021-08-01T00:00:00.000+0800",endDate:"2021-08-31T00:00:00.000+0800",status:1,actuleRatio:10,emergencyDegree:1,actualScheduleWorkday:3,planningScheduleWorkDays:31,processSchedules:[{processScheduleId:579,processScheduleName:"龙湖集团:自建工序1-1😂😄",startDate:"2021-08-01T00:00:00.000+0800",endDate:"2021-08-31T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0}]},{engineeringScheduleId:14132,milestoneId:916,engineeringName:"龙湖集团:自建工程2😂😂",startDate:"2021-08-01T00:00:00.000+0800",endDate:"2021-08-31T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:8,planningScheduleWorkDays:133,processSchedules:[{processScheduleId:594,processScheduleName:"龙湖集团:自建工序2-1",startDate:"2021-08-01T00:00:00.000+0800",endDate:"2021-08-31T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0},{processScheduleId:593,processScheduleName:"龙湖集团:自建工序2-2",startDate:"2021-08-04T00:00:00.000+0800",endDate:"2021-08-05T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0}]},{engineeringScheduleId:14131,milestoneId:0,engineeringName:"龙湖集团:自建工程3",startDate:"2021-08-09T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:7,planningScheduleWorkDays:18,processSchedules:[{processScheduleId:592,processScheduleName:"龙湖集团:自建工序3-1",startDate:"2021-08-08T00:00:00.000+0800",endDate:"2021-08-16T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0}]},{engineeringScheduleId:14136,milestoneId:916,engineeringName:"龙湖集团:自建工程4",startDate:"2021-08-11T00:00:00.000+0800",endDate:"2021-08-31T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:1,planningScheduleWorkDays:7,processSchedules:[{processScheduleId:595,processScheduleName:"龙湖集团:自建工序4-1",startDate:"2021-08-11T00:00:00.000+0800",endDate:"2021-08-11T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0}]},{engineeringScheduleId:14137,milestoneId:0,engineeringName:"龙湖集团:自建工程5",startDate:"2021-08-11T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:0,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:0,planningScheduleWorkDays:0,processSchedules:[]},{engineeringScheduleId:14138,milestoneId:0,engineeringName:"龙湖集团:自建工程6",startDate:"2021-08-11T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:1,actuleRatio:3,emergencyDegree:1,actualScheduleWorkday:6,planningScheduleWorkDays:204,processSchedules:[{processScheduleId:634,processScheduleName:"龙湖集团:自建工序6-1",startDate:"2021-08-11T00:00:00.000+0800",endDate:"2021-08-19T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0},{processScheduleId:640,processScheduleName:"龙湖集团:自建工序6-2",startDate:"2021-08-11T00:00:00.000+0800",endDate:"2021-10-11T00:00:00.000+0800",status:1,actuleRatio:3,emergencyDegree:1}]},{engineeringScheduleId:14182,milestoneId:0,engineeringName:"龙湖集团:自建工程7",startDate:"2021-08-20T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:0,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:0,planningScheduleWorkDays:0,processSchedules:[]},{engineeringScheduleId:14183,milestoneId:0,engineeringName:"龙湖集团:自建工程8",startDate:"2021-08-23T00:00:00.000+0800",endDate:"2021-10-31T00:00:00.000+0800",status:1,actuleRatio:0,emergencyDegree:1,actualScheduleWorkday:0,planningScheduleWorkDays:78,processSchedules:[{processScheduleId:649,processScheduleName:"龙湖集团:自建工序8-1",startDate:"2021-08-23T00:00:00.000+0800",endDate:"2021-09-30T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0}]},{engineeringScheduleId:14184,milestoneId:0,engineeringName:"龙湖集团:自建工程9",startDate:"2021-08-24T00:00:00.000+0800",endDate:"2021-12-31T00:00:00.000+0800",status:1,actuleRatio:21,emergencyDegree:1,actualScheduleWorkday:13,planningScheduleWorkDays:62,processSchedules:[{processScheduleId:655,processScheduleName:"龙湖集团:自建工序9-1",startDate:"2021-08-24T00:00:00.000+0800",endDate:"2021-10-24T00:00:00.000+0800",status:2,actuleRatio:null,emergencyDegree:0}]},{engineeringScheduleId:14185,milestoneId:0,engineeringName:"龙湖集团:自建工程10",startDate:"2021-08-24T00:00:00.000+0800",endDate:"2021-11-30T00:00:00.000+0800",status:0,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:0,planningScheduleWorkDays:0,processSchedules:[]},{engineeringScheduleId:14352,milestoneId:0,engineeringName:"龙湖集团:自建工程11",startDate:"2021-10-13T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:0,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:0,planningScheduleWorkDays:0,processSchedules:[]},{engineeringScheduleId:14355,milestoneId:0,engineeringName:"龙湖集团:自建工程12",startDate:"2021-10-14T00:00:00.000+0800",endDate:"2022-08-31T00:00:00.000+0800",status:0,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:0,planningScheduleWorkDays:0,processSchedules:[]},{engineeringScheduleId:14504,milestoneId:917,engineeringName:"龙湖集团:自建工程13",startDate:"2021-10-25T00:00:00.000+0800",endDate:"2021-12-30T00:00:00.000+0800",status:0,actuleRatio:null,emergencyDegree:0,actualScheduleWorkday:0,planningScheduleWorkDays:0,processSchedules:[]}],projectMilestoneList:[{name:"开工",code:"7",deadline:"2021-08-01T00:00:00.000+0800",emergencyDegree:0,milestoneRate:0},{name:"出±0",code:"1",deadline:"2021-11-23T00:00:00.000+0800",emergencyDegree:1,milestoneRate:.0702},{name:"主体结构完成",code:"2",deadline:"2021-12-30T00:00:00.000+0800",emergencyDegree:0,milestoneRate:0}]};let engineeringScheduleList=projectData.engineeringScheduleList.map(n=>({...n,_type:"engineering",_id:n.engineeringScheduleId,_name:n.engineeringName,_isExpanded:!1,processSchedules:n.processSchedules.map(r=>({...r,_type:"process",_id:r.processScheduleId,_parentId:n.engineeringScheduleId,_name:r.processScheduleName,_isExpanded:!1}))}));const projectMilestoneList=[...projectData.projectMilestoneList.map(n=>({name:n.name,xAxis:new Date(n.deadline).getTime()})),{name:"今日",xAxis:new Date().getTime()}];let dataZoomStart=0;const valueSpanIndex=5,renderChart=n=>{const i=Array.from({length:6},(e,t)=>16848e6/Math.pow(2,5-t)),g=[{type:"slider",show:!1,filterMode:"none",xAxisIndex:[0,1],start:n,minValueSpan:i[valueSpanIndex],maxValueSpan:i[valueSpanIndex]},{id:"zoomX",type:"inside",filterMode:"none",xAxisIndex:[0,1],zoomLock:!0,preventDefaultMouseMove:!1}],w=[{type:"slider",show:!1,filterMode:"none",yAxisIndex:0,minValueSpan:window.innerHeight/80,maxValueSpan:window.innerHeight/80},{type:"inside",filterMode:"none",yAxisIndex:0,zoomLock:!0,moveOnMouseMove:!0,preventDefaultMouseMove:!0}],A=[...g,...w],h=210,E={top:6,right:0,bottom:0,left:h,containLabel:!0},F=new Date(new Date(projectData.startDate).setDate(1)).getTime(),S={type:"time",position:"top",min:F,axisLabel:{margin:6,formatter:"{yyyy}.{MM}",color:"#6F6F6F",fontSize:10,align:"left"},axisLine:{show:!1},axisTick:{show:!1},splitArea:{show:!1}},k=[{...S,minInterval:864e5*7,axisLabel:{show:!0,margin:12,formatter(){return valueSpanIndex>=5?"{yyyy}.{MM}":"{yyyy}.{MM}.{dd}"},hideOverlap:!0,color:"#848484",fontSize:10,align:"left"},axisLine:{show:!0,lineStyle:{color:"#DCDFE7",width:18,cap:"butt"}}},{...S,offset:28,minInterval:valueSpanIndex>3?864e5*30*4:void 0,maxInterval:valueSpanIndex>3?864e5*30*4:void 0,splitNumber:valueSpanIndex<=3&&1,axisLabel:{margin:4,formatter(e){const t=new Date(e).getMonth();return t<3?"Q1":t<6?"Q2":t<9?"Q3":"Q4"},color:"#848484",fontSize:12,align:"left"},axisLine:{show:!0,lineStyle:{color:"#EAEAEA",width:.5}}}],_={inverse:!0,interval:1,axisLabel:{show:!1},axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},splitArea:{show:!0,areaStyle:{color:engineeringScheduleList.map(e=>e._type==="engineering"&&!e._isExpanded?"white":e.status===1?"#FFEEEE":"#EBF3FE")}},min:0,max:engineeringScheduleList.length},L=["未开始","进行中","已完工","待确认","已拒绝"],R=(e,t,l)=>({type:"circle",z2:3,textContent:{style:{y:-1.6,text:t?"-":"+",textFill:l===1?"#FF6E6E":"#3688F6",fontSize:"16px"}},textConfig:{position:"inside"},shape:{r:8},style:{fill:l===1?"#FFEEEE":"#EBF3FE"},ignore:!e}),N=(e,t)=>{const l=e.dataIndexInside,{_type:a,_name:x,_isExpanded:T,actuleRatio:o=0,status:d,processSchedules:p}=engineeringScheduleList[l],u=a==="engineering"&&!!p.length,c=t.coord([t.value(0),l]),s=t.coord([t.value(1),l])[0]-c[0],I=t.size([0,1])[1],D=I*(a==="engineering"?.48:.24),[b,C]=c,f=`${o||0}% (${L[d]})`,z=f.length*11+(u?24:4);return{type:"group",id:"ganttItem",position:[b,C+(I-D)/2],children:[{type:"rect",textContent:{style:{text:f,textFill:"#323232"},ignore:a==="process"},textConfig:{position:"insideLeft"},shape:{width:s,height:D,r:3},style:{fill:d===1?a==="engineering"?"#FF6E6E":"#FFA8A8":a==="engineering"?"#378DFF":"#9AC3FA"}},{type:"rect",shape:{width:s*o/100,height:D/3,r:3},style:{fill:d===1?"#E64A4A":"#006CCF"},ignore:!o}]}},W=(e,t)=>{const l=e.dataIndexInside,{_type:a,_name:x,_isExpanded:T,status:o,processSchedules:d}=engineeringScheduleList[l],p=a==="engineering"&&!!d.length,u=t.coord([0,t.value(0)])[1],c=24,y=6,s=t.size([0,1])[1]*.8;if(!(u<e.coordSys.y-s))return{type:"group",position:[c,u+s/8],children:[a==="engineering"?{type:"rect",z2:1,shape:{width:h-c-y,height:s,r:3},style:{fill:"white"}}:{type:"group",children:[{type:"polyline",shape:{points:[[10,-48],[10,s/2],[16,s/2]]},style:{fill:"transparent",stroke:"#D6D6D6"}},{type:"circle",shape:{cx:20,cy:s/2,r:2},style:{fill:o===1?"#FF5252":"#3688F6"}}]},{type:"group",position:[12,s/2],children:[R(p,T,o),{type:"text",z2:3,style:{x:a==="engineering"?12:16,y:-6,text:x,textFill:a==="engineering"?"#323232":"#5B5B5B",fontWeight:a==="engineering"&&"bold"}}]},{type:"text",z2:5,style:{x:h-c-y-12,y:s/2-8,text:">",textFill:"#D6D6D6"}}]}},m={symbol:["emptyCircle"],animation:!1,data:projectMilestoneList.map(e=>({...e,y:40,label:{show:!1,silent:!0,position:"start"},lineStyle:{color:"#F2BA40",opacity:.5},emphasis:{label:{show:!0,opacity:1,formatter(t){return`{a|${t.name}}
{b|${new Date(t.value).getMonth()+1}.${new Date(t.value).getDate()}}`},rich:{a:{color:"#464646",fontSize:16},b:{color:"#999",fontSize:10,padding:[2,0,2,0]}}},lineStyle:{color:"#205294"}}}))},M=[{...{type:"custom",clip:!0,data:engineeringScheduleList.map(e=>[new Date(e.startDate).getTime(),new Date(e.endDate).getTime()]),renderItem:N,xAxisIndex:0,encode:{x:[0,1],y:0},markLine:m},markLine:{...m,data:m.data.map(e=>({...e,y:44,emphasis:{label:{show:!1}}}))}},{type:"custom",data:engineeringScheduleList.map(e=>[new Date(e.startDate).getTime(),new Date(e.endDate).getTime()]),renderItem:()=>null,xAxisIndex:1,encode:{x:[0,1],y:0}},{type:"custom",data:engineeringScheduleList.map((e,t)=>[t]),renderItem:W,encode:{x:-1,y:0}}];myChart.setOption({dataZoom:A,grid:E,xAxis:k,yAxis:_,series:M,backgroundColor:"#F8F9FB"})},resizeChart=()=>{setTimeout(()=>{myChart.resize({height:window.innerHeight})})};renderChart(),resizeChart(),myChart.on("click","series.custom",n=>{if(n.componentSubType!=="custom")return;const r=n.dataIndex,i=engineeringScheduleList[r];if(i._type==="engineering"){if(!i.processSchedules.length)return;i._isExpanded?engineeringScheduleList=engineeringScheduleList.filter(g=>g._parentId!==i._id):engineeringScheduleList.splice(r+1,0,...i.processSchedules),engineeringScheduleList[r]._isExpanded=!engineeringScheduleList[r]._isExpanded,renderChart(dataZoomStart),resizeChart()}else emit("clickProcess",i)}),myChart.on("dataZoom",n=>{!n.batch||(dataZoomStart=n.batch[0].start)});
