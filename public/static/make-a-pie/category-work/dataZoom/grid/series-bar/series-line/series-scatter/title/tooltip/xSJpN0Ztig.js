function randInt(e){return parseInt(e*Math.random())}function genData(e,i,n){const a=[];for(let s=0;s<n;s++)e+=i[randInt(i.length)],e=Math.abs(e),a.push([s,e]);return a}function calcPnlAndPos(e,i){return e.reduce((n,a)=>[n[0]+a[2]*(i-a[1]),n[1]+a[2]],[0,0])}const data={},length=600;data.price=genData(3210,[-5,0,5],length),data.vol=genData(20,[-1,0,1],length),data.bidVol=genData(20,[-1,0,1],length),data.askVol=genData(20,[-1,0,1],length),data.bidPrice=data.price.map(([e,i])=>[e,i+5*randInt(2)]),data.askPrice=data.price.map(([e,i])=>[e,i-5*randInt(2)]);let com=0;const comRate=.001;data.com=[[0,0]],data.orders=[],data.pnl=[[0,0]],data.npnl=[[0,0]],data.pos=[[0,0]];for(let e=1;e<length;e++){data.price[e][1]>data.price[e-1][1]?(data.orders.push([data.price[e][0],data.price[e][1],1]),com+=data.price[e][1]*comRate):data.price[e][1]<data.price[e-1][1]&&(data.orders.push([data.price[e][0],data.price[e][1],-1]),com+=data.price[e][1]*comRate),data.com.push([e,com]);let[i,n]=calcPnlAndPos(data.orders,data.price[e][1]);data.pnl.push([e,i]),data.npnl.push([e,i-com]),data.pos.push([e,n])}option={title:{text:"Intraday Chart",x:"center",y:0},dataZoom:[{id:"dataZoomX",type:"slider",xAxisIndex:[0,1,2],filterMode:"filter",start:0,end:100,zoomLock:!1},{type:"inside"}],tooltip:{trigger:"axis",axisPointer:{animation:!1}},grid:[{x:"7%",y:"7%",width:"85%",height:"20%"},{x:"7%",y:"32%",width:"85%",height:"30%"},{x:"7%",y:"67%",width:"85%",height:"25%"}],xAxis:[{gridIndex:0},{gridIndex:1},{gridIndex:2}],yAxis:[{gridIndex:0,boundaryGap:["10%","10%"]},{gridIndex:0,boundaryGap:["10%","10%"]},{gridIndex:1,boundaryGap:["10%","10%"],scale:!0},{gridIndex:2,min:0,max:100},{gridIndex:2,min:-100,max:50},{gridIndex:2,min:-50,max:100,inverse:!0,show:!1}],series:[{name:"pnl",type:"line",xAxisIndex:0,yAxisIndex:0,showSymbol:!1,hoverAnimation:!1,data:data.pnl},{name:"commission",type:"line",xAxisIndex:0,yAxisIndex:0,showSymbol:!1,hoverAnimation:!1,data:data.com},{name:"net pnl",type:"line",xAxisIndex:0,yAxisIndex:0,showSymbol:!1,hoverAnimation:!1,data:data.npnl},{name:"position",type:"bar",xAxisIndex:0,yAxisIndex:1,data:data.pos},{name:"orders",type:"scatter",xAxisIndex:1,yAxisIndex:2,symbolSize:(e,i)=>Math.abs(e[2])*4,itemStyle:{normal:{color:({data:e})=>e[2]>0?"red":"green"}},hoverAnimation:!1,data:data.orders},{name:"price",type:"line",xAxisIndex:1,yAxisIndex:2,showSymbol:!1,hoverAnimation:!1,data:data.price},{name:"bid price",type:"line",xAxisIndex:1,yAxisIndex:2,showSymbol:!1,hoverAnimation:!1,data:data.bidPrice},{name:"ask price",type:"line",xAxisIndex:1,yAxisIndex:2,showSymbol:!1,hoverAnimation:!1,data:data.askPrice},{name:"volume",type:"bar",xAxisIndex:2,yAxisIndex:3,data:data.vol},{name:"bid volume",type:"bar",xAxisIndex:2,yAxisIndex:4,data:data.bidVol},{name:"ask volume",type:"bar",xAxisIndex:2,yAxisIndex:5,data:data.askVol}]};
