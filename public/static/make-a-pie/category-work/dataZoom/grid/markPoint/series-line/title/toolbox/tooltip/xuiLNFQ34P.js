const rnd=()=>.2*Math.random()-.1+.003,randomWalk=t=>{const e=[1];for(let o=1;o<t;o++)e[o]=Number((e[o-1]*(1+rnd())).toFixed(2));return e},prices=JSON.parse(localStorage.getItem("rnd_prices")),getInfinity=t=>{const e=[],o=[];let r=0;for(let i=1;i<t.length-1;i++){const c=t[i-1],s=t[i],l=t[i+1];s<=c&&s<l&&(e.push(i),r-=s),s>c&&s>=l&&(o.push(i),r+=s)}return o[0]<e[0]&&(e.unshift(0),r-=t[0]),e[e.length-1]>o[o.length-1]&&(o.push(t.length-1),r+=t[t.length-1]),{bIdxs:e,sIdxs:o,value:r}},dropMinTrade=(t,{bIdxs:e,sIdxs:o,value:r})=>{let i=0,c=0,s=t[o[0]]-t[e[0]];for(let l=1;l<e.length;l++){const f=t[o[l]]-t[e[l]],d=t[o[l-1]]-t[e[l]];f<s&&(i=l,c=l,s=f),d<s&&(i=l,c=l-1,s=d)}return e.splice(i,1),o.splice(c,1),r=r-s,{bIdxs:e,sIdxs:o,value:r}},getKMax=(t,e)=>{let o=getInfinity(t);if(e>=o.bIdxs.length)return o;for(;o.bIdxs.length>e;)o=dropMinTrade(t,o);return o},getDPKMax=(t,e)=>{const{bIdxs:o,sIdxs:r,value:i}=getInfinity(t);if(e>=o.length)return{bIdxs:o,sIdxs:r,value:i};const c=t.length,s=e*2,l=[],f=[];for(let n=0;n<=s;n++)l[n]=Array(c+1-n).fill(0),f[n]=Array(c+1-n).fill(0);for(let n=1;n<=s;n++){const h=n%2===0?-1:1;for(let a=c-1-n;a>=0;a--)l[n-1][a+1]+h*t[a]>l[n][a+1]?(l[n][a]=l[n-1][a+1]+h*t[a],f[n][a]=f[n-1][a+1]+","+a):(l[n][a]=l[n][a+1],f[n][a]=f[n][a+1])}const d=l[s][0],m=f[s][0].split(",").slice(1).map(Number).reverse();return{value:d,bIdxs:m.filter((n,h)=>h%2===0),sIdxs:m.filter((n,h)=>h%2===1)}},dataSet=prices.map((t,e)=>[e,t]),shDataUrl="https://money.finance.sina.com.cn/quotes_service/api/json_v2.php/CN_MarketData.getKLineData?symbol=sh000001&scale=240&ma=no&datalen=8000",{bIdxs,sIdxs}=getKMax(prices,6),markPoints=[];bIdxs.forEach(t=>{markPoints.push({name:"买点",coord:[t,dataSet[t][1]],symbolOffset:[0,10],itemStyle:{color:"red"}})}),sIdxs.forEach(t=>{markPoints.push({name:"卖点",coord:[t,dataSet[t][1]],symbolOffset:[0,-10],itemStyle:{color:"yellowgreen"}})}),option={backgroundColor:"#080b30",title:{text:"quan-infinity",textStyle:{color:"#fff"}},tooltip:{trigger:"axis",formatter:t=>{const e=t[0];return e.marker+e.data[0]+", "+e.data[1]}},grid:{left:64,right:16,bottom:80},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{axisLine:{show:!0,lineStyle:{color:"rgba(255,255,255,0.3)"}},axisTick:{show:!1},splitLine:{show:!1}},yAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"rgba(255,255,255,0.3)"},splitLine:{show:!0,lineStyle:{color:"rgba(255,255,255,0.3)"}}},dataZoom:[{type:"inside",start:0,end:1e3},{start:0,end:1e3,handleIcon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"80%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}],series:[{type:"line",lineStyle:{color:"#6c50f3"},markPoint:{symbol:"circle",symbolSize:10,data:markPoints},data:dataSet}]};
