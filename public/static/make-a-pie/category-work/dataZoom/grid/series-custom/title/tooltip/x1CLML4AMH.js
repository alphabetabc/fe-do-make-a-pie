var data=[],dataCount=20,startTime=+new Date,categories=["深睡","浅睡","REM","清醒"],types=[{name:"深睡",color:"#764497"},{name:"浅睡",color:"#4CBAEB"},{name:"REM",color:"#F0843E"},{name:"清醒",color:"#F1D31E"}],baseTime=startTime;const linedata=[];let pre=null;const indexFn=()=>{const e=Math.round(Math.random()*3);return e===pre?indexFn():e};for(var i=0;i<dataCount;i++){const e=indexFn();pre=e;const o=types[e],t=Math.round(Math.random()*1e3*60+1e3)*Math.round(Math.random()*30+50);data.push({name:o.name,value:[e,baseTime,baseTime+t,t],itemStyle:{normal:{color:o.color}}}),linedata.push([baseTime,o.name,e]),linedata.push([baseTime+t,o.name,e]),baseTime+=t}function renderItem(e,o){var t=o.value(0),n=o.coord([o.value(1),t]),r=o.coord([o.value(2),t]),a=o.size([0,1])[1]*.5,l=echarts.graphic.clipRectByRect({x:n[0],y:n[1]-a/2,width:r[0]-n[0],height:a},{x:e.coordSys.x,y:e.coordSys.y,width:e.coordSys.width,height:e.coordSys.height});return l&&{type:"rect",transition:["shape"],shape:l,style:o.style()}}linedata.pop(),linedata.shift();const newData=[];linedata.forEach((e,o)=>{o%2===0&&newData.push([e,linedata[o+1]])}),console.log(moment(startTime).format("HH:mm")),option={tooltip:{formatter:function(e){console.log(e);const o=moment.duration(e.value[3]).hours(),t=moment.duration(e.value[3]).minutes();let n="";return o>0?n=o+"小时"+t+"分钟":n=t+"分钟",console.log(moment(e.value[1]).format("HH:mm")),e.marker+moment(e.value[1]).format("HH:mm")+"-"+moment(e.value[2]).format("HH:mm")+" | "+e.name+": "+n}},title:{text:"Profile",left:"center"},grid:{height:200},xAxis:{min:startTime,scale:!0,interval:6e5*5,axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{formatter:function(e){return moment(e).format("HH:mm")}}},yAxis:{data:categories,axisTick:{show:!1},axisLine:{show:!1}},series:[{type:"custom",renderItem,itemStyle:{opacity:1},encode:{x:[1,2],y:0},data},...newData.map((e,o)=>{let t=types.find(r=>r.name===e[0][1]).color,n=types.find(r=>r.name===e[1][1]).color;if(e[0][2]>e[1][2]){const r=t;t=n,n=r}return e[0][0]=e[0][0]-3e4,e[1][0]=e[1][0]+3e4,console.log(e,"--"),{type:"line",symbol:"none",smooth:!0,lineStyle:{width:3,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:1,color:t},{offset:.8,color:t},{offset:.2,color:n},{offset:0,color:n}],global:!1}},data:e}})]};
