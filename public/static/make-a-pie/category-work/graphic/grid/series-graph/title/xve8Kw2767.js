var xydata=[[0,1],[1,2],[2,3]],dataArr=[{name:"A",value:[15,50]},{name:"B",value:[-50,10]},{name:"C",value:[-55,-70]},{name:"D",value:[40,-40]}],symbolSize=70,position=0,positionSource,positionTarget,ok=1,del,links=xydata.map(function(e,t){return{source:xydata[t][0],target:xydata[t][1]}}),option={title:{text:"可拖动流程图"},grid:{},xAxis:{min:-100,max:100,type:"value",axisLine:{onZero:!1},show:!1},yAxis:{min:-100,max:100,type:"value",axisLine:{onZero:!1},show:!1},series:[{id:"a",type:"graph",layout:"none",coordinateSystem:"cartesian2d",symbolSize,label:{show:!0,formatter:function(e,t){return dataArr[e.dataIndex].name}},itemStyle:{borderColor:"#22faf7",borderWidth:3,color:"#123456"},edgeSymbol:["circle","arrow"],edgeSymbolSize:[4,10],data:echarts.util.map(dataArr,function(e,t){return e.value}),edges:links,lineStyle:{normal:{color:"#22faf7"}}}]};setTimeout(function(){initGraphic(),window.addEventListener("resize",updatePosition)},0);function updatePosition(){myChart.setOption({graphic:echarts.util.map(dataArr,function(e,t){return{position:myChart.convertToPixel("grid",e.value)}})})}function initGraphic(){myChart.setOption({graphic:echarts.util.map(dataArr,function(e,t){return{type:"circle",position:myChart.convertToPixel("grid",e.value),shape:{r:symbolSize/2-2},style:{fill:"#3FA7DC50",borderColor:"#22faf7",borderWidth:1},invisible:!1,draggable:!0,onclick:echarts.util.curry(initLinks,t),onmouseup:echarts.util.curry(onPointDragging,t),z:100}})})}function onPointDragging(e,t,r){dataArr[e].value=myChart.convertFromPixel("grid",this.position),myChart.setOption({series:[{id:"a",data:dataArr}]})}function initLinks(e){for(var t=0;t<dataArr.length;t++)if(t==e){if(ok=0,position==0)positionSource=t,position=1;else{positionTarget=t,position=0,xydata.push([positionSource,positionTarget]);var r=xydata.map(function(i,a){return{source:xydata[a][0],target:xydata[a][1]}});return myChart.setOption({series:[{edges:r,lineStyle:{normal:{color:"#22faf7"}}}]}),!0}break}}myChart.on("click",function(e){if(!(e.componentType!="series"||e.dataType!="edge")){for(var t=[e.data.source,e.data.target],r=0;r<xydata.length;r++)if(e.data.source==xydata[r][0]&&e.data.target==xydata[r][1]){del=r,xydata.splice(del,1);var i=xydata.map(function(a,o){return{source:xydata[o][0],target:xydata[o][1]}});return myChart.setOption({series:[{edges:i}]}),!0}}});
