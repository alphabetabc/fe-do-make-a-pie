var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),imgData,currentImg,config={scale:.25,roughness:.53,metalness:.81,projection:"orthographic",depthOfField:0,lockY:!1,move:!0,sameColor:!1,color:"#777",colorContrast:1.4,lightIntensity:10,lightColor:"#fff",lightRotate:30,lightPitch:10,AO:1.5,showEnvironment:!1,barNumber:152,barBevel:.44,barSize:1};option={tooltip:{},backgroundColor:"#000",xAxis3D:{type:"value"},yAxis3D:{type:"value"},zAxis3D:{type:"value",min:0,max:100},grid3D:{show:!1,viewControl:{projection:"perspective",alpha:45,beta:-45,panSensitivity:config.move?1:0,rotateSensitivity:config.lockY?[1,0]:1,damping:.9,distance:60},postEffect:{enable:!0,bloom:{intensity:.2},screenSpaceAmbientOcclusion:{enable:!0,intensity:1.5,radius:5,quality:"high"},screenSpaceReflection:{enable:!0},depthOfField:{enable:!0,blurRadius:config.depthOfField,fstop:10,focalDistance:55}},boxDepth:100,boxHeight:20,environment:"none",light:{main:{shadow:!0,intensity:2},ambientCubemap:{texture:"/asset/get/s/data-1491838644249-ry33I7YTe.hdr",exposure:2,diffuseIntensity:.2,specularIntensity:1.5}}}};function updateData(e,t,r){console.time("update");var a=[],u={getItem:function(n){var o=e[n*4],s=e[n*4+1],l=e[n*4+2],i=.2125*o+.7154*s+.0721*l;return i=(i-125)*config.scale+50,a[0]=n%t,a[1]=r-Math.floor(n/t),a[2]=i,a},count:function(){return e.length/4}};myChart.setOption({grid3D:{boxWidth:100/r*t},series:[{animation:!1,type:"bar3D",shading:"realistic",realisticMaterial:{roughness:config.roughness,metalness:config.metalness},barSize:config.barSize,bevelSize:config.barBevel,silent:!0,itemStyle:{color:config.sameColor?config.color:function(n){var o=n.dataIndex,s=e[o*4]/255,l=e[o*4+1]/255,i=e[o*4+2]/255,c=.2125*s+.7154*l+.0721*i;return s*=c*config.colorContrast,l*=c*config.colorContrast,i*=c*config.colorContrast,[s,l,i,1]}},data:u}]}),setTimeout(function(){myChart.getZr().refresh()},100)}function loadImage(e){var t=canvas.height=Math.min(config.barNumber,e.height),r=e.width/e.height,a=canvas.width=Math.round(t*r);ctx.drawImage(e,0,0,a,t),imgData=ctx.getImageData(0,0,a,t),updateData(imgData.data,a,t)}function updateDataWhenChange(){imgData&&updateData(imgData.data,imgData.width,imgData.height)}function updateControlAndLight(){myChart.setOption({grid3D:{environment:config.showEnvironment?"auto":"#000",viewControl:{panSensitivity:config.move?1:0,rotateSensitivity:config.lockY?[1,0]:1},light:{main:{intensity:config.lightIntensity,color:config.lightColor,alpha:config.lightPitch,beta:config.lightRotate},ambientCubemap:{texture:"/asset/get/s/data-1491838644249-ry33I7YTe.hdr"}},postEffect:{screenSpaceAmbientOcclusion:{intensity:config.AO}}}})}function readFile(e){if(!(!e||!e.type.match(/image/))){var t=new FileReader;t.onload=function(r){img=new Image,img.onload=function(){loadImage(img),currentImg=img},img.src=r.target.result},t.readAsDataURL(e)}}$('<div id="image-upload">将图片拖到此处或点击上传</div>').appendTo($("#chart-panel")).css({width:"200px",height:"50px","line-height":"50px","text-align":"center",cursor:"pointer","font-size":"12px",background:"rgba(0, 255, 255, 0.1)","border-radius":"4px",border:"1px dashed #0ff",position:"absolute",right:"10px",bottom:"10px","z-index":"10",color:"#0ff"}),$("#image-upload").on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),$("#image-upload")[0].addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;return readFile(t[0])}),$("#image-upload").on("click",function(){var e=$('<input type="file" />');e.on("change",function(t){readFile(t.target.files[0])}),e.click()});var img=new Image;img.onload=function(){loadImage(img),currentImg=img},img.src="/asset/get/s/data-1627544052697-LqMgjlaLP.png";
