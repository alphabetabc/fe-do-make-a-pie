function getParametricEquation(i,a,o,l){let n=(i+a)/2,s=i*Math.PI*2,h=a*Math.PI*2,e=n*Math.PI*2;i===0&&a===1&&(o=!1);let r=o?Math.sin(e)*.1:0,d=o?Math.cos(e)*.1:0,p=l?1.05:1;return{u:{min:0,max:Math.PI*2,step:Math.PI/100},v:{min:0,max:Math.PI,step:Math.PI/50},x:function(t,M){if(n-.5<0){if(t<s||t>e+Math.PI)return tmp=t-Math.PI-e<0?t+Math.PI-e:t-Math.PI-e,r+Math.sin(s)*tmp/(Math.PI-e+s)*p;if(t>h&&t<e+Math.PI)return tmp=e+Math.PI-t,r+Math.sin(h)*tmp/(Math.PI-e+s)*p}else{if(t<s&&t>e-Math.PI)return tmp=t+Math.PI-e,r+Math.sin(s)*tmp/(Math.PI-e+s)*p;if(t>h||t<e-Math.PI)return tmp=e-Math.PI-t<0?e+Math.PI-t:e-Math.PI-t,r+Math.sin(h)*tmp/(Math.PI-e+s)*p}return r+Math.sin(M)*Math.sin(t)*p},y:function(t,M){if(n-.5<0){if(t<s||t>e+Math.PI)return tmp=t-Math.PI-e<0?t+Math.PI-e:t-Math.PI-e,d+Math.cos(s)*tmp/(Math.PI-e+s)*p;if(t>h&&t<e+Math.PI)return tmp=e+Math.PI-t,d+Math.cos(h)*tmp/(Math.PI-e+s)*p}else{if(t<s&&t>e-Math.PI)return tmp=t+Math.PI-e,d+Math.cos(s)*tmp/(Math.PI-e+s)*p;if(t>h||t<e-Math.PI)return tmp=e-Math.PI-t<0?e+Math.PI-t:e-Math.PI-t,d+Math.cos(h)*tmp/(Math.PI-e+s)*p}return d+Math.sin(M)*Math.cos(t)*p},z:function(t,M){return Math.cos(M)>0?.1:-.1}}}function getPie3D(i){let a=[],o=0,l=0,n=0,s=[];for(let e=0;e<i.length;e++){o+=i[e].value;let r={name:typeof i[e].name>"u"?`series${e}`:i[e].name,type:"surface",parametric:!0,wireframe:{show:!1},pieData:i[e],pieStatus:{selected:!1,hovered:!1}};if(typeof i[e].itemStyle<"u"){let d={};typeof i[e].itemStyle.color<"u"&&(d.color=i[e].itemStyle.color),typeof i[e].itemStyle.opacity<"u"&&(d.opacity=i[e].itemStyle.opacity),r.itemStyle=d}a.push(r)}for(let e=0;e<a.length;e++)n=l+a[e].pieData.value,a[e].pieData.startRatio=l/o,a[e].pieData.endRatio=n/o,a[e].parametricEquation=getParametricEquation(a[e].pieData.startRatio,a[e].pieData.endRatio,!1,!1),l=n,s.push(a[e].name);a.push({name:"mouseoutSeries",type:"surface",parametric:!0,wireframe:{show:!1},itemStyle:{opacity:0},parametricEquation:{u:{min:0,max:Math.PI*2,step:Math.PI/20},v:{min:0,max:Math.PI,step:Math.PI/20},x:function(e,r){return Math.sin(r)*Math.sin(e)+Math.sin(e)},y:function(e,r){return Math.sin(r)*Math.cos(e)+Math.cos(e)},z:function(e,r){return Math.cos(r)>0?.1:-.1}}});let h={legend:{data:s},tooltip:{formatter:e=>{if(e.seriesName!=="mouseoutSeries")return`${e.seriesName}<br/><span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${e.color};"></span>${h.series[e.seriesIndex].pieData.value}`}},xAxis3D:{min:-1,max:1},yAxis3D:{min:-1,max:1},zAxis3D:{min:-1,max:1},grid3D:{show:!1,boxHeight:30,bottom:"50%"},series:a};return h}option=getPie3D([{name:"aa",value:11,itemStyle:{opacity:.5}},{name:"cc",value:33},{name:"bb",value:22,itemStyle:{color:"green"}}]);let selectedIndex="",hoveredIndex="";myChart.on("click",function(i){let a=!option.series[i.seriesIndex].pieStatus.selected,o=option.series[i.seriesIndex].pieStatus.hovered,l=option.series[i.seriesIndex].pieData.startRatio,n=option.series[i.seriesIndex].pieData.endRatio;selectedIndex!==""&&selectedIndex!==i.seriesIndex&&(option.series[selectedIndex].parametricEquation=getParametricEquation(option.series[selectedIndex].pieData.startRatio,option.series[selectedIndex].pieData.endRatio,!1,!1),option.series[selectedIndex].pieStatus.selected=!1),option.series[i.seriesIndex].parametricEquation=getParametricEquation(l,n,a,o),option.series[i.seriesIndex].pieStatus.selected=a,a&&(selectedIndex=i.seriesIndex),myChart.setOption(option)}),myChart.on("mouseover",function(i){let a,o,l,n;hoveredIndex!==i.seriesIndex&&(hoveredIndex!==""&&(a=option.series[hoveredIndex].pieStatus.selected,o=!1,l=option.series[hoveredIndex].pieData.startRatio,n=option.series[hoveredIndex].pieData.endRatio,option.series[hoveredIndex].parametricEquation=getParametricEquation(l,n,a,o),option.series[hoveredIndex].pieStatus.hovered=o,hoveredIndex=""),i.seriesName!=="mouseoutSeries"&&(a=option.series[i.seriesIndex].pieStatus.selected,o=!0,l=option.series[i.seriesIndex].pieData.startRatio,n=option.series[i.seriesIndex].pieData.endRatio,option.series[i.seriesIndex].parametricEquation=getParametricEquation(l,n,a,o),option.series[i.seriesIndex].pieStatus.hovered=o,hoveredIndex=i.seriesIndex),myChart.setOption(option))}),myChart.on("globalout",function(){hoveredIndex!==""&&(isSelected=option.series[hoveredIndex].pieStatus.selected,isHovered=!1,startRatio=option.series[hoveredIndex].pieData.startRatio,endRatio=option.series[hoveredIndex].pieData.endRatio,option.series[hoveredIndex].parametricEquation=getParametricEquation(startRatio,endRatio,isSelected,isHovered),option.series[hoveredIndex].pieStatus.hovered=isHovered,hoveredIndex=""),myChart.setOption(option)});
