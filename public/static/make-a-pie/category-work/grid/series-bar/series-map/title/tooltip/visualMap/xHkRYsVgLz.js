var typeArr=["鲜花","星星","香蕉","嫌弃"],typeIndex=1,selectedRange=null,option=null,str="",data=[],geoCoordMap={},name="虚拟地图区域柱状图",mapName="china",mapFeatures=echarts.getMap(mapName).geoJson.features;mapFeatures.forEach(function(e){var o=e.properties.name;geoCoordMap[o]=e.properties.cp,data.push({name:o,value:[{name:"鲜花",value:Math.round(Math.random()*100+10)},{name:"星星",value:Math.round(Math.random()*100+10)},{name:"香蕉",value:Math.round(Math.random()*100+10)},{name:"嫌弃",value:Math.round(Math.random()*100+10)}]})}),console.log("===========geoCoordMap===============");for(var i in geoCoordMap)console.log(geoCoordMap[i]);console.log(geoCoordMap),console.log("==============data==============="),console.log(data);function convertMapDta_bar(e,o){var n=[];return o.forEach(function(l){l.value.forEach(function(a){String(a.name)===String(e)&&n.push({name:l.name,value:a.value})})}),n}console.log("================mapData=================="),console.log(convertMapDta_bar(typeArr[typeIndex],data)),console.log("=========================================");function resetBar(e,o,n,l){var a=e.getOption(),c=a.series;c.forEach(function(t,u){if(u>0){var s=n[t.name],m=e.convertToPixel({seriesIndex:0},s);if(t.center=m,o!=0&&o.zoom&&(t.radius=t.radius*o.zoom),o!=0&&o.selected){var r=o.selected[0],f=o.selected[1],p=t.data[l].value;p<r||p>f?t.itemStyle.normal.opacity=0:t.itemStyle.normal.opacity=1}}}),e.setOption(a,!0)}function addBar(e,o){for(var n=e.getOption(),l=option.series,a=0;a<o.length;a++){var c=Math.round(Math.random()*30),t=c<=10?10:c,u=geoCoordMap[o[a].name];if(u){var s=[];o[a].value.map(function(r,f){s.push(r.value)});var m=e.convertToPixel({seriesIndex:0},u);console.log("================柱图数据=================="),console.log(s),console.log("================柱图位置=================="),console.log(m),console.log("================option操作数=================="),n.xAxis={type:"category",data:["鲜花","星星","香蕉","嫌弃"]},n.yAxis={type:"value"},console.log(n),l.push({name:o[a].name,type:"bar",tooltip:{formatter:function(r){return r.seriesName+"<br/>"+r.name+" : "+r.value}},radius:t,center:m,data:s,zlevel:4,label:{normal:{show:!1}},labelLine:{normal:{show:!1}},itemStyle:{mormal:{opacity:1}},itemStyle:{normal:{color:function(r){var f=["rgb(164,205,238)","rgb(42,170,227)","rgb(25,46,94)","rgb(195,229,235)"];return f[r.dataIndex]}},emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}})}}return l}option={xAxis:{type:"category",data:["鲜花","星星","香蕉","嫌弃"]},yAxis:{type:"value"},title:{text:name,left:"center",textStyle:{color:"black"}},tooltip:{trigger:"item",formatter:function(e){if(e.value)return e.name+"<br/>"+typeArr[typeIndex]+": "+e.value}},visualMap:{min:0,max:120,left:"right",top:"bottom",seriesIndex:0,text:["高","低"],calculable:!0,color:["#c05050","#e5cf0d","#5ab1ef"]},series:[{name:"chinaMap",type:"map",mapType:mapName,roam:!0,label:{normal:{show:!0},emphasis:{show:!0}},itemStyle:{normal:{areaColor:"#eee"}},data:convertMapDta_bar(typeArr[typeIndex],data)}]},option&&typeof option=="object"&&myChart.setOption(option,!0),addBar(myChart,data),console.log("===========option================="),console.log(option),myChart.setOption(option,!0),myChart.on("georoam",function(e){resetBar(myChart,e,geoCoordMap,typeIndex)}),myChart.on("datarangeselected",function(e){resetBar(myChart,e,geoCoordMap,typeIndex)}),window.addEventListener("resize",function(){myChart.resize(),resetBar(myChart,0,geoCoordMap)}),myChart.setOption(option);
