var stageProgress={fangAnTimeBucket:["2017-11-23","2017-11-28"],gangYaoTimeBucket:["2017-11-25","2017-11-30"],chengGuoTimeBucket:["2017-12-06","2017-12-12"],scheduledStartTime:"2017-11-23",validTime:"2017-12-02"},timeInterval={day:3600*1e3*24,month:3600*1e3*24*31,year:3600*1e3*24*31*12},xAxisLabelUnit={year:!1,month:!1,day:!1};function getProperTimeAxisInterval(){xAxisLabelUnit.year=!1,xAxisLabelUnit.month=!1,xAxisLabelUnit.day=!1;var e=getXAxisData(),t=getTimeMilliseconds(e[e.length-1]);console.log("begin "+t);var i=getTimeMilliseconds(e[e.length-1])-getTimeMilliseconds(e[0]);console.log("periodMillis "+i);var a=i/timeInterval.year;console.log("years "+a);var n=i/timeInterval.month;console.log("months "+n);var o=i/timeInterval.day;if(console.log("days "+o),n<=1)return xAxisLabelUnit.day=!0,timeInterval.day*2;if(n<=16)return xAxisLabelUnit.month=!0,timeInterval.month;if(n<=24)return xAxisLabelUnit.month=!0,timeInterval.month*2;if(a<=16)return xAxisLabelUnit.year=!0,timeInterval.year}function getXAxisData(){var e=new Array;return e=e.concat(stageProgress.scheduledStartTime).concat(stageProgress.fangAnTimeBucket).concat(stageProgress.gangYaoTimeBucket).concat(stageProgress.chengGuoTimeBucket).concat(stageProgress.validTime).filter(function(t){return t!="-"}).sort(),console.log(e),e}function changeDateToMonthFirstDay(e){var t=new Date(e);t.setDate(1);var i=t.getFullYear()+"-"+(t.getMonth()>=9?t.getMonth()+1:"0"+(t.getMonth()+1))+"-"+("0"+1);return i}function formatDateToStr(e){var t=e.getMonth(),i=e.getDate(),a=e.getFullYear()+"-"+(t>=9?t+1:"0"+(t+1))+"-"+(i>=9?i:"0"+i);return a}var faOnTimeCompletionTime=getOnTimeCompletionTime("方案",stageProgress.fangAnTimeBucket[0],stageProgress.fangAnTimeBucket[1]),gyOnTimeCompletionTime=getOnTimeCompletionTime("纲要",stageProgress.gangYaoTimeBucket[0],stageProgress.gangYaoTimeBucket[1]),cgOnTimeCompletionTime=getOnTimeCompletionTime("成果",stageProgress.chengGuoTimeBucket[0],stageProgress.chengGuoTimeBucket[1]),faOverTimeCompletionTime=getOverTimeCompletionTime("方案",stageProgress.fangAnTimeBucket[0],stageProgress.fangAnTimeBucket[1]),gyOverTimeCompletionTime=getOverTimeCompletionTime("纲要",stageProgress.gangYaoTimeBucket[0],stageProgress.gangYaoTimeBucket[1]),cgOverTimeCompletionTime=getOverTimeCompletionTime("成果",stageProgress.chengGuoTimeBucket[0],stageProgress.chengGuoTimeBucket[1]),timeArray={beginTimeArr:[getTimeMilliseconds(stageProgress.fangAnTimeBucket[0]),getTimeMilliseconds(stageProgress.gangYaoTimeBucket[0]),getTimeMilliseconds(stageProgress.chengGuoTimeBucket[0])],onTimeCompletionTimeArr:[getTimeMilliseconds(faOnTimeCompletionTime),getTimeMilliseconds(gyOnTimeCompletionTime),getTimeMilliseconds(cgOnTimeCompletionTime)],overTimeCompletionTimeArr:[getTimeMilliseconds(faOverTimeCompletionTime),getTimeMilliseconds(gyOverTimeCompletionTime),getTimeMilliseconds(cgOverTimeCompletionTime)]};option={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){console.log("params[2]"+JSON.stringify(e[2]));var t=e[0].axisValue+":<br />";return t+=e[0].seriesName+"："+getSeriesDateStr(e[0].data)+"<br />",t+="结束时间："+(e[2].data!="-"&&e[2].data!=null&&e[2].data!=null&&!isNaN(e[2].data)?getSeriesDateStr(e[2].data):!isNaN(e[1].data)&&e[1].data!=null&&e[1].data!=null?getSeriesDateStr(e[1].data):"-"),t}},toolbox:{right:"3%",show:!1,feature:{saveAsImage:{show:!0}}},legend:{data:["按时完成","超时完成"],tooltip:{show:!0},itemWidth:15,itemHeight:15,textStyle:{fontSize:16,fontFamily:"Microsoft YaHei"},itemGap:120,padding:10},grid:{left:"3%",right:"3%",bottom:"2%",containLabel:!0},xAxis:{type:"time",min:function(e){return e.min+(getTimeMilliseconds(getProperTimeAxisBeginAndEndTime()[0])-e.min)},max:function(e){return e.max+(getTimeMilliseconds(getProperTimeAxisBeginAndEndTime()[1])-e.max)},interval:getProperTimeAxisInterval(),axisLine:{lineStyle:{color:"#BDC8CD",width:1}},axisLabel:{showMinLabel:!1,showMaxLabel:!1,rotate:35,margin:12,fontSize:16,color:"#1c2431",formatter:function(e,t){var i=new Date(e),a=i.getFullYear();return xAxisLabelUnit.month&&(a+="."+(i.getMonth()+1)),xAxisLabelUnit.day&&(a+="."+(i.getMonth()+1)+"."+i.getDate()),a}},splitLine:{show:!1}},yAxis:{type:"category",data:[`方
案`,`纲
要`,`成
果`],axisTick:{show:!1},axisLine:{lineStyle:{color:"#e9e9ea",width:1}},axisLabel:{fontWeight:"bold",fontSize:16,color:"#1c2431",fontFamily:"Microsoft YaHei"},splitLine:{show:!0,lineStyle:{color:"#eaeae9",width:1}}},series:[{name:"开始时间",type:"bar",stack:"时间",itemStyle:{normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}},label:{normal:{formatter:function(e){return getSeriesDateStr(e.value)},show:!0,position:"insideRight",fontSize:16,color:"#1c2431",fontFamily:"Microsoft YaHei",offset:[40,-20]}},data:timeArray.beginTimeArr,markLine:{lineStyle:{normal:{color:"#0f77e9"}},label:{normal:{fontWeight:"bold",padding:2,fontSize:14,fontFamily:"Microsoft YaHei",formatter:function(e){return"计划开始时间 "+getSeriesDateStr(e.value)}}},data:[{name:"计划开始时间",xAxis:getTimeMilliseconds(stageProgress.scheduledStartTime)}]}},{name:"按时完成",type:"bar",stack:"时间",itemStyle:{normal:{color:"#0f77e9"}},label:{normal:{formatter:function(e){return getSeriesDateStr(e.value)},show:!0,fontSize:16,color:"#1c2431",position:"right",fontFamily:"Microsoft YaHei",offset:[-45,-20]}},data:timeArray.onTimeCompletionTimeArr,markLine:{lineStyle:{normal:{color:"#ff4747"}},label:{normal:{fontWeight:"bold",padding:2,fontSize:14,fontFamily:"Microsoft YaHei",formatter:function(e){return"计划完成时间 "+getSeriesDateStr(e.value)}}},data:[{name:"有效期",xAxis:getTimeMilliseconds(stageProgress.validTime)}]}},{name:"超时完成",type:"bar",stack:"时间",itemStyle:{normal:{color:"#ff4747"}},label:{normal:{formatter:function(e){return getSeriesDateStr(e.value)},show:!0,fontSize:16,color:"#1c2431",offset:[-45,-20],position:"right",fontFamily:"Microsoft YaHei"}},data:timeArray.overTimeCompletionTimeArr,barWidth:20}]};function getSeriesDateStr(e){if(e=="-")return e;var t=new Date(e),i="";return i+=t.getFullYear()+".",i+=t.getMonth()+1+".",i+=t.getDate(),i}function getOnTimeCompletionTime(e,t,i){var a=getTimeMilliseconds(stageProgress.validTime),n=getTimeMilliseconds(t),o=getTimeMilliseconds(i);if(a<=n)return"-";if(a>n&&a<o)return stageProgress.validTime;if(a>=o)return i}function getOverTimeCompletionTime(e,t,i){var a=getTimeMilliseconds(stageProgress.validTime),n=getTimeMilliseconds(t),o=getTimeMilliseconds(i);if(a<o)return i;if(a>=o)return"-"}function getTimeMilliseconds(e){return new Date(e).getTime()}function getProperTimeAxisBeginAndEndTime(){var e=getXAxisData(),t=e[0],i=e[e.length-1],a=new Date(t),n=new Date(i);if(xAxisLabelUnit.month)a.setDate(1),n.setMonth(n.getMonth()+1),n.setDate(1);else{var o=getProperTimeAxisInterval()/timeInterval.day;console.log("daysCount "+o),a.setDate(a.getDate()-o),n.setDate(n.getDate()+o)}var r=[formatDateToStr(a),formatDateToStr(n)];return console.log("beArr "+r),r}
