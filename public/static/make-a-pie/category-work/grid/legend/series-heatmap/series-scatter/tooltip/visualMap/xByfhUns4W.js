var gridCount=50,data=[1478729724,1479311478,1478761660,1479307021,1478729885,1479232519,1478732238,1479194757,1478711101,1479311996,1478707230,1479307195,1478730048,1479306188,1478707206,1479311128,1479085312,1479311271,1478711635,1479311998,1478728498,1479311999,1478731526,1479309311,1478730676,1479307276,1478728717,1479297930,1478767403,1479311994,1478818927,1479311998,1478724285,1479310387,1478707205,1479311390,1478731145,1479229316,1478775204,1479264482,1478707205,1479311879,1478707205,1479311994,1478707206,1479310890,1479003360,1479221106,1478727895,1479235223,1478707203,1479307996,1478707201,1479310388,1478724694,1479244875,1478709314,1479305480,1478730502,1479311506,1478747274,1479296426,1478707264,1479311999,1478727436,1479306982,1478707204,1479311994,1478707206,1479309008,1478707762,1479311957,1478731348,1479226004,1478732983,1479311296,1478758006,1479297177,1478732624,1479311995,1478707204,1479310260,1478727295,1479311997,1479009556,1479304022,1478728047,1479304756,1478731409,1479311994,1478738554,1479305618,1478838482,1479311994,1478707624,1479310732,1478707240,1479308394,1478718520,1479304536,1478734323,1479288904,1478707202,1479309501,1478713771,1479311859,1478708635,1479311478,1478707202,1479289802,1478731092,1479304848,1478731592,1479303829,1478724961,1479309346,1478731196,1479309348,1478707206,1479311560,1478707205,1479288653,1478730962,1479199476,1478707204,1479303015,1478731994,1479309152,1478728876,1479287088,1478707266,1479300729,1478708111,1479130712,1478731061,1479306130,1478733092,1479311651,1478726863,1479309931,1478818445,1479308438,1478818176,1479310822,1478732149,1479266358,1478707206,1479308779,1478730323,1479303450,1478728318,1479296128,1478708318,1479287815,1478726086,1479311998,1478733362,1479306667,1478846528,1479307204,1478707205,1479311971,1478728060,1479212106,1478731436,1479307836,1478723527,1479311991,1478732854,1479307296,1478739740,1479311998,1478727046,1479311994,1478707573,1479311652,1478707215,1479311986,1478745396,1479276767,1478751561,1479311996,1478708392,1479311994,1478725996,1479288990,1478707201,1479311991,1478732584,1479302518,1478708190,1479305596,1478708685,1479307847,1478707204,1479309067,1478707206,1479310392,1478845900,1479310515],startTime=[],endTime=[],heatmapData=[],durationLenData=[],rawData=[],maxCount=0,maxCarCount=0,maxDuration=0,minDuration,durationMap={};function runMe(){for(var a=[],t=1;t<data.length;t+=2)a.push({start:data[t-1],end:data[t]});minCount=a.length;var o=_.min(data),r=_.max(data),i=parseInt((r-o)/gridCount);minDuration=r-o,console.log(o,r,i);for(var e=0;e<gridCount+1;e++){var s=o+e*i;startTime.push(moment(s*1e3).format("YYYY/MM/DD HH:mm"));for(var l=0;l<gridCount+1;l++){var n=o+l*i;if(e===0&&endTime.push(moment(n*1e3).format("YYYY/MM/DD HH:mm")),!(l<=e)){heatmapData.push([e,l,calc(a,s,n)]),durationLenData.push([e,l,n-s]);var u=e+"-"+l;durationMap[u]=n-s,maxDuration<n-s&&(maxDuration=n-s),minDuration>n-s&&(minDuration=n-s)}}}calcRaw(a,o,i),console.log(maxDuration,minDuration)}function calc(a,t,o){var r=0;for(var i in a){var e=a[i];e.start<=t&&o<=e.end&&r++}return r>maxCount&&(maxCount=r),r<minCount&&(minCount=r),r}var pointMap={};function calcRaw(a,t,o){var r={};for(var i in a){var e=a[i],s=parseInt((e.start-t)/o),l=parseInt((e.end-t)/o),n=s+"-"+l;n in r?(e.end-e.start<r[n][0]&&(r[n][0]=e.end-e.start),r[n][1]=r[n][1]+1):r[n]=[e.end-e.start,1]}for(var u in r){var m=u.split("-"),v=moment.duration(r[u][0],"seconds");pointMap[u]={duration:v.days()+" days "+v.hours()+" hours",carCount:r[u][1]},rawData.push([parseInt(m[0]),parseInt(m[1]),v.days()+" days "+v.hours()+" hours"]),r[u][1]>maxCarCount&&(maxCarCount=r[u][1])}}runMe(),option={legend:{right:10,data:["Coverage","Duration length","Raw"]},animation:!1,grid:{height:"80%",y:"10%",x:"12%"},xAxis:{type:"category",data:startTime,splitArea:{show:!0}},yAxis:{type:"category",data:endTime,splitArea:{show:!0}},tooltip:{position:"right",formatter:function(a){var t=a.value[0]+"-"+a.value[1];if(a.seriesType=="heatmap")if(a.seriesName=="Coverage"){var o=moment.duration(durationMap[t]*1e3);return a.value[2]+" cars cover "+o.days()+" days "+o.hours()+" hours ("+startTime[a.value[0]]+" - "+endTime[a.value[1]]+")"}else{var r=moment.duration(a.value[2]*1e3);return r.days()+" days "+r.hours()+" hours"}else{var t=a.value[0]+"-"+a.value[1],i=pointMap[t];return i.duration+" ("+i.carCount+" cars. timeline ("+startTime[a.value[0]]+" - "+endTime[a.value[1]]+")"}}},visualMap:[{seriesIndex:0,min:0,max:maxCount,calculable:!0,orient:"horizontal",left:"center",bottom:"25%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}},{seriesIndex:1,min:minDuration,max:maxDuration,calculable:!0,orient:"horizontal",left:"center",bottom:"10%",inRange:{opacity:[0,.3],color:["#000","#333"]},formatter:function(a){var t=moment.duration(a*1e3);return t.days()+" days "+t.hours()+" hours"}}],series:[{name:"Coverage",type:"heatmap",data:heatmapData,label:{normal:{show:!1}},itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},animation:!1},{name:"Duration length",type:"heatmap",data:durationLenData,label:{normal:{show:!1}},itemStyle:{normal:{color:"#BCF"}}},{name:"Raw",type:"scatter",data:rawData,label:{normal:{show:!1}},itemStyle:{normal:{color:"rgb(0,180,20)"},emphasis:{shadowBlur:16,shadowColor:"rgba(0, 0, 200, 0.5)"}},animation:!1}]};
