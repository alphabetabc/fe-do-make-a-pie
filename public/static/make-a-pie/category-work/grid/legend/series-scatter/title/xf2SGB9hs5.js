for(var markUrl="/asset/get/s/data-1502962358603-HkJ6fkX_b.png",xDotCnt=20,yDotCnt=16,mineCnt=50,markedCnt=0,startTime=null,mines=[],isMarking=!1,series=[{name:"isNotOpen",type:"scatter",symbol:"rect",symbolSize:23,data:[],itemStyle:{normal:{color:"#c0c0c0",shadowColor:"#747474",shadowOffsetX:3,shadowOffsetY:3}}},{name:"mines",type:"scatter",symbol:"path://M1.04147922,4 C1.11795272,3.5441717 1.29721854,3.12319909 1.55462604,2.76173282 L0.818019485,2.02512627 L1.52512627,1.31801948 L2.26173282,2.05462604 C2.62319909,1.79721854 3.0441717,1.61795272 3.5,1.54147922 L3.5,0.5 L4.5,0.5 L4.5,1.54147922 C4.9558283,1.61795272 5.37680091,1.79721854 5.73826718,2.05462604 L6.47487373,1.31801948 L7.18198052,2.02512627 L6.44537396,2.76173282 C6.70278146,3.12319909 6.88204728,3.5441717 6.95852078,4 L8,4 L8,5 L6.95852078,5 C6.88204728,5.4558283 6.70278146,5.87680091 6.44537396,6.23826718 L7.18198052,6.97487373 L6.47487373,7.68198052 L5.73826718,6.94537396 C5.37680091,7.20278146 4.9558283,7.38204728 4.5,7.45852078 L4.5,8.5 L3.5,8.5 L3.5,7.45852078 C3.0441717,7.38204728 2.62319909,7.20278146 2.26173282,6.94537396 L1.52512627,7.68198052 L0.818019485,6.97487373 L1.55462604,6.23826718 C1.29721854,5.87680091 1.11795272,5.4558283 1.04147922,5 L0,5 L0,4 L1.04147922,4 Z M3,5 C3.55228475,5 4,4.55228475 4,4 C4,3.44771525 3.55228475,3 3,3 C2.44771525,3 2,3.44771525 2,4 C2,4.55228475 2.44771525,5 3,5 Z",symbolSize:[16,16],data:[],itemStyle:{normal:{color:"#000"}},z:10},{type:"scatter",name:"marker",data:[],symbol:"image://"+markUrl,symbolSize:20,z:100}],numColors=["#0B02B7","#147A14","#B61A1D","#0A0677","#6A030C","#187C79","#000","#7A7A7A"],i=-1;i<numColors.length;++i)series.push({name:"isOpen-"+(i+1),type:"scatter",symbol:"rect",symbolSize:24,data:[],itemStyle:{normal:{color:"#ccc"}},label:{normal:{show:!0,formatter:function(e){return e.data[2]||""},textStyle:{color:numColors[i]}}},z:5});series.push({type:"scatter",name:"标记",data:[]}),option={grid:{width:500,height:400,left:130,backgroundColor:"#eee",borderColor:"#fefefe",show:!0},xAxis:{min:-.5,max:xDotCnt-.5,type:"value",show:!1},yAxis:{min:-.5,max:yDotCnt-.5,type:"value",inverse:!0,show:!1},series,title:[{text:"扫雷"},{text:"剩余雷数："+mineCnt,top:480,left:"center"}],animation:!1,legend:{show:!0,itemWidth:25,itemHeight:25,left:330,data:[{name:"标记",icon:"image://"+markUrl}],selected:{标记:!1}}},setTimeout(function(){mines=initMines(),setOption()},0);var btn=document.createElement("button");btn.style.position="absolute",btn.style.top="50px",btn.style.marginLeft="10px",btn.setAttribute("onclick","restart()"),btn.innerHTML="重新开始",document.body.appendChild(btn),myChart.on("click",function(e){var a=e.data[0],t=e.data[1];if(isMarking){var r=series[2],n=!1;console.log(r.data);for(var o=0,l=r.data.length;o<l;++o)if(r.data[o][0]===a&&r.data[o][1]===t){r.data[o]="-",n=!0,mines[t][a].isMarked=!1,--markedCnt;break}!n&&!mines[t][a].isOpen&&(r.data.push([a,t]),mines[t][a].isMarked=!0,++markedCnt),myChart.setOption({series:r,title:[{},{text:"剩余雷数："+(mineCnt-markedCnt)}]})}else{var s=mines[t][a];if(s.isMarked)return;s.isMine?gameOver(a,t):(clearSeries(),open(a,t),setOption(),checkWin())}}),myChart.on("legendselectchanged",function(e){isMarking=e.selected.标记});function open(e,a){startTime||(startTime=new Date);var t=mines[a][e];t.isOpen||(t.isOpen=!0,t.mineNeighbors===0&&(e>0&&(open(e-1,a),a>0&&open(e-1,a-1),a<yDotCnt-1&&open(e-1,a+1)),a>0&&open(e,a-1),a<yDotCnt-1&&open(e,a+1),e<xDotCnt-1&&(open(e+1,a),a>0&&open(e+1,a-1),a<yDotCnt-1&&open(e+1,a+1))))}function gameOver(e,a){for(var t=[],r=0;r<yDotCnt;++r)for(var n=0;n<xDotCnt;++n)mines[r][n].isMine&&t.push([n,r]);if(series[1].data=t,e!==null){var o=getSeries(mines[a][e].mineNeighbors).data;o.push({value:[e,a],itemStyle:{normal:{color:"#f00"}}})}myChart.setOption({series})}window.restart=function(){initMines(),setOption(),series[2].data=[],isMarking=!1,markedCnt=0,startTime=null,myChart.setOption({series,legend:{selected:{标记:!1}},title:[{},{text:"剩余雷数："+mineCnt}]})};function initMines(){mines=[];for(var e=0;e<yDotCnt;++e){for(var a=[],t=0;t<xDotCnt;++t)a.push({isMine:!1,isOpen:!1,mineNeighbors:0});mines.push(a)}for(var r=0;r<mineCnt;++r){var t=Math.ceil(Math.random()*xDotCnt)-1,e=Math.ceil(Math.random()*yDotCnt)-1;if(mines[e][t].isMine){--r;continue}mines[e][t].isMine=!0,t>0&&(++mines[e][t-1].mineNeighbors,e>0&&++mines[e-1][t-1].mineNeighbors,e<yDotCnt-1&&++mines[e+1][t-1].mineNeighbors),e>0&&++mines[e-1][t].mineNeighbors,e<yDotCnt-1&&++mines[e+1][t].mineNeighbors,t<xDotCnt-1&&(++mines[e][t+1].mineNeighbors,e>0&&++mines[e-1][t+1].mineNeighbors,e<yDotCnt-1&&++mines[e+1][t+1].mineNeighbors)}return mines}function setOption(){clearSeries();for(var e=series[0].data,a=0;a<yDotCnt;++a)for(var t=0;t<xDotCnt;++t){var r=mines[a][t];if(r.isOpen){var n=getSeries(r.mineNeighbors).data;n.push([t,a,r.mineNeighbors])}else e.push([t,a])}myChart.setOption({series})}function clearSeries(){for(var e=0;e<series.length;++e)e!==2&&(series[e].data=[])}function getSeries(e){return series[3+e]}function checkWin(){for(var e=!0,a=0;a<xDotCnt&&e;++a)for(var t=0;t<yDotCnt;++t){var r=mines[t][a];if(!r.isMine&&!r.isOpen){console.log(a,t,r),e=!1;break}}if(e){var n=new Date,o=(n-startTime)/1e3;alert("赢啦！用时 "+o+"秒，很不错哦！"),gameOver(null)}}
