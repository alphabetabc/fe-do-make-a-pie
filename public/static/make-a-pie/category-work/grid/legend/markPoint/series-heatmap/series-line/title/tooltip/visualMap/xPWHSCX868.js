const uploadedDataURL="/asset/get/s/data-1635390802457-HRSoVX4EN.json",symbolPass="image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0MjAwNDAzNDA1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI1MDAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMjRDMjI5LjI0OCAxMDI0IDAgNzk0Ljc1MiAwIDUxMlMyMjkuMjQ4IDAgNTEyIDBzNTEyIDIyOS4yNDggNTEyIDUxMi0yMjkuMjQ4IDUxMi01MTIgNTEyeiBtLTExNC4xNzYtMzEwLjk1NDY2N2E1My4zMzMzMzMgNTMuMzMzMzMzIDAgMCAwIDc1LjQzNDY2NyAwbDMyMy4zMjgtMzIzLjMyOGE1My4zMzMzMzMgNTMuMzMzMzMzIDAgMSAwLTc1LjQzNDY2Ny03NS40MzQ2NjZsLTI4Ny45MTQ2NjcgMjgzLjMwNjY2Ni0xMjguODUzMzMzLTEyOC44NTMzMzNhNTMuMzMzMzMzIDUzLjMzMzMzMyAwIDEgMC03NS40MzQ2NjcgNzUuNDM0NjY3bDE2OC44NzQ2NjcgMTY4Ljg3NDY2NnoiIGZpbGw9IiMxYWZhMjkiIHAtaWQ9IjI1MDEiIGRhdGEtc3BtLWFuY2hvci1pZD0iYTMxM3guNzc4MTA2OS4wLmkwIiBjbGFzcz0iIj48L3BhdGg+PC9zdmc+",symbolFail="image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0MjgwMDM2OTY5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwOTkiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDMyQzI1MS40Mjg1NzE1NjI1IDMyIDMyIDI1MS40Mjg1NzE1NjI1IDMyIDUxMnMyMTkuNDI4NTcxNTYyNSA0ODAgNDgwIDQ4MCA0ODAtMjE5LjQyODU3MTU2MjUgNDgwLTQ4MC0yMTkuNDI4NTcxNTYyNS00ODAtNDgwLTQ4MHogbTIwNS43MTQyODUzMTI1IDYxNy4xNDI4NTY4NzVjMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1IDIwLjU3MTQyODQzNzUgNDggMCA2MS43MTQyODYyNDk5OTk5OTQtMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1LTQ4IDIwLjU3MTQyODQzNzUtNjEuNzE0Mjg1MzEyNDk5OTk2IDBsLTEzNy4xNDI4NTY4NzUtMTM3LjE0Mjg1NzgxMjVMMzc0Ljg1NzE0MzEyNSA3MTcuNzE0Mjg1MzEyNWMtMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1LTQ4IDIwLjU3MTQyODQzNzUtNjguNTcxNDI4NDM3NSAwcy0yMC41NzE0Mjg0Mzc1LTU0Ljg1NzE0MzEyNSAwLTY4LjU3MTQyODQzNzVsMTQ0LTE0NC0xMzcuMTQyODU3ODEyNS0xMzcuMTQyODU2ODc1Yy0yMC41NzE0Mjg0Mzc1LTEzLjcxNDI4NTMxMjUwMDAwMS0yMC41NzE0Mjg0Mzc1LTQxLjE0Mjg1Njg3NSAwLTYxLjcxNDI4NTMxMjQ5OTk5NiAyMC41NzE0Mjg0Mzc1LTIwLjU3MTQyODQzNzUgNDgtMjAuNTcxNDI4NDM3NSA2MS43MTQyODYyNDk5OTk5OTQgMGwxMzcuMTQyODU2ODc1IDEzNy4xNDI4NTY4NzUgMTQ0LTE0NGMyMC41NzE0Mjg0Mzc1LTIwLjU3MTQyODQzNzUgNDgtMjAuNTcxNDI4NDM3NSA2OC41NzE0Mjg0Mzc1IDAgMjAuNTcxNDI4NDM3NSAyMC41NzE0Mjg0Mzc1IDIwLjU3MTQyODQzNzUgNDggMCA2OC41NzE0Mjg0Mzc1TDU4MC41NzE0Mjg0Mzc1IDUxMmwxMzcuMTQyODU2ODc1IDEzNy4xNDI4NTY4NzV6IiBmaWxsPSIjZjE1MDQ3IiBwLWlkPSIyMTAwIj48L3BhdGg+PC9zdmc+",colors=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],AQI_LEVELS=[{icon:"k1",label:"优",otherName:"一级",value:1,min:0,max:50,proposal:"空气质量令人满意，基本无空气污染",influence:"各类人群可正常活动",color:"#00E500",lightColor:"#D2F5A5"},{icon:"k2",label:"良",otherName:"二级",value:2,min:51,max:100,proposal:"空气质量可接受，但某些污染物可能对极少数异常敏感人群健康有较弱影响",influence:"极少数异常敏感人群应减少户外活动",color:"#FFFF00",lightColor:"#EBEBD8"},{icon:"k3",label:"轻度",otherName:"三级",value:3,min:101,max:150,proposal:"易感人群症状有轻度加剧，健康人群出现刺激症状",influence:"儿童、老年人及心脏病、呼吸系统疾病患者应减少长时间、高强度的户外锻炼",color:"#FF7E00",lightColor:"#F2E1C7"},{icon:"k4",label:"中度",otherName:"四级",value:4,min:151,max:200,proposal:"进一步加剧易感人群症状，可能对健康人群心脏、呼吸系统有影响",influence:"儿童、老年人及心脏病、呼吸系统疾病患者避免长时间、高强度的户外锻炼，一般人群适量减少户外运动",color:"#FE0000",lightColor:"#F3D3D3"},{icon:"k5",label:"重度",otherName:"五级",value:5,min:201,max:300,proposal:"心脏病和肺病患者症状显著加剧，运动耐受力降低，健康人群普遍出现症状",influence:"儿童、老年人及心脏病、肺病患者应停留在室内，停止户外运动，一般人群减少户外运动",color:"#99004C",lightColor:"#E5D2ED"},{icon:"k6",label:"严重",otherName:"六级",value:6,min:301,max:"+",proposal:"健康人群运动耐受力降低，有明显强烈症状，提前出现某些疾病",influence:"儿童、老年人和病人应停留在室内，避免体力消耗，一般人群避免户外活动",color:"#7E0022",lightColor:"#F3CBD7"}],getLevel=M=>{let e=0;return(!M||M<=50)&&(e=0),M>50&&M<=100&&(e=1),M>100&&M<=150&&(e=2),M>150&&M<=200&&(e=3),M>200&&M<=300&&(e=4),M>300&&(e=5),{index:e,...AQI_LEVELS[e]}},PRIMARY={NA:"无"},getPrimaryLabel=M=>M?PRIMARY[M]?PRIMARY[M]:M:"",colorRange=(M,e)=>({type:"linear",x:-.33,y:.5,colorStops:[{offset:0,color:M},{offset:.5,color:M},{offset:.5,color:e},{offset:1,color:e}],global:!1}),getTrend=(M,e)=>{if(M===null||e===null)return"";const n=getLevel(M),s=getLevel(e);return n.label===s.label?"正确":M<e?"偏高":"偏低"},getSymbol=(M,e)=>M===null||e===null?"":M===e?symbolPass:symbolFail,getTooltipRow=(M,e)=>`
  <div style="display: flex; justify-content: space-between; padding-top: 3px;">
    <span>${M.value[1]?"实况监测":"模式预测"}</span>
    <span style="padding-left: 15px">${M.marker||""}</span>
    <span>${e[M.value[2]]||"-"}</span>
  </div>`,transformData=(M,e,n=!1)=>{const s=[...new Set([...Object.keys(M)])].sort(),D=["模式预测","实况监测"];let z=[],I=[];const l=[],a=[];for(let N=0;N<s.length;N++)for(let t=0;t<D.length;t++){const i=s[N],o=getPrimaryLabel((M[i]||{}).primary)||null,c=getPrimaryLabel((e[i]||{}).primary)||null;if(z.push([N,t,t?o:c]),a.includes(o)||a.push(o),a.includes(c)||a.push(c),t){const y=getSymbol(o,c);l.push({show:Boolean(y),xAxis:N,yAxis:1,symbolSize:20,symbol:y})}}return z=z.map(([N,t,i])=>{const o=a.findIndex(c=>c===i);return[N,t,o]}),n&&(I=a.map((N,t)=>{const i=z.filter(c=>c[2]===t),o=N==="无"?"#EFEFEF":colors[t];return{name:N,data:i,color:o}})),{xAxisData:s,yAxisData:D,seriesData:z,seriesDatas:I,markPointData:l,factors:a}};$.getJSON(uploadedDataURL,M=>{const{history:e,forecast:n}=M;console.log(M);const{xAxisData:s,yAxisData:D,seriesDatas:z,markPointData:I,factors:l}=transformData(e||{},n||{},!0),a={title:{text:"首要污染物准确率评估",left:"center"},grid:{height:80,top:70,left:58,right:10,bottom:50},xAxis:{type:"category",data:s,splitArea:{show:!0},axisLine:{show:!1},axisTick:{show:!1}},yAxis:[{type:"category",data:D,axisLine:{show:!1},axisTick:{show:!1}},{type:"value"}],legend:{show:!0,icon:"circle",bottom:0},tooltip:{position:"top",trigger:"axis",formatter:N=>{if(N.length!==2)return"";const[t,i]=N,o=[],c=(i||{}).axisValue||(t||{}).axisValue;return c&&o.push(c),t.value[1]?(t&&o.push(getTooltipRow(t,l)),i&&o.push(getTooltipRow(i,l))):(i&&o.push(getTooltipRow(i,l)),t&&o.push(getTooltipRow(t,l))),o.join("")}},visualMap:[{show:!1,type:"piecewise",pieces:l.map((N,t)=>({value:t,name:N,color:N==="无"?"#EFEFEF":colors[t]}))}],series:[{type:"line",color:"#41C15A",markPoint:{symbolOffset:[0,-35],data:I}},...z.map(({name:N,data:t,color:i})=>({name:N,data:t,type:"heatmap",label:{show:!0,formatter:o=>o.value.length?l[o.value[2]]:""},itemStyle:{color:i,borderWidth:2,borderColor:"#fff"}}))]};myChart.setOption(a)});
