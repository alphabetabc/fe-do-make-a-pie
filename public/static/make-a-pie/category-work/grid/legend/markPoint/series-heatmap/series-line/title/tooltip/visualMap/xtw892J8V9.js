const uploadedDataURL="/asset/get/s/data-1635390802457-HRSoVX4EN.json",symbolPass="image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0MjAwNDAzNDA1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI1MDAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMjRDMjI5LjI0OCAxMDI0IDAgNzk0Ljc1MiAwIDUxMlMyMjkuMjQ4IDAgNTEyIDBzNTEyIDIyOS4yNDggNTEyIDUxMi0yMjkuMjQ4IDUxMi01MTIgNTEyeiBtLTExNC4xNzYtMzEwLjk1NDY2N2E1My4zMzMzMzMgNTMuMzMzMzMzIDAgMCAwIDc1LjQzNDY2NyAwbDMyMy4zMjgtMzIzLjMyOGE1My4zMzMzMzMgNTMuMzMzMzMzIDAgMSAwLTc1LjQzNDY2Ny03NS40MzQ2NjZsLTI4Ny45MTQ2NjcgMjgzLjMwNjY2Ni0xMjguODUzMzMzLTEyOC44NTMzMzNhNTMuMzMzMzMzIDUzLjMzMzMzMyAwIDEgMC03NS40MzQ2NjcgNzUuNDM0NjY3bDE2OC44NzQ2NjcgMTY4Ljg3NDY2NnoiIGZpbGw9IiMxYWZhMjkiIHAtaWQ9IjI1MDEiIGRhdGEtc3BtLWFuY2hvci1pZD0iYTMxM3guNzc4MTA2OS4wLmkwIiBjbGFzcz0iIj48L3BhdGg+PC9zdmc+",symbolUp="image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0NTI4NTM3NTE4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEyNDQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDIwLjQ4Yy0yNzEuNDI4MjY2NjcgMC00OTEuNTIgMjIwLjA5MTczMzMzLTQ5MS41MiA0OTEuNTJzMjIwLjA5MTczMzMzIDQ5MS41MiA0OTEuNTIgNDkxLjUyIDQ5MS41Mi0yMjAuMDkxNzMzMzMgNDkxLjUyLTQ5MS41Mi0yMjAuMDkxNzMzMzMtNDkxLjUyLTQ5MS41Mi00OTEuNTJ6IG0yMjIuODIyNCA0NDcuODI5MzMzMzNjLTguNzM4MTMzMzMgOC43MzgxMzMzMy0xOS42NjA4IDEyLjU2MTA2NjY3LTMxLjEyOTYgMTIuNTYxMDY2NjctMTAuOTIyNjY2NjcgMC0yMi4zOTE0NjY2Ny00LjM2OTA2NjY3LTMxLjEyOTYtMTIuNTYxMDY2NjdMNTU1LjY5MDY2NjY3IDM1MC44OTA2NjY2N3Y0MjguMTY4NTMzMzNjMCAyNC4wMjk4NjY2Ny0xOS42NjA4IDQzLjY5MDY2NjY3LTQzLjY5MDY2NjY3IDQzLjY5MDY2NjY3cy00My42OTA2NjY2Ny0xOS42NjA4LTQzLjY5MDY2NjY3LTQzLjY5MDY2NjY3VjM1MC44OTA2NjY2N0wzNTAuODkwNjY2NjcgNDY4LjMwOTMzMzMzYy0xNi45MzAxMzMzMyAxNi45MzAxMzMzMy00NC43ODI5MzMzMyAxNi45MzAxMzMzMy02MS43MTMwNjY2NyAwLTE2LjkzMDEzMzMzLTE2LjkzMDEzMzMzLTE2LjkzMDEzMzMzLTQ0Ljc4MjkzMzMzIDAtNjEuNzEzMDY2NjZsMTg3LjMyMzczMzMzLTE4Ni43Nzc2YzcuNjQ1ODY2NjctMTEuNDY4OCAyMC43NTMwNjY2Ny0xOC41Njg1MzMzMyAzNi4wNDQ4LTE4LjU2ODUzMzM0IDE0Ljc0NTYgMCAyNy44NTI4IDcuNjQ1ODY2NjcgMzYuMDQ0OCAxOC41Njg1MzMzNEw3MzUuOTE0NjY2NjcgNDA2LjU5NjI2NjY3YzE2LjM4NCAxNi45MzAxMzMzMyAxNi4zODQgNDQuMjM2OC0xLjA5MjI2NjY3IDYxLjcxMzA2NjY2eiIgZmlsbD0iI0U1REUxRSIgcC1pZD0iMTI0NSI+PC9wYXRoPjwvc3ZnPg==",symbolDown="image://data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM0NTI4NDk3NzE2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMDIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNNTEyIDEwMDMuNTJjMjcxLjQyODI2NjY3IDAgNDkxLjUyLTIyMC4wOTE3MzMzMyA0OTEuNTItNDkxLjUycy0yMjAuMDkxNzMzMzMtNDkxLjUyLTQ5MS41Mi00OTEuNTItNDkxLjUyIDIyMC4wOTE3MzMzMy00OTEuNTIgNDkxLjUyIDIyMC4wOTE3MzMzMyA0OTEuNTIgNDkxLjUyIDQ5MS41MnogbS0yMjIuODIyNC00NDcuODI5MzMzMzNjOC43MzgxMzMzMy04LjczODEzMzMzIDE5LjY2MDgwMDAxLTEyLjU2MTA2NjY3IDMxLjEyOTYtMTIuNTYxMDY2NjcgMTAuOTIyNjY2NjcgMCAyMi4zOTE0NjY2NyA0LjM2OTA2NjY4IDMxLjEyOTYgMTIuNTYxMDY2NjdMNDY4LjMwOTMzMzMzIDY3My4xMDkzMzMzM2wwLTQyOC4xNjg1MzMzM2MwLTI0LjAyOTg2NjY3IDE5LjY2MDgtNDMuNjkwNjY2NjcgNDMuNjkwNjY2NjctNDMuNjkwNjY2NjdzNDMuNjkwNjY2NjcgMTkuNjYwOCA0My42OTA2NjY2NyA0My42OTA2NjY2N0w1NTUuNjkwNjY2NjcgNjczLjEwOTMzMzMzIDY3My4xMDkzMzMzMyA1NTUuNjkwNjY2NjdjMTYuOTMwMTMzMzMtMTYuOTMwMTMzMzMgNDQuNzgyOTMzMzMtMTYuOTMwMTMzMzMgNjEuNzEzMDY2NjcgMCAxNi45MzAxMzMzMyAxNi45MzAxMzMzMyAxNi45MzAxMzMzMyA0NC43ODI5MzMzMyAwIDYxLjcxMzA2NjY2bC0xODcuMzIzNzMzMzMgMTg2Ljc3NzZjLTcuNjQ1ODY2NjcgMTEuNDY4OC0yMC43NTMwNjY2NyAxOC41Njg1MzMzMy0zNi4wNDQ4IDE4LjU2ODUzMzM0LTE0Ljc0NTYgMC0yNy44NTI4LTcuNjQ1ODY2NjctMzYuMDQ0OC0xOC41Njg1MzMzNEwyODguMDg1MzMzMzMgNjE3LjQwMzczMzMzYy0xNi4zODQtMTYuOTMwMTMzMzMtMTYuMzg0LTQ0LjIzNjggMS4wOTIyNjY2Ny02MS43MTMwNjY2NnoiIGZpbGw9IiMzOUE1REQiIHAtaWQ9IjExMDMiPjwvcGF0aD48L3N2Zz4=",AQI_LEVELS=[{icon:"k1",label:"优",otherName:"一级",value:1,min:0,max:50,proposal:"空气质量令人满意，基本无空气污染",influence:"各类人群可正常活动",color:"#00E500",lightColor:"#D2F5A5"},{icon:"k2",label:"良",otherName:"二级",value:2,min:51,max:100,proposal:"空气质量可接受，但某些污染物可能对极少数异常敏感人群健康有较弱影响",influence:"极少数异常敏感人群应减少户外活动",color:"#FFFF00",lightColor:"#EBEBD8"},{icon:"k3",label:"轻度",otherName:"三级",value:3,min:101,max:150,proposal:"易感人群症状有轻度加剧，健康人群出现刺激症状",influence:"儿童、老年人及心脏病、呼吸系统疾病患者应减少长时间、高强度的户外锻炼",color:"#FF7E00",lightColor:"#F2E1C7"},{icon:"k4",label:"中度",otherName:"四级",value:4,min:151,max:200,proposal:"进一步加剧易感人群症状，可能对健康人群心脏、呼吸系统有影响",influence:"儿童、老年人及心脏病、呼吸系统疾病患者避免长时间、高强度的户外锻炼，一般人群适量减少户外运动",color:"#FE0000",lightColor:"#F3D3D3"},{icon:"k5",label:"重度",otherName:"五级",value:5,min:201,max:300,proposal:"心脏病和肺病患者症状显著加剧，运动耐受力降低，健康人群普遍出现症状",influence:"儿童、老年人及心脏病、肺病患者应停留在室内，停止户外运动，一般人群减少户外运动",color:"#99004C",lightColor:"#E5D2ED"},{icon:"k6",label:"严重",otherName:"六级",value:6,min:301,max:"+",proposal:"健康人群运动耐受力降低，有明显强烈症状，提前出现某些疾病",influence:"儿童、老年人和病人应停留在室内，避免体力消耗，一般人群避免户外活动",color:"#7E0022",lightColor:"#F3CBD7"}],getLevel=M=>{let N=0;return(!M||M<=50)&&(N=0),M>50&&M<=100&&(N=1),M>100&&M<=150&&(N=2),M>150&&M<=200&&(N=3),M>200&&M<=300&&(N=4),M>300&&(N=5),{index:N,...AQI_LEVELS[N]}},colorRange=(M,N)=>({type:"linear",x:-.33,y:.5,colorStops:[{offset:0,color:M},{offset:.5,color:M},{offset:.5,color:N},{offset:1,color:N}],global:!1}),getTrend=(M,N)=>{if(M===null||N===null)return"";const o=getLevel(M),c=getLevel(N);return o.label===c.label?"正确":M<N?"偏高":"偏低"},getSymbol=(M,N)=>{const o=getTrend(M,N);return o==="正确"?symbolPass:o==="偏高"?symbolUp:o==="偏低"?symbolDown:""},getTooltipRow=M=>`
  <div style="display: flex; justify-content: space-between; min-width: 80px; padding-top: 3px;">
    <span style="${M.marker?"":"padding-left: 18px"}">${M.marker||""}</span>
    <span>${M.seriesName} ${M.value[2]||"-"}</span>
    <span style="padding-left: 15px">${M.value[1]?"实况监测":"模式预测"}</span>
  </div>`,transformData=(M,N,o=!0)=>{const c=[...new Set([...Object.keys(M)])].sort(),I=["模式预测","实况监测"];let D=[];const y=[],a=[];for(let j=0;j<c.length;j++)for(let z=0;z<I.length;z++){const i=c[j],e=(M[i]||{}).aqi||null,l=(N[i]||{}).aqi||null;if(y.push([j,z,z?e:l]),z){const t=getSymbol(e,l);a.push({show:Boolean(t),xAxis:j,yAxis:1,symbolSize:20,symbol:t})}}return o&&(D=AQI_LEVELS.map(({label:j,min:z,max:i,color:e})=>{const l=y.filter(([,,t])=>i==="+"?t>=z:t>=z&&t<=i);return{name:j,data:l,color:e}})),{xAxisData:c,yAxisData:I,seriesData:y,seriesDatas:D,markPointData:a}};$.getJSON(uploadedDataURL,M=>{const{history:N,forecast:o}=M;console.log(M);const{xAxisData:c,yAxisData:I,seriesDatas:D,markPointData:y}=transformData(N||{},o||{}),a={title:{text:"空气质量等级准确率评估",left:"center"},grid:{height:80,top:70,left:58,right:10,bottom:50},tooltip:{position:"top",trigger:"axis",formatter:j=>{if(j.length!==2)return"";const[z,i]=j,e=[],l=(i||{}).axisValue||(z||{}).axisValue;l&&e.push(l);const t=z.value[1]?getTrend(z.value[2],i.value[2]):getTrend(i.value[2],z.value[2]);return t&&e.push(`&nbsp;&nbsp;&nbsp;&nbsp; ${t}`),z.value[1]?(z&&e.push(getTooltipRow(z)),i&&e.push(getTooltipRow(i))):(i&&e.push(getTooltipRow(i)),z&&e.push(getTooltipRow(z))),e.join("")}},xAxis:{type:"category",data:c,splitArea:{show:!0},axisLine:{show:!1},axisTick:{show:!1}},yAxis:[{type:"category",data:I,axisLine:{show:!1},axisTick:{show:!1}},{type:"value"}],legend:{show:!0,icon:"circle",bottom:0},visualMap:[{show:!1,type:"piecewise",pieces:[...AQI_LEVELS.map(j=>({lt:j.max,gte:j.min,color:j.color})),{value:AQI_LEVELS[0].max,color:colorRange(AQI_LEVELS[0].color,AQI_LEVELS[1].color)},{value:AQI_LEVELS[1].max,color:colorRange(AQI_LEVELS[1].color,AQI_LEVELS[2].color)},{value:AQI_LEVELS[2].max,color:colorRange(AQI_LEVELS[2].color,AQI_LEVELS[3].color)},{value:AQI_LEVELS[3].max,color:colorRange(AQI_LEVELS[3].color,AQI_LEVELS[4].color)}]}],series:[...D.map(({name:j,data:z,color:i})=>({name:j,data:z,type:"heatmap",label:{show:!0},itemStyle:{color:i,borderWidth:5,borderColor:"#fff"}})),{type:"line",color:"#41C15A",markPoint:{symbolOffset:[0,-35],data:y}}]};myChart.setOption(a)});
