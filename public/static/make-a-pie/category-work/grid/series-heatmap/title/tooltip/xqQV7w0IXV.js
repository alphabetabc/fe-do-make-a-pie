conf={sizeX:10,sizeY:10,mines:20},minesLeft=conf.mines,bricksLeft=conf.sizeX*conf.sizeY-conf.mines;var flag=0;function generateMinesData(e,t,i){for(var f=e*t,o=[],r=[],n=[],d=0;d<f;d++)o.push(d);for(var u=0;u<i;u++)r.push(o.splice(Math.floor(Math.random()*o.length),1)[0]);for(var a=0;a<e;a++){n[a]=[];for(var l=0;l<t;l++)n[a].push(10)}for(var s=0;s<r.length;s++)x=Math.floor(r[s]/e),y=r[s]%t,n[x][y]=19,typeof n[x][y+1]<"u"&&n[x][y+1]!=19&&(n[x][y+1]+=1),typeof n[x][y-1]<"u"&&n[x][y-1]!=19&&(n[x][y-1]+=1),typeof n[x+1]<"u"&&(typeof n[x+1][y]<"u"&&n[x+1][y]!=19&&(n[x+1][y]+=1),typeof n[x+1][y+1]<"u"&&n[x+1][y+1]!=19&&(n[x+1][y+1]+=1),typeof n[x+1][y-1]<"u"&&n[x+1][y-1]!=19&&(n[x+1][y-1]+=1)),typeof n[x-1]<"u"&&(typeof n[x-1][y]<"u"&&n[x-1][y]!=19&&(n[x-1][y]+=1),typeof n[x-1][y+1]<"u"&&n[x-1][y+1]!=19&&(n[x-1][y+1]+=1),typeof n[x-1][y-1]<"u"&&n[x-1][y-1]!=19&&(n[x-1][y-1]+=1));return n}function covertData(e){for(var t=[],i=0;i<e.length;i++)for(var f=0;f<e[i].length;f++)t.push([f,i,e[i][f]]);return t}var minesData=generateMinesData(conf.sizeX,conf.sizeY,conf.mines),heatmapData=covertData(minesData);function getOption(e){return option={title:{text:"扫雷游戏",subtext:"剩余雷数："+minesLeft},tooltip:{show:!1},grid:{width:"80%",height:"80%",left:"10px",top:"15%"},xAxis:{show:!1,type:"category",splitArea:{show:!0}},yAxis:{show:!1,type:"category",splitArea:{show:!0}},series:[{id:"btnPanel",type:"heatmap",label:{normal:{show:!0,color:"#000",formatter:function(t){return t.data[2]>=20?"P":t.data[2]>=10||t.data[2]===0?"":t.data[2]===9?"*":t.data[2]}}},itemStyle:{color:function(t){return t.data[2]>=10?"#ddd":"#fff"},borderColor:"#AAA",borderWidth:2},data:e}]},option}myChart.setOption(getOption(heatmapData)),myChart.on("click",function(e){e.seriesId==="btnPanel"&&flag===0&&btnClick(e.data[1],e.data[0])});function btnClick(e,t){if(!(minesData[e][t]>19)){if(minesData[e][t]===19)return flag=1,minesData[e][t]-=10,myChart.setOption({title:{subtext:"游戏结束…"},series:{label:{formatter:function(i){return i.data[2]>=20?"P":i.data[2]===9||i.data[2]===19?"*":i.data[2]>=10||i.data[2]===0?"":i.data[2]}},data:covertData(minesData)}});minesData[e][t]>10?(minesData[e][t]-=10,bricksLeft--,bricksLeft===0?myChart.setOption({title:{subtext:"胜利"},series:{data:covertData(minesData)}}):myChart.setOption({series:{data:covertData(minesData)}})):minesData[e][t]===10&&(autoClick(e,t),bricksLeft===0?myChart.setOption({title:{subtext:"胜利"},series:{data:covertData(minesData)}}):myChart.setOption({series:{data:covertData(minesData)}}))}}function autoClick(e,t){function i(f,o){if(typeof minesData[f]>"u")return!1;if(minesData[f][o]>10&&minesData[f][o]<20)return minesData[f][o]-=10,bricksLeft--,!1;if(minesData[f][o]===10)return!0}minesData[e][t]-=10,bricksLeft--,i(e,t+1)&&autoClick(e,t+1),i(e,t-1)&&autoClick(e,t-1),i(e+1,t)&&autoClick(e+1,t),i(e-1,t)&&autoClick(e-1,t),i(e+1,t+1)&&autoClick(e+1,t+1),i(e+1,t-1)&&autoClick(e+1,t-1),i(e-1,t+1)&&autoClick(e-1,t+1),i(e-1,t-1)&&autoClick(e-1,t-1)}document.oncontextmenu=function(){return!1},myChart.on("contextmenu",function(e){e.seriesId==="btnPanel"&&flag===0&&(minesData[e.data[1]][e.data[0]]>19?(minesData[e.data[1]][e.data[0]]-=10,minesLeft++):minesData[e.data[1]][e.data[0]]>=10&&(minesData[e.data[1]][e.data[0]]+=10,minesLeft--),myChart.setOption({title:{subtext:"剩余雷数："+minesLeft},series:{data:covertData(minesData)}})),console.log(e)});
