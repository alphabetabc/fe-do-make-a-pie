const minLng=120.9337719797137,minLat=30.85610622801201,maxLat=31.452846278953274,maxLng=121.69631352726837,scale=8e3,averageLng=(maxLng-minLng)/50,averageLat=(maxLat-minLat)/50;var UPDATE_DURATION=100;window.AudioContext=window.AudioContext||window.webkitAudioContext;var audioContext=new AudioContext,oReq=new XMLHttpRequest;oReq.open("GET","/asset/get/s/data-1493350085456-S1p6LNlyZ.mp3",!0),oReq.responseType="arraybuffer",oReq.onload=function(d){audioContext.decodeAudioData(oReq.response,initVisualizer)},oReq.send();function initVisualizer(d){inited=!0;var e=audioContext.createBufferSource();e.buffer=d,e.noteOn?e.noteOn(0):e.start(0);var a=audioContext.createAnalyser(),r=audioContext.createGain();a.fftSize=4096,r.gain.value=1,e.connect(r),r.connect(a),a.connect(audioContext.destination);var m=a.frequencyBinCount,p=new Uint8Array(m),w=0;function f(){a.getByteFrequencyData(p);for(var S=[],t=50,i=[],n=0;n<t*t;n++){var v=n%t,h=Math.floor(n/t),s=v-t/2,u=h-t/2,o=Math.atan2(u,s);o<0&&(o=Math.PI*2+o);var M=Math.sqrt(s*s+u*u),b=Math.min(m-1,Math.round(o/Math.PI/2*60+M*60)+100),C=Math.pow(p[b]/100,3);i.push([v,h,Math.max(C,.1)])}let y=[];for(let l=0;l<i.length;l++){let c=i[l],A=c[0],x=c[1],D=c[2],z=minLng+A*averageLng,L=minLat+x*averageLat,g=D*scale;g<2e3||y.push({name:Math.random()*1e4,value:[z,L,g]})}myChart.setOption({series:[{data:y}]}),w+=2,setTimeout(f,UPDATE_DURATION)}f()}option={tooltip:{},visualMap:{show:!1,min:.1*scale,max:4*scale,inRange:{color:["#010103","#2f490c","#b0b70f","#fdff44","#fff"]}},maptalks3D:{urlTemplate:"http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",center:[121.4693,31.12307],zoom:11,pitch:60,environment:"#000",viewControl:{distance:100},postEffect:{enable:!0,FXAA:{enable:!0}},light:{main:{shadow:!0,intensity:10,quality:"high"},ambientCubemap:{texture:"/asset/get/s/data-1530248984324-SyeXJSmM7.hdr",exposure:0,diffuseIntensity:.2}}},series:[{type:"bar3D",silent:!0,shading:"lambert",coordinateSystem:"maptalks3D",data:[],barSize:1,lineStyle:{width:4},animationDurationUpdate:UPDATE_DURATION}]},myChart.setOption(option);var map=myChart.getModel().getComponent("maptalks3D").getMaptalks();console.log(map);
