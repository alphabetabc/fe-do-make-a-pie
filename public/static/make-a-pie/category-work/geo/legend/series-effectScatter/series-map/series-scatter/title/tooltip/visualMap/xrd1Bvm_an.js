var uploadedDataURL="/asset/get/s/data-1551588846073-bEWk1-YFr.json";let left=!1,top=!1,priority="top",config={ecBoxId:"chart-panel",lineColor:"#fff",L1:{time:.3,long:40},L2:{time:.3,long:40},text:{time:.5,text:"",font:"14px Arial",color:"#fff",padding:[10,10],width:120,height:60,lineHeight:24,backgroundColor:"rgba(50, 50, 50, 0.8)"}};myChart.showLoading(),$.getJSON(uploadedDataURL,function(r){echarts.registerMap("jiangxi",r),myChart.hideLoading();var t={济南市:[117.121225,36.66466],菏泽市:[115.480656,35.23375],济宁市:[116.59,35.38],德州市:[116.39,37.45],聊城市:[115.97,36.45],泰安市:[117.13,36.18],临沂市:[118.35,35.05],淄博市:[118.05,36.78],枣庄市:[117.57,34.86],滨州市:[118.03,37.36],潍坊市:[119.1,36.62],东营市:[118.49,37.46],青岛市:[120.3,36.62],烟台市:[120.9,37.32],威海市:[122.1,37.2],日照市:[119.1,35.62],济宁市:[116.7,35.42],莱芜市:[117.7,36.28]},e=[{name:"济南市",value:390},{name:"菏泽市",value:158},{name:"德州市",value:252},{name:"聊城市",value:99},{name:"泰安市",value:189},{name:"临沂市",value:52},{name:"淄博市",value:158},{name:"枣庄市",value:152},{name:"滨州市",value:189},{name:"潍坊市",value:160},{name:"东营市",value:80},{name:"青岛市",value:180},{name:"烟台市",value:190},{name:"威海市",value:290},{name:"日照市",value:190},{name:"济宁市",value:190},{name:"莱芜市",value:290}],s=480,l=9,a=100,o=20,m=function(i){for(var n=[],h=0;h<i.length;h++){var d=t[i[h].name];d&&n.push({name:i[h].name,value:d.concat(i[h].value)})}return n};option={backgroundColor:"#020933",title:{top:20,text:"“会员活跃度” - 山东省",subtext:"",x:"center",textStyle:{color:"#ccc"}},tooltip:{trigger:"item",backgroundColor:"transparent",alwaysShowContent:!0,position(i){return getPosOrSize("pos",i)},formatter(i,n,h){canvasAnimation(i);let d=getPosOrSize("size");return`<canvas id="tCanvas" width="${d.width}" height="${d.height}">123</canvas>`}},legend:{orient:"vertical",y:"bottom",x:"right",data:["pm2.5"],textStyle:{color:"#fff"}},visualMap:{show:!1,min:0,max:500,left:"left",top:"bottom",text:["高","低"],calculable:!0,seriesIndex:[1],inRange:{}},geo:{show:!0,map:"jiangxi",label:{normal:{show:!1},emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"transparent",borderColor:"#3fdaff",borderWidth:2,shadowColor:"rgba(63, 218, 255, 0.5)",shadowBlur:30},emphasis:{areaColor:"#2B91B7"}}},series:[{name:"light",type:"scatter",coordinateSystem:"geo",data:m(e),symbolSize:function(i){return i[2]/10},label:{normal:{formatter:"{b}",position:"right",show:!0},emphasis:{show:!0}},itemStyle:{normal:{color:"#F4E925"}}},{type:"map",map:"jiangxi",geoIndex:0,aspectScale:.75,showLegendSymbol:!1,label:{normal:{show:!1},emphasis:{show:!1,textStyle:{color:"#fff"}}},roam:!0,itemStyle:{normal:{areaColor:"#031525",borderColor:"#FFFFFF"},emphasis:{areaColor:"#2B91B7"}},animation:!1,data:e},{name:"Top 5",type:"effectScatter",coordinateSystem:"geo",data:m(e.sort(function(i,n){return n.value-i.value}).slice(0,5)),symbolSize:function(i){return i[2]/10},showEffectOn:"render",rippleEffect:{brushType:"stroke"},hoverAnimation:!0,label:{normal:{formatter:"{b}",position:"right",show:!0}},itemStyle:{normal:{color:"#F4E925",shadowBlur:10,shadowColor:"#05C3F9"}},zlevel:1}]},myChart.setOption(option)});const canvasAnimation=r=>{setTimeout(function(){console.log(r),config.text.text=`地点：${r.name}
数量：${r.value[2]}`,new myTooltip("tCanvas",config)},0)},getPosOrSize=(r,t)=>{let e=config.L1.long*Math.sin(Math.PI/4),s=e+config.L2.long+config.text.width,l=e+config.text.height/2;if(r==="size")return config.width=s,config.height=l,{width:s,height:l};{let a=document.getElementById(config.ecBoxId),o=a.offsetWidth,m=a.offsetHeight,i=t[0],n=t[1];return left=!1,i+s>=o-30&&(i=i-s-15,left=!0),priority==="top"?(top=!0,n=n-l-15,n<=0&&(n=t[1],top=!1),[i,n]):(top=!1,n+l>=m&&(n=n-l-15,top=!0),[i,n])}};class myTooltip{constructor(t,e){this.config=e,this.totalTime=0,this.stage=new createjs.Stage(t),this.timeline=new TimelineMax({repeat:0}),this.g=new createjs.Graphics,this.lineShape=new createjs.Shape(this.g),this.textShape=new createjs.Shape,this.stage.addChild(this.lineShape,this.textShape),this.init(),this.begin(),this.update()}init(){this.start=[0,0],left&&(this.start[0]=this.config.width),top&&(this.start[1]=this.config.height)}begin(){this.L1(),this.L2(),this.addText()}L1(){let t=this,e=t.config,s=new TimelineMax,l={s:0},a=e.L1.long*Math.sin(Math.PI/4);left?top?this.L1End=[t.start[0]-a,t.start[1]-a]:this.L1End=[t.start[0]-a,t.start[1]+a]:top?this.L1End=[a,t.start[1]-a]:this.L1End=[a,a],s.to(l,e.L1.time,{s:1,onUpdate(){let o=l.s;left?top?t.g.c().s(e.lineColor).mt(...t.start).lt(t.start[0]-a*o,t.start[1]-a*o):t.g.c().s(e.lineColor).mt(...t.start).lt(t.start[0]-a*o,t.start[1]+a*o):top?t.g.c().s(e.lineColor).mt(...t.start).lt(a*o,t.start[1]-a*o):t.g.c().s(e.lineColor).mt(...t.start).lt(a*o,a*o),t.update()}}),this.timeline.add(s,this.totalTime),this.totalTime+=e.L1.time}L2(){let t=this,e=t.config,s=new TimelineMax,l={s:0};s.to(l,e.L2.time,{s:1,onUpdate(){let a=l.s;left?t.g.c().s(e.lineColor).mt(...t.start).lt(...t.L1End).lt(t.L1End[0]-e.L2.long*a,t.L1End[1]):t.g.c().s(e.lineColor).mt(...t.start).lt(...t.L1End).lt(t.L1End[0]+e.L2.long*a,t.L1End[1]),t.update()}}),this.timeline.add(s,this.totalTime),this.totalTime+=e.L2.time}addText(){let t=this,e=t.config,s=new TimelineMax,l={s:0},a=[t.L1End[0]+e.L2.long,t.L1End[1]];left&&(a=[t.L1End[0]-e.L2.long,t.L1End[1]]),s.to(l,e.text.time,{s:1,onStart(){let o=0,m=0;left?o=a[0]-e.text.width:o=a[0],t.g.c().s(e.lineColor).mt(...t.start).lt(...t.L1End).lt(...a),t.text=new createjs.Text(e.text.text,e.text.font,e.text.color),t.text.alpha=0,t.text.lineHeight=e.text.lineHeight,t.text.x=o+e.text.padding[0],t.text.y=a[1]-e.text.height/2+e.text.padding[1],t.stage.addChild(t.text),t.textShape.graphics.c().f(e.text.backgroundColor).rr(o,a[1]-e.text.height/2,e.text.width,e.text.height,5),t.textShape.alpha=0,t.update()},onUpdate(){t.text.alpha=l.s,t.textShape.alpha=l.s,t.update()}}),this.timeline.add(s,this.totalTime)}update(){this.stage.update()}}let EC=myChart;var index=0;setInterval(r=>{EC.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:index}),index++,index>=data.length&&(index=0)},3e3),window.addEventListener("resize",r=>{let t=document.getElementById("tCanvas");t&&(t.style.display="none")});
