$('<div class="back">返 回</div>').appendTo($("#chart-panel")),$(".back").css({position:"absolute",left:"25px",top:"25px",color:"rgb(179, 239, 255)","font-size":"16px",cursor:"pointer","z-index":"100"}),$(".back").click(function(){parentInfo.length!==1&&(parentInfo.pop(),getGeoJson(parentInfo[parentInfo.length-1].code))});var geoJson={features:[]},parentInfo=[{cityName:"全国",level:"china",code:1e5}],timeTitle=["2016"];getGeoJson(1e5);function getGeoJson(a){AMapUI.loadUI(["geo/DistrictExplorer"],o=>{var n=new o;n.loadAreaNode(a,function(r,e){if(r){console.error(r);return}let t=e.getSubFeatures();if(t.length>0)geoJson.features=t;else if(t.length===0&&(geoJson.features=geoJson.features.filter(i=>i.properties.adcode==a),geoJson.features.length===0))return;getMapData()})})}function getMapData(){let a={},o={},n={};for(let r=0;r<timeTitle.length;r++){a[timeTitle[r]]=[],o[timeTitle[r]]=[],n[timeTitle[r]]=0;for(let e=0;e<geoJson.features.length;e++){let t=Math.random()*3e3;a[timeTitle[r]].push({name:geoJson.features[e].properties.name,value:t,level:geoJson.features[e].properties.level,cityCode:geoJson.features[e].properties.adcode}),o[timeTitle[r]].push({name:geoJson.features[e].properties.name,value:[geoJson.features[e].properties.center[0],geoJson.features[e].properties.center[1],t],cityCode:geoJson.features[e].properties.adcode}),n[timeTitle[r]]+=t}a[timeTitle[r]]=a[timeTitle[r]].sort(function(e,t){return t.value-e.value})}initEchartMap(a,n,o)}function initEchartMap(a,o,n){parentInfo.length===1?echarts.registerMap("china",geoJson):echarts.registerMap("map",geoJson);var r={timeline:{},baseOption:{animation:!0,animationDuration:1e3,animationEasing:"cubicInOut",animationDurationUpdate:1e3,animationEasingUpdate:"cubicInOut",tooltip:{trigger:"item"},toolbox:{feature:{restore:{show:!1},dataView:{optionToContent:function(e){let t=e.series[0].data,i='<th  style="padding: 0 20px">所在地区</th><th style="padding: 0 20px">销售额</th>',s="",l=`<table border="1" style="margin-left:20px;border-collapse:collapse;font-size:14px;text-align:left;"><tbody><tr>${i} </tr>`;for(let c=0;c<t.length;c++)l+=`<tr>
                              <td style="padding: 0 50px">${t[c].name}</td>
                              <td style="padding: 0 50px">${t[c].value.toFixed(2)}万</td>
                              </tr>`;return l+="</tbody></table>",l}},saveAsImage:{name:parentInfo[parentInfo.length-1].cityName+"销售额统计图"},dataZoom:{show:!1},magicType:{show:!1}},iconStyle:{normal:{borderColor:"#1990DA"}},top:15,right:35},geo:{map:parentInfo.length===1?"china":"map",zoom:1.1,roam:!0,tooltip:{trigger:"item",formatter:e=>{let t=e.value[2];return window.isNaN(t)&&(t=0),"<div style='text-align:left'>"+e.name+":<br />销售额："+t.toFixed(2)+"万</div>"}},label:{normal:{show:!0,color:"rgb(249, 249, 249)",formatter:e=>{switch(e.name){case"内蒙古自治区":e.name="内蒙古";break;case"西藏自治区":e.name="西藏";break;case"新疆维吾尔自治区":e.name="新疆";break;case"宁夏回族自治区":e.name="宁夏";break;case"广西壮族自治区":e.name="广西";break;case"香港特别行政区":e.name="香港";break;case"澳门特别行政区":e.name="澳门";break;default:break}return e.name}},emphasis:{show:!0,color:"#f75a00"}},itemStyle:{normal:{areaColor:"#24CFF4",borderColor:"#53D9FF",borderWidth:1.3,shadowBlur:15,shadowColor:"rgb(58,115,192)",shadowOffsetX:7,shadowOffsetY:6},emphasis:{areaColor:"#8dd7fc",borderWidth:1.6,shadowBlur:25}}}},options:[]};timeTitle.forEach(e=>{var t=a[e][a[e].length-1].value,i=a[e][0].value;a[e].length===1&&(t=0),r.options.push({backgroundColor:"#012248",title:[{left:"center",top:10,text:e+"年"+parentInfo[parentInfo.length-1].cityName+"销售额统计图(可点击)",textStyle:{color:"rgb(179, 239, 255)",fontSize:16}},{text:"年度销售总额："+o[e].toFixed(2)+"万",left:"center",top:"6.5%",textStyle:{color:"#FFAC50",fontSize:26}}],visualMap:{min:t,max:i,left:"3%",bottom:"5%",calculable:!0,seriesIndex:[0],inRange:{color:["#24CFF4","#2E98CA","#1E62AC"]},textStyle:{color:"#24CFF4"}},series:[{name:e+"销售额度",type:"map",geoIndex:0,map:parentInfo.length===1?"china":"map",roam:!0,zoom:1.3,tooltip:{trigger:"item",formatter:s=>{let l=s.value;return s.name=="南海诸岛"?void 0:(window.isNaN(l)&&(l=0),"<div style='text-align:left'>"+s.name+":<br />销售额："+l.toFixed(2)+"万</div>")}},label:{normal:{show:!1},emphasis:{show:!1}},data:a[e]},{name:"散点",type:"effectScatter",coordinateSystem:"geo",rippleEffect:{brushType:"fill"},itemStyle:{normal:{color:"#F4E925",shadowBlur:10,shadowColor:"#333"}},data:n[e],symbolSize:function(s){return s[2]==i?11:10},showEffectOn:"render"}]})}),myChart.setOption(r,!0),myChart.off("click"),myChart.on("click",echartsMapClick)}function echartsMapClick(a){if(a.data){if(parentInfo[parentInfo.length-1].code==a.data.cityCode)return;let o=a.data;parentInfo.push({cityName:o.name,level:o.level,code:o.cityCode}),getGeoJson(o.cityCode)}else return}
