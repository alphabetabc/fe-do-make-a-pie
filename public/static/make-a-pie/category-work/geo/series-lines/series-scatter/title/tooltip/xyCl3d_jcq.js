let tableId=1;const data=[[{tableId:2,tableName:"我是祖先表AAAAAAAAAA"},{tableId:3,tableName:"我是祖先表B"}],[{tableId:4,parentId:[2],tableName:"我是父亲表A"},{tableId:5,parentId:[2,3,22],tableName:"我是父亲表BAAAAAA"},{tableId:6,parentId:[3],tableName:"我是父亲表C"},{tableId:7,parentId:[3],tableName:"我是父亲表D"}],[{parentId:[4,5,6,7],tableId:1,tableName:"我是被选中的表"}],[{tableId:8,parentId:[1],tableName:"我是子表AAAAA"},{tableId:9,parentId:[1],tableName:"我是子表B"}],[{tableId:10,parentId:[8,1],tableName:"我是孙子表A"},{tableId:11,parentId:[8,9],tableName:"我是孙子表B"},{tableId:12,parentId:[8,9],tableName:"我是孙子表CCCCC"},{tableId:13,parentId:[9],tableName:"我是孙子表D"}]];let gleft=150,gtop=100,allTable=[],allLine=[],lengthKey=[],lengthKeyList=[];for(let e=0;e<data.length;e++)lengthKeyList[e]=data[e].map(t=>t.tableName.length*15),lengthKey[e]=data[e].map(t=>t.tableName).join("").length*25;function getW(e,t,a){let o=0,r=t/2,n=Math.floor(t/2);if(a<r){for(let l=a;l<n;l++)l===a?o+=e[l]/2:o+=e[l];o=-o}else if(a>=r)for(let l=n;l<a+1;l++)l===a?o+=e[l]/2:o+=e[l];return o}const maxLengthMid=Math.max(...lengthKey)/2;console.log(maxLengthMid);for(let e=0;e<data.length;e++){let t=data[e],a=lengthKeyList[e];if(t){let o=t.length,r=o/2,n=0,l=0,s=gleft;for(let b=0;b<t.length;b++){let m=t[b],d=m.tableName.length*12;b<r?n--:b>=r&&l++;let i=getW(a,o,b);i<0?i+=n*5:i>0&&(i+=l*5),allTable.push({id:m.tableId,level:e,name:m.tableName,tableName:m.tableName,data:m,parentId:m.parentId,value:[maxLengthMid+i,gtop+e*100],symbol:"rect",symbolSize:[d,25],itemStyle:{normal:{color:m.tableId===tableId?"red":"#337ab7"}}})}}}console.log(allTable);for(let e=0;e<allTable.length;e++){let t=allTable[e],a=[];t.parentId&&t.parentId.forEach(o=>{let r=allTable.find(n=>n.id==o);r&&a.push({fromName:r.tableName,toName:t.tableName,coords:[r.value,t.value]})}),allLine=allLine.concat(a)}console.log(allLine);const temp={id:"",name:"数据表A",value:[gleft+0,gtop+0],symbol:"rect",symbolSize:[80,25],itemStyle:{normal:{color:"#337ab7"}}},line={fromName:"数据表A",toName:"数据表AA",coords:[[112,215],[232,215]]};option={title:{text:"数据库表血缘图"},tooltip:{trigger:"item",show:!0,formatter:function(e,t,a){if(e.componentSubType==="scatter")return e.name+"的表信息，巴拉巴拉~~";if(e.componentSubType==="lines")return"从"+e.data.fromName+"到"+e.data.toName}},geo:{map:"北京市",label:{emphasis:{show:!1}},roam:!0,itemStyle:{normal:{areaColor:"#323c48",borderColor:"#404a59"},emphasis:{areaColor:"#2a333d"}}},series:[{name:"数据库表",type:"scatter",coordinateSystem:"geo",zlevel:2,rippleEffect:{brushType:"stroke",period:7,scale:26},label:{normal:{show:!0,formatter:"{b}",color:"#000"},emphasis:{show:!0,formatter:"{b}"}},symbolSize:2,showEffectOn:"render",itemStyle:{normal:{color:"#46bee9"}},data:allTable},{name:"线路",type:"lines",coordinateSystem:"geo",zlevel:2,large:!0,effect:{show:!0,constantSpeed:30,symbol:"arrow",symbolSize:6,trailLength:0},lineStyle:{normal:{color:"green",width:2,opacity:.6,curveness:0}},data:allLine}]};const clickFun=e=>{console.log(e.event.target),e.event.target.style.textFill="blue"};myChart.on("click",clickFun);
