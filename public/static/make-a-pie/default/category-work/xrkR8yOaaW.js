var districts={曲靖:{lat:25.5,lng:103.8},玉溪:{lat:24.35,lng:102.55},保山:{lat:25.12,lng:99.17},丽江:{lat:26.88,lng:100.23},普洱:{lat:22.79,lng:100.98},临沧:{lat:23.88,lng:100.08},大理:{lat:25.6,lng:100.23},红河:{lat:23.37,lng:103.4},版纳:{lat:22.02,lng:100.8},楚雄:{lat:25.03,lng:101.55},德宏:{lat:24.43,lng:98.58},怒江:{lat:25.85,lng:98.85},迪庆:{lat:27.83,lng:99.7},文山:{lat:23.37,lng:104.25},昭通:{lat:27.33,lng:103.72},乐山:{lat:29.57,lng:103.77},甘孜:{lat:30.05,lng:101.97},阿坝:{lat:31.9,lng:102.22},凉山:{lat:27.9,lng:102.27}},allData={白族:{district_count:[{district:"曲靖",count:5572},{district:"玉溪",count:11822},{district:"保山",count:45890},{district:"临沧",count:30904},{district:"大理",count:1112e3},{district:"楚雄",count:16474},{district:"怒江",count:139164},{district:"文山",count:9130}]},哈尼族:{district_count:[{district:"曲靖",count:2114},{district:"玉溪",count:130279},{district:"普洱",count:45466},{district:"红河",count:789700},{district:"版纳",count:215434},{district:"楚雄",count:6176}]},景颇族:{district_count:[{district:"德宏",count:134373}]},拉祜族:{district_count:[{district:"玉溪",count:7027},{district:"普洱",count:393037},{district:"临沧",count:84818},{district:"大理",count:1e3},{district:"红河",count:11400},{district:"版纳",count:61504}]},傈僳族:{district_count:[{district:"玉溪",count:556},{district:"保山",count:34423},{district:"丽江",count:115730},{district:"临沧",count:84818},{district:"大理",count:34e3},{district:"楚雄",count:53114},{district:"德宏",count:31430},{district:"怒江",count:257620},{district:"迪庆",count:106910}]},纳西族:{district_count:[{district:"丽江",count:240580},{district:"大理",count:5e3},{district:"迪庆",count:46402}]},羌族:{district_count:[{district:"阿坝",count:157959}]},彝族:{district_count:[{district:"曲靖",count:226733},{district:"玉溪",count:446764},{district:"保山",count:81524},{district:"丽江",count:246282},{district:"普洱",count:451052},{district:"临沧",count:355266},{district:"大理",count:45e4},{district:"红河",count:1043300},{district:"版纳",count:66731},{district:"楚雄",count:716627},{district:"怒江",count:11578},{district:"迪庆",count:716627},{district:"文山",count:351318},{district:"昭通",count:161302},{district:"乐山",count:153092},{district:"凉山",count:2226755}]},藏族:{district_count:[{district:"大理",count:1e3},{district:"迪庆",count:129496},{district:"甘孜",count:854860},{district:"阿坝",count:48982}]}},option={bmap:{center:[101.722423,26.587571],zoom:7,roam:!0,enableMapClick:!1,mapStyle:{styleJson:[{featureType:"all",elementType:"all",stylers:{lightness:61,saturation:-70}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}}]}},legend:{show:!1,orient:"vertical",right:20,top:15,padding:10,backgroundColor:"rgba(255,255,255,0.8)",data:[]},series:[{type:"pie",data:[]}]};myChart.setOption(option),myChart.on("legendselectchanged",function(n){console.log(n.name);for(var t in districtChart)districtChart[t].dispatchAction({type:"legendToggleSelect",name:n.name})}),setTimeout(init,0);function init(){initMap(),initPieDistrict(myChart,getMap()),showPie(["白族","哈尼族","景颇族","拉祜族","傈僳族","纳西族","羌族","彝族","藏族"])}function initMap(){var n=new BMap.NavigationControl({}),t=getMap();return t.addControl(n),t.disableDoubleClickZoom(),t.removeEventListener("click"),t}function getMap(){return myChart.getModel().getComponent("bmap").getBMap()}var districtPoint=districts,districtChart={},districtLabels=[],parentChart=null,initPieDistrict=function(n,t){parentChart=n;var o=0;for(var i in districtPoint){var c=i,r=districtPoint[i],e="districtPoint"+o++;districtLabels.push(c),districtChart[c]=initPieMarker(t,e,c,r)}};function initPieMarker(n,t,o,i){var c='<div id="'+t+'" style="width:100px;height:100px;"></div>',r=new BMap.Point(i.lng,i.lat),e=new BMapLib.RichMarker(c,r,{anchor:new BMap.Size(-30,-30),barkground:"transparent"});n.addOverlay(e),document.getElementById(t).parentNode.style.backgroundColor="transparent",document.getElementById(t).parentNode.style.zIndex="1";var a=echarts.init(document.getElementById(t),"macarons"),l={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},title:{left:"center",top:"center",textStyle:{fontSize:14,fontWeight:"bold"}},series:[{name:o,type:"pie",avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center",formatter:"{a}"}},radius:["25","40"],data:[]}]};return a.setOption(l),a}function showPie(n){let t={};console.log(n.length,"len"),districtLabels.forEach(o=>{t[o]={},n.forEach(i=>{console.log(i,"xxx"),t[o][i]=0})}),console.log(t,"AA");for(let o in allData)allData[o].district_count.forEach(i=>{t[i.district][o]===0&&(t[i.district][o]=i.count)});console.log(t),setData(t,n)}var placeHolderStyle={normal:{color:"rgba(255,255,255,0.8)",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"rgba(0,0,0,0)"}};function setData(n,t){districtLabels.forEach(i=>{var c=0,r=n[i],e=[];for(let a in r)e.push({name:a,value:r[a]}),c+=r[a];console.log(e),c===0&&(e=[]),districtChart[i].setOption({title:{show:c>0,text:i},legend:{show:!1,data:t},series:[{data:e},{tooltip:{show:!1},type:"pie",radius:[0,25],data:[{value:0,itemStyle:placeHolderStyle}]}]})});let o=t.map(i=>({name:i}));parentChart.setOption({legend:{show:t.length>0,data:t},series:[{data:o}]})}
