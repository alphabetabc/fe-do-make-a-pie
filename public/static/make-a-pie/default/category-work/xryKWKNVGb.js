var uploadedDataURL="/asset/get/s/data-1497613978134-ByGiUH-m-.json",t_pos={left:0,top:0},last_point=[0,0],counter=0;myChart.showLoading();var planePath="path://M268.601,18.375c0,0,14.496,0,18.005,0 		c31.325,0,59.155,0,59.155,0c6.701,0,12.14,5.238,12.14,11.695v17.872c-24.507,0-44.374,19.859-44.374,44.351 		c0,24.492,19.86,44.351,44.374,44.351V335.99c-24.507,0.006-44.374,19.857-44.374,44.357c0,24.484,19.86,44.344,44.374,44.352 		v25.26c0,6.457-5.431,11.695-12.14,11.695H200.158c-12.013,0-19.527-7.781-19.527-19.084c0,0,0-351.215,0-365.378 		s18.736-42.622,44.1-53.734C238.303,17.658,268.601,18.375,268.601,18.375z M202.818,387.729v39.918 		c0,6.531,5.29,11.828,11.821,11.828h35.426c6.531,0,11.814-5.297,11.814-11.828v-39.918H202.818z M202.818,321.199v51.746h59.053 		v-51.746H202.818z M202.818,254.904v51.518h59.053v-51.518H202.818z M202.818,188.413v51.517h59.053v-51.517H202.818z 		 M202.818,121.882v51.746h59.053v-51.746H202.818z M289.658,121.904c-3.037,0-5.497,3.311-5.497,7.396 		c0,4.086,2.46,7.389,5.497,7.389h10.978c3.037,0,5.497-3.303,5.497-7.389c0-4.085-2.46-7.396-5.497-7.396H289.658z M237.38,43.472 		c-20.229,4.766-34.562,30.897-34.562,38.145c0,17.754,0,25.475,0,25.475h59.053l0.03-66.094 		C261.901,40.998,253.641,39.653,237.38,43.472z M328.326,380.348c0-16.328,13.247-29.568,29.59-29.568 		c16.335,0,29.582,13.24,29.582,29.568c0,16.334-13.247,29.566-29.582,29.566C341.573,409.914,328.326,396.682,328.326,380.348z 		 M328.326,92.286c0-16.328,13.247-29.567,29.59-29.567c16.335,0,29.582,13.239,29.582,29.567c0,16.335-13.247,29.574-29.582,29.574 		C341.573,121.86,328.326,108.621,328.326,92.286z  ";if(myChart.setOption(option={title:[{text:"公交线路可视化",subtext:"点击右侧柱状图可对应到站点",left:10,top:10,textStyle:{color:"rgba(18,89,147,1)",fontSize:40}},{right:170,text:"公交站点上车人数",subtext:"",textStyle:{color:"#fff",fontSize:15}},{right:170,top:"53%",text:"公交上车客流时变",subtext:"",textStyle:{color:"#fff",fontSize:15}}],grid:[{right:150,height:"44%",width:"300px"},{right:50,width:"380px",bottom:"3%",top:"58%"},{show:!0,left:null,right:0,height:"100%",width:"480px",bottom:"0%",backgroundColor:"rgba(18,89,147,0.8)"},{show:!0,left:0,top:0,height:"80px",width:"320px",bottom:"0%",backgroundColor:"rgba(255,255,255,0.8)",zlevel:-1}],tooltip:{trigger:"item",transitionDuration:0,position:function(t,i,a,r,e){var o=20,n=30,l=30;if(Math.abs(t[0]-last_point[0])<o&&Math.abs(t[1]-last_point[1])<o&&counter>=2)return t_pos;if((Math.abs(t[0]-last_point[0])>=o||Math.abs(t[1]-last_point[1])>=o)&&(counter=0),counter+=1,counter==1&&(t_pos.left=t[0]+n,t_pos.top=t[1]+l,last_point=[t[0],t[1]]),counter==2){var s=$(a).position().left,f=$(a).position().top;t_pos.left+=t[0]-s+n,t_pos.top+=t[1]-f+l}return t_pos}},animation:!1,bmap:{center:[114.050032,22.543052],zoom:13,roam:!0},dataZoom:[{type:"slider",yAxisIndex:0,start:0,end:30,filterMode:"empty",textStyle:{color:"#fff"},borderColor:"#fff",handleIcon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"80%",handleStyle:{color:"#fff",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}},{type:"inside",yAxisIndex:0,start:0,end:30,filterMode:"empty"}],visualMap:{type:"continuous",top:"65%",text:["High","Low"],min:0,calculable:!1,inRange:{color:["lightblue","yellow","#FF8000"]},textStyle:{color:"#000",formatter:"aaaa{value}bbbb{value2}"}},xAxis:[{type:"value",scale:!0,position:"top",boundaryGap:!1,splitLine:{show:!1},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{margin:2,textStyle:{color:"#fff"}}},{gridIndex:1,min:0,max:24,name:"时间",axisLine:{lineStyle:{color:"#fff"}},axisLabel:{margin:2,textStyle:{color:"#fff"}}}],yAxis:[{type:"category",nameGap:16,axisLine:{show:!0,lineStyle:{color:"#fff"}},axisTick:{show:!1,lineStyle:{color:"#fff"}},axisLabel:{show:!1,interval:0,textStyle:{color:"#fff"}},data:[]},{gridIndex:1,min:0,name:"客流",axisLine:{lineStyle:{color:"#fff"}},axisLabel:{margin:2,textStyle:{color:"#fff"}}}],series:[{id:"scatter",zlevel:-2,type:"scatter",coordinateSystem:"bmap",symbolSize:8,tooltip:{trigger:"item",formatter:function(t){return t.name+" : "+t.value[2]},position:"left"},tooltip:{trigger:"item",formatter:function(t){return t.name+"上车人数:"+t.data.value[2]+"人次"}},label:{normal:{show:!1},emphasis:{show:!1}}},{type:"lines",effect:{show:!0,period:20,trailLength:0,symbol:planePath,symbolSize:15},coordinateSystem:"bmap",polyline:!0,zlevel:-2,lineStyle:{normal:{color:"rgba(18,89,147, 1)",opacity:.8,width:5,shadowColor:"rgba(0, 0, 0, 0.9)",shadowBlur:10}},progressiveThreshold:500,progressive:200},{id:"bar",zlevel:2,type:"bar",symbol:"none",itemStyle:{normal:{color:"#ddb926"}},label:{normal:{show:!0,position:"right",formatter:function(t){return t.data[0]+":"+t.data[1]+"人次"}}},xAxisIndex:0,yAxisIndex:0,data:[],encode:{x:[1]},tooltip:{trigger:"item",formatter:function(t){return t.name+"上车人数:"+t.data+"人次"}}},{id:"line2",zlevel:2,type:"line",itemStyle:{normal:{color:"#ddb926"}},xAxisIndex:1,yAxisIndex:1,data:[],tooltip:{trigger:"item",formatter:function(t){return t.data[0]+"时客流量"+t.data[1]+"人次"}}}]}),!app.inNode){var bmap=myChart.getModel().getComponent("bmap").getBMap();bmap.addControl(new BMap.MapTypeControl)}option&&typeof option=="object"&&myChart.setOption(option,!0),$.getJSON(uploadedDataURL,function(t){for(var i=[],a=[],r=0;r<t[0].length;r+=1)i.push(t[0][r].name),a.push([t[0][r].name,t[0][r].value[2]]);myChart.hideLoading(),myChart.setOption({yAxis:{data:i},visualMap:{max:t[1]},series:[{data:t[0],symbolSize:function(e){return Math.max(30*e[2]/t[1],10)}},{data:[{coords:t[2]}]},{data:a},{data:t[3]}]}),myChart.on("mouseover",function(e){e.seriesId=="bar"&&myChart.setOption({visualMap:{seriesIndex:[0,1,2,3,4]},series:[{},{},{},{},{type:"effectScatter",coordinateSystem:"bmap",symbolSize:function(o){return Math.max(30*o[2]/t[1],10)},data:[t[0][e.dataIndex]],showEffectOn:"render",label:{normal:{show:!0,position:"right",textStyle:{fontSize:15,fontWeight:"bolder",color:"rgba(18,89,127, 1)"},formatter:function(o){return t[0][e.dataIndex].name}},emphasis:{show:!0,position:"top",textStyle:{fontSize:25,fontWeight:"bold",color:"rgba(18,89,147, 1)"},formatter:function(o){return t[0][e.dataIndex].name}}}}]})}),myChart.on("click",function(e){e.seriesIndex==0|e.seriesIndex==2&&myChart.setOption({bmap:{center:t[0][e.dataIndex].value,zoom:16},visualMap:{seriesIndex:[0,1,2,3,4]},series:[{},{},{},{},{type:"effectScatter",coordinateSystem:"bmap",symbolSize:function(o){return Math.max(30*o[2]/t[1],10)},data:[t[0][e.dataIndex]],showEffectOn:"render",label:{normal:{show:!0,position:"top",textStyle:{fontSize:25,fontWeight:"bold",color:"rgba(18,89,147, 1)"},formatter:function(o){return t[0][e.dataIndex].name}},emphasis:{show:!0,position:"top",textStyle:{fontSize:25,fontWeight:"bold",color:"rgba(18,89,147, 1)"},formatter:function(o){return t[0][e.dataIndex].name}}}}]})})});
